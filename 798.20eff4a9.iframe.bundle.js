/*! For license information please see 798.20eff4a9.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[798],{"./src/react-extension/components/Administration/DisplayScimSettingsAdministration/DisplayScimSettingsAdministration.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>DisplayScimSettingsAdministration_DisplayScimSettingsAdministration});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),AdministrationWorkspaceContext=__webpack_require__("./src/react-extension/contexts/AdministrationWorkspaceContext.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),memoize_one_esm=__webpack_require__("./node_modules/memoize-one/dist/memoize-one.esm.js"),NotifyError=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),scimSettingsEntity=__webpack_require__("./src/shared/models/entity/scimSettings/scimSettingsEntity.js"),v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");class ScimSettingsFormEntity extends scimSettingsEntity.A{static getSchema(){return{type:"object",required:["scim_user_id","setting_id"],properties:{...scimSettingsEntity.A.getSchema().properties}}}static createFromDefault(userId){return new ScimSettingsFormEntity({scim_user_id:userId,setting_id:(0,v4.A)(),secret_token:this.generateScimSecretToken()})}}const scimSettingsFormEntity=ScimSettingsFormEntity;var ActionFeedbackContext=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),DialogContext=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js");const scimSettingsServiceWorkerService=class ScimSettingsServiceWorkerService{constructor(port){this.port=port}async findSettings(){const settingsDto=await this.port.request("passbolt.scim.find-settings");return settingsDto?new scimSettingsEntity.A(settingsDto):null}async createSettings(formSettings){if(!(formSettings instanceof scimSettingsEntity.A))throw new TypeError("The 'settings' property should be of type 'ScimSettingsEntity'.");const savedSettingsDto=await this.port.request("passbolt.scim.create-settings",formSettings.toDto());return new scimSettingsEntity.A(savedSettingsDto)}async updateSettings(formSettings,id){if(!(formSettings instanceof scimSettingsEntity.A))throw new TypeError("The 'settings' property should be of type 'ScimSettingsEntity'.");const updated=formSettings.toDto(),savedSettingsDto=await this.port.request("passbolt.scim.update-settings",id,updated);return new scimSettingsEntity.A(savedSettingsDto)}async disableSettings(id){await this.port.request("passbolt.scim.disable-settings",id)}};var copy=__webpack_require__("./src/img/svg/copy.svg"),refresh=__webpack_require__("./src/img/svg/refresh.svg"),ManagedClipboardServiceProvider=__webpack_require__("./src/react-extension/contexts/Clipboard/ManagedClipboardServiceProvider.js"),Password=__webpack_require__("./src/shared/components/Password/Password.js"),Select=__webpack_require__("./src/react-extension/components/Common/Select/Select.js"),userUtils=__webpack_require__("./src/shared/utils/userUtils.js"),portals=__webpack_require__("./src/shared/utils/portals.js"),info=__webpack_require__("./src/img/svg/info.svg");class DisplayScimSettingsAdministrationHelp extends react.Component{render(){return react.createElement(react.Fragment,null,this.props.shouldDisplayWarning&&react.createElement("div",{className:"sidebar-help-section warning message"},react.createElement("div",{className:"form-banner"},react.createElement("p",null,react.createElement("b",null,react.createElement(es.x6,null,"Warning:"))," ",react.createElement(es.x6,null,"if you think the secret has been compromised please regenerate and update it in your provider settings.")))),react.createElement("div",{className:"sidebar-help-section"},react.createElement("h3",null,react.createElement(es.x6,null,"Need help?")),react.createElement("p",null,react.createElement(es.x6,null,"For more information about SCIM, checkout the dedicated page on the official website.")),react.createElement("a",{className:"button",target:"_blank",rel:"noopener noreferrer",href:"https://www.passbolt.com/docs/admin/user-provisioning/scim"},react.createElement(info.A,null),react.createElement("span",null,react.createElement(es.x6,null,"Read the documentation")))))}}DisplayScimSettingsAdministrationHelp.propTypes={shouldDisplayWarning:prop_types_default().bool.isRequired};const DisplayScimSettingsAdministration_DisplayScimSettingsAdministrationHelp=DisplayScimSettingsAdministrationHelp;DisplayScimSettingsAdministrationHelp.__docgenInfo={description:"This component displays the help section for SCIM Settings Administration",methods:[],displayName:"DisplayScimSettingsAdministrationHelp",props:{shouldDisplayWarning:{description:"",type:{name:"bool"},required:!0}}};var RoleContext=__webpack_require__("./src/react-extension/contexts/RoleContext.js");class DisplayScimSettingsAdministration extends react.Component{originalSettings=null;formSettings=null;scimSettingsService=null;constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks(),this.scimSettingsService=props.scimSettingsServiceWorkerService??new scimSettingsServiceWorkerService(this.props.context.port)}get defaultState(){return{isProcessing:!0,hasAlreadyBeenValidated:!1,enabled:!1,settings:null}}bindCallbacks(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.save=this.save.bind(this),this.handleToggleEnabled=this.handleToggleEnabled.bind(this),this.handleCopyScimUrl=this.handleCopyScimUrl.bind(this),this.handleCopySecretToken=this.handleCopySecretToken.bind(this),this.handleRegenerateSecretToken=this.handleRegenerateSecretToken.bind(this)}async componentDidMount(){this.props.context.users||await this.props.context.port.request("passbolt.users.update-local-storage"),await this.findScimSettings(),this.setState({isProcessing:!1})}componentWillUnmount(){this.clearContext()}get adminUsers(){const adminRole=this.props.roles.items.filter(r=>r.isAdmin())?.[0]||null,users=this.props.context.users;return null!==users&&adminRole?users.filter(user=>!0===user.active&&user.role_id===adminRole.id):[]}get adminUsersForSelect(){return this.adminUsers&&this.adminUsers.map(user=>({value:user.id,label:(0,userUtils.$2)(user,this.props.t,{withUsername:!0})}))}async findScimSettings(){this.setState({isProcessing:!0});try{const scimSettings=await this.scimSettingsService.findSettings();scimSettings&&(this.originalSettings=new scimSettingsFormEntity(scimSettings,{validate:!1}),this.formSettings=new scimSettingsFormEntity(scimSettings,{validate:!1}),this.setState({settings:this.formSettings.toDto(),enabled:!0}))}catch(error){await this.handleUnexpectedError(error),this.setDefaultSettings()}this.setState({isProcessing:!1})}setDefaultSettings(){this.formSettings=scimSettingsFormEntity.createFromDefault(this.adminUsers[0].id),this.setState({settings:this.formSettings.toDto()})}handleToggleEnabled(){this.state.enabled||(this.formSettings=scimSettingsFormEntity.createFromDefault(this.adminUsers[0].id),this.setState({settings:this.formSettings.toDto()})),this.setState({enabled:!this.state.enabled})}hasSettingsChanges=(0,memoize_one_esm.A)((originalSettings,formSettings,settings)=>originalSettings?.hasDiffProps(formSettings)||!1);handleInputChange(event){if(this.hasAllInputDisabled())return;const{type,checked,name}=event.target,parsedValue="checkbox"===type?checked:event.target.value;this.setFormPropertyValue(name,parsedValue)}setFormPropertyValue(name,parsedValue){this.formSettings.set(name,parsedValue,{validate:!1}),this.setState({settings:this.formSettings.toDto()})}hasAllInputDisabled(){return this.state.isProcessing}async handleCopyScimUrl(){await this.props.clipboardContext.copy(this.scimUrl,this.props.t("The SCIM URL has been copied to the clipboard."))}async handleCopySecretToken(){await this.props.clipboardContext.copy(this.state.settings.secret_token,this.props.t("The SCIM secret token has been copied to the clipboard."))}handleRegenerateSecretToken(){const secretToken=scimSettingsEntity.A.generateScimSecretToken();this.setFormPropertyValue("secret_token",secretToken)}handleFormSubmit(event){event.preventDefault(),this.save()}async save(){if(this.state.isProcessing)return;this.setState({isProcessing:!0});const validationError=this.validateForm();if(validationError?.hasErrors())this.setState({isProcessing:!1,hasAlreadyBeenValidated:!0});else{try{const result=await this.saveScimSettings();this.formSettings=result?new scimSettingsFormEntity(result,{validate:!1}):null,this.originalSettings=result?new scimSettingsFormEntity(this.formSettings.toDto(),{validate:!1}):null,this.setState({settings:result?this.formSettings.toDto():null,enabled:null!==result}),await this.props.actionFeedbackContext.displaySuccess(this.props.t("The SCIM settings were updated."))}catch(error){await this.handleUnexpectedError(error)}this.setState({isProcessing:!1})}}validateForm(){return this.formSettings?this.formSettings.validate():null}async saveScimSettings(){if(this.state.enabled){let scimSettingResult;return scimSettingResult=this.originalSettings?await this.scimSettingsService.updateSettings(this.formSettings,this.originalSettings.id):await this.scimSettingsService.createSettings(this.formSettings),scimSettingResult}return this.originalSettings&&await this.scimSettingsService.disableSettings(this.originalSettings.id),null}handleUnexpectedError(error){if(console.error(error),"UserAbortsOperationError"!==error.name)return this.props.dialogContext.open(NotifyError.A,{error})}clearContext(){this.setState(this.defaultState)}get scimUrl(){return`${this.props.context.userSettings.getTrustedDomain()}/scim/v2/${this.state.settings.setting_id}`}render(){const errors=this.state.hasAlreadyBeenValidated?this.validateForm():null,hasSettingsChanges=this.hasSettingsChanges(this.originalSettings,this.formSettings,this.state.settings);return react.createElement("div",{className:"row"},react.createElement("div",{id:"scim-settings",className:"main-column"},react.createElement("div",{className:"main-content"},react.createElement("form",{onSubmit:this.handleFormSubmit,"data-testid":"submit-form"},react.createElement("h3",{className:"title"},react.createElement("span",{className:"input toggle-switch form-element"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"enabled",onChange:this.handleToggleEnabled,checked:this.state.enabled,disabled:this.hasAllInputDisabled(),id:"scimSettingsToggle"}),react.createElement("label",{htmlFor:"scimSettingsToggle"},react.createElement(es.x6,null,"SCIM")))),react.createElement("p",{className:"description"},react.createElement(es.x6,null,"SCIM is a standard protocol that automates user provisioning and deprovisioning with identity providers.")),this.state.enabled&&this.state.settings&&react.createElement(react.Fragment,null,react.createElement("div",{className:"input text input-wrapper "+(this.hasAllInputDisabled()?"disabled":"")},react.createElement("label",null,react.createElement(es.x6,null,"SCIM URL")),react.createElement("div",{className:"button-inline"},react.createElement("input",{id:"scim-url-input",type:"text",className:"fluid form-element disabled",name:"scim_url",value:this.scimUrl,readOnly:!0,disabled:!0}),react.createElement("button",{type:"button",onClick:this.handleCopyScimUrl,className:"copy-to-clipboard button button-icon"},react.createElement(copy.A,null))),react.createElement("p",null,react.createElement(es.x6,null,"The URL to enter in your provider when configuring user provisioning."))),react.createElement("div",{className:"input text input-wrapper "+(this.hasAllInputDisabled()?"disabled":"")},react.createElement("label",null,react.createElement(es.x6,null,"Secret Token")),react.createElement("div",{className:"button-inline"},react.createElement(Password.A,{id:"scim-secret-token-input",className:"fluid form-element",autoComplete:"off",name:"scim_secret_token",value:this.state.settings.secret_token,preview:!0,disabled:this.state.settings.secret_token===scimSettingsEntity.A.EMPTY_SECRET_VALUE}),react.createElement("button",{type:"button",disabled:this.state.settings.secret_token===scimSettingsEntity.A.EMPTY_SECRET_VALUE,onClick:this.handleCopySecretToken,className:"copy-to-clipboard button button-icon"},react.createElement(copy.A,null)),react.createElement("button",{type:"button",onClick:this.handleRegenerateSecretToken,className:"copy-to-clipboard button button-icon"},react.createElement(refresh.A,null)))),react.createElement("div",{className:"input text input-wrapper "+(this.hasAllInputDisabled()?"disabled":"")},react.createElement("label",null,react.createElement(es.x6,null,"SCIM User")),react.createElement(Select.A,{items:this.adminUsersForSelect,name:"scim_user_id",className:"users",value:this.state.settings.scim_user_id,onChange:this.handleInputChange,disabled:this.state.isProcessing,search:!0,direction:"bottom"}),react.createElement("p",null,react.createElement(es.x6,null,"The SCIM user is the user that will perform the operation in the logs."))),react.createElement("div",{className:"section"},react.createElement("label",null,react.createElement(es.x6,null,"Synchronisation")),react.createElement("span",{className:"input toggle-switch form-element"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"passwordUpdate",disabled:!0,checked:!0,id:"send-password-update-toggle-button"}),react.createElement("label",{className:"text",htmlFor:"send-password-update-toggle-button"},react.createElement(es.x6,null,"Users."))),react.createElement("span",{className:"input toggle-switch form-element"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"passwordUpdate",disabled:!0,checked:!1,id:"send-password-update-toggle-button"}),react.createElement("label",{className:"text",htmlFor:"send-password-update-toggle-button"},react.createElement(es.x6,null,"Groups (Not supported)."))))))),react.createElement("div",{className:"warning message"},!this.formSettings?.id&&this.state.enabled&&react.createElement("div",{className:"form-banner"},react.createElement("p",null,react.createElement(es.x6,null,"Please save the settings to enable the feature."))),this.formSettings?.id&&!this.state.enabled&&react.createElement("div",{className:"form-banner"},react.createElement("p",null,react.createElement(es.x6,null,"Please save the settings to disable the feature."))),hasSettingsChanges&&this.state.enabled&&this.formSettings.id&&react.createElement("div",{className:"form-banner"},react.createElement("p",null,react.createElement(es.x6,null,"Don't forget to save your settings to apply your modification."))),errors?.hasErrors()&&react.createElement("div",{className:"form-banner"},react.createElement("p",null,react.createElement("b",null,react.createElement(es.x6,null,"Warning:"))," ",react.createElement(es.x6,null,"Please fix the errors in the form before saving."))))),react.createElement("div",{className:"actions-wrapper"},react.createElement("button",{type:"button",className:"button primary",disabled:this.state.isProcessing||errors?.hasErrors(),onClick:this.handleFormSubmit},react.createElement("span",null,react.createElement(es.x6,null,"Save")))),(0,portals.m)(react.createElement(DisplayScimSettingsAdministration_DisplayScimSettingsAdministrationHelp,{shouldDisplayWarning:!hasSettingsChanges&&this.state.enabled&&this.formSettings?.id}),document.getElementById("administration-help-panel")))}}DisplayScimSettingsAdministration.propTypes={context:prop_types_default().object,actionFeedbackContext:prop_types_default().object,dialogContext:prop_types_default().object,roleContext:prop_types_default().object,roles:prop_types_default().object,clipboardContext:prop_types_default().object,administrationWorkspaceContext:prop_types_default().object,scimSettingsServiceWorkerService:prop_types_default().object,t:prop_types_default().func};const DisplayScimSettingsAdministration_DisplayScimSettingsAdministration=(0,AdministrationWorkspaceContext.Kk)((0,DialogContext.z9)((0,ActionFeedbackContext.ot)((0,ManagedClipboardServiceProvider.nJ)((0,AppContext.L)((0,RoleContext.ou)((0,es.CI)("common")(DisplayScimSettingsAdministration)))))));DisplayScimSettingsAdministration.__docgenInfo={description:"This component allows to display the SCIM settings for the administration",methods:[{name:"defaultState",docblock:"Get default state\n@returns {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"adminUsers",docblock:"Get admin users\n@returns {Array} Array of active admin users",modifiers:["get"],params:[],returns:{description:"Array of active admin users",type:{name:"Array"}},description:"Get admin users"},{name:"adminUsersForSelect",docblock:"Get admin users formatted for select input\n@returns {Array<{value: string, label: string}>} Array of admin users formatted for select input",modifiers:["get"],params:[],returns:{description:"Array of admin users formatted for select input",type:{name:"Array",elements:[]}},description:"Get admin users formatted for select input"},{name:"findScimSettings",docblock:"Find the SCIM settings\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Find the SCIM settings"},{name:"setDefaultSettings",docblock:"Set SCIM form with default settings.",modifiers:[],params:[],returns:null,description:"Set SCIM form with default settings."},{name:"handleToggleEnabled",docblock:"Enable/Disable the settings",modifiers:[],params:[],returns:null,description:"Enable/Disable the settings"},{name:"handleInputChange",docblock:"Handle form input changes.\n@param {ReactEvent} event The react event\n@returns {void}",modifiers:[],params:[{name:"event",description:"The react event",type:{name:"ReactEvent"},optional:!1}],returns:{type:{name:"void"}},description:"Handle form input changes."},{name:"setFormPropertyValue",docblock:"Set a form property value. Trigger the validation if the form has already been submitted once.\n@param {string} name The property name\n@param {*} parsedValue The parsed value",modifiers:[],params:[{name:"name",description:"The property name",type:{name:"string"},optional:!1},{name:"parsedValue",description:"The parsed value",type:{name:"mixed"},optional:!1}],returns:null,description:"Set a form property value. Trigger the validation if the form has already been submitted once."},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"handleCopyScimUrl",docblock:"Handle the copy to clipboard button",modifiers:["async"],params:[],returns:null,description:"Handle the copy to clipboard button"},{name:"handleCopySecretToken",docblock:"Handle the copy to clipboard button",modifiers:["async"],params:[],returns:null,description:"Handle the copy to clipboard button"},{name:"handleRegenerateSecretToken",docblock:"Handle the regeneration of the secret token",modifiers:[],params:[],returns:null,description:"Handle the regeneration of the secret token"},{name:"handleFormSubmit",docblock:"Handle form submission that can be triggered when hitting `enter`\n@param {Event} event The html event triggering the form submit.",modifiers:[],params:[{name:"event",description:"The html event triggering the form submit.",type:{name:"Event"},optional:!1}],returns:null,description:"Handle form submission that can be triggered when hitting `enter`"},{name:"save",docblock:"Save the settings.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Save the settings."},{name:"validateForm",docblock:"Validate form.\n@return {EntityValidationError|null}",modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"EntityValidationError"}]}},description:"Validate form."},{name:"saveScimSettings",docblock:"Save the SCIM settings.\n@returns {Promise<ScimSettingsEntity|null>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"union",elements:[{name:"ScimSettingsEntity"}]}]}},description:"Save the SCIM settings."},{name:"handleUnexpectedError",docblock:"Handle unexpected error\n@param {Error} error The error\n@returns {Promise<string>} Return the dialog key identifier.",modifiers:[],params:[{name:"error",description:"The error",type:{name:"Error"},optional:!1}],returns:{description:"Return the dialog key identifier.",type:{name:"Promise",elements:[{name:"string"}]}},description:"Handle unexpected error"},{name:"clearContext",docblock:"Puts the state to its default in order to avoid keeping the data users didn't want to save.",modifiers:[],params:[],returns:null,description:"Puts the state to its default in order to avoid keeping the data users didn't want to save."},{name:"scimUrl",docblock:"Return the formatted scim url\n@returns {string} the formated scim url",modifiers:["get"],params:[],returns:{description:"the formated scim url",type:{name:"string"}},description:"Return the formatted scim url"}],displayName:"DisplayScimSettingsAdministration",props:{context:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"object"},required:!1},roleContext:{description:"",type:{name:"object"},required:!1},roles:{description:"",type:{name:"object"},required:!1},clipboardContext:{description:"",type:{name:"object"},required:!1},administrationWorkspaceContext:{description:"",type:{name:"object"},required:!1},scimSettingsServiceWorkerService:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-extension/contexts/RoleContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ou:()=>withRoles});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_shared_models_entity_role_rolesCollection__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/role/rolesCollection.js"),_shared_services_serviceWorker_role_roleServiceWorkerService__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/services/serviceWorker/role/roleServiceWorkerService.js"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/shared/context/AppContext/AppContext.js");const RoleContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({getRole:()=>{},getAllRoles:()=>{},refreshRoles:()=>{}});class RoleContextProvider extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState(),this.runningLocalStorageUpdatePromise=null,this.roleServiceWorkerService=new _shared_services_serviceWorker_role_roleServiceWorkerService__WEBPACK_IMPORTED_MODULE_3__.Ay(props.context.port),this.initEventHandlers()}defaultState(){return{rolesCollection:null,getRole:this.getRole.bind(this),getAllRoles:this.getAllRoles.bind(this),refreshRoles:this.refreshRoles.bind(this)}}async componentDidMount(){this.props.context.storage.onChanged.addListener(this.handleStorageChange)}componentWillUnmount(){this.props.context.storage.onChanged.removeListener(this.handleStorageChange)}initEventHandlers(){this.handleStorageChange=this.handleStorageChange.bind(this)}handleStorageChange(changes){if(!changes[this.storageKey])return;const rolesCollectionDto=changes[this.storageKey].newValue;this.setState({rolesCollection:new _shared_models_entity_role_rolesCollection__WEBPACK_IMPORTED_MODULE_2__.A(rolesCollectionDto)})}get storageKey(){return"roles"}getRole(roleId){const role=this.state.rolesCollection?.getById(roleId);return role||(this.refreshRoles(),null)}getAllRoles(){return this.state.rolesCollection?this.state.rolesCollection:(this.refreshRoles(),null)}async refreshRoles(){null===this.runningLocalStorageUpdatePromise?(this.runningLocalStorageUpdatePromise=this.roleServiceWorkerService.updateResourceLocalStorage(),await this.runningLocalStorageUpdatePromise,this.runningLocalStorageUpdatePromise=null):await this.runningLocalStorageUpdatePromise}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(RoleContext.Provider,{value:this.state},this.props.children)}}RoleContextProvider.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_1___default().any},RoleContextProvider.displayName="RoleContextProvider";(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_4__.L)(RoleContextProvider);function withRoles(WrappedComponent){return class withRoles extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(RoleContext.Consumer,null,context=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(WrappedComponent,{roleContext:context,roles:context.getAllRoles(),...this.props}))}}}RoleContextProvider.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:[],params:[],returns:null,description:"Returns the default component state"},{name:"initEventHandlers",docblock:"Initialize the component event handlers",modifiers:[],params:[],returns:null,description:"Initialize the component event handlers"},{name:"handleStorageChange",docblock:"Handles update of the metadata type settings in the local storage.",modifiers:[],params:[{name:"changes",optional:!1}],returns:null,description:"Handles update of the metadata type settings in the local storage."},{name:"storageKey",docblock:"Get the storage key.\n@returns {string}",modifiers:["get"],params:[],returns:{type:{name:"string"}},description:"Get the storage key."},{name:"getRole",docblock:"Get a role given its id.\nIf the role is not find, returns null and triggers a refresh of the local storage\n@param {string} roleId\n@returns {RoleEntity|null}",modifiers:[],params:[{name:"roleId",type:{name:"string"},optional:!1}],returns:{type:{name:"union",elements:[{name:"RoleEntity"}]}},description:"Get a role given its id.\nIf the role is not find, returns null and triggers a refresh of the local storage"},{name:"getAllRoles",docblock:"Returns all known roles.\n@returns {RolesCollection|null}",modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"RolesCollection"}]}},description:"Returns all known roles."},{name:"refreshRoles",docblock:"Triggers a role local storage update.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Triggers a role local storage update."}],displayName:"RoleContextProvider",props:{children:{description:"",type:{name:"any"},required:!1}}}},"./src/shared/models/entity/scimSettings/scimSettingsEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_entitySchema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js"),_abstract_entityV2__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),_abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js");class ScimSettingsEntity extends _abstract_entityV2__WEBPACK_IMPORTED_MODULE_1__.A{static getSchema(){return{type:"object",required:["scim_user_id"],properties:{id:{type:"string",format:"uuid",nullable:!0},scim_user_id:{type:"string",format:"uuid"},setting_id:{type:"string",format:"uuid",nullable:!0},secret_token:{type:"string",length:46,pattern:"^pb_[A-Za-z0-9]{43}$",nullable:!0}}}}toDto(){return Object.assign({},this._props)}get id(){return this._props.id||null}get scimUserId(){return this._props.scim_user_id}get settingId(){return this._props.setting_id}get secretToken(){return this._props.secret_token||null}set secretToken(secretToken){_abstract_entitySchema__WEBPACK_IMPORTED_MODULE_0__.A.validateProp("secret_token",secretToken,this.cachedSchema.properties.secret_token),this._props.secret_token=secretToken}static get SECRET_TOKEN_LENGTH(){return 46}static get EMPTY_SECRET_VALUE(){return"pb_0000000000000000000000000000000000000000000"}static generateScimSecretToken(){const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",secretLength=ScimSettingsEntity.SECRET_TOKEN_LENGTH-3,secret=[],randomValues=new Uint8Array(2*secretLength);for(;secret.length<secretLength;){window.crypto.getRandomValues(randomValues);for(let i=0;i<randomValues.length&&secret.length<secretLength;i++){const v=randomValues[i];v<248&&secret.push(chars[v%62])}}return"pb_"+secret.join("")}static createFromScimSettingsFind(scimSettingsDto){const scimSettingsEntity=new ScimSettingsEntity(scimSettingsDto),entityValidationError=new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_2__.A;if(scimSettingsEntity.id||entityValidationError.addError("id","required","SCIM settings id is mandatory"),scimSettingsEntity.secretToken&&entityValidationError.addError("secretToken","empty","SCIM settings should not contain secret_token"),entityValidationError.hasErrors())throw entityValidationError;return scimSettingsEntity.secretToken="pb_0000000000000000000000000000000000000000000",scimSettingsEntity}static createFromScimSettingsCreation(scimSettingsDto){const scimSettingsEntity=new ScimSettingsEntity(scimSettingsDto),entityValidationError=new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_2__.A;if(scimSettingsEntity.secretToken||entityValidationError.addError("secretToken","required","SCIM settings secret_token is mandatory."),entityValidationError.hasErrors())throw entityValidationError;return scimSettingsEntity}static createFromScimSettingsUpdate(scimSettingsDto){delete scimSettingsDto.setting_id;return new ScimSettingsEntity(scimSettingsDto)}}const __WEBPACK_DEFAULT_EXPORT__=ScimSettingsEntity},"./src/shared/services/serviceWorker/role/roleServiceWorkerService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>RoleServiceWorkerService});var _models_entity_role_rolesCollection__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/role/rolesCollection.js");class RoleServiceWorkerService{constructor(port){this.port=port}async findAll(){const rolesCollection=await this.port.request("passbolt.role.get-all");return new _models_entity_role_rolesCollection__WEBPACK_IMPORTED_MODULE_0__.A(rolesCollection)}async updateResourceLocalStorage(){await this.port.request("passbolt.role.update-local-storage")}}}}]);