/*! For license information please see 9412.ef043b01.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[9412],{"./src/img/svg/copy.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _g,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SvgCopy(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},props),_g||(_g=react__WEBPACK_IMPORTED_MODULE_0__.createElement("g",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,clipPath:"url(#copy_svg__clip0_57_467942)"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{d:"M15 6H7.5A1.5 1.5 0 0 0 6 7.5V15a1.5 1.5 0 0 0 1.5 1.5H15a1.5 1.5 0 0 0 1.5-1.5V7.5A1.5 1.5 0 0 0 15 6"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{d:"M3 12c-.825 0-1.5-.675-1.5-1.5V3c0-.825.675-1.5 1.5-1.5h7.5c.825 0 1.5.675 1.5 1.5"}))))}},"./src/img/svg/qr_code.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _path,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SvgQrCode(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",width:19,height:18,fill:"none",viewBox:"0 0 19 18"},props),_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5.847 2.25h-2.25a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h2.25a.75.75 0 0 0 .75-.75V3a.75.75 0 0 0-.75-.75M15.597 2.25h-2.25a.75.75 0 0 0-.75.75v2.25c0 .414.336.75.75.75h2.25a.75.75 0 0 0 .75-.75V3a.75.75 0 0 0-.75-.75M5.847 12h-2.25a.75.75 0 0 0-.75.75V15c0 .414.336.75.75.75h2.25a.75.75 0 0 0 .75-.75v-2.25a.75.75 0 0 0-.75-.75M16.347 12h-2.25a1.5 1.5 0 0 0-1.5 1.5v2.25M16.347 15.75v.008M9.597 5.25V7.5a1.5 1.5 0 0 1-1.5 1.5h-2.25M2.847 9h.008M9.597 2.25h.008M9.597 12v.008M12.597 9h.75M16.347 9v.008M9.597 15.75V15"})))}},"./src/img/svg/timer.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _circle,_circle2,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SvgTimer(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({width:16,height:16,fill:"none",className:"svg-icon timer",viewBox:"0 0 20 20"},props),_circle||(_circle=react__WEBPACK_IMPORTED_MODULE_0__.createElement("circle",{r:8,stroke:"var(--timer-background)",strokeWidth:"var(--timer-stroke-width)",transform:"translate(10 10)"})),_circle2||(_circle2=react__WEBPACK_IMPORTED_MODULE_0__.createElement("circle",{id:"timer-progress",r:8,fill:"none",stroke:"var(--timer-color)",strokeLinecap:"round",strokeWidth:"var(--timer-stroke-width)",transform:"rotate(-90 10 0)"})))}},"./src/react-extension/components/Resource/ResourceForm/AddResourceTotp.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var prop_types__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_17__),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_i18next__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_img_svg_caret_down_svg__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/img/svg/caret_down.svg"),_img_svg_caret_right_svg__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/img/svg/caret_right.svg"),_img_svg_copy_svg__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/img/svg/copy.svg"),_img_svg_qr_code_svg__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/img/svg/qr_code.svg"),_img_svg_timer_svg__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/img/svg/timer.svg"),_shared_components_Password_Password__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/shared/components/Password/Password.js"),_shared_components_Totp_Totp__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/shared/components/Totp/Totp.js"),_Common_Select_Select__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/react-extension/components/Common/Select/Select.js"),_shared_models_entity_totp_totpEntity__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/shared/models/entity/totp/totpEntity.js"),_shared_services_otp_TotpCodeGeneratorService__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/shared/services/otp/TotpCodeGeneratorService.js"),_shared_lib_Browser_clipBoard__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./src/shared/lib/Browser/clipBoard.js"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),html5_qrcode__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/html5-qrcode/esm/index.js"),_img_svg_attention_svg__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./src/img/svg/attention.svg");class AddResourceTotp extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks(),this.createReferences()}get defaultState(){return{displayAdvancedSettings:!1,warningImportFile:null}}bindCallbacks(){this.handleDisplayAdvancedSettingsClick=this.handleDisplayAdvancedSettingsClick.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.hasValidTotp=this.hasValidTotp.bind(this),this.handleTotpClick=this.handleTotpClick.bind(this),this.handleSelectFile=this.handleSelectFile.bind(this),this.handleInputFileChange=this.handleInputFileChange.bind(this),this.isFieldUriError=this.isFieldUriError.bind(this)}createReferences(){this.fileUploaderRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.keyInputRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.periodInputRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.digitsInputRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef()}componentDidMount(){Boolean(this.props.errors)&&this.focusFirstFieldError()}componentDidUpdate(prevProps,prevState){const hasSameError=prevProps.errors===this.props.errors,isFirstError=null===prevProps.errors,hasNotResourceChanged=prevProps.resource===this.props.resource,hasChangedDisplayAdvancedSettings=prevState.displayAdvancedSettings!==this.state.displayAdvancedSettings;(hasSameError&&hasNotResourceChanged&&!hasChangedDisplayAdvancedSettings||isFirstError)&&this.focusFirstFieldError()}handleDisplayAdvancedSettingsClick(){this.setState({displayAdvancedSettings:!this.state.displayAdvancedSettings})}handleSelectFile(){this.fileUploaderRef.current.click()}async handleInputFileChange(event){try{const[file]=event.target.files,eventTotp={target:{name:"secret.totp",value:await this.getTotpFromFile(file)}};this.props.onChange?.(eventTotp),this.setState({warningImportFile:null})}catch(error){this.handleImportError(error)}}get supportedAlgorithms(){return _shared_models_entity_totp_totpEntity__WEBPACK_IMPORTED_MODULE_10__.e.map((algorithm=>({value:algorithm,label:algorithm})))}get isResourceHasPassword(){return null!=this.props.resource?.secret?.password}get translate(){return this.props.t}handleInputChange(event){this.setState({warningImportFile:null}),this.props.onChange&&this.props.onChange(event)}hasValidTotp(){return null===new _shared_models_entity_totp_totpEntity__WEBPACK_IMPORTED_MODULE_10__.A(this.props.resource?.secret?.totp,{validate:!1}).validate()}async handleTotpClick(){const code=_shared_services_otp_TotpCodeGeneratorService__WEBPACK_IMPORTED_MODULE_11__.l.generate(this.props.resource.secret.totp);await _shared_lib_Browser_clipBoard__WEBPACK_IMPORTED_MODULE_16__.A.copy(code,this.props.context.port),await this.props.actionFeedbackContext.displaySuccess(this.translate("The TOTP has been copied to clipboard"))}async getTotpFromFile(file){const url=await this.getDataFromQrCode(file);return _shared_models_entity_totp_totpEntity__WEBPACK_IMPORTED_MODULE_10__.A.createTotpFromUrl(url)}async getDataFromQrCode(file){const html5QrCode=new html5_qrcode__WEBPACK_IMPORTED_MODULE_14__.j9("upload-qr-code",{formatsToSupport:[html5_qrcode__WEBPACK_IMPORTED_MODULE_14__.Jl.QR_CODE]}),result=await html5QrCode.scanFileV2(file,!1);return new URL(result.decodedText)}handleImportError(error){let warningImportFile=null;"NotFoundException"===error.name?warningImportFile=this.translate("No QR code found."):(console.error(error),warningImportFile=this.translate("The QR code is incomplete.")),this.setState({warningImportFile})}get hasWarningImportFile(){return Boolean(this.state.warningImportFile)}isMaxLengthWarnings(propName){return this.props.warnings?.hasError(propName,"maxLength")}isFieldTotpError(name){return this.props.errors?.details?.secret?.details.totp?.hasError(name)}isFieldUriError(propName){const uris=propName.split("."),propArrayName=uris[0],propsArrayIndex=uris[1];return this.props.errors?.details?.metadata?.details?.[propArrayName]?.[propsArrayIndex].maxLength}get secretKeyErrorMessage(){const secretError=this.props.errors?.details.secret,error=secretError?.details.totp.getError("secret_key");return error?.minLength&&0===this.props.resource.secret.totp.secret_key.length?this.translate("The key is required."):error?.pattern?this.translate("The key is not valid."):null}get periodErrorMessage(){const secretError=this.props.errors?.details.secret,error=secretError?.details.totp.getError("period");return error?.type?this.translate("TOTP expiry is required."):error?.minimum?this.translate("TOTP expiry must be greater than 0."):null}get digitsErrorMessage(){const secretError=this.props.errors?.details.secret,error=secretError?.details.totp.getError("digits");return error?.type?this.translate("TOTP length is required."):error?.minimum||error?.maximum?this.translate("TOTP length must be between 6 and 8."):null}focusFirstFieldError(){this.isFieldTotpError("secret_key")?this.keyInputRef.current.focus():this.isFieldTotpError("period")?this.state.displayAdvancedSettings?this.periodInputRef.current.focus():this.setState({displayAdvancedSettings:!0},(()=>this.periodInputRef.current.focus())):this.isFieldTotpError("digits")&&(this.state.displayAdvancedSettings?this.digitsInputRef.current.focus():this.setState({displayAdvancedSettings:!0},(()=>this.digitsInputRef.current.focus())))}render(){const hasValidTotp=this.hasValidTotp();return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"totp-workspace"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"totp-form"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"title"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("h2",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"TOTP"))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"content"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"totp-fields"},!this.isResourceHasPassword&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input text "+(this.props.disabled?"disabled":"")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"resource-uri"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"URI"),this.isMaxLengthWarnings("uris.0")&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_attention_svg__WEBPACK_IMPORTED_MODULE_15__.A,{className:"attention-required"})),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"resource-uri",disabled:this.props.disabled,name:"metadata.uris.0",maxLength:"1024",type:"text",autoComplete:"off",placeholder:this.translate("URI"),value:this.props.resource?.metadata?.uris?.[0],onChange:this.handleInputChange}),this.isMaxLengthWarnings("uris.0")&&!this.isFieldUriError("uris.0")&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"uri warning-message"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("strong",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Warning:"))," ",react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"this is the maximum size for this field, make sure your data was not truncated.")),this.isFieldUriError("uris.0")&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"uri error-message"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"This is the maximum size for this field, make sure your data was not truncated."))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input text ${this.isFieldTotpError("secret_key")?"error":""} ${this.props.disabled?"disabled":""}`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"resource-totp-key"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Key")," (",react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"secret"),")"),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"secret-key-wrapper"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_components_Password_Password__WEBPACK_IMPORTED_MODULE_7__.A,{id:"resource-totp-key",disabled:this.props.disabled,name:"secret.totp.secret_key",inputRef:this.keyInputRef,autoComplete:"new-password",placeholder:this.translate("Key"),preview:!0,value:this.props.resource?.secret?.totp?.secret_key,onChange:this.handleInputChange}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{type:"file",name:"secret.totp",id:"upload-qr-code",ref:this.fileUploaderRef,onChange:this.handleInputFileChange,accept:".png, .jpg, .jpeg"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{className:"button",type:"button",id:"import-qr-code",onClick:this.handleSelectFile},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_qr_code_svg__WEBPACK_IMPORTED_MODULE_5__.A,null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Upload a QR code")))),this.isFieldTotpError("secret_key")&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"totp-key error-message"},this.secretKeyErrorMessage))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"additional-information"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",className:"section-header no-border",onClick:this.handleDisplayAdvancedSettingsClick},react__WEBPACK_IMPORTED_MODULE_0__.createElement("h4",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Advanced settings")),this.state.displayAdvancedSettings?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_caret_down_svg__WEBPACK_IMPORTED_MODULE_2__.A,null):react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_caret_right_svg__WEBPACK_IMPORTED_MODULE_3__.A,null)),this.state.displayAdvancedSettings&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"advanced-settings"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input text ${this.isFieldTotpError("period")?"error":""} ${this.props.disabled?"disabled":""}`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"resource-totp-period"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"TOTP expiry")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input-wrapper-inline"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"resource-totp-period",ref:this.periodInputRef,disabled:this.props.disabled,name:"secret.totp.period",type:"number",min:"1",max:"120",value:this.props.resource?.secret?.totp?.period,onChange:this.handleInputChange}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"seconds until the TOTP expires"))),this.isFieldTotpError("period")&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"period error-message"},this.periodErrorMessage)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input text ${this.isFieldTotpError("digits")?"error":""} ${this.props.disabled?"disabled":""}`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"resource-totp-digits"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"TOTP length")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input-wrapper-inline"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"resource-totp-digits",ref:this.digitsInputRef,disabled:this.props.disabled,name:"secret.totp.digits",type:"number",min:"6",max:"8",value:this.props.resource?.secret?.totp?.digits,onChange:this.handleInputChange}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"digits"))),this.isFieldTotpError("digits")&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"digits error-message"},this.digitsErrorMessage)),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"select-wrapper input "+(this.props.disabled?"disabled":"")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"resource-totp-algorithm"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Algorithm")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Select_Select__WEBPACK_IMPORTED_MODULE_9__.A,{id:"resource-totp-algorithm",disabled:this.props.disabled,name:"secret.totp.algorithm",items:this.supportedAlgorithms,value:this.props.resource?.secret?.totp?.algorithm,onChange:this.handleInputChange}))))),this.hasWarningImportFile&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"message warning"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,this.state.warningImportFile))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"totp-view"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"title"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("h2",{className:"preview"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Preview"))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"totp-wrapper"},hasValidTotp?react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"secret-totp"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_components_Totp_Totp__WEBPACK_IMPORTED_MODULE_8__.A,{totp:this.props.resource.secret.totp,canClick:!0,onClick:this.handleTotpClick})):react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"secret-totp secret-copy"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",className:"no-border",disabled:!0},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Copy TOTP to clipboard")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_timer_svg__WEBPACK_IMPORTED_MODULE_6__.A,{style:{"--timer-duration":"0s","--timer-delay":"0s","--timer-stroke-width":"0.25rem"}})),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{id:"copy-totp",type:"button",onClick:this.handleTotpClick,disabled:!hasValidTotp},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_copy_svg__WEBPACK_IMPORTED_MODULE_4__.A,null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,"Copy TOTP")))))}}AddResourceTotp.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_17___default().any,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_17___default().object,resource:prop_types__WEBPACK_IMPORTED_MODULE_17___default().object,onChange:prop_types__WEBPACK_IMPORTED_MODULE_17___default().func,t:prop_types__WEBPACK_IMPORTED_MODULE_17___default().func,warnings:prop_types__WEBPACK_IMPORTED_MODULE_17___default().object,errors:prop_types__WEBPACK_IMPORTED_MODULE_17___default().object,disabled:prop_types__WEBPACK_IMPORTED_MODULE_17___default().bool};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_12__.L)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_13__.ot)((0,react_i18next__WEBPACK_IMPORTED_MODULE_1__.CI)("common")(AddResourceTotp)));AddResourceTotp.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:null,modifiers:["get"],params:[],returns:null},{name:"bindCallbacks",docblock:"Bind callbacks methods\n@return {void}",modifiers:[],params:[],returns:{type:{name:"void"}},description:"Bind callbacks methods"},{name:"createReferences",docblock:"Create elements references",modifiers:[],params:[],returns:null,description:"Create elements references"},{name:"handleDisplayAdvancedSettingsClick",docblock:"Handles the click on the display secrets button.",modifiers:[],params:[],returns:null,description:"Handles the click on the display secrets button."},{name:"handleSelectFile",docblock:"Handle the selection of a file by file explorer",modifiers:[],params:[],returns:null,description:"Handle the selection of a file by file explorer"},{name:"handleInputFileChange",docblock:null,modifiers:["async"],params:[{name:"event",optional:!1,type:null}],returns:null},{name:"supportedAlgorithms",docblock:"Get the supported algorithms\n@returns {array}",modifiers:["get"],params:[],returns:{type:{name:"array"}},description:"Get the supported algorithms"},{name:"isResourceHasPassword",docblock:"Is resource has password\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Is resource has password"},{name:"translate",docblock:"Get the translation function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translation function"},{name:"handleInputChange",docblock:"Handle form input change.\n@params {ReactEvent} The react event.",modifiers:[],params:[{name:"event",optional:!1}],returns:null,description:"Handle form input change."},{name:"hasValidTotp",docblock:"Has valid totp\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Has valid totp"},{name:"handleTotpClick",docblock:"Handle Totp click\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handle Totp click"},{name:"getTotpFromFile",docblock:"Get the totp from qr code\n@param {File} file The file\n@returns {Promise<TotpEntity>}",modifiers:["async"],params:[{name:"file",description:"The file",type:{name:"File"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"TotpEntity"}]}},description:"Get the totp from qr code"},{name:"getDataFromQrCode",docblock:"Get data from QR code\n@param {File} file The file\n@return {Promise<module:url.URL>}",modifiers:["async"],params:[{name:"file",description:"The file",type:{name:"File"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"module:url.URL"}]}},description:"Get data from QR code"},{name:"handleImportError",docblock:"Handle import error.\n@param {Object} error The error returned by the qr code file and entity",modifiers:[],params:[{name:"error",description:"The error returned by the qr code file and entity",type:{name:"Object"},optional:!1}],returns:null,description:"Handle import error."},{name:"hasWarningImportFile",docblock:"Has errors import file\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Has errors import file"},{name:"isMaxLengthWarnings",docblock:"Checks if there is a max length warning for a specific property.\n\n@param {string} propName - The name of the property to check for max length warnings.\n@returns {boolean} - Returns true if there is a max length warning for the property, false otherwise.",modifiers:[],params:[{name:"propName",description:"The name of the property to check for max length warnings.",type:{name:"string"},optional:!1}],returns:{description:"Returns true if there is a max length warning for the property, false otherwise.",type:{name:"boolean"}},description:"Checks if there is a max length warning for a specific property."},{name:"isFieldTotpError",docblock:"Is field totp has error\n@param {string} name\n@return {boolean}",modifiers:[],params:[{name:"name",type:{name:"string"},optional:!1}],returns:{type:{name:"boolean"}},description:"Is field totp has error"},{name:"isFieldUriError",docblock:"Is field uri has error\n@param {string} propName\n@return {boolean}",modifiers:[],params:[{name:"propName",type:{name:"string"},optional:!1}],returns:{type:{name:"boolean"}},description:"Is field uri has error"},{name:"secretKeyErrorMessage",docblock:"Get the secret key error message\n@return {*|null}",modifiers:["get"],params:[],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Get the secret key error message"},{name:"periodErrorMessage",docblock:"Get the period error message\n@return {*|null}",modifiers:["get"],params:[],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Get the period error message"},{name:"digitsErrorMessage",docblock:"Get the digits error message\n@return {*|null}",modifiers:["get"],params:[],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Get the digits error message"},{name:"focusFirstFieldError",docblock:"Focus the first field of the form which is in error state.",modifiers:[],params:[],returns:null,description:"Focus the first field of the form which is in error state."}],displayName:"AddResourceTotp",props:{context:{description:"",type:{name:"any"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},resource:{description:"",type:{name:"object"},required:!1},onChange:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1},warnings:{description:"",type:{name:"object"},required:!1},errors:{description:"",type:{name:"object"},required:!1},disabled:{description:"",type:{name:"bool"},required:!1}}}},"./src/shared/components/Totp/Totp.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_5__),_img_svg_timer_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/img/svg/timer.svg"),_services_otp_TotpCodeGeneratorService__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/services/otp/TotpCodeGeneratorService.js"),react_i18next__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_react_extension_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js");class Totp extends react__WEBPACK_IMPORTED_MODULE_0__.Component{updateCodeOnPeriodTimeout=null;dateOnCreation=null;constructor(props){super(props),this.bindCallbacks(),this.dateOnCreation=new Date(Date.now()),this.state=this.defaultState}bindCallbacks(){this.updateCodeOnPeriod=this.updateCodeOnPeriod.bind(this),this.onClick=this.onClick.bind(this)}calculateDelayFromMounted(){return(3600*this.dateOnCreation.getUTCHours()+60*this.dateOnCreation.getUTCMinutes()+this.dateOnCreation.getUTCSeconds())%this.period}calculateDelayFromNow(){const now=new Date(Date.now());return(3600*now.getUTCHours()+60*now.getUTCMinutes()+now.getUTCSeconds())%this.period}get defaultState(){return{code:this.generateCode(),delay:this.calculateDelayFromMounted()}}generateCode(){try{return _services_otp_TotpCodeGeneratorService__WEBPACK_IMPORTED_MODULE_2__.l.generate(this.props.totp)}catch(error){return this.props.actionFeedbackContext.displayError(this.props.t("Unable to preview the TOTP")),""}}componentDidMount(){this.updateCodeOnPeriodTimeout=this.updateCodeOnPeriod(this.period-this.state.delay)}componentDidUpdate(prevProps){prevProps.totp!==this.props.totp&&(clearTimeout(this.updateCodeOnPeriodTimeout),this.updateCode())}componentWillUnmount(){clearTimeout(this.updateCodeOnPeriodTimeout)}updateCode(){const delay=this.calculateDelayFromMounted(),delayTotp=this.calculateDelayFromNow(),code=this.generateCode();this.updateCodeOnPeriodTimeout=this.updateCodeOnPeriod(this.period-delayTotp),this.setState({code,delay})}updateCodeOnPeriod(when){return setTimeout((()=>{const code=this.generateCode();this.setState({code}),this.updateCodeOnPeriodTimeout=this.updateCodeOnPeriod(this.period)}),1e3*when)}get period(){return this.props.totp?.period||30}onClick(ev){ev.stopPropagation(),this.props.canClick&&this.props?.onClick()}render(){const halfLength=Math.round(this.state.code.length/2),firstHalfCode=this.state.code.substring(0,halfLength),secondHalfCode=this.state.code.substring(halfLength);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",className:"no-border",onClick:this.onClick,disabled:!this.props.canClick},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"totp-code"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,firstHalfCode)," ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,secondHalfCode)),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_timer_svg__WEBPACK_IMPORTED_MODULE_1__.A,{style:{"--timer-duration":`${this.period}s`,"--timer-delay":`-${this.state.delay}s`}}))}}Totp.defaultProps={canClick:!1,onClick:()=>{}},Totp.propTypes={totp:prop_types__WEBPACK_IMPORTED_MODULE_5___default().object.isRequired,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_5___default().any,canClick:prop_types__WEBPACK_IMPORTED_MODULE_5___default().bool,onClick:prop_types__WEBPACK_IMPORTED_MODULE_5___default().func,t:prop_types__WEBPACK_IMPORTED_MODULE_5___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_react_extension_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_4__.ot)((0,react_i18next__WEBPACK_IMPORTED_MODULE_3__.CI)("common")(Totp));Totp.__docgenInfo={description:"This component represents an OTP viewer",methods:[{name:"bindCallbacks",docblock:"Bind component callbacks.",modifiers:[],params:[],returns:null,description:"Bind component callbacks."},{name:"calculateDelayFromMounted",docblock:"Return the delay with the previous period start from the mounted component.\n@return {number}",modifiers:[],params:[],returns:{type:{name:"number"}},description:"Return the delay with the previous period start from the mounted component."},{name:"calculateDelayFromNow",docblock:"Return the delay with the previous period start.\n@return {number}",modifiers:[],params:[],returns:{type:{name:"number"}},description:"Return the delay with the previous period start."},{name:"defaultState",docblock:"Get the default state\n@return {object}",modifiers:["get"],params:[],returns:{type:{name:"object"}},description:"Get the default state"},{name:"generateCode",docblock:"Generate the code.\n@returns {string}",modifiers:[],params:[],returns:{type:{name:"string"}},description:"Generate the code."},{name:"updateCode",docblock:"Update the code, the delay and the period timeout",modifiers:[],params:[],returns:null,description:"Update the code, the delay and the period timeout"},{name:"updateCodeOnPeriod",docblock:"Update TOTP code when period ends.\n@param {number} when When to update",modifiers:[],params:[{name:"when",description:"When to update",type:{name:"number"},optional:!1}],returns:null,description:"Update TOTP code when period ends."},{name:"period",docblock:"Return the OTP period\n@return {number}",modifiers:["get"],params:[],returns:{type:{name:"number"}},description:"Return the OTP period"},{name:"onClick",docblock:"Whenever the user click on the OTP.\n@param {HtmlEvent} ev The associated html event.",modifiers:[],params:[{name:"ev",description:"The associated html event.",type:{name:"HtmlEvent"},optional:!1}],returns:null,description:"Whenever the user click on the OTP."}],displayName:"Totp",props:{canClick:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},onClick:{defaultValue:{value:"() => {}",computed:!1},description:"",type:{name:"func"},required:!1},totp:{description:"",type:{name:"object"},required:!0},actionFeedbackContext:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/shared/lib/Browser/clipBoard.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class ClipBoard{static async copy(text,port){if(navigator.clipboard)try{await navigator.clipboard.writeText(text)}catch{ClipBoard.copyWithBrowserExtension(text,port)}else ClipBoard.copyWithBrowserExtension(text,port)}static copyWithBrowserExtension(text,port){port.request("passbolt.clipboard.copy",text)}}const __WEBPACK_DEFAULT_EXPORT__=ClipBoard},"./src/shared/services/otp/TotpCodeGeneratorService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>TotpCodeGeneratorService});var otpauth__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/otpauth/dist/otpauth.esm.js");class TotpCodeGeneratorService{static createTotpObject(totpDto){return new otpauth__WEBPACK_IMPORTED_MODULE_0__._k({algorithm:totpDto.algorithm,digits:totpDto.digits,period:totpDto.period,secret:totpDto.secret_key.replace(/(\W|_|\s)/g,""),issuer:totpDto.issuer,label:totpDto.label,timestamp:Date.now()})}static generate(totpDto){return this.createTotpObject(totpDto).generate()}static generateUri(totpDto){return this.createTotpObject(totpDto).toString()}}}}]);