/*! For license information please see 563.de56afd5.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[563],{"./src/react-extension/components/ResourceDescription/EditResourceDescription/EditResourceDescription.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_13__),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),_contexts_LoadingContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/react-extension/contexts/LoadingContext.js"),_Common_Tooltip_Tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/components/Common/Tooltip/Tooltip.js"),_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/contexts/ResourceWorkspaceContext.js"),react_i18next__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_shared_components_Icons_Icon__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/shared/components/Icons/Icon.js"),_shared_models_resource_ResourcePasswordStringViewModel__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/shared/models/resource/ResourcePasswordStringViewModel.js"),_shared_models_resource_ResourcePasswordDescriptionViewModel__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/shared/models/resource/ResourcePasswordDescriptionViewModel.js"),_shared_models_resource_ResourcePasswordDescriptionTotpViewModel__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/shared/models/resource/ResourcePasswordDescriptionTotpViewModel.js"),_shared_context_ResourceTypesLocalStorageContext_ResourceTypesLocalStorageContext__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/shared/context/ResourceTypesLocalStorageContext/ResourceTypesLocalStorageContext.js"),_shared_models_entity_resourceType_resourceTypesCollection__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js");class EditResourceDescription extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks(),this.createInputRef()}get defaultState(){return{processing:!1,unexpectedError:null,resourceViewModel:null,originalResourceTypeSlug:null,hasAlreadyBeenValidated:!1}}bindCallbacks(){this.handleEditorClickEvent=this.handleEditorClickEvent.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleDescriptionToggle=this.handleDescriptionToggle.bind(this)}createInputRef(){this.elementRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.textareaRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef()}componentDidMount(){this.handleOutsideEditorClickEvent(),this.initializeResourceViewModel(),this.setFocusOnDescriptionEditor()}componentWillUnmount(){this.removeOutsideEditorClickEvent()}initializeResourceViewModel(){const originalResourceType=this.props.resourceTypes?.getFirstById(this.props.resource.resource_type_id);let resourceViewModel=this.getViewModelTypeBySlug(originalResourceType?.slug).createFromEntity(this.props.resource);this.props.plaintextSecretDto&&(resourceViewModel=resourceViewModel.updateSecret(this.props.plaintextSecretDto)),this.setState({resourceViewModel,originalResourceTypeSlug:originalResourceType?.slug})}getViewModelTypeBySlug(slug){switch(slug){case _shared_models_resource_ResourcePasswordStringViewModel__WEBPACK_IMPORTED_MODULE_8__.A.resourceTypeSlug:return _shared_models_resource_ResourcePasswordStringViewModel__WEBPACK_IMPORTED_MODULE_8__.A;case _shared_models_resource_ResourcePasswordDescriptionViewModel__WEBPACK_IMPORTED_MODULE_9__.A.resourceTypeSlug:return _shared_models_resource_ResourcePasswordDescriptionViewModel__WEBPACK_IMPORTED_MODULE_9__.A;case _shared_models_resource_ResourcePasswordDescriptionTotpViewModel__WEBPACK_IMPORTED_MODULE_10__.A.resourceTypeSlug:return _shared_models_resource_ResourcePasswordDescriptionTotpViewModel__WEBPACK_IMPORTED_MODULE_10__.A;default:throw new Error("There is no ResourceViewModel mathching the given slug")}}async save(){this.setState({processing:!0});try{const updateDescriptionResult=await this.updateResource();await this.props.actionFeedbackContext.displaySuccess(this.translate("The description has been updated successfully")),await this.props.resourceWorkspaceContext.onResourceDescriptionEdited(),this.props.onUpdate(updateDescriptionResult.description,updateDescriptionResult.plaintextSecretDto),this.close()}catch(error){if("UserAbortsOperationError"===error.name)return void this.setState({processing:!1});console.error(error),this.setState({unexpectedError:error.message,processing:!1})}}async updateResource(){let resourceViewModel=this.state.resourceViewModel;const resourceDto=resourceViewModel.toResourceDto(),hasResourceTypeChange=this.state.originalResourceTypeSlug!==resourceViewModel.constructor.resourceTypeSlug,hasSecretChanged=this.props.plaintextSecretDto&&resourceViewModel.areSecretsDifferent(this.props.plaintextSecretDto),shouldUpdateSecret=hasResourceTypeChange||hasSecretChanged;if(hasResourceTypeChange){const description=resourceViewModel.description,plaintextSecretDto=await this.props.context.port.request("passbolt.secret.find-by-resource-id",resourceViewModel.id);resourceViewModel=resourceViewModel.updateSecret(plaintextSecretDto).cloneWithMutation("description",description)}const secretDto=shouldUpdateSecret?resourceViewModel.toSecretDto():null;return await this.props.context.port.request("passbolt.resources.update",resourceDto,secretDto),{description:this.state.resourceViewModel.description,plaintextSecretDto:this.state.resourceViewModel.toSecretDto()}}close(){return this.props.onClose()}removeOutsideEditorClickEvent(){document.removeEventListener("click",this.handleEditorClickEvent,{capture:!0})}handleOutsideEditorClickEvent(){document.addEventListener("click",this.handleEditorClickEvent,{capture:!0})}setFocusOnDescriptionEditor(){const descriptionLength=this.state.resourceViewModel?.description?.length||0;this.textareaRef.current.selectionStart=descriptionLength,this.textareaRef.current.selectionEnd=descriptionLength,this.textareaRef.current.focus()}handleEditorClickEvent(event){this.elementRef.current.contains(event.target)||this.state.processing||this.close()}hasAllInputDisabled(){return this.state.processing||this.state.loading}handleKeyDown(event){27===event.keyCode&&(event.stopPropagation(),this.close())}handleCancel(){this.close()}handleInputChange(event){const target=event.target,name=target.name,value=target.value||null;this.setState({resourceViewModel:this.state.resourceViewModel.cloneWithMutation(name,value)})}async handleFormSubmit(event){event.preventDefault(),this.state.processing||(this.props.loadingContext.add(),await this.save(),this.props.loadingContext.remove())}async handleDescriptionToggle(){if(!(this.state.originalResourceTypeSlug===_shared_models_resource_ResourcePasswordStringViewModel__WEBPACK_IMPORTED_MODULE_8__.A.resourceTypeSlug))return;if(!this.state.resourceViewModel.canToggleDescription())return;const newResourceViewModelType=this.state.resourceViewModel.isDescriptionUnencrypted()?_shared_models_resource_ResourcePasswordDescriptionViewModel__WEBPACK_IMPORTED_MODULE_9__.A:_shared_models_resource_ResourcePasswordStringViewModel__WEBPACK_IMPORTED_MODULE_8__.A,resourceType=this.props.resourceTypes.getFirstBySlug(newResourceViewModelType.resourceTypeSlug),newResourceViewModel=new newResourceViewModelType({...this.state.resourceViewModel,resource_type_id:resourceType.id});this.setState({resourceViewModel:newResourceViewModel})}get translate(){return this.props.t}render(){const isReady=Boolean(this.state.resourceViewModel);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("form",{onKeyDown:this.handleKeyDown,noValidate:!0,className:"description-editor"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-content",ref:this.elementRef},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input textarea required"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("textarea",{name:"description",className:"fluid","aria-required":!0,ref:this.textareaRef,maxLength:"10000",placeholder:this.translate("Enter a description"),value:isReady?this.state.resourceViewModel.description:"",onChange:this.handleInputChange,disabled:this.hasAllInputDisabled(),autoComplete:"off"})),this.state.unexpectedError&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"feedbacks error-message"},this.state.unexpectedError),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"actions"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"description-lock"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",onClick:this.handleDescriptionToggle,className:"link no-border lock-toggle"},isReady&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,this.state.resourceViewModel.isDescriptionUnencrypted()?react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Tooltip_Tooltip__WEBPACK_IMPORTED_MODULE_4__.A,{message:this.translate("Do not store sensitive data or click here to enable encryption for the description field.")},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_components_Icons_Icon__WEBPACK_IMPORTED_MODULE_7__.A,{name:"lock-open"})):react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Tooltip_Tooltip__WEBPACK_IMPORTED_MODULE_4__.A,{message:this.translate("The description content will be encrypted."),icon:""},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_components_Icons_Icon__WEBPACK_IMPORTED_MODULE_7__.A,{name:"lock"}))))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",disabled:this.hasAllInputDisabled(),className:"cancel",onClick:this.handleCancel},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_6__.x6,null,"Cancel")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",disabled:this.hasAllInputDisabled(),className:"primary description-editor-submit "+(this.hasAllInputDisabled()?"processing":""),onClick:this.handleFormSubmit},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_6__.x6,null,"Save"))))))}}EditResourceDescription.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_13___default().any,plaintextSecretDto:prop_types__WEBPACK_IMPORTED_MODULE_13___default().object,resource:prop_types__WEBPACK_IMPORTED_MODULE_13___default().any,onClose:prop_types__WEBPACK_IMPORTED_MODULE_13___default().func,onUpdate:prop_types__WEBPACK_IMPORTED_MODULE_13___default().func,resourceWorkspaceContext:prop_types__WEBPACK_IMPORTED_MODULE_13___default().any,resourceTypes:prop_types__WEBPACK_IMPORTED_MODULE_13___default().instanceOf(_shared_models_entity_resourceType_resourceTypesCollection__WEBPACK_IMPORTED_MODULE_12__.A),actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_13___default().any,loadingContext:prop_types__WEBPACK_IMPORTED_MODULE_13___default().any,t:prop_types__WEBPACK_IMPORTED_MODULE_13___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)((0,_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_5__.Qw)((0,_shared_context_ResourceTypesLocalStorageContext_ResourceTypesLocalStorageContext__WEBPACK_IMPORTED_MODULE_11__.KH)((0,_contexts_LoadingContext__WEBPACK_IMPORTED_MODULE_3__.$A)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_2__.ot)((0,react_i18next__WEBPACK_IMPORTED_MODULE_6__.CI)("common")(EditResourceDescription))))));EditResourceDescription.__docgenInfo={description:"This component allows the current user to edit the description of a resource",methods:[{name:"defaultState",docblock:"Get default state\n@returns {object}",modifiers:["get"],params:[],returns:{type:{name:"object"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"createInputRef",docblock:"Create DOM nodes or React elements references in order to be able to access them programmatically.",modifiers:[],params:[],returns:null,description:"Create DOM nodes or React elements references in order to be able to access them programmatically."},{name:"initializeResourceViewModel",docblock:"initialize the resource view model",modifiers:[],params:[],returns:null,description:"initialize the resource view model"},{name:"getViewModelTypeBySlug",docblock:"Returns the corresponding ResourceViewModel type based on the given slug.\n@param {string} slug\n@returns {typeof ResourceViewModel}\n@throws {Error} if the slug is unknown",modifiers:[],params:[{name:"slug",type:{name:"string"},optional:!1}],returns:null,description:"Returns the corresponding ResourceViewModel type based on the given slug."},{name:"save",docblock:"Save the changes.",modifiers:["async"],params:[],returns:null,description:"Save the changes."},{name:"updateResource",docblock:"Update the resource\n@returns {Promise<Object>} updated resource",modifiers:["async"],params:[],returns:{description:"updated resource",type:{name:"Promise",elements:[{name:"Object"}]}},description:"Update the resource"},{name:"close",docblock:"Toggle the editor back to display mode",modifiers:[],params:[],returns:null,description:"Toggle the editor back to display mode"},{name:"removeOutsideEditorClickEvent",docblock:"Remove listener for outside description editor clicks that aims to closes the editor",modifiers:[],params:[],returns:null,description:"Remove listener for outside description editor clicks that aims to closes the editor"},{name:"handleOutsideEditorClickEvent",docblock:"handle a click outside of the editor",modifiers:[],params:[],returns:null,description:"handle a click outside of the editor"},{name:"setFocusOnDescriptionEditor",docblock:"set the focus at the end of the description editor",modifiers:[],params:[],returns:null,description:"set the focus at the end of the description editor"},{name:"handleEditorClickEvent",docblock:"Handle click events on editor. Hide the component if the click occurred outside of the component.\n@param {ReactEvent} event The event",modifiers:[],params:[{name:"event",description:"The event",type:{name:"ReactEvent"},optional:!1}],returns:null,description:"Handle click events on editor. Hide the component if the click occurred outside of the component."},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"handleKeyDown",docblock:"Handle key down on the component.\n@params {ReactEvent} The react event",modifiers:[],params:[{name:"event",optional:!1}],returns:null,description:"Handle key down on the component."},{name:"handleCancel",docblock:"On cancel button click",modifiers:[],params:[],returns:null,description:"On cancel button click"},{name:"handleInputChange",docblock:"Handle form input change.\n@params {ReactEvent} The react event.",modifiers:[],params:[{name:"event",optional:!1}],returns:null,description:"Handle form input change."},{name:"handleFormSubmit",docblock:"Handle form submit event.\n@params {ReactEvent} The react event\n@return {Promise}",modifiers:["async"],params:[{name:"event",optional:!1}],returns:{type:{name:"Promise"}},description:"Handle form submit event."},{name:"handleDescriptionToggle",docblock:"Switch to toggle description field encryption",modifiers:["async"],params:[],returns:null,description:"Switch to toggle description field encryption"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"EditResourceDescription",props:{context:{description:"",type:{name:"any"},required:!1},plaintextSecretDto:{description:"",type:{name:"object"},required:!1},resource:{description:"",type:{name:"any"},required:!1},onClose:{description:"",type:{name:"func"},required:!1},onUpdate:{description:"",type:{name:"func"},required:!1},resourceWorkspaceContext:{description:"",type:{name:"any"},required:!1},resourceTypes:{description:"",type:{name:"instanceOf",value:"ResourceTypesCollection"},required:!1},actionFeedbackContext:{description:"",type:{name:"any"},required:!1},loadingContext:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}}}]);