/*! For license information please see 5552.3f647b57.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[5552],{"./src/react-extension/components/UserSetting/EditUserProfile/EditUserProfile.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_11__),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/components/Common/Dialog/DialogWrapper/DialogWrapper.js"),_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormSubmitButton.js"),_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormCancelButton.js"),_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),react_i18next__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_contexts_UserSettingsContext__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/react-extension/contexts/UserSettingsContext.js"),_Common_Select_Select__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/react-extension/components/Common/Select/Select.js");class EditUserProfile extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindHandlers(),this.createReferences()}async componentDidMount(){await this.populate()}get defaultState(){return{profile:{first_name:"",last_name:"",username:"",locale:"en-UK"},actions:{processing:!1},errors:{isFirstnameEmpty:!1,isLastnameEmpty:!1},hasAlreadyBeenValidated:!1}}get isProcessing(){return this.state.actions.processing}get areActionsAllowed(){return!this.isProcessing}get hasErrors(){return Object.values(this.state.errors).some((value=>value))}bindHandlers(){this.handleInputChange=this.handleInputChange.bind(this),this.handleClose=this.handleClose.bind(this),this.handleSave=this.handleSave.bind(this)}createReferences(){this.firstnameRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.lastnameRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef()}async handleInputChange(event){const target=event.target,value=target.value,name=target.name;this.setState({profile:Object.assign(this.state.profile,{[name]:value})}),this.state.hasAlreadyBeenValidated&&await this.validate()}handleClose(){this.close()}async handleSave(event){event.preventDefault(),await this.save()}async populate(){const{first_name,last_name}=this.props.context.loggedInUser.profile,locale=this.props.context.locale;await this.setState({profile:{first_name,last_name,locale}})}async save(){if(await this.setState({hasAlreadyBeenValidated:!0}),await this.toggleProcessing(),await this.validate(),this.hasErrors)return await this.toggleProcessing(),void this.focusFirstFieldError();await this.updateUserProfile().then(this.onSaveSuccess.bind(this)).catch(this.onSaveError.bind(this))}async updateUserProfile(){const userToUpdateDto=this.buildUserToUpdateDto();if(await this.props.context.port.request("passbolt.users.update",userToUpdateDto),this.canIUseLocale){const localeToUpdateDto=this.buildLocaleToUpdateDto();await this.props.userSettingsContext.onUpdateLocaleUserRequested(localeToUpdateDto)}}buildUserToUpdateDto(){const{id,username}=this.props.context.loggedInUser;return{id,username,profile:{first_name:this.state.profile.first_name,last_name:this.state.profile.last_name}}}buildLocaleToUpdateDto(){return{locale:this.state.profile.locale}}async onSaveSuccess(){await this.props.actionFeedbackContext.displaySuccess(this.translate("The user has been updated successfully"));const loggedInUser=await this.props.context.port.request("passbolt.users.find-logged-in-user",!0);this.props.context.setContext({loggedInUser}),this.props.context.onUpdateLocaleRequested(),this.props.onClose()}async onSaveError(error){await this.toggleProcessing();const errorDialogProps={error};this.props.dialogContext.open(_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_5__.A,errorDialogProps)}close(){this.props.onClose()}async validate(){const isEmpty=s=>0===s.trim().length,errors={isFirstnameEmpty:isEmpty(this.state.profile.first_name),isLastnameEmpty:isEmpty(this.state.profile.last_name)};await this.setState({errors})}focusFirstFieldError(){this.state.errors.isFirstnameEmpty?this.firstnameRef.current.focus():this.state.errors.isLastnameEmpty&&this.lastnameRef.current.focus()}async toggleProcessing(){const prev=this.state.actions.processing;return this.setState({actions:Object.assign(this.state.actions,{processing:!prev})})}get translate(){return this.props.t}get supportedLocales(){return this.props.context.siteSettings.supportedLocales?this.props.context.siteSettings.supportedLocales.map((supportedLocale=>({value:supportedLocale.locale,label:supportedLocale.label}))):[]}get canIUseLocale(){return this.props.context.siteSettings.canIUse("locale")}render(){const firstnameErrorSelector=this.state.errors.isFirstnameEmpty?"error":"",lastnameErrorSelector=this.state.errors.isLastnameEmpty?"error":"";return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_2__.A,{title:this.translate("Edit profile"),onClose:this.handleClose,disabled:!this.areActionsAllowed},react__WEBPACK_IMPORTED_MODULE_0__.createElement("form",{className:"user-edit-form",onSubmit:this.handleSave,noValidate:!0},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-content"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input text required ${firstnameErrorSelector} ${this.areActionsAllowed?"":"disabled"}`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"user-profile-firstname-input"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_8__.x6,null,"First name")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"user-profile-firstname-input",name:"first_name",type:"text",placeholder:this.translate("First name"),required:"required",autoComplete:"off",autoFocus:!0,ref:this.firstnameRef,value:this.state.profile.first_name,onChange:this.handleInputChange,disabled:!this.areActionsAllowed}),this.state.errors.isFirstnameEmpty&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"first_name error-message"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_8__.x6,null,"A first name is required."))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input text required ${lastnameErrorSelector} ${this.areActionsAllowed?"":"disabled"}`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"user-profile-lastname-input"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_8__.x6,null,"Last name")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"user-profile-lastname-input",name:"last_name",type:"text",placeholder:this.translate("Last name"),required:"required",autoComplete:"off",ref:this.lastnameRef,value:this.state.profile.last_name,onChange:this.handleInputChange,disabled:!this.areActionsAllowed}),this.state.errors.isLastnameEmpty&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"last_name error-message"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_8__.x6,null,"A last name is required."))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input text required disabled"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"user-profile-username-input"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_8__.x6,null,"Username / Email")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"user-profile-username-input",name:"username",type:"text",disabled:!0,"aria-required":!0,value:this.props.context.loggedInUser.username})),this.canIUseLocale&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"select-wrapper input required "+(this.areActionsAllowed?"":"disabled")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"user-profile-locale-input"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_8__.x6,null,"Language")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Select_Select__WEBPACK_IMPORTED_MODULE_10__.A,{id:"user-profile-locale-input",name:"locale",value:this.state.profile.locale,items:this.supportedLocales,disabled:!this.areActionsAllowed,onChange:this.handleInputChange}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"submit-wrapper clearfix"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_4__.A,{disabled:!this.areActionsAllowed,onClick:this.handleClose}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_3__.A,{disabled:!this.areActionsAllowed,processing:this.isProcessing,value:this.translate("Save")}))))}}EditUserProfile.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_11___default().any,onClose:prop_types__WEBPACK_IMPORTED_MODULE_11___default().func,dialogContext:prop_types__WEBPACK_IMPORTED_MODULE_11___default().object,userSettingsContext:prop_types__WEBPACK_IMPORTED_MODULE_11___default().object,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_11___default().object,t:prop_types__WEBPACK_IMPORTED_MODULE_11___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_7__.ot)((0,_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_6__.z9)((0,_contexts_UserSettingsContext__WEBPACK_IMPORTED_MODULE_9__.tX)((0,react_i18next__WEBPACK_IMPORTED_MODULE_8__.CI)("common")(EditUserProfile)))));EditUserProfile.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Returns the component default state",modifiers:["get"],params:[],returns:null,description:"Returns the component default state"},{name:"isProcessing",docblock:"Return trus if the export is processing",modifiers:["get"],params:[],returns:null,description:"Return trus if the export is processing"},{name:"areActionsAllowed",docblock:"Returns true if actions can be performed",modifiers:["get"],params:[],returns:null,description:"Returns true if actions can be performed"},{name:"hasErrors",docblock:"True if the edit has validation errors",modifiers:["get"],params:[],returns:null,description:"True if the edit has validation errors"},{name:"bindHandlers",docblock:"Bind  handlers",modifiers:[],params:[],returns:null,description:"Bind  handlers"},{name:"createReferences",docblock:"Create references",modifiers:[],params:[],returns:null,description:"Create references"},{name:"handleInputChange",docblock:"Handle form input changes.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:["async"],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle form input changes."},{name:"handleClose",docblock:"Whenever the user wants to close",modifiers:[],params:[],returns:null,description:"Whenever the user wants to close"},{name:"handleSave",docblock:"Whenever the user wants to save the changes on his profile\n@param event A DOM event",modifiers:["async"],params:[{name:"event",description:"A DOM event",optional:!1}],returns:null,description:"Whenever the user wants to save the changes on his profile"},{name:"populate",docblock:"Populates the component with data",modifiers:["async"],params:[],returns:null,description:"Populates the component with data"},{name:"save",docblock:"Saves the change on the user profile",modifiers:["async"],params:[],returns:null,description:"Saves the change on the user profile"},{name:"updateUserProfile",docblock:"Update the user profile.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Update the user profile."},{name:"buildUserToUpdateDto",docblock:"Build the user to update DTO\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Build the user to update DTO"},{name:"buildLocaleToUpdateDto",docblock:"Build the locale to update DTO\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Build the locale to update DTO"},{name:"onSaveSuccess",docblock:"Whenever the save has been successful",modifiers:["async"],params:[],returns:null,description:"Whenever the save has been successful"},{name:"onSaveError",docblock:"Whenever the save has failed\n@param error The error",modifiers:["async"],params:[{name:"error",description:"The error",optional:!1}],returns:null,description:"Whenever the save has failed"},{name:"close",docblock:"Close the component",modifiers:[],params:[],returns:null,description:"Close the component"},{name:"validate",docblock:"Validates the edit data",modifiers:["async"],params:[],returns:null,description:"Validates the edit data"},{name:"focusFirstFieldError",docblock:"Focus the first field of the form which is in error state.",modifiers:[],params:[],returns:null,description:"Focus the first field of the form which is in error state."},{name:"toggleProcessing",docblock:"Toggle processing state\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Toggle processing state"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"},{name:"supportedLocales",docblock:"Get the supported locales\n@returns {array}",modifiers:["get"],params:[],returns:{type:{name:"array"}},description:"Get the supported locales"},{name:"canIUseLocale",docblock:"Can I use the locale plugin.\n@type {boolean}",modifiers:["get"],params:[],returns:null,description:"Can I use the locale plugin."}],displayName:"EditUserProfile",props:{context:{description:"",type:{name:"any"},required:!1},onClose:{description:"",type:{name:"func"},required:!1},dialogContext:{description:"",type:{name:"object"},required:!1},userSettingsContext:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-extension/contexts/UserSettingsContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,T6:()=>UserSettingsContextState,tX:()=>withUserSettings});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js");const UserSettingsContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({state:null,oldPassphrase:null,onIntroductionPassphraseRequested:()=>{},onProvidePassphraseRequested:()=>{},onCheckProvidePassphraseRequested:()=>{},onUpdatePassphraseRequested:()=>{},onGoToIntroductionPassphraseRequested:()=>{},onDownloadRecoveryKitRequested:()=>{},onUpdateSecurityTokenRequested:()=>{},onUpdateUserLocaleRequested:()=>{}});class UserSettingsContextProvider extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState}get defaultState(){return{state:UserSettingsContextState.INITIAL_STATE,oldPassphrase:null,onIntroductionPassphraseRequested:this.onIntroductionPassphraseRequested.bind(this),onProvidePassphraseRequested:this.onProvidePassphraseRequested.bind(this),onCheckProvidePassphraseRequested:this.onCheckProvidePassphraseRequested.bind(this),onUpdatePassphraseRequested:this.onUpdatePassphraseRequested.bind(this),onGoToIntroductionPassphraseRequested:this.onGoToIntroductionPassphraseRequested.bind(this),onDownloadRecoveryKitRequested:this.onDownloadRecoveryKitRequested.bind(this),onUpdateSecurityTokenRequested:this.onUpdateSecurityTokenRequested.bind(this),onUpdateLocaleUserRequested:this.handleUpdateLocaleUserRequested.bind(this)}}async onIntroductionPassphraseRequested(){await this.setState({state:UserSettingsContextState.PASSPHRASE_INTRODUCTION})}async onProvidePassphraseRequested(){await this.setState({state:UserSettingsContextState.PASSPHRASE_TO_PROVIDE_REQUESTED})}async onCheckProvidePassphraseRequested(passphrase){await this.props.context.port.request("passbolt.auth.verify-passphrase",passphrase),await this.setState({state:UserSettingsContextState.PASSPHRASE_TO_PROVIDE_CHECKED,oldPassphrase:passphrase})}async onGoToIntroductionPassphraseRequested(){await this.setState({state:UserSettingsContextState.PASSPHRASE_INTRODUCTION,oldPassphrase:null})}async onUpdatePassphraseRequested(passphrase){await this.props.context.port.request("passbolt.user.update-private-key",this.state.oldPassphrase,passphrase),await this.setState({state:UserSettingsContextState.PASSPHRASE_UPDATED,oldPassphrase:null})}async onDownloadRecoveryKitRequested(){await this.props.context.port.request("passbolt.keyring.download-my-private-key")}async onUpdateSecurityTokenRequested(securityTokenDto){await this.props.context.port.request("passbolt.users.update-security-token",securityTokenDto)}async handleUpdateLocaleUserRequested(localeDto){await this.props.context.port.request("passbolt.locale.update-user-locale",localeDto)}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(UserSettingsContext.Provider,{value:this.state},this.props.children)}}UserSettingsContextProvider.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_2___default().any,children:prop_types__WEBPACK_IMPORTED_MODULE_2___default().any};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)(UserSettingsContextProvider);function withUserSettings(WrappedComponent){return class withUserSettings extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(UserSettingsContext.Consumer,null,(userSettingsContext=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(WrappedComponent,{userSettingsContext,...this.props})))}}}const UserSettingsContextState={INITIAL_STATE:"Initial State",PASSPHRASE_INTRODUCTION:"Passphrase Introduction",PASSPHRASE_TO_PROVIDE_REQUESTED:"Passphrase To Provide Requested",PASSPHRASE_TO_PROVIDE_CHECKED:"Passphrase To Provide Checked",PASSPHRASE_UPDATED:"Passphrase Updated"};UserSettingsContextProvider.__docgenInfo={description:"The related context provider",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"},{name:"onIntroductionPassphraseRequested",docblock:"Whenever the introduction passphrase is requested",modifiers:["async"],params:[],returns:null,description:"Whenever the introduction passphrase is requested"},{name:"onProvidePassphraseRequested",docblock:"Whenever the provide passphrase is requested",modifiers:["async"],params:[],returns:null,description:"Whenever the provide passphrase is requested"},{name:"onCheckProvidePassphraseRequested",docblock:"Whenever the check provide passphrase is requested\n@param passphrase A passphrase",modifiers:["async"],params:[{name:"passphrase",description:"A passphrase",optional:!1}],returns:null,description:"Whenever the check provide passphrase is requested"},{name:"onGoToIntroductionPassphraseRequested",docblock:"Whenever the user wants to go back to the passphrase introduction",modifiers:["async"],params:[],returns:null,description:"Whenever the user wants to go back to the passphrase introduction"},{name:"onUpdatePassphraseRequested",docblock:"Whenever the update passphrase is requested\n@param {string} passphrase The new passphrase",modifiers:["async"],params:[{name:"passphrase",description:"The new passphrase",type:{name:"string"},optional:!1}],returns:null,description:"Whenever the update passphrase is requested"},{name:"onDownloadRecoveryKitRequested",docblock:"Whenever the download of the recovery kit is requested",modifiers:["async"],params:[],returns:null,description:"Whenever the download of the recovery kit is requested"},{name:"onUpdateSecurityTokenRequested",docblock:"Whenever the update security token is requested\n@param securityTokenDto The security token DTO",modifiers:["async"],params:[{name:"securityTokenDto",description:"The security token DTO",optional:!1}],returns:null,description:"Whenever the update security token is requested"},{name:"handleUpdateLocaleUserRequested",docblock:"Whenever the update of the locale is requested\n@param localeDto The locale DTO",modifiers:["async"],params:[{name:"localeDto",description:"The locale DTO",optional:!1}],returns:null,description:"Whenever the update of the locale is requested"}],displayName:"UserSettingsContextProvider",props:{context:{description:"",type:{name:"any"},required:!1},children:{description:"",type:{name:"any"},required:!1}}}}}]);