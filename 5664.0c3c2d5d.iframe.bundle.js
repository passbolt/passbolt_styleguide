/*! For license information please see 5664.0c3c2d5d.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[5664],{"./src/react-extension/contexts/MFAContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N8:()=>MfaContextProvider,bb:()=>Providers,dg:()=>withMfa,hx:()=>MfaSettingsWorkflowStates});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_5__),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_shared_models_mfaPolicy_MfaPolicyEnumeration__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/mfaPolicy/MfaPolicyEnumeration.js"),_shared_services_api_Mfa_MfaService__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/services/api/Mfa/MfaService.js"),_shared_services_api_mfaPolicy_MfaPolicyService__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/shared/services/api/mfaPolicy/MfaPolicyService.js");const MfaSettingsWorkflowStates={OVERVIEW:"Overview",TOTPOVERVIEW:"Totp Overview",SCANTOTPCODE:"Scan totp code",VIEWCONFIGURATION:"View a totp configuration",SETUPYUBIKEY:"Setup Yubikey"},Providers={TOTP:"totp",YUBIKEY:"yubikey",DUO:"duo"},MfaContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({state:null,setup:null,provider:null,getPolicy:()=>{},getMfaOrganisationSettings:()=>{},getMfaUserSettings:()=>{},findPolicy:()=>{},setProcessing:()=>{},isProcessing:()=>{},clearContext:()=>{},isMfaChoiceRequired:()=>{},checkMfaChoiceRequired:()=>{},hasMfaUserSettings:()=>{},navigate:()=>{},setProvider:()=>{},goToProviderList:()=>{},validateTotpCode:()=>{},removeProvider:()=>{},validateYubikeyCode:()=>{}});class MfaContextProvider extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.props.context.getApiClientOptions&&(this.mfaService=new _shared_services_api_Mfa_MfaService__WEBPACK_IMPORTED_MODULE_3__.A(this.props.context.getApiClientOptions()),this.mfaPolicyService=new _shared_services_api_mfaPolicy_MfaPolicyService__WEBPACK_IMPORTED_MODULE_4__.A(this.props.context.getApiClientOptions()))}get defaultState(){return{state:MfaSettingsWorkflowStates.OVERVIEW,setup:null,policy:null,provider:null,processing:!0,mfaUserSettings:null,mfaOrganisationSettings:null,mfaChoiceRequired:!1,getPolicy:this.getPolicy.bind(this),getMfaOrganisationSettings:this.getMfaOrganisationSettings.bind(this),getMfaUserSettings:this.getMfaUserSettings.bind(this),findPolicy:this.findPolicy.bind(this),findMfaSettings:this.findMfaSettings.bind(this),isProcessing:this.isProcessing.bind(this),setProcessing:this.setProcessing.bind(this),hasMfaSettings:this.hasMfaSettings.bind(this),hasMfaOrganisationSettings:this.hasMfaOrganisationSettings.bind(this),hasMfaUserSettings:this.hasMfaUserSettings.bind(this),clearContext:this.clearContext.bind(this),checkMfaChoiceRequired:this.checkMfaChoiceRequired.bind(this),isMfaChoiceRequired:this.isMfaChoiceRequired.bind(this),navigate:this.navigate.bind(this),setProvider:this.setProvider.bind(this),goToProviderList:this.goToProviderList.bind(this),validateTotpCode:this.validateTotpCode.bind(this),removeProvider:this.removeProvider.bind(this),validateYubikeyCode:this.validateYubikeyCode.bind(this)}}async findPolicy(){if(this.getPolicy())return;this.setProcessing(!0);let policy=null,result=null;result=this.mfaPolicyService?await this.mfaPolicyService.find():await this.props.context.port.request("passbolt.mfa-policy.get-policy"),policy=result?result.policy:null,this.setState({policy}),this.setProcessing(!1)}async findMfaSettings(){this.setProcessing(!0);let settings=null,mfaUserSettings=null,mfaOrganisationSettings=null;settings=this.mfaService?await this.mfaService.getUserSettings():await this.props.context.port.request("passbolt.mfa-policy.get-mfa-settings"),mfaUserSettings=settings.MfaAccountSettings,mfaOrganisationSettings=settings.MfaOrganizationSettings,this.setState({mfaUserSettings}),this.setState({mfaOrganisationSettings}),this.setProcessing(!1)}getPolicy(){return this.state.policy}getMfaOrganisationSettings(){return this.state.mfaOrganisationSettings}getMfaUserSettings(){return this.state.mfaUserSettings}hasMfaSettings(){return!this.hasMfaOrganisationSettings()||this.hasMfaUserSettings()}hasMfaOrganisationSettings(){return this.state.mfaOrganisationSettings&&Object.values(this.state.mfaOrganisationSettings).some((value=>value))}hasMfaUserSettings(){return this.state.mfaUserSettings&&Object.values(this.state.mfaUserSettings).some((value=>value))}isProcessing(){return this.state.processing}setProcessing(processing){this.setState({processing})}clearContext(){const{policy,processing}=this.defaultState;this.setState({policy,processing})}async checkMfaChoiceRequired(){if(await this.findPolicy(),null===this.getPolicy()||this.getPolicy()!==_shared_models_mfaPolicy_MfaPolicyEnumeration__WEBPACK_IMPORTED_MODULE_2__.F.MANDATORY)return!1;await this.findMfaSettings(),this.setState({mfaChoiceRequired:!this.hasMfaSettings()})}isMfaChoiceRequired(){return this.state.mfaChoiceRequired}navigate(state){this.setState({state})}goToProviderList(){this.setState({state:MfaSettingsWorkflowStates.OVERVIEW,provider:null})}setProvider(provider){this.setState({provider})}async validateTotpCode(otpProvisioningUri,totp){try{this.setProcessing(!0),await this.props.context.port.request("passbolt.mfa-setup.verify-totp-code",{otpProvisioningUri,totp})}catch(error){throw console.error(error),error}finally{this.setProcessing(!1)}}async validateYubikeyCode(hotp){try{this.setProcessing(!0),await this.props.context.port.request("passbolt.mfa-setup.verify-yubikey-code",{hotp})}catch(error){throw console.error(error),error}finally{this.setProcessing(!1)}}async removeProvider(){try{this.setProcessing(!0),await this.props.context.port.request("passbolt.mfa-setup.remove-provider",{provider:this.state.provider})}catch(error){throw console.error(error),error}finally{this.setProcessing(!1)}}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(MfaContext.Provider,{value:this.state},this.props.children)}}MfaContextProvider.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_5___default().any,children:prop_types__WEBPACK_IMPORTED_MODULE_5___default().any};(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)(MfaContextProvider);function withMfa(WrappedComponent){return class WithMfa extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(MfaContext.Consumer,null,(mfaContext=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(WrappedComponent,{mfaContext,...this.props})))}}}MfaContextProvider.__docgenInfo={description:"The MFA context provider",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"},{name:"findPolicy",docblock:"Find the mfa policy settings\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Find the mfa policy settings"},{name:"findMfaSettings",docblock:"Find the mfa settings of the current user\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Find the mfa settings of the current user"},{name:"getPolicy",docblock:"Returns the policy for MFA.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns the policy for MFA."},{name:"getMfaOrganisationSettings",docblock:"Returns the mfa organisations settings.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns the mfa organisations settings."},{name:"getMfaUserSettings",docblock:"Returns the mfa user settings.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns the mfa user settings."},{name:"hasMfaSettings",docblock:"Returns if mfa settings are defined.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns if mfa settings are defined."},{name:"hasMfaOrganisationSettings",docblock:"Returns true organization settings has MFA defined\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true organization settings has MFA defined"},{name:"hasMfaUserSettings",docblock:"Returns true user settings has MFA defined\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true user settings has MFA defined"},{name:"isProcessing",docblock:"Returns true when the data is under processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true when the data is under processing"},{name:"setProcessing",docblock:"Handle processing change.\n@params {Boolean} processing value\n@returns {void}",modifiers:[],params:[{name:"processing",optional:!1}],returns:{type:{name:"void"}},description:"Handle processing change."},{name:"clearContext",docblock:"Puts the state to its default in order to avoid keeping the data users didn't want to save.",modifiers:[],params:[],returns:null,description:"Puts the state to its default in order to avoid keeping the data users didn't want to save."},{name:"checkMfaChoiceRequired",docblock:"checkMfaChoiceRequired if mfa settings is required\n@returns {bool}",modifiers:["async"],params:[],returns:{type:{name:"bool"}},description:"checkMfaChoiceRequired if mfa settings is required"},{name:"isMfaChoiceRequired",docblock:"Returns true if the current user has to choose for a mfa setting.\n@returns {bool}",modifiers:[],params:[],returns:{type:{name:"bool"}},description:"Returns true if the current user has to choose for a mfa setting."},{name:"navigate",docblock:"Change mfa settings state\n@params {string} next state step\n@returns {void}",modifiers:[],params:[{name:"state",optional:!1}],returns:{type:{name:"void"}},description:"Change mfa settings state"},{name:"goToProviderList",docblock:"Cancel a setup process or go back to mfa settings providers",modifiers:[],params:[],returns:null,description:"Cancel a setup process or go back to mfa settings providers"},{name:"setProvider",docblock:"Set the selected provider and the next step\n@params {string} next setup state\n@returns {void}",modifiers:[],params:[{name:"provider",optional:!1}],returns:{type:{name:"void"}},description:"Set the selected provider and the next step"},{name:"validateTotpCode",docblock:"Validate the totp provider with code and uri provided during setup\n@param {string} otpProvisioningUri\n@param {string} totp\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"otpProvisioningUri",type:{name:"string"},optional:!1},{name:"totp",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Validate the totp provider with code and uri provided during setup"},{name:"validateYubikeyCode",docblock:"Validate the totp provider with code and uri provided during setup\n@param {string} hotp\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"hotp",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Validate the totp provider with code and uri provided during setup"},{name:"removeProvider",docblock:"Delete the totp provider from configuration\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Delete the totp provider from configuration"}],displayName:"MfaContextProvider",props:{context:{description:"",type:{name:"any"},required:!1},children:{description:"",type:{name:"any"},required:!1}}}},"./src/shared/lib/Error/PassboltApiFetchError.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class PassboltApiFetchError extends Error{constructor(message,data){super(message),this.name="PassboltApiFetchError",this.data=data||{}}}const __WEBPACK_DEFAULT_EXPORT__=PassboltApiFetchError},"./src/shared/lib/Error/PassboltServiceUnavailableError.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class PassboltServiceUnavailableError extends Error{constructor(message){super(message=message||"The service is unavailable"),this.name="PassboltServiceUnavailableError"}}const __WEBPACK_DEFAULT_EXPORT__=PassboltServiceUnavailableError},"./src/shared/lib/apiClient/apiClient.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>ApiClient});var PassboltApiFetchError=__webpack_require__("./src/shared/lib/Error/PassboltApiFetchError.js");class PassboltBadResponseError extends Error{constructor(){super("An internal error occurred. The server response could not be parsed. Please contact your administrator."),this.name="PassboltBadResponseError"}}const Error_PassboltBadResponseError=PassboltBadResponseError;var PassboltServiceUnavailableError=__webpack_require__("./src/shared/lib/Error/PassboltServiceUnavailableError.js");const SUPPORTED_METHODS=["GET","POST","PUT","DELETE"];class ApiClient{constructor(options){if(this.options=options,!this.options.getBaseUrl())throw new TypeError("ApiClient constructor error: baseUrl is required.");if(!this.options.getResourceName())throw new TypeError("ApiClient constructor error: resourceName is required.");try{let rawBaseUrl=this.options.getBaseUrl().toString();rawBaseUrl.endsWith("/")&&(rawBaseUrl=rawBaseUrl.slice(0,-1));let resourceName=this.options.getResourceName();resourceName.startsWith("/")&&(resourceName=resourceName.slice(1)),resourceName.endsWith("/")&&(resourceName=resourceName.slice(0,-1)),this.baseUrl=`${rawBaseUrl}/${resourceName}`,this.baseUrl=new URL(this.baseUrl)}catch(typeError){throw new TypeError("ApiClient constructor error: b.")}this.apiVersion="api-version=v2"}getDefaultHeaders(){return{Accept:"application/json","content-type":"application/json"}}async buildFetchOptions(){const optionHeaders=await this.options.getHeaders();return{credentials:"include",headers:{...this.getDefaultHeaders(),...optionHeaders}}}async get(id,urlOptions){this.assertValidId(id);const url=this.buildUrl(`${this.baseUrl}/${id}`,urlOptions||{});return this.fetchAndHandleResponse("GET",url)}async delete(id,body,urlOptions,dryRun){let url;this.assertValidId(id),void 0===dryRun&&(dryRun=!1),url=dryRun?this.buildUrl(`${this.baseUrl}/${id}/dry-run`,urlOptions||{}):this.buildUrl(`${this.baseUrl}/${id}`,urlOptions||{});let bodyString=null;return body&&(bodyString=this.buildBody(body)),this.fetchAndHandleResponse("DELETE",url,bodyString)}async findAll(urlOptions){const url=this.buildUrl(this.baseUrl.toString(),urlOptions||{});return this.fetchAndHandleResponse("GET",url)}async create(body,urlOptions){const url=this.buildUrl(this.baseUrl.toString(),urlOptions||{}),bodyString=this.buildBody(body);return this.fetchAndHandleResponse("POST",url,bodyString)}async update(id,body,urlOptions,dryRun){let url;this.assertValidId(id),void 0===dryRun&&(dryRun=!1),url=dryRun?this.buildUrl(`${this.baseUrl}/${id}/dry-run`,urlOptions||{}):this.buildUrl(`${this.baseUrl}/${id}`,urlOptions||{});let bodyString=null;return body&&(bodyString=this.buildBody(body)),this.fetchAndHandleResponse("PUT",url,bodyString)}async updateAll(body,urlOptions={}){const url=this.buildUrl(this.baseUrl.toString(),urlOptions),bodyString=body?this.buildBody(body):null;return this.fetchAndHandleResponse("PUT",url,bodyString)}assertValidId(id){if(!id)throw new TypeError("ApiClient.assertValidId error: id cannot be empty");if("string"!=typeof id)throw new TypeError("ApiClient.assertValidId error: id should be a string")}assertMethod(method){if("string"!=typeof method)throw new TypeError("ApiClient.assertValidMethod method should be a string.");if(SUPPORTED_METHODS.indexOf(method.toUpperCase())<0)throw new TypeError(`ApiClient.assertValidMethod error: method ${method} is not supported.`)}assertUrl(url){if(!url)throw new TypeError("ApliClient.assertUrl error: url is required.");if(!(url instanceof URL))throw new TypeError("ApliClient.assertUrl error: url should be a valid URL object.");if("https:"!==url.protocol&&"http:"!==url.protocol)throw new TypeError("ApliClient.assertUrl error: url protocol should only be https or http.")}assertBody(body){if(!(body instanceof FormData)&&"string"!=typeof body)throw new TypeError("ApiClient.assertBody error: body should be a string or a FormData.")}buildBody(body){return JSON.stringify(body)}buildUrl(url,urlOptions){if("string"!=typeof url)throw new TypeError("ApiClient.buildUrl error: url should be a string.");const urlObj=new URL(`${url}.json?${this.apiVersion}`);urlOptions=urlOptions||{};for(const[key,value]of Object.entries(urlOptions)){if("string"!=typeof key)throw new TypeError("ApiClient.buildUrl error: urlOptions key should be a string.");if("string"==typeof value)urlObj.searchParams.append(key,value);else{if(!Array.isArray(value))throw new TypeError("ApiClient.buildUrl error: urlOptions value should be a string or array.");value.forEach((v=>{urlObj.searchParams.append(key,v)}))}}return urlObj}async sendRequest(method,url,body,options){this.assertUrl(url),this.assertMethod(method),body&&this.assertBody(body);const fetchStrategy="undefined"!=typeof customApiClientFetch?customApiClientFetch:fetch,fetchOptions={...await this.buildFetchOptions(),...options};fetchOptions.method=method,body&&(fetchOptions.body=body);try{return await fetchStrategy(url.toString(),fetchOptions)}catch(error){throw console.error(error),navigator.onLine?new PassboltServiceUnavailableError.A("Unable to reach the server, an unexpected error occurred"):new PassboltServiceUnavailableError.A("Unable to reach the server, you are not connected to the network")}}async fetchAndHandleResponse(method,url,body,options){const response=await this.sendRequest(method,url,body,options);return this.parseResponseJson(response)}async parseResponseJson(response){let responseJson;try{responseJson=await response.json()}catch(error){throw console.debug(response.url.toString(),error),new Error_PassboltBadResponseError(error,response)}if(!response.ok){const message=responseJson.header.message;throw new PassboltApiFetchError.A(message,{code:response.status,body:responseJson.body})}return responseJson}}},"./src/shared/models/mfaPolicy/MfaPolicyEnumeration.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>MfaPolicyEnumerationTypes});const MfaPolicyEnumerationTypes={MANDATORY:"mandatory",OPTIN:"opt-in"}},"./src/shared/services/api/Mfa/MfaService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _lib_apiClient_apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/lib/apiClient/apiClient.js");const __WEBPACK_DEFAULT_EXPORT__=class MFAService{constructor(apiClientOptions){this.apiClientOptions=apiClientOptions}async findAllSettings(){return this.initClient(),(await this.apiClient.findAll()).body}async save(MFASetting){return this.initClient(),(await this.apiClient.create(MFASetting)).body}async getUserSettings(){return this.initClient("setup/select"),(await this.apiClient.findAll()).body}initClient(path="settings"){this.apiClientOptions.setResourceName(`mfa/${path}`),this.apiClient=new _lib_apiClient_apiClient__WEBPACK_IMPORTED_MODULE_0__.O(this.apiClientOptions)}}},"./src/shared/services/api/mfaPolicy/MfaPolicyService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _lib_apiClient_apiClient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/lib/apiClient/apiClient.js");const __WEBPACK_DEFAULT_EXPORT__=class MfaPolicyService{constructor(apiClientOptions){apiClientOptions.setResourceName("mfa-policies/settings"),this.apiClient=new _lib_apiClient_apiClient__WEBPACK_IMPORTED_MODULE_0__.O(apiClientOptions)}async find(){return(await this.apiClient.findAll()).body}async save(dto){await this.apiClient.create(dto)}}}}]);