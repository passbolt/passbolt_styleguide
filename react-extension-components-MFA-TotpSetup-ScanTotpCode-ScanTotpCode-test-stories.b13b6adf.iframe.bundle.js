/*! For license information please see react-extension-components-MFA-TotpSetup-ScanTotpCode-ScanTotpCode-test-stories.b13b6adf.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[4410],{"./src/react-extension/components/MFA/TotpSetup/ScanTotpCode/ScanTotpCode.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ScanTotpCode_test_stories});var react=__webpack_require__("./node_modules/react/index.js"),MockTranslationProvider=__webpack_require__("./src/react-extension/test/mock/components/Internationalisation/MockTranslationProvider.js"),MFAContext=__webpack_require__("./src/react-extension/contexts/MFAContext.js"),DisplayProviderList_test_data=__webpack_require__("./src/react-extension/components/MFA/DisplayProviderList/DisplayProviderList.test.data.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),browser=__webpack_require__("./node_modules/qrcode/lib/browser.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),Icon=__webpack_require__("./src/shared/components/Icons/Icon.js");class ScanTotpCode extends react.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks(),this.createInputRef()}bindCallbacks(){this.handleCancelClick=this.handleCancelClick.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this)}get defaultState(){return{qrCode:null,toptCode:"",uri:"",isSubmitted:!1,error:{isRequired:!1,invalidCode:!1}}}async componentDidMount(){this.focusOnOtpInput(),await this.getQrCode()}createInputRef(){this.otpInputRef=react.createRef()}focusOnOtpInput(){this.otpInputRef.current.focus()}getIssuer(){const domain=this.props.context.userSettings.getTrustedDomain(),parsedUrl=new URL(domain);let issuer=parsedUrl.hostname+parsedUrl.pathname;return issuer=issuer.replace(":",""),issuer=issuer.replace(/\/$/,""),issuer}async getQrCodeUri(){const uri=await this.props.context.port.request("passbolt.mfa-setup.get-totp-code");return this.setState({uri}),uri}handleInputChange(event){const toptCode=event.target.value;""!==this.state.toptCode&&this.setError("isRequired",!1),this.setState({toptCode})}async handleSubmit(event){event.preventDefault();try{this.setState({isSubmitted:!0}),""===this.state.toptCode?this.setError("isRequired",!0):(await this.props.mfaContext.validateTotpCode(this.state.uri,this.state.toptCode),this.props.mfaContext.navigate(MFAContext.hx.VIEWCONFIGURATION),await this.props.mfaContext.findMfaSettings())}catch(error){this.setError("invalidCode",!0)}}setError(key,value){const error=Object.assign({},this.state.error,{[key]:value});this.setState({error})}handleCancelClick(){this.props.mfaContext.goToProviderList()}async getQrCode(){const totpUri=await this.getQrCodeUri(),qrCode=await browser.toDataURL([{data:totpUri,mode:"byte"}],{type:"image/jpeg",quality:1});this.setState({qrCode})}hasAllInputDisabled(){return this.props.mfaContext.isProcessing()}render(){return react.createElement("div",{className:"grid grid-responsive-12"},react.createElement("div",{className:"row mfa-setup totp-scan-code"},react.createElement("div",{className:"col8 main-column totp-setup"},react.createElement("h3",null,react.createElement(es.x6,null,"Time based One Time Password (TOTP)")),react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Scan this bar code")),react.createElement("div",{className:"qrcode"},react.createElement("img",{id:"qr-canvas",src:this.state.qrCode})),react.createElement("div",{className:"input-verify"},react.createElement("form",{onSubmit:this.handleSubmit},react.createElement("div",{className:"input text required"},react.createElement("label",{htmlFor:"totp"},react.createElement(es.x6,null,"One Time Password (OTP)")),react.createElement("input",{type:"text",name:"totp",placeholder:"123456",autoComplete:"off",onChange:this.handleInputChange,disabled:this.hasAllInputDisabled(),ref:this.otpInputRef}),this.state.error.isRequired&&this.state.isSubmitted&&react.createElement("div",{className:"code-required error-message"},react.createElement(es.x6,null,"A OTP code is required.")),this.state.error.invalidCode&&this.state.isSubmitted&&react.createElement("div",{className:"invalid-code error-message"},react.createElement(es.x6,null,"This OTP is not valid."))),react.createElement("div",{className:"helptext"},react.createElement(es.x6,null,"Enter the six digit number as presented on your phone or tablet.")))),react.createElement("div",{className:"actions-wrapper"},react.createElement("button",{className:"button cancel",type:"button",disabled:this.hasAllInputDisabled(),onClick:this.handleCancelClick},react.createElement("span",null,react.createElement(es.x6,null,"Cancel"))),react.createElement("button",{className:"button primary",type:"button",disabled:this.hasAllInputDisabled(),onClick:this.handleSubmit},react.createElement("span",null,react.createElement(es.x6,null,"Validate"))))),react.createElement("div",{className:"col4 last"},react.createElement("div",{className:"sidebar-help"},react.createElement("h3",null,react.createElement(es.x6,null,"Requirements")),react.createElement("p",null,react.createElement(es.x6,null,"To proceed you need to install an application that supports Time Based One Time Passwords (TOTP) on your phone or tablet such as:"),react.createElement("a",{href:"https://support.google.com/accounts/answer/1066447",target:"_blank",rel:"noopener noreferrer"},"Google Authenticator")," ",react.createElement(es.x6,null,"or")," ",react.createElement("a",{href:"https://freeotp.github.io/",target:"_blank",rel:"noopener noreferrer"},"FreeOTP"),"."),react.createElement("a",{className:"button",href:"https://help.passbolt.com/start",target:"_blank",rel:"noopener noreferrer"},react.createElement(Icon.A,{name:"document"}),react.createElement("span",null,react.createElement(es.x6,null,"Read the documentation")))))))}}ScanTotpCode.propTypes={context:prop_types_default().object,t:prop_types_default().func,mfaContext:prop_types_default().object,port:prop_types_default().object};const ScanTotpCode_ScanTotpCode=(0,AppContext.L)((0,MFAContext.dg)((0,es.CI)("common")(ScanTotpCode)));ScanTotpCode.__docgenInfo={description:"This component will display scan for the totp setup",methods:[{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"defaultState",docblock:"Returns the component default state",modifiers:["get"],params:[],returns:null,description:"Returns the component default state"},{name:"createInputRef",docblock:"Create DOM nodes or React elements references in order to be able to access them programmatically.",modifiers:[],params:[],returns:null,description:"Create DOM nodes or React elements references in order to be able to access them programmatically."},{name:"focusOnOtpInput",docblock:"Put the focus on the otp input",modifiers:[],params:[],returns:null,description:"Put the focus on the otp input"},{name:"getIssuer",docblock:"Return Issuer\nThe domain name without http(s):// and trailing /\n@returns {string} return the issuer",modifiers:[],params:[],returns:{description:"return the issuer",type:{name:"string"}},description:"Return Issuer\nThe domain name without http(s):// and trailing /"},{name:"getQrCodeUri",docblock:"Get totp uri from bext\n@returns the totp code",modifiers:["async"],params:[],returns:{description:"the totp code"},description:"Get totp uri from bext"},{name:"handleInputChange",docblock:"Handle change of generic form input.\n@param {object} event",modifiers:[],params:[{name:"event",type:{name:"object"},optional:!1}],returns:null,description:"Handle change of generic form input."},{name:"handleSubmit",docblock:"handle the valdation click\n@param event A form submit event",modifiers:["async"],params:[{name:"event",description:"A form submit event",optional:!1}],returns:null,description:"handle the valdation click"},{name:"setError",docblock:"set an error to object",modifiers:[],params:[{name:"key",optional:!1},{name:"value",optional:!1}],returns:null,description:"set an error to object"},{name:"handleCancelClick",docblock:"handle the cancelation when setup the provider",modifiers:[],params:[],returns:null,description:"handle the cancelation when setup the provider"},{name:"getQrCode",docblock:"Populates the component with data\n@param {Uint8ClampedArray} content\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Populates the component with data"},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"}],displayName:"ScanTotpCode",props:{context:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1},mfaContext:{description:"",type:{name:"object"},required:!1},port:{description:"",type:{name:"object"},required:!1}}};const ScanTotpCode_test_stories={title:"Components/MFA/ScanTotpCode",component:ScanTotpCode_ScanTotpCode},Default=(args=>react.createElement(MFAContext.N8,args,react.createElement(MockTranslationProvider.A,null,react.createElement("div",{className:"panel middle"},react.createElement("div",{className:"grid grid-responsive-12"},react.createElement(ScanTotpCode_ScanTotpCode,args)))),";")).bind({});Default.args=(0,DisplayProviderList_test_data.Gs)();const __namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:'args => <MfaContextProvider {...args}>\n    <MockTranslationProvider>\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <ScanTotpCode {...args} />\n        </div>\n      </div>\n    </MockTranslationProvider>;\n  </MfaContextProvider>',...Default.parameters?.docs?.source}}}},"./src/react-extension/components/MFA/DisplayProviderList/DisplayProviderList.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Gs:()=>defaultProps,Ek:()=>mockMfaContext,dG:()=>propsWithMfaProviders,rC:()=>propsWithoutMfaProviders});var RbacContext_test_data=__webpack_require__("./src/shared/context/Rbac/RbacContext.test.data.js"),ExtAppContext_test_data=__webpack_require__("./src/react-extension/contexts/ExtAppContext.test.data.js"),MfaPolicyEnumeration=__webpack_require__("./src/shared/models/mfaPolicy/MfaPolicyEnumeration.js");const noMfaDefined={totp:!1,duo:!1,yubikey:!1},mfaDefined={totp:!0,duo:!1,yubikey:!1},allProviders={totp:!0,duo:!0,yubikey:!0};MfaPolicyEnumeration.F.MANDATORY,MfaPolicyEnumeration.F.OPTIN;function defaultProps(props={}){return{context:(0,ExtAppContext_test_data.st)(props.appContext),mfaContext:mockMfaContext(props.mfaContext),rbacContext:(0,RbacContext_test_data.mM)()}}function mockMfaContext(props={}){return{findPolicy:jest.fn(),getPolicy:jest.fn(),findMfaSettings:jest.fn(),hasMfaSettings:jest.fn(),isProcessing:jest.fn(),hasMfaOrganisationSettings:jest.fn(),validateYubikeyCode:jest.fn(),goToProviderList:jest.fn(),navigate:jest.fn(),...props}}const httpsTrustedDomain={userSettings:{getTrustedDomain:()=>"https://localhost:6006"}};function propsWithMfaProviders(props={}){const propsWithProviders=defaultProps({appContext:httpsTrustedDomain,mfaContext:{hasMfaOrganisationSettings:()=>!0,getMfaOrganisationSettings:()=>allProviders,getMfaUserSettings:()=>mfaDefined,setProvider:jest.fn(),navigate:jest.fn()}});return Object.assign(propsWithProviders,props)}function propsWithoutMfaProviders(props={}){const propsWithoutProviders=defaultProps({appContext:httpsTrustedDomain,mfaContext:{getMfaOrganisationSettings:()=>noMfaDefined,getMfaUserSettings:()=>noMfaDefined,hasMfaOrganisationSettings:()=>!1}});return Object.assign(propsWithoutProviders,props)}},"./src/shared/context/Rbac/RbacContext.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E2:()=>defaultAdministratorRbacContext,UO:()=>denyRbacContext,mM:()=>defaultUserRbacContext});__webpack_require__("./src/shared/models/entity/groupUser/groupUserEntity.test.data.js"),__webpack_require__("./src/shared/models/entity/user/userEntity.test.data.js");function defaultAdministratorRbacContext(data={}){return{canIUseUiAction:()=>!0,...data}}function defaultUserRbacContext(data={}){return{canIUseUiAction:()=>!0,...data}}function denyRbacContext(data={}){return{canIUseUiAction:()=>!1,...data}}},"./src/shared/models/entity/abstract/entity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class Entity{constructor(dto,options={}){(options?.clone??!0)&&(dto=JSON.parse(JSON.stringify(dto))),this._props=dto}toDto(){return JSON.parse(JSON.stringify(this))}toJSON(){return this._props}_hasProp(propName){if(!propName.includes(".")){const normalizedPropName=Entity._normalizePropName(propName);return Object.prototype.hasOwnProperty.call(this._props,normalizedPropName)}try{return this._getPropByPath(propName),!0}catch(error){return!1}}_getPropByPath(path){return Entity._normalizePropName(path).split(".").reduce(((obj,i)=>{if(Object.prototype.hasOwnProperty.call(obj,i))return obj[i];throw new Error}),this._props)}static _normalizePropName(name){return name.replace(/([A-Z])/g,((x,y)=>`_${y.toLowerCase()}`)).replace(/\._/,".").replace(/^_/,"").replace(/^\./,"")}}const __WEBPACK_DEFAULT_EXPORT__=Entity},"./src/shared/models/entity/abstract/entityV2.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _entitySchema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js"),_entity__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/abstract/entity.js"),validator_es_lib_util_assertString__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/validator/es/lib/util/assertString.js"),_entityValidationError__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js");const SCALAR_PROPERTY_TYPES=["string","number","integer","boolean"];class EntityV2 extends _entity__WEBPACK_IMPORTED_MODULE_2__.A{static _cachedSchema={};constructor(dtos={},options={}){const validate=options?.validate??!0;if(super(dtos,options),this.marshall(),validate){const error=this.validate({schema:options?.schema,validateBuildRules:options?.validateBuildRules});if(error)throw error}}marshall(){}validate(options={}){try{this.validateSchema(options?.schema),this.validateBuildRules(options?.validateBuildRules)}catch(error){if(!(error instanceof _entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A))throw error;return error}return null}validateSchema(schema=null){this._props=_entitySchema__WEBPACK_IMPORTED_MODULE_0__.A.validate(this.constructor.name,this._props,schema??this.cachedSchema)}get cachedSchema(){return this.constructor._cachedSchema[this.constructor.name]||(this.constructor._cachedSchema[this.constructor.name]=this.constructor.getSchema()),this.constructor._cachedSchema[this.constructor.name]}static getSchema(){throw new Error("The entity class should declare its schema.")}validateBuildRules(options={}){}get(propName){(0,validator_es_lib_util_assertString__WEBPACK_IMPORTED_MODULE_3__.A)(propName);const schemaProperties=this.constructor.getSchema().properties[propName];if(!schemaProperties)throw new Error(`The property "${propName}" has no schema definition.`);if(!SCALAR_PROPERTY_TYPES.includes(schemaProperties?.type))throw new Error('The property "associated_entity" should reference scalar properties only.');return this._props[propName]}set(propName,value,options={}){(0,validator_es_lib_util_assertString__WEBPACK_IMPORTED_MODULE_3__.A)(propName);const validate=options?.validate??!0,schemaProperties=this.constructor.getSchema().properties[propName];if(!schemaProperties)throw new Error(`The property "${propName}" has no schema definition.`);if(!SCALAR_PROPERTY_TYPES.includes(schemaProperties?.type))throw new Error('The property "associated_entity" should reference scalar properties only.');validate&&_entitySchema__WEBPACK_IMPORTED_MODULE_0__.A.validateProp(propName,value,schemaProperties),this._props[propName]=value}diffProps(compareEntity){if(!(compareEntity instanceof EntityV2))throw new TypeError('The property "compareEntity" should be of "EntityV2" type.');const diff={},schema=this.constructor.getSchema(),propertiesNamesToCompare=Object.keys(schema.properties).filter((propertyName=>SCALAR_PROPERTY_TYPES.includes(schema.properties[propertyName].type)));for(const propertyName of propertiesNamesToCompare){const propValue=this.get(propertyName),comparedPropValue=compareEntity.get(propertyName);propValue!==comparedPropValue&&(diff[propertyName]=comparedPropValue)}return diff}hasDiffProps(compareEntity){const diff=this.diffProps(compareEntity);return Object.keys(diff).length>0}}const __WEBPACK_DEFAULT_EXPORT__=EntityV2},"./src/shared/models/entity/role/roleEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js");class RoleEntity extends _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__.A{static getSchema(){return{type:"object",required:["id","name"],properties:{id:{type:"string",format:"uuid"},name:{type:"string",enum:[RoleEntity.ROLE_ADMIN,RoleEntity.ROLE_USER,RoleEntity.ROLE_GUEST,RoleEntity.ROLE_ROOT]},description:{type:"string",maxLength:255},created:{type:"string",format:"date-time"},modified:{type:"string",format:"date-time"}}}}get id(){return this._props.id}get name(){return this._props.name}get description(){return this._props.description||null}get created(){return this._props.created||null}get modified(){return this._props.modified||null}isAdmin(){return this.name===RoleEntity.ROLE_ADMIN}static get ENTITY_NAME(){return"Role"}static get ROLE_ADMIN(){return"admin"}static get ROLE_USER(){return"user"}static get ROLE_GUEST(){return"guest"}static get ROLE_ROOT(){return"root"}}const __WEBPACK_DEFAULT_EXPORT__=RoleEntity}}]);