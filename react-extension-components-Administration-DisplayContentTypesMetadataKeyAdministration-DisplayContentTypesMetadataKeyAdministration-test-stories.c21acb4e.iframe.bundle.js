/*! For license information please see react-extension-components-Administration-DisplayContentTypesMetadataKeyAdministration-DisplayContentTypesMetadataKeyAdministration-test-stories.c21acb4e.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[1155],{"./src/react-extension/components/Administration/DisplayContentTypesMetadataKeyAdministration/DisplayContentTypesMetadataKeyAdministration.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GeneratedMetadataKey:()=>GeneratedMetadataKey,Initial:()=>Initial,MultipleActiveKeys:()=>MultipleActiveKeys,MultipleKeys:()=>MultipleKeys,SingleActiveMetadataKey:()=>SingleActiveMetadataKey,WithValidationError:()=>WithValidationError,__namedExportsOrder:()=>__namedExportsOrder,default:()=>DisplayContentTypesMetadataKeyAdministration_test_stories});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),memoize_one_esm=__webpack_require__("./node_modules/memoize-one/dist/memoize-one.esm.js"),react_dom=__webpack_require__("./node_modules/react-dom/index.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),metadataSettingsServiceWorkerService=__webpack_require__("./src/shared/services/serviceWorker/metadata/metadataSettingsServiceWorkerService.js"),NotifyError=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),DialogContext=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),dateUtils=__webpack_require__("./src/shared/utils/dateUtils.js"),entityV2Collection=__webpack_require__("./src/shared/models/entity/abstract/entityV2Collection.js"),entityV2=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),entitySchema=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js");class MetadataPrivateKeyDataEntity extends entityV2.A{static getSchema(){return{type:"object",required:["object_type","domain","fingerprint","armored_key","passphrase"],properties:{object_type:{type:"string",enum:["PASSBOLT_METADATA_PRIVATE_KEY"]},domain:{type:"string",maxLength:1024},fingerprint:{type:"string",pattern:/^[a-f0-9]{40}$/im},armored_key:{type:"string",maxLength:1e4,pattern:/^-----BEGIN PGP PRIVATE KEY BLOCK-----([\r\n])([ -9;-~]{1,76}: [ -~]{1,76}([\r\n]))*\n([a-zA-Z0-9\/+=]{1,76}([\r\n]))*=[a-zA-Z0-9\/+=]{4}([\r\n])-----END PGP PRIVATE KEY BLOCK-----([\r\n]*)$/},passphrase:{type:"string",maxLength:1024}}}}get armoredKey(){return this._props.armored_key}}const metadataPrivateKeyDataEntity=MetadataPrivateKeyDataEntity;class MetadataPrivateKeyEntity extends entityV2.A{constructor(dto,options={}){super(dto),this._props.data&&"string"!=typeof this._props.data&&(this._data=new metadataPrivateKeyDataEntity(this._props.data,{...options,clone:!1}),delete this._props.data)}static getSchema(){return{type:"object",required:["user_id","data"],properties:{id:{type:"string",format:"uuid",nullable:!0},metadata_key_id:{type:"string",format:"uuid",nullable:!0},user_id:{type:"string",format:"uuid",nullable:!0},data:{anyOf:[{type:"string",maxLength:1e4,pattern:/^-----BEGIN PGP MESSAGE-----([\r\n])([ -9;-~]{1,76}: [ -~]{1,76}([\r\n]))*\n([a-zA-Z0-9\/+=]{1,76}([\r\n]))*=[a-zA-Z0-9\/+=]{4}([\r\n])-----END PGP MESSAGE-----([\r\n]*)$/},{type:"object"}]},created:{type:"string",format:"date-time"},created_by:{type:"string",format:"uuid"},modified:{type:"string",format:"date-time"},modified_by:{type:"string",format:"uuid"}}}}validateBuildRules(){if(Boolean(this._props.data)&&Boolean(this._data)){const error=new entityValidationError.A,message="The property data and _data cannot be set at the same time";throw error.addError("data","only-one-defined",message),error}}toDto(){const result=Object.assign({},this._props),data=this.data;return result.data=data instanceof metadataPrivateKeyDataEntity?data.toDto():data,result}toJSON(){return this.toDto()}get data(){return this.isDecrypted?this._data:this._props.data}get metadataKeyId(){return this._props.metadata_key_id||null}set data(data){entitySchema.A.validateProp("data",data,this.cachedSchema.properties.data),"string"==typeof data?(this._props.data=data,delete this._data):(this._data=new metadataPrivateKeyDataEntity(data.toDto(),{clone:!0,validate:!1}),delete this._props.data)}get isDecrypted(){return Boolean(this._data)}get userId(){return this._props.user_id}}const metadataPrivateKeyEntity=MetadataPrivateKeyEntity;class MetadataPrivateKeysCollection extends entityV2Collection.A{get entityClass(){return metadataPrivateKeyEntity}constructor(dtos=[],options={}){super(dtos,options)}static getSchema(){return{type:"array",items:metadataPrivateKeyEntity.getSchema()}}validateBuildRules(item,options={}){this.assertNotExist("id",item._props.id,{haystackSet:options?.uniqueIdsSetCache}),this.assertNotExist("user_id",item._props.user_id,{haystackSet:options?.uniqueUserIdsSetCache}),this.assertSameMetadataKeyId(item)}assertSameMetadataKeyId(item){if(!item.metadataKeyId)return;const collectionMetadataKeyId=this._items.find((item=>Boolean(item.metadataKeyId)))?.metadataKeyId;if(!collectionMetadataKeyId)return;if(item.metadataKeyId===collectionMetadataKeyId)return;const error=new entityValidationError.A;throw error.addError("metadata_key_id","same_metadata_key","The collection should not contain different metadata key ID."),error}hasDecryptedPrivateKeys(){return this._items.some((item=>item.isDecrypted))}hasEncryptedPrivateKeys(){return this._items.some((item=>!item.isDecrypted))}pushMany(data,entityOptions={},options={}){const uniqueIdsSetCache=new Set(this.extract("id")),uniqueUserIdsSetCache=new Set(this.extract("user_id"));options={onItemPushed:item=>{uniqueIdsSetCache.add(item._props.id),uniqueUserIdsSetCache.add(item._props.user_id)},validateBuildRules:{...options?.validateBuildRules,uniqueIdsSetCache,uniqueUserIdsSetCache},...options},super.pushMany(data,entityOptions,options)}}const metadataPrivateKeysCollection=MetadataPrivateKeysCollection;class MetadataKeyEntity extends entityV2.A{constructor(dto,options={}){super(dto,options),this._props.metadata_private_keys&&(this._metadata_private_keys=new metadataPrivateKeysCollection(this._props.metadata_private_keys,{...options,clone:!1}),delete this._props.metadata_private_keys,this.assertSameMetadataKeyId())}static getSchema(){return{type:"object",required:["fingerprint","armored_key"],properties:{id:{type:"string",format:"uuid",nullable:!0},fingerprint:{type:"string",pattern:/^[a-f0-9]{40}$/im},armored_key:{type:"string",maxLength:1e4,pattern:/^-----BEGIN PGP PUBLIC KEY BLOCK-----([\r\n])([ -9;-~]{1,76}: [ -~]{1,76}([\r\n]))*\n([a-zA-Z0-9\/+=]{1,76}([\r\n]))*=[a-zA-Z0-9\/+=]{4}([\r\n])-----END PGP PUBLIC KEY BLOCK-----([\r\n]*)$/},created:{type:"string",format:"date-time",nullable:!0},created_by:{type:"string",format:"uuid",nullable:!0},modified:{type:"string",format:"date-time",nullable:!0},modified_by:{type:"string",format:"uuid",nullable:!0},deleted:{type:"string",format:"date-time",nullable:!0},expired:{type:"string",format:"date-time",nullable:!0},metadata_private_keys:metadataPrivateKeysCollection.getSchema()}}}validateBuildRules(){}assertSameMetadataKeyId(){if(0===(this._metadata_private_keys?.length||0))return;if(this.id!==this._metadata_private_keys.items[0].metadataKeyId){const error=new entityValidationError.A;throw error.addError("id:metadata_private_keys","same_id","`id` and the `metadata_private_keys.id` should be the same"),error}}toDto(contain){const result=Object.assign({},this._props);return contain?(this._metadata_private_keys&&contain.metadata_private_keys&&(result.metadata_private_keys=this._metadata_private_keys.toDto()),result):result}get armoredKey(){return this._props.armored_key}get id(){return this._props.id||null}get metadataPrivateKeys(){return this._metadata_private_keys||null}get created(){return this._props.created||null}get fingerprint(){return this._props.fingerprint}get expired(){return this._props.expired||null}static get ALL_CONTAIN_OPTIONS(){return{metadata_private_keys:!0}}}const metadataKeyEntity=MetadataKeyEntity;class MetadataKeysCollection extends entityV2Collection.A{get entityClass(){return metadataKeyEntity}constructor(dtos=[],options={}){super(dtos,options)}static getSchema(){return{type:"array",items:metadataKeyEntity.getSchema()}}validateBuildRules(item,options={}){this.assertNotExist("id",item._props.id,{haystackSet:options?.uniqueIdsSetCache}),this.assertNotExist("fingerprint",item._props.fingerprint,{haystackSet:options?.uniqueFingerprintsSetCache})}getFirstByLatestCreated(){return this.length?this._items.reduce(((latestCreatedItem,item)=>latestCreatedItem.created?item.created&&item.created>latestCreatedItem.created?item:latestCreatedItem:item)):null}toDto(contains={}){return this._items.map((entity=>entity.toDto(contains)))}hasDecryptedKeys(){return this._items.some((metadataKey=>metadataKey.metadataPrivateKeys?.hasDecryptedPrivateKeys()))}hasEncryptedKeys(){return this._items.some((metadataKey=>metadataKey.metadataPrivateKeys?.hasEncryptedPrivateKeys()))}pushMany(data,entityOptions={},options={}){const uniqueIdsSetCache=new Set(this.extract("id")),uniqueFingerprintsSetCache=new Set(this.extract("fingerprint"));options={onItemPushed:item=>{uniqueIdsSetCache.add(item._props.id),uniqueFingerprintsSetCache.add(item._props.fingerprint)},validateBuildRules:{...options?.validateBuildRules,uniqueIdsSetCache,uniqueFingerprintsSetCache},...options},super.pushMany(data,entityOptions,options)}}const metadataKeysCollection=MetadataKeysCollection;var entity=__webpack_require__("./src/shared/models/entity/abstract/entity.js");class ExternalGpgKeyEntity extends entity.A{constructor(gpgkeyDto,options={}){const sanitizedGpgkeyDto=ExternalGpgKeyEntity.sanitizeDto(gpgkeyDto);super(entitySchema.A.validate(ExternalGpgKeyEntity.ENTITY_NAME,sanitizedGpgkeyDto,ExternalGpgKeyEntity.getSchema()),options)}static getSchema(){return{type:"object",required:["armored_key"],properties:{armored_key:{type:"string",minLength:1},key_id:{type:"string",minLength:8,maxLength:16},user_ids:{type:"array"},fingerprint:{type:"string",minLength:40,maxLength:40},expires:{anyOf:[{type:"string",format:"date-time"},{type:"string",pattern:"^Infinity$"},{}],nullable:!0},created:{type:"string",format:"date-time"},algorithm:{type:"string"},length:{type:"integer",minimum:1},curve:{type:"string",nullable:!0},private:{type:"boolean"},revoked:{type:"boolean"}}}}static sanitizeDto(dto){const sanitizedDto=JSON.parse(JSON.stringify(dto));if(dto.key&&(sanitizedDto.armored_key=dto.key,delete sanitizedDto.key),dto.keyId&&(sanitizedDto.key_id=dto.keyId,delete sanitizedDto.keyId),dto.userIds&&(sanitizedDto.user_ids=dto.userIds,delete sanitizedDto.userIds),dto.created)try{const date=new Date(sanitizedDto.created);sanitizedDto.created=date.toISOString()}catch(error){delete sanitizedDto.created}if("Never"===dto.expires)sanitizedDto.expires="Infinity";else if(dto.expires&&"Infinity"!==dto.expires)try{const date=new Date(sanitizedDto.expires);sanitizedDto.expires=date.toISOString()}catch(error){delete sanitizedDto.expires,console.error(`ExternalGpgKeyEntity::sanitizeDto Unable to sanitize the key for the user ${dto.user_id}`)}return sanitizedDto}get armoredKey(){return this._props.armored_key}get keyId(){return this._props.key_id}get userIds(){return this._props.user_ids}get fingerprint(){return this._props.fingerprint}get expires(){return this._props.expires}get isValid(){return null!==this.expires}get created(){return this._props.created}get algorithm(){return this._props.algorithm}get length(){return this._props.length}get curve(){return this._props.curve}get revoked(){return this._props.revoked}get private(){return this._props.private}get isExpired(){const expires=this.expires;if(null===expires)return null;if("Infinity"===expires)return!1;const now=Date.now();return new Date(expires)<now}static get ENTITY_NAME(){return"externalGpgKey"}}const externalGpgKeyEntity=ExternalGpgKeyEntity;class ExternalGpgKeyPairEntity extends entity.A{constructor(externalGpgKeyPeyPairDto,options={}){super(entitySchema.A.validate(ExternalGpgKeyPairEntity.ENTITY_NAME,externalGpgKeyPeyPairDto,ExternalGpgKeyPairEntity.getSchema()),options),this._props.private_key&&(this._private_key=new externalGpgKeyEntity(this._props.private_key,{clone:!1}),delete this._props.private_key),this._props.public_key&&(this._public_key=new externalGpgKeyEntity(this._props.public_key,{clone:!1}),delete this._props.public_key)}static getSchema(){return{type:"object",required:["public_key","private_key"],properties:{public_key:externalGpgKeyEntity.getSchema(),private_key:externalGpgKeyEntity.getSchema()}}}toDto(contain){const result=Object.assign({},this._props);return contain?(contain.public_key&&this._public_key&&(result.public_key=this.publicKey.toDto()),contain.private_key&&this._private_key&&(result.private_key=this.privateKey.toDto()),result):result}toJSON(){return this.toDto(ExternalGpgKeyPairEntity.ALL_CONTAIN_OPTIONS)}get publicKey(){return this._public_key}get privateKey(){return this._private_key}static get ENTITY_NAME(){return"externalGpgKeyPairEntity"}static get ALL_CONTAIN_OPTIONS(){return{public_key:!0,private_key:!0}}}const externalGpgKeyPairEntity=ExternalGpgKeyPairEntity;const metadataKeysServiceWorkerService=class MetadataKeysServiceWorkerService{constructor(port){this.port=port}async findAll(){const metadataKeysDto=await this.port.request("passbolt.metadata.find-all-non-deleted-metadata-keys");return new metadataKeysCollection(metadataKeysDto)}async generateKeyPair(){const externalGpgKeyPairDto=await this.port.request("passbolt.metadata.generate-metadata-key");return new externalGpgKeyPairEntity(externalGpgKeyPairDto)}async createKey(metadataKeyPair){if(!(metadataKeyPair instanceof externalGpgKeyPairEntity))throw new TypeError("The parameter `metadataKeyPair` should be of type ExternalGpgKeyPairEntity.");const metadataKeyDto=await this.port.request("passbolt.metadata.create-key",metadataKeyPair.toDto({public_key:!0,private_key:!0}));return new metadataKeyEntity(metadataKeyDto)}};var Fingerprint=__webpack_require__("./src/react-extension/components/Common/Fingerprint/Fingerprint.js"),entityCollection=__webpack_require__("./src/shared/models/entity/abstract/entityCollection.js"),entityCollectionError=__webpack_require__("./src/shared/models/entity/abstract/entityCollectionError.js");class ExternalGpgKeyCollection extends entityCollection.A{constructor(externalGpgKeyCollectionDto,options={}){super(entitySchema.A.validate(ExternalGpgKeyCollection.ENTITY_NAME,externalGpgKeyCollectionDto,ExternalGpgKeyCollection.getSchema()),options);this._props.map((resource=>resource.id)).sort().sort(((a,b)=>{if(a===b)throw new entityCollectionError.A(0,ExternalGpgKeyCollection.RULE_UNIQUE_ID,`Gpgkey fingerprint ${a} already exists.`)})),this._props.forEach((resource=>{this._items.push(new externalGpgKeyEntity(resource,{clone:!1}))})),this._props=null}static getSchema(){return{type:"array",items:externalGpgKeyEntity.getSchema()}}static get ENTITY_NAME(){return"externalGpgKey"}static get RULE_UNIQUE_ID(){return"fingerprint"}}const externalGpgKeyCollection=ExternalGpgKeyCollection;const gpgServiceWorkerService=class GpgServiceWorkerService{constructor(port){this.port=port}async keyInfo(armoredKey){const keyInfoDto=await this.port.request("passbolt.keyring.get-key-info",armoredKey);return new externalGpgKeyEntity(keyInfoDto)}async keysInfo(armoredKeys=[]){const keysInfoDto=[];for(const armoredKey of armoredKeys){const keyInfo=await this.keyInfo(armoredKey);keysInfoDto.push(keyInfo)}return new externalGpgKeyCollection(keysInfoDto)}};var metadataKeysSettingsEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataKeysSettingsEntity.js");class MetadataKeysSettingsFormEntity extends metadataKeysSettingsEntity.A{constructor(dto,options={}){super(dto,options),this._props.generated_metadata_key&&(this._generated_metadata_key=new externalGpgKeyPairEntity(this._props.generated_metadata_key,{...options,clone:!1}),delete this._props.generated_metadata_key)}static getSchema(){return{type:"object",required:["allow_usage_of_personal_keys","zero_knowledge_key_share"],properties:{...metadataKeysSettingsEntity.A.getSchema().properties,generated_metadata_key:externalGpgKeyPairEntity.getSchema()}}}toDto(){return{...this._props,generated_metadata_key:this.generatedMetadataKey?.toDto({public_key:!0,private_key:!0})||null}}get generatedMetadataKey(){return this._generated_metadata_key||null}set generatedMetadataKey(generatedMetadataKey){if(null!==generatedMetadataKey&&!(generatedMetadataKey instanceof externalGpgKeyPairEntity))throw new TypeError("The parameter `generatedMetadataKey` should be of type ExternalGpgKeyPairEntity.");this._generated_metadata_key=generatedMetadataKey}}const metadataKeysSettingsFormEntity=MetadataKeysSettingsFormEntity;var Icon=__webpack_require__("./src/shared/components/Icons/Icon.js");class DisplayContentTypesMetadataKeyAdministration extends react.Component{render(){return react.createElement("div",{className:"col2_3 actions-wrapper"},react.createElement("div",{className:"actions"},react.createElement("ul",null,react.createElement("li",null,react.createElement("button",{type:"button",disabled:this.props.isProcessing,onClick:this.props.onSaveRequested},react.createElement(Icon.A,{name:"save"}),react.createElement("span",null,react.createElement(es.x6,null,"Save settings")))))))}}DisplayContentTypesMetadataKeyAdministration.propTypes={isProcessing:prop_types_default().bool,onSaveRequested:prop_types_default().func,t:prop_types_default().func};const DisplayContentTypesMetadataKeyAdministrationActions=(0,es.CI)("common")(DisplayContentTypesMetadataKeyAdministration);DisplayContentTypesMetadataKeyAdministration.__docgenInfo={description:"",methods:[],displayName:"DisplayContentTypesMetadataKeyAdministration",props:{isProcessing:{description:"",type:{name:"bool"},required:!1},onSaveRequested:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};var ActionFeedbackContext=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js");class DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration extends react.Component{originalSettings=null;formSettings=null;constructor(props){super(props),this.metadataSettingsServiceWorkerService=props.metadataSettingsServiceWorkerService??new metadataSettingsServiceWorkerService.Ay(props.context.port),this.metadataKeysServiceWorkerService=props.metadataKeysServiceWorkerService??new metadataKeysServiceWorkerService(props.context.port),this.gpgServiceWorkerService=props.gpgServiceWorkerService??new gpgServiceWorkerService(props.context.port),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{isProcessing:!0,hasAlreadyBeenValidated:!1,settings:{allow_usage_of_personal_keys:!0,zero_knowledge_key_share:!1,generated_metadata_key:null},activeMetadataKeys:null,expiredMetadataKeys:null}}bindCallbacks(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.generateMetadataKey=this.generateMetadataKey.bind(this),this.save=this.save.bind(this)}async componentDidMount(){await this.loadKeysSettings(),await this.loadKeys(),this.setState({isProcessing:!1})}async loadKeysSettings(){try{const settings=await this.metadataSettingsServiceWorkerService.findKeysSettings();this.originalSettings=new metadataKeysSettingsFormEntity(settings.toDto(),{validate:!1}),this.formSettings=new metadataKeysSettingsFormEntity(settings.toDto(),{validate:!1}),this.setState({settings:this.formSettings.toDto()})}catch(error){await this.handleUnexpectedError(error)}}handleUnexpectedError(error){if(console.error(error),"UserAbortsOperationError"!==error.name)return this.props.dialogContext.open(NotifyError.A,{error})}async loadKeys(){try{const metadataKeys=await this.metadataKeysServiceWorkerService.findAll(),activeMetadataKeys=new metadataKeysCollection(metadataKeys);activeMetadataKeys.filterByCallback((metadataKey=>!metadataKey.expired));const expiredMetadataKeys=new metadataKeysCollection(metadataKeys);expiredMetadataKeys.filterByCallback((metadataKey=>metadataKey.expired));const armoredKeys=metadataKeys.items.map((metadataKey=>metadataKey.armoredKey)),metadataKeysInfo=await this.gpgServiceWorkerService.keysInfo(armoredKeys);this.setState({activeMetadataKeys,expiredMetadataKeys,metadataKeysInfo})}catch(error){await this.handleUnexpectedError(error)}}hasSettingsChanges=(0,memoize_one_esm.A)(((originalSettings,formSettings,formSettingsDto)=>originalSettings?.hasDiffProps(formSettings)||originalSettings?.generatedMetadataKey!==formSettings?.generatedMetadataKey));handleInputChange(event){if(this.hasAllInputDisabled())return;const{type,checked,value,name}=event.target;let parsedValue=value;"checkbox"===type&&(parsedValue=checked),"allow_usage_of_personal_keys"!==name&&"zero_knowledge_key_share"!==name||(parsedValue="true"===value),this.setFormPropertyValue(name,parsedValue)}setFormPropertyValue(name,parsedValue){this.formSettings.set(name,parsedValue,{validate:!1}),this.setState({settings:this.formSettings.toDto()})}hasAllInputDisabled(){return this.state.isProcessing}async generateMetadataKey(){const metadataKeysInfo=this.state.metadataKeysInfo,activeMetadataKeys=this.state.activeMetadataKeys;this.setState({isProcessing:!0});try{const metadataKeyPair=await this.metadataKeysServiceWorkerService.generateKeyPair(),metadataKeyInfo=await this.gpgServiceWorkerService.keyInfo(metadataKeyPair.publicKey.armoredKey);metadataKeysInfo.push(metadataKeyInfo);const metadataKey=new metadataKeyEntity({armored_key:metadataKeyPair.publicKey.armoredKey,fingerprint:metadataKeyInfo.fingerprint});activeMetadataKeys.push(metadataKey),this.formSettings.generatedMetadataKey=metadataKeyPair,this.setState({activeMetadataKeys,metadataKeysInfo,settings:this.formSettings.toDto()})}catch(error){await this.handleUnexpectedError(error)}this.setState({isProcessing:!1})}handleFormSubmit(event){event.preventDefault(),this.save()}async save(){if(this.state.isProcessing)return;this.setState({isProcessing:!0});const validationError=this.validateForm(this.state.settings);if(validationError?.hasErrors())this.setState({isProcessing:!1,hasAlreadyBeenValidated:!0});else{try{await this.saveMetadataKeysSettings(),await this.createMetadataKey(),await this.props.actionFeedbackContext.displaySuccess(this.props.t("The metadata key settings were updated."))}catch(error){await this.handleUnexpectedError(error)}this.setState({isProcessing:!1,settings:this.formSettings.toDto()})}}validateForm=(0,memoize_one_esm.A)((formSettingsDto=>{if(!this.formSettings)return null;let validationErrors=this.formSettings.validate();return this.state.activeMetadataKeys.length||(validationErrors=validationErrors||new entityValidationError.A,validationErrors.addError("generated_metadata_key","required",this.props.t("A shared metadata key is required."))),validationErrors}));async saveMetadataKeysSettings(){const metadataKeysSettings=new metadataKeysSettingsEntity.A(this.formSettings.toDto()),savedMetadataKeysSettings=await this.metadataSettingsServiceWorkerService.saveKeysSettings(metadataKeysSettings);this.originalSettings=new metadataKeysSettingsFormEntity({...this.originalSettings.toDto(),...savedMetadataKeysSettings.toDto()}),this.formSettings=new metadataKeysSettingsFormEntity({...this.formSettings.toDto(),...savedMetadataKeysSettings.toDto()})}async createMetadataKey(){if(!this.formSettings.generatedMetadataKey)return;const metadataKey=await this.metadataKeysServiceWorkerService.createKey(this.formSettings.generatedMetadataKey);this.state.activeMetadataKeys.pushOrReplace(metadataKey,{},{replacePropertyName:"fingerprint"}),this.formSettings.generatedMetadataKey=null}render(){const errors=this.state.hasAlreadyBeenValidated?this.validateForm(this.state.settings):null,hasSettingsChanges=this.hasSettingsChanges(this.originalSettings,this.formSettings,this.state.settings);return react.createElement("div",{className:"row"},(this.props.createPortal||react_dom.createPortal)(react.createElement(DisplayContentTypesMetadataKeyAdministrationActions,{onSaveRequested:this.save,isProcessing:this.state.isProcessing}),document.getElementById("administration-actions-content-action")),react.createElement("div",{id:"content-types-metadata-key-settings",className:"col8 main-column"},react.createElement("form",{onSubmit:this.handleFormSubmit,"data-testid":"submit-form"},react.createElement("h3",null,react.createElement("label",null,react.createElement(es.x6,null,"Metadata key"))),hasSettingsChanges&&react.createElement("div",{className:"warning message form-banner"},react.createElement("p",null,react.createElement(es.x6,null,"Don't forget to save your settings to apply your modification."))),errors?.hasError("generated_metadata_key","required")&&react.createElement("div",{className:"warning message form-banner"},react.createElement("p",null,react.createElement(es.x6,null,"A shared metadata key is required to save the metadata keys settings."))),react.createElement("p",{className:"description"},react.createElement(es.x6,null,"This section controls the layer of encryption that is used to protect metadata such as the name of a resource, URIs, etc.")),react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Metadata key policy")),react.createElement("p",{className:"description"},react.createElement(es.x6,null,"It is possible for users to use their personal keys to encrypt resources metadata for more security. However you can elect to enforce the use of the shared metadata keys for all resources metadata for auditing purposes. Secrets such as passwords will always be encrypted using the user personal keys.")),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:"input radio "+(!0===this.state.settings.allow_usage_of_personal_keys?"checked":"")},react.createElement("input",{type:"radio",value:"true",onChange:this.handleInputChange,name:"allow_usage_of_personal_keys",checked:!0===this.state.settings.allow_usage_of_personal_keys,id:"allowUsageOfPersonalKeysInput",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"allowUsageOfPersonalKeysInput"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Allow the use of personal keys. (Recommended)")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Users can use shared and personal keys. By default personal resources that are not shared will be encrypted with the users personal keys."),react.createElement("br",null))))),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:"input radio "+(!1===this.state.settings.allow_usage_of_personal_keys?"checked":"")},react.createElement("input",{type:"radio",value:"false",onChange:this.handleInputChange,name:"allow_usage_of_personal_keys",checked:!1===this.state.settings.allow_usage_of_personal_keys,id:"disallowUsageOfPersonalKeysInput",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"disallowUsageOfPersonalKeysInput"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Enforce the use of shared metadata keys.")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"By default, metadata wil be encrypted with the shared keys. It is not possible to use personal keys to encrypt metadata."),react.createElement("br",null))))),react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Zero knowledge (Coming soon)")),react.createElement("p",{className:"description"},react.createElement(es.x6,null,"This section defines how the shared metadata key is shared with users.")),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:"input radio "+(!1===this.state.settings.zero_knowledge_key_share?"checked":"")},react.createElement("input",{type:"radio",value:"true",name:"zero_knowledge_key_share",checked:!1===this.state.settings.zero_knowledge_key_share,id:"disableZeroKnowledgeKeyShareInput",disabled:!0}),react.createElement("label",{htmlFor:"disableZeroKnowledgeKeyShareInput"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"User-friendly mode (Better on-boarding)")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"The shared metadata key is accessible to the server and can be shared by the server when a user completes the setup. In practice, an attacker with full server access can see the shared metadata."),react.createElement("br",null))))),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:"input radio "+(!0===this.state.settings.zero_knowledge_key_share?"checked":"")},react.createElement("input",{type:"radio",value:"true",name:"zero_knowledge_key_share",checked:!0===this.state.settings.zero_knowledge_key_share,id:"enableZeroKnowledgeKeyShareInput",disabled:!0}),react.createElement("label",{htmlFor:"enableZeroKnowledgeKeyShareInput"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Zero-knowledge mode (More secure)")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"The shared metadata key is not available to the server and must be shared with users by the admins. New users are not allowed to create or access shared content until they are provided the metadata key. It is recommended to rotate the key if you switch to that mode."),react.createElement("br",null))))),react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Shared metadata keys")),react.createElement("div",{className:`metadata-key-info ${errors?.hasError("generated_metadata_key","required")&&"error"}`},this.state.activeMetadataKeys?.length>0&&react.createElement("div",{id:"metadata-active-keys"},this.state.activeMetadataKeys?.items.map((metadataKey=>{const metadataKeyInfo=this.state.metadataKeysInfo?.getFirst("fingerprint",metadataKey.fingerprint);return react.createElement("table",{key:metadataKey.fingerprint,className:"table-info"},react.createElement("tbody",null,react.createElement("tr",{className:"fingerprint"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Fingerprint")),react.createElement("td",{className:"value"},react.createElement(Fingerprint.A,{fingerprint:metadataKey.fingerprint}))),react.createElement("tr",{className:"algorithm"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Algorithm")),react.createElement("td",{className:"value"},metadataKeyInfo?.algorithm," ",metadataKeyInfo?.curve)),react.createElement("tr",{className:"key-length"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Key length")),react.createElement("td",{className:"value"},metadataKeyInfo?.length)),react.createElement("tr",{className:"created"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Created")),metadataKey.created&&react.createElement("td",{className:"value"},react.createElement("span",{title:metadataKey.created},(0,dateUtils.kD)(metadataKey.created,this.props.t,this.props.context.locale))),!metadataKey.created&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"Pending")))))}))),!this.state.activeMetadataKeys?.length&&react.createElement("div",{id:"no-metadata-active-keys"},react.createElement("table",{className:"table-info"},react.createElement("tbody",null,react.createElement("tr",null,react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"You need to generate a new shared key to enable encrypted metadata.")),react.createElement("td",{className:"table-button"},react.createElement("button",{className:"button primary medium",type:"button",disabled:this.hasAllInputDisabled(),onClick:this.generateMetadataKey,"data-testid":"generate-key-buton"},react.createElement(es.x6,null,"Generate key")))),errors?.hasError("generated_metadata_key","required")&&react.createElement("tr",{className:"error-message"},react.createElement(es.x6,null,"A shared metadata key is required."))))),this.state.expiredMetadataKeys?.length>0&&react.createElement(react.Fragment,null,react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Previous keys")),react.createElement("div",{id:"metadata-expired-keys"},this.state.expiredMetadataKeys?.items.map((metadataKey=>{const metadataKeyInfo=this.state.metadataKeysInfo.getFirst("fingerprint",metadataKey.fingerprint);return react.createElement("table",{key:metadataKey.fingerprint,className:"table-info"},react.createElement("tbody",null,react.createElement("tr",{className:"fingerprint"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Fingerprint")),react.createElement("td",{className:"value"},react.createElement(Fingerprint.A,{fingerprint:metadataKey.fingerprint}))),react.createElement("tr",{className:"algorithm"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Algorithm")),react.createElement("td",{className:"value"},metadataKeyInfo?.algorithm," ",metadataKeyInfo?.curve)),react.createElement("tr",{className:"key-length"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Key length")),react.createElement("td",{className:"value"},metadataKeyInfo?.length)),react.createElement("tr",{className:"created"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Created")),react.createElement("td",{className:"value"},react.createElement("span",{title:metadataKey.created},(0,dateUtils.kD)(metadataKey.created,this.props.t,this.props.context.locale)))),react.createElement("tr",{className:"expired"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Expired")),react.createElement("td",{className:"value"},react.createElement("span",{title:metadataKey.expired},(0,dateUtils.kD)(metadataKey.expired,this.props.t,this.props.context.locale))))))}))))))))}}DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration.propTypes={context:prop_types_default().object,actionFeedbackContext:prop_types_default().object,dialogContext:prop_types_default().object,createPortal:prop_types_default().func,metadataSettingsServiceWorkerService:prop_types_default().object,metadataKeysServiceWorkerService:prop_types_default().object,gpgServiceWorkerService:prop_types_default().object,t:prop_types_default().func};const Administration_DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration=(0,AppContext.L)((0,DialogContext.z9)((0,ActionFeedbackContext.ot)((0,es.CI)("common")(DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration))));DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get default state\n@returns {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"loadKeysSettings",docblock:"Load the metadata key settings.\nIf the settings cannot be loaded, display the error dialog.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Load the metadata key settings.\nIf the settings cannot be loaded, display the error dialog."},{name:"handleUnexpectedError",docblock:"Handle unexpected error\n@param {Error} error The error\n@returns {Promise<string>} Return the dialog key identifier.",modifiers:[],params:[{name:"error",description:"The error",type:{name:"Error"},optional:!1}],returns:{description:"Return the dialog key identifier.",type:{name:"Promise",elements:[{name:"string"}]}},description:"Handle unexpected error"},{name:"loadKeys",docblock:"Load the metadata keys.\nIf the metadata keys cannot be loaded, display the error dialog.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Load the metadata keys.\nIf the metadata keys cannot be loaded, display the error dialog."},{name:"handleInputChange",docblock:"Handle form input changes.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:[],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle form input changes."},{name:"setFormPropertyValue",docblock:"Set a form property value. Trigger the validation if the form has already been submitted once.\n@param name\n@param parsedValue",modifiers:[],params:[{name:"name",optional:!1},{name:"parsedValue",optional:!1}],returns:null,description:"Set a form property value. Trigger the validation if the form has already been submitted once."},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"generateMetadataKey",docblock:"Generate a new metadata key\n@return {Promise}",modifiers:["async"],params:[],returns:{type:{name:"Promise"}},description:"Generate a new metadata key"},{name:"handleFormSubmit",docblock:"Handle form submission that can be trigger when hitting `enter`\n@param {Event} event The html event triggering the form submit.",modifiers:[],params:[{name:"event",description:"The html event triggering the form submit.",type:{name:"Event"},optional:!1}],returns:null,description:"Handle form submission that can be trigger when hitting `enter`"},{name:"save",docblock:"Save the settings.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Save the settings."},{name:"saveMetadataKeysSettings",docblock:"Save the metadata keys settings.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Save the metadata keys settings."},{name:"createMetadataKey",docblock:"Create the metadata key.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Create the metadata key."}],displayName:"DisplayContentTypesMetadataKeyAdministration",props:{context:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"object"},required:!1},createPortal:{description:"",type:{name:"func"},required:!1},metadataSettingsServiceWorkerService:{description:"",type:{name:"object"},required:!1},metadataKeysServiceWorkerService:{description:"",type:{name:"object"},required:!1},gpgServiceWorkerService:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};var ExtAppContext_test_data=__webpack_require__("./src/react-extension/contexts/ExtAppContext.test.data.js"),DialogContext_test_data=__webpack_require__("./src/react-extension/contexts/DialogContext.test.data.js"),resourceTypesCollection=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js"),resourceTypesCollection_test_data=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.test.data.js");var v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");function mutatePgpBlockFromOptions(block,options={withCrc:!0,withComments:!1,withWrongExtraCharacters:!1,withDuplicates:!1}){return options.withComments&&(block=block.replace("\n\n","\nVersion: PGP 1.0\nComments: This is a test\n\n")),options.withWrongExtraCharacters&&(block=block.replace(/\n\n(.{64})\n/,"\n\n$1Wrong Stuff Here\n")),options.withCrc||(block=block.replace(/\n=[a-zA-Z0-9/+=]{4}\n-----/,"\n-----")),options.withDuplicates&&(block=`${block}\n\n${block}\n\n${block}`),block}const defaultArmoredPublicKey=options=>mutatePgpBlockFromOptions("-----BEGIN PGP PUBLIC KEY BLOCK-----\n\n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\n=KFUt\n-----END PGP PUBLIC KEY BLOCK-----",options);var keys=__webpack_require__("./test/fixture/pgpKeys/keys.js");const defaultMetadataPrivateKeyDto=(data={})=>((data={})=>({user_id:null,data:keys.u.metadataKey.encryptedMetadataPrivateKeyDataMessage,...data}))({id:(0,v4.A)(),user_id:(0,v4.A)(),metadata_key_id:(0,v4.A)(),modified:"2022-10-11T08:09:00+00:00",created_by:(0,v4.A)(),created:"2022-10-11T08:09:00+00:00",modified_by:(0,v4.A)(),...data}),defaultMetadataKeyDto=(data={},options={})=>((data={},options={})=>{const defaultData={fingerprint:Array.from({length:40},(()=>Math.floor(16*Math.random()).toString(16).toUpperCase())).join(""),armored_key:defaultArmoredPublicKey(),...data};return!defaultData.metadata_private_keys&&options?.withMetadataPrivateKeys&&(defaultData.metadata_private_keys=[defaultMetadataPrivateKeyDto({metadata_key_id:defaultData.id})]),defaultData})({id:data.id||(0,v4.A)(),modified:"2022-10-11T08:09:00+00:00",created_by:(0,v4.A)(),created:"2022-10-11T08:09:00+00:00",modified_by:(0,v4.A)(),deleted:null,expired:null,...data},options),ed25519ExternalPublicGpgKeyEntityDto=(data={})=>{const defaultData={armored_key:keys.u.eddsa_ed25519.public,key_id:keys.u.eddsa_ed25519.key_id,user_ids:keys.u.eddsa_ed25519.user_ids,fingerprint:keys.u.eddsa_ed25519.fingerprint,expires:"Infinity",created:keys.u.eddsa_ed25519.created,algorithm:keys.u.eddsa_ed25519.algorithm?.toLowerCase(),length:keys.u.eddsa_ed25519.length,curve:keys.u.eddsa_ed25519.curve,private:!1,revoked:keys.u.eddsa_ed25519.revoked};return Object.assign(defaultData,data)},ed25519ExternalPrivateGpgKeyEntityDto=(data={})=>{const defaultData={armored_key:keys.u.eddsa_ed25519.private,key_id:keys.u.eddsa_ed25519.key_id,user_ids:keys.u.eddsa_ed25519.user_ids,fingerprint:keys.u.eddsa_ed25519.fingerprint,expires:"Infinity",created:keys.u.eddsa_ed25519.created,algorithm:keys.u.eddsa_ed25519.algorithm?.toLowerCase(),length:keys.u.eddsa_ed25519.length,curve:keys.u.eddsa_ed25519.curve,private:!0,revoked:keys.u.eddsa_ed25519.revoked};return Object.assign(defaultData,data)};var ActionFeedbackContext_test_data=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.test.data.js");const metadataKeysInfoDto=[((data={})=>{const defaultData={armored_key:keys.u.ada.private,key_id:keys.u.ada.key_id,user_ids:keys.u.ada.user_ids,fingerprint:keys.u.ada.fingerprint,expires:keys.u.ada.expires,created:keys.u.ada.created,algorithm:keys.u.ada.algorithm.toLowerCase(),length:keys.u.ada.length,curve:keys.u.ada.curve,private:!0,revoked:keys.u.ada.revoked};return Object.assign(defaultData,data)})(),((data={})=>{const defaultData={armored_key:keys.u.betty.public,key_id:keys.u.betty.key_id,user_ids:keys.u.betty.user_ids,fingerprint:keys.u.betty.fingerprint,expires:keys.u.betty.expires,created:keys.u.betty.created,algorithm:keys.u.betty.algorithm?.toLowerCase(),length:keys.u.betty.length,curve:keys.u.betty.curve,private:!1,revoked:keys.u.betty.revoked};return Object.assign(defaultData,data)})(),((data={})=>{const defaultData={armored_key:keys.u.carol.public,key_id:keys.u.carol.key_id,user_ids:keys.u.carol.user_ids,fingerprint:keys.u.carol.fingerprint,expires:"Infinity",created:keys.u.carol.created,algorithm:keys.u.carol.algorithm?.toLowerCase(),length:keys.u.carol.length,curve:keys.u.carol.curve,private:!1,revoked:keys.u.carol.revoked};return Object.assign(defaultData,data)})(),ed25519ExternalPublicGpgKeyEntityDto()];function defaultProps(props={}){const metadataKeysInfo=new externalGpgKeyCollection(metadataKeysInfoDto);return{context:(0,ExtAppContext_test_data.dO)(),dialogContext:(0,DialogContext_test_data.L)(),actionFeedbackContext:(0,ActionFeedbackContext_test_data.M)(),metadataSettingsServiceWorkerService:{findKeysSettings:()=>new metadataKeysSettingsEntity.A(((data={})=>Object.assign({allow_usage_of_personal_keys:!0,zero_knowledge_key_share:!1},data))()),saveKeysSettings:settings=>settings},metadataKeysServiceWorkerService:{findAll:()=>new metadataKeysCollection([]),generateKeyPair:()=>new externalGpgKeyPairEntity({public_key:ed25519ExternalPublicGpgKeyEntityDto(),private_key:ed25519ExternalPrivateGpgKeyEntityDto()}),createKey:()=>new metadataKeyEntity(defaultMetadataKeyDto({fingerprint:keys.u.eddsa_ed25519.fingerprint,armored_key:keys.u.eddsa_ed25519.public}))},gpgServiceWorkerService:{keyInfo:armoredKey=>metadataKeysInfo.getFirst("armored_key",armoredKey),keysInfo:()=>metadataKeysInfo},createPortal:jest.fn(),resourceTypes:new resourceTypesCollection.A((0,resourceTypesCollection_test_data.V1)()),t:text=>text,...props}}var dom_esm=__webpack_require__("./node_modules/@testing-library/dom/dist/@testing-library/dom.esm.js");const DisplayContentTypesMetadataKeyAdministration_test_stories={title:"Components/Administration/DisplayContentTypesMetadataKeyAdministration",component:Administration_DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration},Template=args=>react.createElement("div",{className:"panel middle"},react.createElement("div",{className:"grid grid-responsive-12"},react.createElement(Administration_DisplayContentTypesMetadataKeyAdministration_DisplayContentTypesMetadataKeyAdministration,args)));Template.propTypes={context:prop_types_default().object};const Initial=Template.bind({});Initial.args=defaultProps();const WithValidationError=Template.bind({});WithValidationError.args=defaultProps(),WithValidationError.play=async({canvasElement})=>{(0,dom_esm.ux)(canvasElement).getByTestId("submit-form").requestSubmit()};const GeneratedMetadataKey=Template.bind({});GeneratedMetadataKey.args=defaultProps(),GeneratedMetadataKey.play=async({canvasElement})=>{(0,dom_esm.ux)(canvasElement).getByTestId("generate-key-buton").click()};const SingleActiveMetadataKey=Template.bind({});SingleActiveMetadataKey.args=function defaultSettingsAndSingleActiveKeyProps(props={}){const metadataKeysDto=[defaultMetadataKeyDto({armored_key:keys.u.ada.public,fingerprint:keys.u.ada.fingerprint})];return defaultProps({metadataKeysServiceWorkerService:{findAll:()=>new metadataKeysCollection(metadataKeysDto)},...props})}();const MultipleActiveKeys=Template.bind({});MultipleActiveKeys.args=function defaultSettingsAndMultipleActiveKeysProps(props={}){const metadataKeysDto=[defaultMetadataKeyDto({armored_key:keys.u.ada.public,fingerprint:keys.u.ada.fingerprint}),defaultMetadataKeyDto({armored_key:keys.u.betty.public,fingerprint:keys.u.betty.fingerprint})];return defaultProps({metadataKeysServiceWorkerService:{findAll:()=>new metadataKeysCollection(metadataKeysDto)},...props})}();const MultipleKeys=Template.bind({});MultipleKeys.args=function defaultSettingsAndMultipleKeysProps(props={}){const metadataKeysDto=[defaultMetadataKeyDto({armored_key:keys.u.ada.public,fingerprint:keys.u.ada.fingerprint}),defaultMetadataKeyDto({armored_key:keys.u.betty.public,fingerprint:keys.u.betty.fingerprint}),defaultMetadataKeyDto({armored_key:keys.u.carol.public,fingerprint:keys.u.carol.fingerprint,expired:"2022-03-04T13:59:11+00:00"}),defaultMetadataKeyDto({armored_key:keys.u.eddsa_ed25519.public,fingerprint:keys.u.eddsa_ed25519.fingerprint,expired:"2023-10-04T15:11:45+00:00"})];return defaultProps({metadataKeysServiceWorkerService:{findAll:()=>new metadataKeysCollection(metadataKeysDto)},...props})}();const __namedExportsOrder=["Initial","WithValidationError","GeneratedMetadataKey","SingleActiveMetadataKey","MultipleActiveKeys","MultipleKeys"];Initial.parameters={...Initial.parameters,docs:{...Initial.parameters?.docs,source:{originalSource:'args => <div className="panel middle">\n    <div className="grid grid-responsive-12">\n      <DisplayContentTypesMetadataKeyAdministration {...args} />\n    </div>\n  </div>',...Initial.parameters?.docs?.source}}},WithValidationError.parameters={...WithValidationError.parameters,docs:{...WithValidationError.parameters?.docs,source:{originalSource:'args => <div className="panel middle">\n    <div className="grid grid-responsive-12">\n      <DisplayContentTypesMetadataKeyAdministration {...args} />\n    </div>\n  </div>',...WithValidationError.parameters?.docs?.source}}},GeneratedMetadataKey.parameters={...GeneratedMetadataKey.parameters,docs:{...GeneratedMetadataKey.parameters?.docs,source:{originalSource:'args => <div className="panel middle">\n    <div className="grid grid-responsive-12">\n      <DisplayContentTypesMetadataKeyAdministration {...args} />\n    </div>\n  </div>',...GeneratedMetadataKey.parameters?.docs?.source}}},SingleActiveMetadataKey.parameters={...SingleActiveMetadataKey.parameters,docs:{...SingleActiveMetadataKey.parameters?.docs,source:{originalSource:'args => <div className="panel middle">\n    <div className="grid grid-responsive-12">\n      <DisplayContentTypesMetadataKeyAdministration {...args} />\n    </div>\n  </div>',...SingleActiveMetadataKey.parameters?.docs?.source}}},MultipleActiveKeys.parameters={...MultipleActiveKeys.parameters,docs:{...MultipleActiveKeys.parameters?.docs,source:{originalSource:'args => <div className="panel middle">\n    <div className="grid grid-responsive-12">\n      <DisplayContentTypesMetadataKeyAdministration {...args} />\n    </div>\n  </div>',...MultipleActiveKeys.parameters?.docs?.source}}},MultipleKeys.parameters={...MultipleKeys.parameters,docs:{...MultipleKeys.parameters?.docs,source:{originalSource:'args => <div className="panel middle">\n    <div className="grid grid-responsive-12">\n      <DisplayContentTypesMetadataKeyAdministration {...args} />\n    </div>\n  </div>',...MultipleKeys.parameters?.docs?.source}}}},"./src/react-extension/components/Common/Fingerprint/Fingerprint.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__);class Fingerprint extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"fingerprint"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"fingerprint-line"},this.props.fingerprint?.substring(0,20)?.replace(/.{4}/g,"$& ")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"fingerprint-line"},this.props.fingerprint?.substring(20)?.replace(/.{4}/g,"$& ")))}}Fingerprint.propTypes={fingerprint:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string.isRequired};const __WEBPACK_DEFAULT_EXPORT__=Fingerprint;Fingerprint.__docgenInfo={description:"",methods:[],displayName:"Fingerprint",props:{fingerprint:{description:"",type:{name:"string"},required:!0}}}},"./src/shared/utils/dateUtils.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{B7:()=>formatDateForApi,Br:()=>formatExpirationDateTimeAgo,kD:()=>formatDateTimeAgo});var luxon__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/luxon/src/luxon.js");const formatDateTimeAgo=(date,translate,locale)=>{if(null===date)return"n/a";if("Infinity"===date)return translate("Never");const dateTime=luxon__WEBPACK_IMPORTED_MODULE_0__.c9.fromISO(date),duration=dateTime.diffNow().toMillis();return duration>-1e3&&duration<0?translate("Just now"):dateTime.toRelative({locale})},formatExpirationDateTimeAgo=(date,translate,locale)=>date?formatDateTimeAgo(date,translate,locale):translate("Never"),formatDateForApi=date=>date?.toUTC().toISO()||null},"?4f7e":()=>{}}]);