/*! For license information please see 2145.bfb45e7e.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[2145],{"./src/shared/models/entity/metadata/metadataKeysSettingsEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>metadataKeysSettingsEntity});var entityV2=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),entityV2Collection=__webpack_require__("./src/shared/models/entity/abstract/entityV2Collection.js"),metadataPrivateKeyEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataPrivateKeyEntity.js");class ShareMetadataPrivateKeysCollection extends entityV2Collection.A{get entityClass(){return metadataPrivateKeyEntity.A}constructor(dtos=[],options={}){super(dtos,options)}static getSchema(){return{type:"array",items:metadataPrivateKeyEntity.A.getSchema()}}validateBuildRules(item,options){this.assertUniqueMetadataKeyIdUserId(item,{haystackSet:options?.uniqueMetadataKeyIdUserIdSetCache})}assertUniqueMetadataKeyIdUserId(item,options){if(!item.userId||!item.metadataKeyId)return;let haystackSet=options?.haystackSet;haystackSet||(haystackSet=new Set(this.items.map(item=>`${item.metadataKeyId}:${item.userId}`)));const metadataKeyIdUserIdKey=`${item.metadataKeyId}:${item.userId}`;if(haystackSet.has(metadataKeyIdUserIdKey)){const error=new entityValidationError.A,message=`The collection already includes an element that has a couple metadata_key_id:user_id (${metadataKeyIdUserIdKey}) with an identical value.`;throw error.addError("metadata_key_id:user_id","unique",message),error}}pushMany(data,entityOptions={},options={}){const uniqueMetadataKeyIdUserIdSetCache=new Set(this.items.map(item=>`${item.metadataKeyId}:${item.userId}`));options={onItemPushed:item=>{uniqueMetadataKeyIdUserIdSetCache.add(`${item.metadataKeyId}:${item.userId}`)},validateBuildRules:{...options?.validateBuildRules,uniqueMetadataKeyIdUserIdSetCache},...options},super.pushMany(data,entityOptions,options)}hasDecryptedPrivateKeys(){return this._items.some(item=>item.isDecrypted)}hasEncryptedPrivateKeys(){return this._items.some(item=>!item.isDecrypted)}}const shareMetadataPrivateKeysCollection=ShareMetadataPrivateKeysCollection;class MetadataKeysSettingsEntity extends entityV2.A{static getSchema(){return{type:"object",required:["allow_usage_of_personal_keys","zero_knowledge_key_share"],properties:{allow_usage_of_personal_keys:{type:"boolean"},zero_knowledge_key_share:{type:"boolean"},metadata_private_keys:shareMetadataPrivateKeysCollection.getSchema()}}}static get associations(){return{metadata_private_keys:shareMetadataPrivateKeysCollection}}validateBuildRules(){if(this._props.zero_knowledge_key_share&&this.metadataPrivateKeys?.length>0){const error=new entityValidationError.A,message="If the property zero_knowledge_key_share is true, metadata_private_keys cannot be set";throw error.addError("metadata_private_keys","not_defined_for_zero_knowledge",message),error}}static createFromDefault(data={}){return new MetadataKeysSettingsEntity({allow_usage_of_personal_keys:!0,zero_knowledge_key_share:!1,...data})}toDto(contain){const result=Object.assign({},this._props);return contain?(this._metadataPrivateKeys&&contain.metadata_private_keys&&(result.metadata_private_keys=this._metadataPrivateKeys.toDto()),result):result}get allowUsageOfPersonalKeys(){return this._props.allow_usage_of_personal_keys}get zeroKnowledgeKeyShare(){return this._props.zero_knowledge_key_share}get metadataPrivateKeys(){return this._metadataPrivateKeys||null}set metadataPrivateKeys(metadataPrivateKeysCollection){if(!(metadataPrivateKeysCollection instanceof shareMetadataPrivateKeysCollection))throw new TypeError("The metadataPrivateKeysCollection is not of MetadataPrivateKeysCollection type");this._metadataPrivateKeys=metadataPrivateKeysCollection}static get ALL_CONTAIN_OPTIONS(){return{metadata_private_keys:!0}}}const metadataKeysSettingsEntity=MetadataKeysSettingsEntity},"./src/shared/models/entity/metadata/metadataPrivateKeyEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>metadataPrivateKeyEntity});var entitySchema=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js"),entityV2=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js");class MetadataPrivateKeyDataEntity extends entityV2.A{static getSchema(){return{type:"object",required:["object_type","domain","fingerprint","armored_key","passphrase"],properties:{object_type:{type:"string",enum:["PASSBOLT_METADATA_PRIVATE_KEY"]},domain:{type:"string",maxLength:1024},fingerprint:{type:"string",pattern:/^[a-f0-9]{40}$/im},armored_key:{type:"string",maxLength:1e4,pattern:/^-----BEGIN PGP PRIVATE KEY BLOCK-----\r?\n((?:[!-9;-~]+:\s?.*\r?\n)*\r?\n)((?:[A-Za-z0-9+/]{1,76}\r?\n)*)([A-Za-z0-9+/]{1,76}={0,2}\r?\n)(=[A-Za-z0-9+/]{4}\r?\n)-----END PGP PRIVATE KEY BLOCK-----\s*$/},passphrase:{type:"string",maxLength:1024}}}}get armoredKey(){return this._props.armored_key}get fingerprint(){return this._props.fingerprint}}const metadataPrivateKeyDataEntity=MetadataPrivateKeyDataEntity;var userEntity=__webpack_require__("./src/shared/models/entity/user/userEntity.js");class MetadataPrivateKeyEntity extends entityV2.A{constructor(dto,options={}){super(dto,options),this._props.data&&"string"!=typeof this._props.data&&(this._data=new metadataPrivateKeyDataEntity(this._props.data,{...options,clone:!1}),delete this._props.data)}static getSchema(){return{type:"object",required:["user_id","data"],properties:{id:{type:"string",format:"uuid",nullable:!0},metadata_key_id:{type:"string",format:"uuid",nullable:!0},user_id:{type:"string",format:"uuid",nullable:!0},data_signed_by_current_user:{type:"string",format:"date-time",nullable:!0},data:{anyOf:[{type:"string",maxLength:1e4,pattern:/^-----BEGIN PGP MESSAGE-----\r?\n((?:[!-9;-~]+:\s?.*\r?\n)*\r?\n)((?:[A-Za-z0-9+/]{1,76}\r?\n)*)([A-Za-z0-9+/]{1,76}={0,2}\r?\n)(=[A-Za-z0-9+/]{4}\r?\n)-----END PGP MESSAGE-----\s*$/},{type:"object"}]},created:{type:"string",format:"date-time"},created_by:{type:"string",format:"uuid",nullable:!0},modified:{type:"string",format:"date-time"},modified_by:{type:"string",format:"uuid",nullable:!0}}}}validateBuildRules(){if(Boolean(this._props.data)&&Boolean(this._data)){const error=new entityValidationError.A,message="The property data and _data cannot be set at the same time";throw error.addError("data","only-one-defined",message),error}}toDto(contain){const result=Object.assign({},this._props),data=this.data;return result.data=data instanceof metadataPrivateKeyDataEntity?data.toDto():data,contain?(this._creator&&contain.creator&&(result.creator=this._creator.toDto(userEntity.A.ALL_CONTAIN_OPTIONS)),result):result}toDataDto(){return{data:this.toDto().data}}toContentCodeConfirmTrustRequestDto(){const result=this.toDto();return delete result.data,result}toJSON(){return this.toDto(userEntity.A.ALL_CONTAIN_OPTIONS)}cloneForSharing(userId){const cloneDto={user_id:userId,metadata_key_id:this.metadataKeyId,data:this.data};return new MetadataPrivateKeyEntity(cloneDto)}marshall(){}get data(){return this.isDecrypted?this._data:this._props.data}get id(){return this._props.id||null}get metadataKeyId(){return this._props.metadata_key_id||null}get isDecrypted(){return Boolean(this._data)}get userId(){return this._props.user_id}get dataSignedByCurrentUser(){return this._props.data_signed_by_current_user||null}get modifiedBy(){return this._props.modified_by}get modified(){return this._props.modified}set modified(modified){this._props.modified=modified}set modifiedBy(modifiedBy){this._props.modifiedBy=modifiedBy}set data(data){entitySchema.A.validateProp("data",data,this.cachedSchema.properties.data),"string"==typeof data?(this._props.data=data,delete this._data):(this._data=new metadataPrivateKeyDataEntity(data.toDto(),{clone:!0,validate:!1}),delete this._props.data)}set dataSignedByCurrentUser(value){entitySchema.A.validateProp("data_signed_by_current_user",value,this.cachedSchema.properties.data_signed_by_current_user),this._props.data_signed_by_current_user=value}static get ALL_CONTAIN_OPTIONS(){return{creator:!0}}}const metadataPrivateKeyEntity=MetadataPrivateKeyEntity}}]);