/*! For license information please see react-extension-components-Authentication-EnterUsernameForm-EnterUsernameForm-test-stories.7948f99c.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[2555],{"./src/react-extension/components/Authentication/EnterUsernameForm/EnterUsernameForm.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Initial:()=>Initial,WithSsoRecoverEnabled:()=>WithSsoRecoverEnabled,__namedExportsOrder:()=>__namedExportsOrder,default:()=>EnterUsernameForm_test_stories});var react=__webpack_require__("./node_modules/react/index.js"),react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),ApiTriageContext=__webpack_require__("./src/react-extension/contexts/ApiTriageContext.js"),FormSubmitButton=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormSubmitButton.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),AppEmailValidatorService=__webpack_require__("./src/shared/services/validator/AppEmailValidatorService.js");class EnterUsernameForm extends react.Component{constructor(props){super(props),this.state=this.defaultState,this.createInputRefs(),this.bindEventHandlers()}get defaultState(){return{loading:!0,processing:!1,username:"",usernameError:null,agreedTerms:!1,agreedTermsError:null,hasAlreadyBeenValidated:!1}}componentDidMount(){null!==this.props.context.siteSettings&&this.setState({loading:!1},(()=>{this.focusUsernameElement()}))}async componentDidUpdate(){this.state.loading&&null!==this.props.context.siteSettings&&this.setState({loading:!1},(()=>{this.focusUsernameElement()}))}focusUsernameElement(){this.isFocusOnBrowserExtension()||this.usernameRef.current.focus()}isFocusOnBrowserExtension(){const activeElement=document.activeElement;return!!activeElement&&"iframe"===activeElement.tagName.toLowerCase()}bindEventHandlers(){this.handleInputChange=this.handleInputChange.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleUsernameInputOnKeyUp=this.handleUsernameInputOnKeyUp.bind(this)}createInputRefs(){this.usernameRef=react.createRef()}async handleInputChange(event){const target=event.target,value="checkbox"===target.type?target.checked:target.value,name=target.name;await this.setState({[name]:value}),this.state.hasAlreadyBeenValidated&&await this.validate()}handleUsernameInputOnKeyUp(){if(this.state.hasAlreadyBeenValidated){const state=this.validateUsernameInput();this.setState(state)}}async handleFormSubmit(event){if(event.preventDefault(),await this.setState({hasAlreadyBeenValidated:!0}),!this.state.processing){if(await this.toggleProcessing(),await this.validate(),this.hasValidationError())return void await this.toggleProcessing();this.props.apiTriageContext.onTriageRequested(this.state.username.trim())}}async toggleProcessing(){const prev=this.state.processing;return this.setState({processing:!prev})}async validate(){return await Promise.all([this.validateUsernameInput(),this.validateAgreedTerms()]),this.hasValidationError()}async validateUsernameInput(){let usernameError=null;const username=this.state.username.trim();return username.length?AppEmailValidatorService.A.validate(username,this.props.context.siteSettings)||(usernameError=this.translate("Please enter a valid email address.")):usernameError=this.translate("A username is required."),this.setState({username,usernameError})}async validateAgreedTerms(){let agreedTermsError=!1;const mustValidateTerms=this.privacyLink||this.termsLink,agreedTerms=this.state.agreedTerms;return mustValidateTerms&&!agreedTerms&&(agreedTermsError=!0),this.setState({agreedTermsError})}hasValidationError(){return null!==this.state.usernameError||this.state.agreedTermsError}hasAllInputDisabled(){return this.state.processing||this.state.loading}get privacyLink(){return!!this.props.context.siteSettings&&this.props.context.siteSettings.privacyLink}get termsLink(){return!!this.props.context.siteSettings&&this.props.context.siteSettings.termsLink}get translate(){return this.props.t}render(){return react.createElement("div",{className:"enter-username"},react.createElement("h1",null,react.createElement(es.x6,null,"Please enter your email to continue.")),react.createElement("form",{acceptCharset:"utf-8",onSubmit:this.handleFormSubmit,noValidate:!0},react.createElement("div",{className:`input text required ${this.state.usernameError?"error":""} ${this.hasAllInputDisabled()?"disabled":""}`},react.createElement("label",{htmlFor:"username"},react.createElement(es.x6,null,"Email")),react.createElement("input",{id:"username-input",type:"text",ref:this.usernameRef,name:"username",value:this.state.username,onKeyUp:this.handleUsernameInputOnKeyUp,onChange:this.handleInputChange,placeholder:this.translate("you@organization.com"),required:"required",disabled:this.hasAllInputDisabled()}),this.state.usernameError&&react.createElement("div",{className:"error-message"},this.state.usernameError)),(this.privacyLink||this.termsLink)&&react.createElement("div",{className:"input checkbox "+(this.state.agreedTermsError?"error":"")},react.createElement("input",{type:"checkbox",name:"agreedTerms",value:this.state.agreedTerms,onChange:this.handleInputChange,id:"checkbox-terms",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"checkbox-terms"},(this.privacyLink||this.termsLink)&&react.createElement("span",null,this.termsLink&&!this.privacyLink&&react.createElement(es.x6,null,"I accept the ",react.createElement("a",{href:this.termsLink,target:"_blank",rel:"noopener noreferrer"},"terms")),!this.termsLink&&this.privacyLink&&react.createElement(es.x6,null,"I accept the ",react.createElement("a",{href:this.privacyLink,target:"_blank",rel:"noopener noreferrer"},"privacy policy")),this.termsLink&&this.privacyLink&&react.createElement(es.x6,null,"I accept the ",react.createElement("a",{href:this.termsLink,target:"_blank",rel:"noopener noreferrer"},"terms")," and the ",react.createElement("a",{href:this.privacyLink,target:"_blank",rel:"noopener noreferrer"},"privacy policy"))))),react.createElement("div",{className:"form-actions"},react.createElement(FormSubmitButton.A,{disabled:this.hasAllInputDisabled(),big:!0,processing:this.state.processing,fullWidth:!0,value:this.translate("Next")}),this.props.isSsoRecoverEnabled&&react.createElement("button",{className:"link",type:"button",onClick:this.props.onSecondaryActionClick},react.createElement(es.x6,null,"Continue with SSO.")))))}}EnterUsernameForm.defaultProps={isSsoRecoverEnabled:!1},EnterUsernameForm.propTypes={apiTriageContext:prop_types_default().object,context:prop_types_default().any,isSsoRecoverEnabled:prop_types_default().bool.isRequired,onSecondaryActionClick:prop_types_default().func,t:prop_types_default().func};const EnterUsernameForm_EnterUsernameForm=(0,AppContext.L)((0,ApiTriageContext.id)((0,es.CI)("common")(EnterUsernameForm)));EnterUsernameForm.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get default state\n@returns {*}",modifiers:["get"],params:[],returns:{type:{name:"mixed"}},description:"Get default state"},{name:"focusUsernameElement",docblock:"Focus the username element.",modifiers:[],params:[],returns:null,description:"Focus the username element."},{name:"isFocusOnBrowserExtension",docblock:"Check if the focus is on the browser extension\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Check if the focus is on the browser extension"},{name:"bindEventHandlers",docblock:"Bind event handlers\n@returns {void}",modifiers:[],params:[],returns:{type:{name:"void"}},description:"Bind event handlers"},{name:"createInputRefs",docblock:"Create references\n@returns {void}",modifiers:[],params:[],returns:{type:{name:"void"}},description:"Create references"},{name:"handleInputChange",docblock:"Handle form input changes.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:["async"],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle form input changes."},{name:"handleUsernameInputOnKeyUp",docblock:"Handle username/email input keyUp event.",modifiers:[],params:[],returns:null,description:"Handle username/email input keyUp event."},{name:"handleFormSubmit",docblock:"Handle form submit event.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:["async"],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle form submit event."},{name:"toggleProcessing",docblock:"Toggle processing state\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Toggle processing state"},{name:"validate",docblock:"Validate the form.\n@returns {Promise<boolean>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"boolean"}]}},description:"Validate the form."},{name:"validateUsernameInput",docblock:"Validate the username input.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Validate the username input."},{name:"validateAgreedTerms",docblock:"Validate the agreed terms checkbox.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Validate the agreed terms checkbox."},{name:"hasValidationError",docblock:"Return true if the form has some validation error\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Return true if the form has some validation error"},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"privacyLink",docblock:"Get the privacy link.\n@returns {string|boolean} false if no privacy link",modifiers:["get"],params:[],returns:{description:"false if no privacy link",type:{name:"union",elements:[{name:"string"},{name:"boolean"}]}},description:"Get the privacy link."},{name:"termsLink",docblock:"Get the terms link\n@returns {string|boolean} false if no terms",modifiers:["get"],params:[],returns:{description:"false if no terms",type:{name:"union",elements:[{name:"string"},{name:"boolean"}]}},description:"Get the terms link"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"EnterUsernameForm",props:{isSsoRecoverEnabled:{defaultValue:{value:"false",computed:!1},description:"",type:{name:"bool"},required:!1},apiTriageContext:{description:"",type:{name:"object"},required:!1},context:{description:"",type:{name:"any"},required:!1},onSecondaryActionClick:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};const EnterUsernameForm_test_stories={title:"Components/Authentication/EnterUsernameForm",component:EnterUsernameForm_EnterUsernameForm},Template=args=>react.createElement("div",{id:"container",className:"container page login"},react.createElement("div",{className:"content"},react.createElement("div",{className:"login-form"},react.createElement(react_router.MemoryRouter,{initialEntries:["/"]},react.createElement(react_router.Route,{component:routerProps=>react.createElement(EnterUsernameForm_EnterUsernameForm,{...args,...routerProps})}))))),Initial=Template.bind({});Initial.parameters={css:"ext_authentication"};const WithSsoRecoverEnabled=Template.bind({});WithSsoRecoverEnabled.parameters={css:"ext_authentication"},WithSsoRecoverEnabled.args={isSsoRecoverEnabled:!0};const __namedExportsOrder=["Initial","WithSsoRecoverEnabled"];Initial.parameters={...Initial.parameters,docs:{...Initial.parameters?.docs,source:{originalSource:'args => <div id="container" className="container page login">\n    <div className="content">\n      <div className="login-form">\n        <MemoryRouter initialEntries={[\'/\']}>\n          <Route component={routerProps => <EnterUsernameForm {...args} {...routerProps} />} />\n        </MemoryRouter>\n      </div>\n    </div>\n  </div>',...Initial.parameters?.docs?.source}}},WithSsoRecoverEnabled.parameters={...WithSsoRecoverEnabled.parameters,docs:{...WithSsoRecoverEnabled.parameters?.docs,source:{originalSource:'args => <div id="container" className="container page login">\n    <div className="content">\n      <div className="login-form">\n        <MemoryRouter initialEntries={[\'/\']}>\n          <Route component={routerProps => <EnterUsernameForm {...args} {...routerProps} />} />\n        </MemoryRouter>\n      </div>\n    </div>\n  </div>',...WithSsoRecoverEnabled.parameters?.docs?.source}}}},"./src/react-extension/lib/Object/getPropValue.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=(obj,path)=>path.split(".").reduce(((accumulator,key)=>accumulator?.[key]),obj)},"./src/react-extension/lib/Sanitize/sanitizeUrl.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,P:()=>urlProtocols});const __WEBPACK_DEFAULT_EXPORT__=(uri,options)=>{if(void 0===uri||"string"!=typeof uri||!uri.length)return!1;if((options=options||{}).whitelistedProtocols&&!Array.isArray(options.whitelistedProtocols))throw new TypeError("The whitelistedProtocols should be an array of string.");if(options.defaultProtocol&&"string"!=typeof options.defaultProtocol)throw new TypeError("The defaultProtocol should be a string.");const whitelistedProtocols=options.whitelistedProtocols||[urlProtocols.HTTP,urlProtocols.HTTPS],blacklistedProtocols=[urlProtocols.JAVASCRIPT],defaultProtocol=options.defaultProtocol||"";!/^((?!:\/\/).)*:\/\//.test(uri)&&defaultProtocol&&(uri=`${defaultProtocol}//${uri}`);try{const url=new URL(uri);return!blacklistedProtocols.includes(url.protocol)&&(!!whitelistedProtocols.includes(url.protocol)&&url.href)}catch(error){return!1}},urlProtocols={FTP:"http:",FTPS:"https:",HTTP:"http:",HTTPS:"https:",JAVASCRIPT:"javascript:",SSH:"ssh:"}},"./src/shared/lib/Settings/SiteSettings.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>SiteSettings});var validator_es_lib_util_assertString__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/validator/es/lib/util/assertString.js"),_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/react-extension/lib/Object/getPropValue.js"),_react_extension_lib_Sanitize_sanitizeUrl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/react-extension/lib/Sanitize/sanitizeUrl.js");class SiteSettings{constructor(settings){this.settings=this.sanitizeDto(settings)}sanitizeDto(dto){const sanitizedDto=JSON.parse(JSON.stringify(dto));return this.sanitizeEmailValidateRegex(sanitizedDto),sanitizedDto}sanitizeEmailValidateRegex(dto){const emailValidateRegex=dto?.passbolt?.email?.validate?.regex;emailValidateRegex&&"string"==typeof emailValidateRegex&&emailValidateRegex.trim().length&&(dto.passbolt.email.validate.regex=emailValidateRegex.trim().replace(/^\/+/,"").replace(/\/+$/,""))}canIUse(name){let result=!1;const configPath=`passbolt.plugins.${name}`,pluginSettings=(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,configPath)||null;if(pluginSettings&&"object"==typeof pluginSettings){const pluginEnabled=(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(pluginSettings,"enabled");void 0!==pluginEnabled&&!0!==pluginEnabled||(result=!0)}return result}isFeatureBeta(name){(0,validator_es_lib_util_assertString__WEBPACK_IMPORTED_MODULE_2__.A)(name);const configPath=`passbolt.plugins.${name}.isInBeta`;return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,configPath)||!1}getPluginSettings(name){const configPath=`passbolt.plugins.${name}`;return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,configPath)}getRememberMeOptions(){return(this.getPluginSettings("rememberMe")||{}).options||{}}get hasRememberMeUntilILogoutOption(){return void 0!==(this.getRememberMeOptions()||{})[-1]}getServerTimezone(){return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.app.server_timezone")}get termsLink(){const termsLink=(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.legal.terms.url");return!!termsLink&&(0,_react_extension_lib_Sanitize_sanitizeUrl__WEBPACK_IMPORTED_MODULE_0__.A)(termsLink)}get privacyLink(){const privacyLink=(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.legal.privacy_policy.url");return!!privacyLink&&(0,_react_extension_lib_Sanitize_sanitizeUrl__WEBPACK_IMPORTED_MODULE_0__.A)(privacyLink)}get registrationPublic(){return!0===(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.registration.public")}get debug(){return!0===(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"app.debug")}get url(){return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"app.url")||""}get version(){return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"app.version.number")}get isCeEdition(){return"ce"===(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.edition")}get locale(){return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"app.locale")||SiteSettings.DEFAULT_LOCALE.locale}async setLocale(locale){this.settings.app.locale=locale}get supportedLocales(){return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.plugins.locale.options")||SiteSettings.DEFAULT_SUPPORTED_LOCALES}get generatorConfiguration(){return(0,_react_extension_lib_Object_getPropValue__WEBPACK_IMPORTED_MODULE_1__.A)(this.settings,"passbolt.plugins.generator.configuration")}get emailValidateRegex(){return this.settings?.passbolt?.email?.validate?.regex||null}static get DEFAULT_SUPPORTED_LOCALES(){return[SiteSettings.DEFAULT_LOCALE]}static get DEFAULT_LOCALE(){return{locale:"en-UK",label:"English"}}}},"./src/shared/services/validator/AppEmailValidatorService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>AppEmailValidatorService});var SiteSettings=__webpack_require__("./src/shared/lib/Settings/SiteSettings.js"),lib=__webpack_require__("./node_modules/xregexp/lib/index.js"),lib_default=__webpack_require__.n(lib);class IsEmailValidator{static validate(value){return"string"==typeof value&&lib_default()("^[\\p{L}0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\p{L}0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[_\\p{L}0-9][-_\\p{L}0-9]*\\.)*(?:[\\p{L}0-9][-\\p{L}0-9]{0,62})\\.(?:(?:[a-z]{2}\\.)?[a-z]{2,})$","i").test(value)}}class IsRegexValidator{constructor(regex){if("string"!=typeof regex)throw Error("The regex should be a string.");this.regex=new(lib_default())(regex)}validate(value){return"string"==typeof value&&this.regex.test(value)}}class AppEmailValidatorService{static validate(value,appSettings){return AppEmailValidatorService.getValidator(appSettings).validate(value)}static getValidator(appSettings){return appSettings&&appSettings instanceof SiteSettings.A&&appSettings.emailValidateRegex?new IsRegexValidator(appSettings.emailValidateRegex):IsEmailValidator}}},"./node_modules/validator/es/lib/util/assertString.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function assertString(input){if(!("string"==typeof input||input instanceof String)){var invalidType=_typeof(input);throw null===input?invalidType="null":"object"===invalidType&&(invalidType=input.constructor.name),new TypeError("Expected a string but received a ".concat(invalidType))}}__webpack_require__.d(__webpack_exports__,{A:()=>assertString})}}]);