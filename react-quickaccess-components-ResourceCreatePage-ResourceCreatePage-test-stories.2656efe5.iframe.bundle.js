/*! For license information please see react-quickaccess-components-ResourceCreatePage-ResourceCreatePage-test-stories.2656efe5.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[8766],{"./src/react-quickaccess/components/ResourceCreatePage/ResourceCreatePage.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CreateResourceFromTab:()=>CreateResourceFromTab,Initial:()=>Initial,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ResourceCreatePage_test_stories});var react=__webpack_require__("./node_modules/react/index.js"),react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),react_router_dom=__webpack_require__("./node_modules/react-router-dom/esm/react-router-dom.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),SecretGenerator=__webpack_require__("./src/shared/lib/SecretGenerator/SecretGenerator.js"),PrepareResourceContext=__webpack_require__("./src/react-quickaccess/contexts/PrepareResourceContext.js"),spinner=__webpack_require__("./src/img/svg/spinner.svg"),Password=__webpack_require__("./src/shared/components/Password/Password.js"),PasswordComplexity=__webpack_require__("./src/shared/components/PasswordComplexity/PasswordComplexity.js"),pownedService=__webpack_require__("./src/shared/services/api/secrets/pownedService.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),PasswordPoliciesContext=__webpack_require__("./src/shared/context/PasswordPoliciesContext/PasswordPoliciesContext.js"),PasswordExpirySettingsContext=__webpack_require__("./src/react-extension/contexts/PasswordExpirySettingsContext.js"),ConfirmCreatePage=__webpack_require__("./src/react-quickaccess/components/ConfirmCreatePage/ConfirmCreatePage.js"),SecretGeneratorComplexity=__webpack_require__("./src/shared/lib/SecretGenerator/SecretGeneratorComplexity.js"),entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),ResourcePasswordDescriptionViewModel=__webpack_require__("./src/shared/models/resource/ResourcePasswordDescriptionViewModel.js"),ResourceViewModel=__webpack_require__("./src/shared/models/resource/ResourceViewModel.js"),luxon=__webpack_require__("./node_modules/luxon/src/luxon.js"),ResourceTypesLocalStorageContext=__webpack_require__("./src/shared/context/ResourceTypesLocalStorageContext/ResourceTypesLocalStorageContext.js"),resourceTypesCollection=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js"),MetadataTypesSettingsLocalStorageContext=__webpack_require__("./src/shared/context/MetadataTypesSettingsLocalStorageContext/MetadataTypesSettingsLocalStorageContext.js"),metadataTypesSettingsEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.js"),resourceTypeSchemasDefinition=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypeSchemasDefinition.js"),ResourceViewModelFactory=__webpack_require__("./src/shared/models/resource/ResourceViewModelFactory.js"),caret_left=__webpack_require__("./src/img/svg/caret_left.svg"),svg_close=__webpack_require__("./src/img/svg/close.svg"),dice=__webpack_require__("./src/img/svg/dice.svg"),settings=__webpack_require__("./src/img/svg/settings.svg");class ResourceCreatePage extends react.Component{constructor(props){super(props),this.initEventHandlers(),this.state=this.defaultState,this.createInputRef(),this.isPwndProcessingPromise=null}get defaultState(){return{resourceViewModel:new ResourcePasswordDescriptionViewModel.A,errors:new entityValidationError.A,unexpectedErrorMessage:"",hasAlreadyBeenValidated:!1,isPasswordDictionaryCheckRequested:!0,isPasswordDictionaryCheckServiceAvailable:!0,passwordInDictionary:this.props.location.state?.passwordInDictionary||!1,passwordEntropy:null,generatorSettings:null,processing:!1}}initEventHandlers(){this.handleGoBackClick=this.handleGoBackClick.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleGeneratePasswordButtonClick=this.handleGeneratePasswordButtonClick.bind(this),this.handleOpenGenerator=this.handleOpenGenerator.bind(this),this.handleCancelButtonClick=this.handleCancelButtonClick.bind(this),this.save=this.save.bind(this),this.rejectCreationConfirmation=this.rejectCreationConfirmation.bind(this)}async componentDidMount(){this.props.passwordExpiryContext.findSettings(),this.initPwnedPasswordService(),this.initResourceViewModel()}async initResourceViewModel(){const resourceViewModelDto=await this.getPreparedResource();let resourceType;this.props.metadataTypeSettings.isDefaultResourceTypeV5?resourceType=this.props.resourceTypes.getFirstBySlug(resourceTypeSchemasDefinition.gG):this.props.metadataTypeSettings.isDefaultResourceTypeV4&&(resourceType=this.props.resourceTypes.getFirstBySlug(resourceTypeSchemasDefinition.Bo)),resourceViewModelDto.resource_type_id=resourceType.id;const expired=this.getResourceExpirationDate();resourceViewModelDto.expired=expired;const resourceViewModel=ResourceViewModelFactory.A.createFromResourceTypeAndResourceViewModelDto(resourceType,resourceViewModelDto),passwordEntropy=resourceViewModel.password?SecretGenerator.M.entropy(resourceViewModel.password):null;await this.focusFirstEmptyField(resourceViewModel),this.setState({resourceViewModel,passwordEntropy})}getResourceExpirationDate(){if(!this.props.passwordExpiryContext.isFeatureEnabled())return;const passwordExpirySettings=this.props.passwordExpiryContext.getSettings();return passwordExpirySettings?.automatic_update?null==passwordExpirySettings.default_expiry_period?null:luxon.c9.utc().plus({days:passwordExpirySettings.default_expiry_period}).toISO():void 0}initPwnedPasswordService(){const isPasswordDictionaryCheckRequested=this.props.passwordPoliciesContext.shouldRunDictionaryCheck();isPasswordDictionaryCheckRequested&&(this.pownedService=new pownedService.A(this.props.context.port)),this.setState({isPasswordDictionaryCheckRequested})}createInputRef(){this.nameInputRef=react.createRef(),this.uriInputRef=react.createRef(),this.usernameInputRef=react.createRef(),this.passwordInputRef=react.createRef()}async getPreparedResource(){const preparedResource=this.props.prepareResourceContext.consumePreparedResource(),lastGeneratedPassword=this.props.prepareResourceContext.lastGeneratedPassword;return preparedResource?(preparedResource.password=lastGeneratedPassword??preparedResource.password,preparedResource):await this.getPasswordMetaFromTabInfo()}async getPasswordMetaFromTabInfo(){let name="",uri="",username="",password="";const ignoreNames=["newtab"],ignoreUris=["chrome://newtab/","about:newtab"];try{const tabInfo=await this.props.context.port.request("passbolt.quickaccess.prepare-resource",this.props.context.getOpenerTabId());ignoreNames.includes(tabInfo.name)||(name=tabInfo.name.substring(0,255)),!ignoreUris.includes(tabInfo.uris)&&tabInfo.uris.length>0&&(uri=tabInfo.uris[0]),username=tabInfo.username?.length>0?tabInfo.username:this.props.context.userSettings.username,password=tabInfo.secret_clear?.length>0?tabInfo.secret_clear:this.generateSecret()}catch(error){console.error(error)}return{name,uri,username,password}}focusFirstEmptyField(resourceViewModel){return new Promise((resolve=>{setTimeout((()=>{resourceViewModel.name?resourceViewModel.uri?resourceViewModel.username?resourceViewModel.password||this.passwordInputRef.current.focus():this.usernameInputRef.current.focus():this.uriInputRef.current.focus():this.nameInputRef.current.focus(),resolve()}),210)}))}handleGoBackClick(ev){ev.preventDefault(),this.props.prepareResourceContext.resetSecretGeneratorSettings(),this.props.history.goBack()}handleCancelButtonClick(){this.props.prepareResourceContext.resetSecretGeneratorSettings()}validate(){const errors=this.state.resourceViewModel.validate(ResourceViewModel.A.CREATE_MODE);return this.setState({errors}),errors}async handleFormSubmit(event){if(event.preventDefault(),this.state.processing)return;this.setState({processing:!0,hasAlreadyBeenValidated:!0});const validationErrors=this.validate();if(validationErrors.hasErrors())return this.setState({processing:!1}),void this.focusFirstFieldError(validationErrors);this.isMinimumRequiredEntropyReached()?await this.isPasswordInDictionary()?this.handleComfirmPasswordCreation(ConfirmCreatePage._.IN_DICTIONARY):await this.save():this.handleComfirmPasswordCreation(ConfirmCreatePage._.MINIMUM_ENTROPY)}focusFirstFieldError(validationErrors){validationErrors.hasError("name")?this.nameInputRef.current.focus():validationErrors.hasError("uri")?this.uriInputRef.current.focus():validationErrors.hasError("password")&&this.passwordInputRef.current.focus()}handleComfirmPasswordCreation(createPageRuleVariation){this.persistResourceInPreparedStorage();const pageProps={resourceName:this.state.resourceViewModel.name,rule:createPageRuleVariation};this.props.history.push("/webAccessibleResources/quickaccess/resources/confirm-create",pageProps)}async rejectCreationConfirmation(){await this.toggleProcessing(),this.passwordInputRef.current.focus()}async save(){const resourceDto=this.state.resourceViewModel.toResourceDto(),secretDto=this.state.resourceViewModel.toSecretDto();let resource;try{resource=await this.props.context.port.request("passbolt.resources.create",resourceDto,secretDto)}catch(error){return void this.handleSubmitError(error)}this.props.prepareResourceContext.resetSecretGeneratorSettings(),this.props.history.push(`/webAccessibleResources/quickaccess/resources/view/${resource.id}`,{goBackEntriesCount:-2})}handleSubmitError(error){if("UserAbortsOperationError"===error.name)return void this.setState({processing:!1});if(!("PassboltApiFetchError"===error.name&&400===error.data.code&&(error.data.body?.name||error.data.body?.username||error.data.body?.uri)))return void this.setState({unexpectedErrorMessage:error.message,processing:!1});const apiErrors=this.formatApiErrors(error.data.body);this.setState({errors:apiErrors})}async isPasswordInDictionary(){if(!this.state.isPasswordDictionaryCheckRequested||!this.state.isPasswordDictionaryCheckServiceAvailable)return!1;const{isPwnedServiceAvailable,inDictionary}=await this.pownedService.evaluateSecret(this.state.resourceViewModel.password);return isPwnedServiceAvailable?inDictionary:(this.setState({isPasswordDictionaryCheckServiceAvailable:!1}),!1)}isMinimumRequiredEntropyReached(){return this.state.passwordEntropy&&this.state.passwordEntropy>=SecretGeneratorComplexity.JP.WEAK}formatApiErrors(errorBody){const errors=new entityValidationError.A,fieldsInError=Object.keys(errorBody);for(let i=0;i<fieldsInError.length;i++){const prop=fieldsInError[i],errorMessages=errorBody[prop].join(", ");errors.addError(prop,"api-validation",errorMessages)}return errors}handleInputChange(event){const{name,value}=event.target,newState={resourceViewModel:this.state.resourceViewModel.cloneWithMutation(name,value)};"password"===name&&(newState.passwordInDictionary=!1,newState.passwordEntropy=value?.length?SecretGenerator.M.entropy(value):null),this.state.hasAlreadyBeenValidated&&(newState.errors=newState.resourceViewModel.validate(ResourceViewModel.A.CREATE_MODE)),this.setState(newState)}handleGeneratePasswordButtonClick(){if(this.state.processing)return;const password=this.generateSecret(),resourceViewModel=this.state.resourceViewModel.cloneWithMutation("password",password),passwordEntropy=SecretGenerator.M.entropy(password);this.setState({resourceViewModel,passwordEntropy,passwordInDictionary:!1})}generateSecret(){const configuration=this.props.prepareResourceContext.settings;return SecretGenerator.M.generate(configuration)}handleOpenGenerator(){this.state.processing||(this.persistResourceInPreparedStorage(),this.props.history.push("/webAccessibleResources/quickaccess/resources/generate-password"))}persistResourceInPreparedStorage(){const resource={name:this.state.resourceViewModel.name,username:this.state.resourceViewModel.username,uri:this.state.resourceViewModel.uri,password:this.state.resourceViewModel.password};this.props.prepareResourceContext.onPrepareResource(resource)}get canUsePasswordGenerator(){return this.props.context.siteSettings.canIUse("passwordGenerator")}get translate(){return this.props.t}render(){const passwordEntropy=this.state.passwordInDictionary?0:this.state.passwordEntropy;return react.createElement("div",{className:"resource-create"},react.createElement("div",{className:"back-link"},react.createElement("a",{href:"#",className:"primary-action",onClick:this.handleGoBackClick,title:this.translate("Cancel the operation")},react.createElement(caret_left.A,null),react.createElement("span",{className:"primary-action-title"},react.createElement(es.x6,null,"Create password"))),react.createElement(react_router_dom.N_,{to:"/webAccessibleResources/quickaccess/home",onClick:this.handleCancelButtonClick,className:"secondary-action button-transparent button",title:this.translate("Cancel")},react.createElement(svg_close.A,null),react.createElement("span",{className:"visually-hidden"},react.createElement(es.x6,null,"Cancel")))),react.createElement("form",{onSubmit:this.handleFormSubmit},react.createElement("div",{className:"resource-create-form"},react.createElement("div",{className:"form-container"},react.createElement("div",{className:"input text required "+(this.state.errors.hasError("name")?"error":"")},react.createElement("label",{htmlFor:"name"},react.createElement(es.x6,null,"Name")),react.createElement("input",{name:"name",value:this.state.resourceViewModel.name||"",onChange:this.handleInputChange,disabled:this.state.processing,ref:this.nameInputRef,className:"required fluid",maxLength:"255",type:"text",id:"name",autoComplete:"off"}),this.state.errors.hasError("name","required")&&react.createElement("div",{className:"error-message"},react.createElement(es.x6,null,"A name is required.")),this.state.errors.hasError("name","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("name","api-validation"))),react.createElement("div",{className:"input text "+(this.state.errors.hasError("uri")?"error":"")},react.createElement("label",{htmlFor:"uri"},react.createElement(es.x6,null,"URL")),react.createElement("input",{name:"uri",value:this.state.resourceViewModel.uri||"",onChange:this.handleInputChange,disabled:this.state.processing,ref:this.uriInputRef,className:"fluid",maxLength:"1024",type:"text",id:"uri",autoComplete:"off"}),this.state.errors.hasError("uri","maxLength")&&react.createElement("div",{className:"error-message"},react.createElement(es.x6,null,"The URI cannot exceed 1024 characters.")),this.state.errors.hasError("uri","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("uri","api-validation"))),react.createElement("div",{className:"input text "+(this.state.errors.hasError("username")?"error":"")},react.createElement("label",{htmlFor:"username"},react.createElement(es.x6,null,"Username")),react.createElement("input",{name:"username",value:this.state.resourceViewModel.username||"",onChange:this.handleInputChange,disabled:this.state.processing,ref:this.usernameInputRef,className:"fluid",maxLength:"255",type:"text",id:"username",autoComplete:"off"}),this.state.errors.hasError("username","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("username","api-validation"))),react.createElement("div",{className:"input-password-wrapper input required "+(this.state.errors.hasError("password")?"error":"")},react.createElement("label",{htmlFor:"password"},react.createElement(es.x6,null,"Password")),react.createElement("div",{className:"password-button-inline"},react.createElement(Password.A,{name:"password",value:this.state.resourceViewModel.password||"",preview:!0,onChange:this.handleInputChange,disabled:this.state.processing,autoComplete:"new-password",placeholder:this.translate("Password"),id:"password",inputRef:this.passwordInputRef}),react.createElement("button",{type:"button",onClick:this.handleGeneratePasswordButtonClick,className:"password-generate button-icon button "+(this.state.processing?"disabled":"")},react.createElement(dice.A,null),react.createElement("span",{className:"visually-hidden"},react.createElement(es.x6,null,"Generate"))),this.canUsePasswordGenerator&&react.createElement("button",{type:"button",onClick:this.handleOpenGenerator,className:"password-generator button-icon button"},react.createElement(settings.A,null),react.createElement("span",{className:"visually-hidden"},react.createElement(es.x6,null,"Open generator")))),react.createElement(PasswordComplexity.A,{entropy:passwordEntropy,error:this.state.errors.hasError("password")}),this.state.errors.hasError("password","required")&&react.createElement("div",{className:"error-message"},react.createElement(es.x6,null,"A password is required.")),this.state.errors.hasError("password","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("password","api-validation"))))),react.createElement("div",{className:"submit-wrapper input"},react.createElement("button",{type:"submit",className:"button primary big full-width "+(this.state.processing?"processing":""),role:"button",disabled:this.state.processing},react.createElement(es.x6,null,"Save"),this.state.processing&&react.createElement(spinner.A,null)),this.state.unexpectedErrorMessage&&react.createElement("div",{className:"error-message"},this.state.unexpectedErrorMessage))))}}ResourceCreatePage.propTypes={context:prop_types_default().any,resourceTypes:prop_types_default().instanceOf(resourceTypesCollection.A),metadataTypeSettings:prop_types_default().instanceOf(metadataTypesSettingsEntity.Ay),prepareResourceContext:prop_types_default().any,history:prop_types_default().object,location:prop_types_default().any,t:prop_types_default().func,passwordPoliciesContext:prop_types_default().object,passwordExpiryContext:prop_types_default().object};const ResourceCreatePage_ResourceCreatePage=(0,AppContext.L)((0,react_router.withRouter)((0,ResourceTypesLocalStorageContext.KH)((0,MetadataTypesSettingsLocalStorageContext.mw)((0,PrepareResourceContext.N5)((0,PasswordExpirySettingsContext.f4)((0,PasswordPoliciesContext.WJ)((0,es.CI)("common")(ResourceCreatePage))))))));ResourceCreatePage.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get the default state\n@returns {object}",modifiers:["get"],params:[],returns:{type:{name:"object"}},description:"Get the default state"},{name:"initEventHandlers",docblock:"initialize event handlers\n@returns {void}",modifiers:[],params:[],returns:{type:{name:"void"}},description:"initialize event handlers"},{name:"initResourceViewModel",docblock:null,modifiers:["async"],params:[],returns:null},{name:"getResourceExpirationDate",docblock:"Get the expiration date on the given resource according to the password expiry settings.\nThe value is set to `undefined` if the feature is not activated,\notherwise it is set to `null` if the expiration date must be unset\nor else a `DateTime` at when the expiration should occur.\n@returns {DateTime|null|undefined}",modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"DateTime"}]}},description:"Get the expiration date on the given resource according to the password expiry settings.\nThe value is set to `undefined` if the feature is not activated,\notherwise it is set to `null` if the expiration date must be unset\nor else a `DateTime` at when the expiration should occur."},{name:"initPwnedPasswordService",docblock:"Initialize the pwned password service",modifiers:[],params:[],returns:null,description:"Initialize the pwned password service"},{name:"createInputRef",docblock:"Create DOM nodes or React elements references.",modifiers:[],params:[],returns:null,description:"Create DOM nodes or React elements references."},{name:"getPreparedResource",docblock:"Consumes a prepared resource if any and initialise the form with it.\nIf no resources were preparen the form is initialised with the tab info.\n@returns {Promise<object>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"object"}]}},description:"Consumes a prepared resource if any and initialise the form with it.\nIf no resources were preparen the form is initialised with the tab info."},{name:"getPasswordMetaFromTabInfo",docblock:"Retrieve the password meta information of the current tab\n@returns {Promise<{name: string, uri: string, username: string, password: string}>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[]}},description:"Retrieve the password meta information of the current tab"},{name:"focusFirstEmptyField",docblock:"Focuses on the first empty field in the form after the animation has finished.\n@param {ResourceViewModel} resourceViewModel\n@returns {Promise<void>}",modifiers:[],params:[{name:"resourceViewModel",type:{name:"ResourceViewModel"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Focuses on the first empty field in the form after the animation has finished."},{name:"handleGoBackClick",docblock:"Handles click on the `go back` button\n@param {React.Event} ev",modifiers:[],params:[{name:"ev",type:{name:"React.Event"},optional:!1}],returns:null,description:"Handles click on the `go back` button"},{name:"handleCancelButtonClick",docblock:'Handles the click on the "x" button',modifiers:[],params:[],returns:null,description:'Handles the click on the "x" button'},{name:"validate",docblock:"Validate the form data and returns true if it's valid\n@returns {EntityValidationError}",modifiers:[],params:[],returns:{type:{name:"EntityValidationError"}},description:"Validate the form data and returns true if it's valid"},{name:"handleFormSubmit",docblock:"Handles the form submission\n@param {React.Event} event\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"event",type:{name:"React.Event"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handles the form submission"},{name:"focusFirstFieldError",docblock:"Focus the first field of the form which is in error state.\n@param {EntityValidationError} validationErrors",modifiers:[],params:[{name:"validationErrors",type:{name:"EntityValidationError"},optional:!1}],returns:null,description:"Focus the first field of the form which is in error state."},{name:"handleComfirmPasswordCreation",docblock:"Handle the request to confirm password creation when it is weak\n@param {string} createPageRuleVariation",modifiers:[],params:[{name:"createPageRuleVariation",type:{name:"string"},optional:!1}],returns:null,description:"Handle the request to confirm password creation when it is weak"},{name:"rejectCreationConfirmation",docblock:"Reject the creation confirmation.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Reject the creation confirmation."},{name:"save",docblock:"Save the resource\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Save the resource"},{name:"handleSubmitError",docblock:"Handles error during form submission\n@param {Error} error",modifiers:[],params:[{name:"error",type:{name:"Error"},optional:!1}],returns:null,description:"Handles error during form submission"},{name:"isPasswordInDictionary",docblock:"Check if the password is part of a dictionary.\n@return {Promise<boolean>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"boolean"}]}},description:"Check if the password is part of a dictionary."},{name:"isMinimumRequiredEntropyReached",docblock:"Returns true if the strict minimum entropy is reached (entropy is higher than very weak entropy)\n@param {number} passphraseEntropy\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true if the strict minimum entropy is reached (entropy is higher than very weak entropy)"},{name:"formatApiErrors",docblock:"Format the given BadRequest error invalid field information.\n@param {object} errorBody\n@returns {EntityValidationError}",modifiers:[],params:[{name:"errorBody",type:{name:"object"},optional:!1}],returns:{type:{name:"EntityValidationError"}},description:"Format the given BadRequest error invalid field information."},{name:"handleInputChange",docblock:"Handles form input changed\n@param {React.Event} event",modifiers:[],params:[{name:"event",type:{name:"React.Event"},optional:!1}],returns:null,description:"Handles form input changed"},{name:"handleGeneratePasswordButtonClick",docblock:'Handles click on "regenerate" a password',modifiers:[],params:[],returns:null,description:'Handles click on "regenerate" a password'},{name:"generateSecret",docblock:"Generates a new secret based on the current configuration\n@returns {string}",modifiers:[],params:[],returns:{type:{name:"string"}},description:"Generates a new secret based on the current configuration"},{name:"handleOpenGenerator",docblock:"Whenever the user wants to go to the password generator",modifiers:[],params:[],returns:null,description:"Whenever the user wants to go to the password generator"},{name:"persistResourceInPreparedStorage",docblock:"Persist the current resource state in the prepared storage.\nIt is used when the user is opening the generator or has to confirm the resource creation.",modifiers:[],params:[],returns:null,description:"Persist the current resource state in the prepared storage.\nIt is used when the user is opening the generator or has to confirm the resource creation."},{name:"canUsePasswordGenerator",docblock:"Returns true if the logged in user can use the password generator capability.\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Returns true if the logged in user can use the password generator capability."},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"ResourceCreatePage",props:{context:{description:"",type:{name:"any"},required:!1},resourceTypes:{description:"",type:{name:"instanceOf",value:"ResourceTypesCollection"},required:!1},metadataTypeSettings:{description:"",type:{name:"instanceOf",value:"MetadataTypesSettingsEntity"},required:!1},prepareResourceContext:{description:"",type:{name:"any"},required:!1},history:{description:"",type:{name:"object"},required:!1},location:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"func"},required:!1},passwordPoliciesContext:{description:"",type:{name:"object"},required:!1},passwordExpiryContext:{description:"",type:{name:"object"},required:!1}}};var PrepareResourceContext_test_data=__webpack_require__("./src/react-quickaccess/contexts/PrepareResourceContext.test.data.js"),PasswordPoliciesContext_test_data=__webpack_require__("./src/shared/context/PasswordPoliciesContext/PasswordPoliciesContext.test.data.js"),PasswordPoliciesDto_test_data=__webpack_require__("./src/shared/models/passwordPolicies/PasswordPoliciesDto.test.data.js"),PasswordExpirySettingsContext_test_data=__webpack_require__("./src/react-extension/contexts/PasswordExpirySettingsContext.test.data.js"),PasswordExpirySettingsDto_test_data=__webpack_require__("./src/shared/models/passwordExpirySettings/PasswordExpirySettingsDto.test.data.js"),AppContext_test_data=__webpack_require__("./src/react-quickaccess/contexts/AppContext.test.data.js"),resourceTypesCollection_test_data=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.test.data.js"),metadataTypesSettingsEntity_test_data=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.test.data.js");const defaultProps=(props={})=>({prepareResourceContext:(0,PrepareResourceContext_test_data.M)(),resourceTypes:new resourceTypesCollection.A((0,resourceTypesCollection_test_data.V1)()),metadataTypeSettings:new metadataTypesSettingsEntity.Ay((0,metadataTypesSettingsEntity_test_data.uc)()),passwordExpiryContext:(0,PasswordExpirySettingsContext_test_data.i)({getSettings:()=>(0,PasswordExpirySettingsDto_test_data.om)()}),passwordPoliciesContext:(0,PasswordPoliciesContext_test_data.M)({getPolicies:jest.fn((()=>(0,PasswordPoliciesDto_test_data.m)()))}),context:(0,AppContext_test_data.s)({isAuthenticated:!0,getOpenerTabId:()=>null,getBootstrapFeature:()=>null,getDetached:()=>!1}),...props}),mockResults={"passbolt.quickaccess.prepare-resource":{title:"test",uri:"www.test.com",name:"Tab test",username:"test@passbolt.com",secret_clear:"password test"},"passbolt.resources.create":{}},ResourceCreatePage_test_stories={title:"Components/QuickAccess/ResourceCreate",component:ResourceCreatePage_ResourceCreatePage},Template=({context,...args})=>react.createElement(AppContext.A.Provider,{value:context},react.createElement(react_router.MemoryRouter,{initialEntries:["/"]},react.createElement(react_router.Route,{component:routerProps=>react.createElement("div",{className:"container quickaccess"},react.createElement(ResourceCreatePage_ResourceCreatePage,{...args,...routerProps}))})));Template.propTypes={context:prop_types_default().object};const parameters={css:"ext_quickaccess"},Initial=Template.bind({});Initial.args=defaultProps(),Initial.parameters=parameters;const contextMock={port:{request:path=>mockResults[path]}},CreateResourceFromTab=Template.bind({});CreateResourceFromTab.args=defaultProps({context:(0,AppContext_test_data.s)(contextMock)}),CreateResourceFromTab.parameters=parameters;const __namedExportsOrder=["Initial","CreateResourceFromTab"];Initial.parameters={...Initial.parameters,docs:{...Initial.parameters?.docs,source:{originalSource:"({\n  context,\n  ...args\n}) => <AppContext.Provider value={context}>\n    <MemoryRouter initialEntries={['/']}>\n      <Route component={routerProps => <div className=\"container quickaccess\"><ResourceCreatePage {...args} {...routerProps} /></div>} />\n    </MemoryRouter>\n  </AppContext.Provider>",...Initial.parameters?.docs?.source}}},CreateResourceFromTab.parameters={...CreateResourceFromTab.parameters,docs:{...CreateResourceFromTab.parameters?.docs,source:{originalSource:"({\n  context,\n  ...args\n}) => <AppContext.Provider value={context}>\n    <MemoryRouter initialEntries={['/']}>\n      <Route component={routerProps => <div className=\"container quickaccess\"><ResourceCreatePage {...args} {...routerProps} /></div>} />\n    </MemoryRouter>\n  </AppContext.Provider>",...CreateResourceFromTab.parameters?.docs?.source}}}},"./src/img/svg/settings.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _path,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SvgSettings(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",width:28,height:28,fill:"none",viewBox:"0 0 28 28"},props),_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M24.5 4.667h-8.167M11.667 4.667H3.5M24.5 14H14M9.333 14H3.5M24.5 23.333h-5.833M14 23.333H3.5M16.333 2.333V7M9.333 11.667v4.667M18.667 21v4.667"})))}},"./src/react-quickaccess/components/ConfirmCreatePage/ConfirmCreatePage.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,_:()=>ConfirmCreatePageRuleVariations});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_12__),react_router_dom__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/react-router/esm/react-router.js"),react_i18next__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_img_svg_spinner_svg__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/img/svg/spinner.svg"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_contexts_PrepareResourceContext__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-quickaccess/contexts/PrepareResourceContext.js"),_react_extension_contexts_PasswordExpirySettingsContext__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/contexts/PasswordExpirySettingsContext.js"),_shared_context_PasswordPoliciesContext_PasswordPoliciesContext__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/shared/context/PasswordPoliciesContext/PasswordPoliciesContext.js"),_shared_context_ResourceTypesLocalStorageContext_ResourceTypesLocalStorageContext__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/shared/context/ResourceTypesLocalStorageContext/ResourceTypesLocalStorageContext.js"),_shared_models_entity_resourceType_resourceTypesCollection__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js"),_shared_models_entity_resourceType_resourceTypeSchemasDefinition__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypeSchemasDefinition.js"),_img_svg_caret_left_svg__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/img/svg/caret_left.svg"),_img_svg_close_svg__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/img/svg/close.svg");const ConfirmCreatePageRuleVariations={IN_DICTIONARY:"In dictionary",MINIMUM_ENTROPY:"Minimum entropy"};class ConfirmCreatePage extends react__WEBPACK_IMPORTED_MODULE_0__.PureComponent{constructor(props){super(props),this.state=this.getDefaultState(),this.initEventHandlers()}getDefaultState(){return{error:"",processing:!1}}initEventHandlers(){this.handleGoBackClick=this.handleGoBackClick.bind(this),this.handleConfirmClick=this.handleConfirmClick.bind(this)}handleGoBackClick(event){event.preventDefault();const additionalState={passwordInDictionary:this.props.location.state.rule===ConfirmCreatePageRuleVariations.IN_DICTIONARY};this.props.history.replace({pathname:"/webAccessibleResources/quickaccess/resources/create",state:additionalState}),this.props.history.goBack()}handleConfirmClick(event){event.preventDefault(),this.save()}async save(){const resourceTypeId=this.props.resourceTypes?.getFirstBySlug(_shared_models_entity_resourceType_resourceTypeSchemasDefinition__WEBPACK_IMPORTED_MODULE_9__.Bo)?.id,preparedResource=this.props.prepareResourceContext.consumePreparedResource(),resourceDto={resource_type_id:resourceTypeId,metadata:{name:preparedResource.name,username:preparedResource.username,uris:[preparedResource.uri],resource_type_id:resourceTypeId,expired:this.props.passwordExpiryContext.getDefaultExpirationDate()}},secretDto={password:preparedResource.password,description:""};this.setState({processing:!0});try{const resource=await this.props.context.port.request("passbolt.resources.create",resourceDto,secretDto),goToComponentState={goBackEntriesCount:-3};this.props.prepareResourceContext.resetSecretGeneratorSettings(),this.props.history.push(`/webAccessibleResources/quickaccess/resources/view/${resource.id}`,goToComponentState)}catch(error){this.handleSubmitError(error)}}handleSubmitError(error){"UserAbortsOperationError"===error.name?this.setState({processing:!1}):this.setState({error:error.message,processing:!1})}get translate(){return this.props.t}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"confirm-create"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"back-link"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{href:"#",className:"primary-action",onClick:this.handleGoBackClick,title:this.translate("Edit password")},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_caret_left_svg__WEBPACK_IMPORTED_MODULE_10__.A,null),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"primary-action-title"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Confirm password creation"))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{href:"#",className:"secondary-action button-transparent button",onClick:this.handleGoBackClick,title:this.translate("Reject")},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_close_svg__WEBPACK_IMPORTED_MODULE_11__.A,{className:"close"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"visually-hidden"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Reject")))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-container"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,{[ConfirmCreatePageRuleVariations.IN_DICTIONARY]:react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"The password is part of an exposed data breach."),[ConfirmCreatePageRuleVariations.MINIMUM_ENTROPY]:react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"The password is very weak and might be part of an exposed data breach.")}[this.props.location.state.rule]),react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Are you sure you want to create the resource ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("strong",null,{resourceName:this.props.location.state.resourceName}),"?"))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"submit-wrapper input"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",onClick:this.handleConfirmClick,className:"button primary attention big full-width "+(this.state.processing?"processing":""),role:"button",disabled:this.state.processing},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Proceed anyway"),this.state.processing&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_spinner_svg__WEBPACK_IMPORTED_MODULE_2__.A,null)),this.state.error&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"error-message"},this.state.error)))}}ConfirmCreatePage.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,prepareResourceContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,passwordExpiryContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,resourceTypes:prop_types__WEBPACK_IMPORTED_MODULE_12___default().instanceOf(_shared_models_entity_resourceType_resourceTypesCollection__WEBPACK_IMPORTED_MODULE_8__.A),match:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,location:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,history:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,t:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_3__.L)((0,react_router_dom__WEBPACK_IMPORTED_MODULE_13__.withRouter)((0,_shared_context_ResourceTypesLocalStorageContext_ResourceTypesLocalStorageContext__WEBPACK_IMPORTED_MODULE_7__.KH)((0,_contexts_PrepareResourceContext__WEBPACK_IMPORTED_MODULE_4__.N5)((0,_react_extension_contexts_PasswordExpirySettingsContext__WEBPACK_IMPORTED_MODULE_5__.f4)((0,_shared_context_PasswordPoliciesContext_PasswordPoliciesContext__WEBPACK_IMPORTED_MODULE_6__.WJ)((0,react_i18next__WEBPACK_IMPORTED_MODULE_1__.CI)("common")(ConfirmCreatePage)))))));ConfirmCreatePage.__docgenInfo={description:"",methods:[{name:"getDefaultState",docblock:"Get the default state\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Get the default state"},{name:"initEventHandlers",docblock:"initialize event handlers\n@returns {void}",modifiers:[],params:[],returns:{type:{name:"void"}},description:"initialize event handlers"},{name:"handleGoBackClick",docblock:"Handles click on the `go back` button and cancel button\n@param {React.Event} event",modifiers:[],params:[{name:"event",type:{name:"React.Event"},optional:!1}],returns:null,description:"Handles click on the `go back` button and cancel button"},{name:"handleConfirmClick",docblock:'Handles the click on the "x" button\n@param {React.Event} event',modifiers:[],params:[{name:"event",type:{name:"React.Event"},optional:!1}],returns:null,description:'Handles the click on the "x" button'},{name:"save",docblock:"Save the resource\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Save the resource"},{name:"handleSubmitError",docblock:"Handles error during form submission\n@param {Error} error",modifiers:[],params:[{name:"error",type:{name:"Error"},optional:!1}],returns:null,description:"Handles error during form submission"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"ConfirmCreatePage",props:{context:{description:"",type:{name:"any"},required:!1},prepareResourceContext:{description:"",type:{name:"any"},required:!1},passwordExpiryContext:{description:"",type:{name:"object"},required:!1},resourceTypes:{description:"",type:{name:"instanceOf",value:"ResourceTypesCollection"},required:!1},match:{description:"",type:{name:"object"},required:!1},location:{description:"",type:{name:"object"},required:!1},history:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}}}]);