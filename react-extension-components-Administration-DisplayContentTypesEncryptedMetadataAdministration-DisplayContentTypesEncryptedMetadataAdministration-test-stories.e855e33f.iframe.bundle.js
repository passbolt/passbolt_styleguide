/*! For license information please see react-extension-components-Administration-DisplayContentTypesEncryptedMetadataAdministration-DisplayContentTypesEncryptedMetadataAdministration-test-stories.e855e33f.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[9629],{"./src/react-extension/components/Administration/DisplayContentTypesEncryptedMetadataAdministration/DisplayContentTypesEncryptedMetadataAdministration.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Initial:()=>Initial,WithValidationError:()=>WithValidationError,WithWarnings:()=>WithWarnings,__namedExportsOrder:()=>__namedExportsOrder,default:()=>DisplayContentTypesEncryptedMetadataAdministration_test_stories});var react=__webpack_require__("./node_modules/react/index.js"),dist=__webpack_require__("./node_modules/@storybook/test/dist/index.mjs"),ActionFeedbackContext_test_data=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.test.data.js"),AdministrationWorkspaceContext_test_data=__webpack_require__("./src/react-extension/contexts/AdministrationWorkspaceContext.test.data.js"),ExtAppContext_test_data=__webpack_require__("./src/react-extension/contexts/ExtAppContext.test.data.js"),DialogContext_test_data=__webpack_require__("./src/react-extension/contexts/DialogContext.test.data.js"),metadataTypesSettingsEntity_test_data=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.test.data.js"),metadataTypesSettingsEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.js"),resourceTypesCollection=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js"),resourceTypesCollection_test_data=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.test.data.js"),metadataKeysCollection=__webpack_require__("./src/shared/models/entity/metadata/metadataKeysCollection.js"),metadataKeysCollection_test_data=__webpack_require__("./src/shared/models/entity/metadata/metadataKeysCollection.test.data.js");function defaultProps(props={}){return{context:(0,ExtAppContext_test_data.dO)(),dialogContext:(0,DialogContext_test_data.L)(),administrationWorkspaceContext:(0,AdministrationWorkspaceContext_test_data.M)(),actionFeedbackContext:(0,ActionFeedbackContext_test_data.M)(),metadataSettingsServiceWorkerService:{findTypesSettings:()=>new metadataTypesSettingsEntity.Ay((0,metadataTypesSettingsEntity_test_data.uc)()),saveTypesSettings:jest.fn((settings=>new metadataTypesSettingsEntity.Ay(settings.toDto())))},metadataKeysServiceWorkerService:{findAll:()=>new metadataKeysCollection.A((0,metadataKeysCollection_test_data.hm)())},createPortal:jest.fn,resourceTypes:new resourceTypesCollection.A((0,resourceTypesCollection_test_data.V1)()),t:text=>text,...props}}var DisplayContentTypesEncryptedMetadataAdministration=__webpack_require__("./src/react-extension/components/Administration/DisplayContentTypesEncryptedMetadataAdministration/DisplayContentTypesEncryptedMetadataAdministration.js"),react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),TranslationProvider=__webpack_require__("./src/react-extension/components/Common/Internationalisation/TranslationProvider.js"),DisplayAdministrationWorkspaceBreadcrumb=__webpack_require__("./src/react-extension/components/Administration/DisplayAdministrationWorkspaceBreadcrumb/DisplayAdministrationWorkspaceBreadcrumb.js");const DisplayContentTypesEncryptedMetadataAdministration_test_stories={title:"Components/Administration/DisplayContentTypesEncryptedMetadataAdministration",component:DisplayContentTypesEncryptedMetadataAdministration.A,decorators:[(Story,{args})=>react.createElement(react_router.MemoryRouter,{initialEntries:["/app/administration"]},react.createElement(TranslationProvider.A,{loadingPath:"/webAccessibleResources/locales/{{lng}}/{{ns}}.json"},react.createElement("div",{id:"container",className:"page administration"},react.createElement("div",{id:"app",className:"app",style:{margin:"-1rem"}},react.createElement("div",{className:"panel main"},react.createElement("div",{className:"panel left"},react.createElement("div",{className:"sidebar-content"},react.createElement("div",{className:"top-bar-left-navigation"},react.createElement("div",{className:"navigation"})),react.createElement("div",{className:"sidebar-content-left"}))),react.createElement("div",{className:"panel middle"},react.createElement("div",{className:"header"}),react.createElement("div",{className:"middle-right"},react.createElement("div",{className:"breadcrumbs-and-grid"},react.createElement("div",{className:"top-bar"},react.createElement(DisplayAdministrationWorkspaceBreadcrumb.A,null)),react.createElement("div",{className:"main-page"},react.createElement(Story,args))),react.createElement("div",{className:"help-panel"},react.createElement("div",{className:"sidebar-help"},react.createElement("div",{id:"administration-help-panel"}))))))))))]},Initial={args:defaultProps()},WithValidationError={args:function allowedVersionErrorProps(data={}){const settingsDto=(0,metadataTypesSettingsEntity_test_data.uc)();return settingsDto.allow_creation_of_v4_resources=!1,defaultProps({metadataSettingsServiceWorkerService:{findTypesSettings:()=>new metadataTypesSettingsEntity.Ay(settingsDto,{validate:!1})},...data})}(),play:async({canvasElement})=>{(0,dist.ux)(canvasElement).getByTestId("submit-form").requestSubmit()}},WithWarnings={args:function resourceTypesDeletedProps(data={}){const settingsDto=(0,metadataTypesSettingsEntity_test_data.uc)({allow_v4_v5_upgrade:!0,allow_v5_v4_downgrade:!0});return defaultProps({resourceTypes:new resourceTypesCollection.A,metadataSettingsServiceWorkerService:{findTypesSettings:()=>new metadataTypesSettingsEntity.Ay(settingsDto)},...data})}()},__namedExportsOrder=["Initial","WithValidationError","WithWarnings"];Initial.parameters={...Initial.parameters,docs:{...Initial.parameters?.docs,source:{originalSource:"{\n  args: defaultProps()\n}",...Initial.parameters?.docs?.source}}},WithValidationError.parameters={...WithValidationError.parameters,docs:{...WithValidationError.parameters?.docs,source:{originalSource:'{\n  args: allowedVersionErrorProps(),\n  // Trigger the form validation.\n  play: async ({\n    canvasElement\n  }) => {\n    const canvas = within(canvasElement);\n    const form = canvas.getByTestId("submit-form");\n    form.requestSubmit();\n  }\n}',...WithValidationError.parameters?.docs?.source}}},WithWarnings.parameters={...WithWarnings.parameters,docs:{...WithWarnings.parameters?.docs,source:{originalSource:"{\n  args: resourceTypesDeletedProps()\n}",...WithWarnings.parameters?.docs?.source}}}},"./node_modules/@storybook/instrumenter/dist sync recursive":module=>{function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./node_modules/@storybook/instrumenter/dist sync recursive",module.exports=webpackEmptyContext},"./node_modules/@storybook/test/dist sync recursive":module=>{function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./node_modules/@storybook/test/dist sync recursive",module.exports=webpackEmptyContext},"./src/react-extension/components/Administration/DisplayContentTypesEncryptedMetadataAdministration/DisplayContentTypesEncryptedMetadataAdministration.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>DisplayContentTypesEncryptedMetadataAdministration_DisplayContentTypesEncryptedMetadataAdministration});var prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),react=__webpack_require__("./node_modules/react/index.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),memoize_one_esm=__webpack_require__("./node_modules/memoize-one/dist/memoize-one.esm.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),metadataTypesSettingsEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.js"),entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),resourceTypesCollection=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js"),metadata_metadataKeysCollection=__webpack_require__("./src/shared/models/entity/metadata/metadataKeysCollection.js");const formProperties=["default_resource_types","allow_creation_of_v5_resources","allow_creation_of_v4_resources","allow_v4_v5_upgrade","allow_v5_v4_downgrade"];class MetadataTypesSettingsFormEntity extends metadataTypesSettingsEntity.Ay{toFormDto(){return formProperties.reduce(((result,prop)=>(void 0!==this._props[prop]&&(result[prop]=this._props[prop]),result)),{})}verifyHealth(resourceTypes,metadataKeysCollection){let result=null;if(void 0===resourceTypes)return result;if(void 0===metadataKeysCollection)return result;if(!(resourceTypes instanceof resourceTypesCollection.A))throw new TypeError("The parameter 'resourceTypes' is not a valid 'ResourceTypesCollection' type.");if(!(metadataKeysCollection instanceof metadata_metadataKeysCollection.A))throw new TypeError("The parameter 'metadataKeysCollection' is not a valid 'MetadataKeysCollection' type.");const hasV4ResourceTypes=resourceTypes.hasSomeOfVersion(metadataTypesSettingsEntity.Sr),hasV5ResourceTypes=resourceTypes.hasSomeOfVersion(metadataTypesSettingsEntity.LP);this.allowCreationOfV4Resources&&!hasV4ResourceTypes&&(result=result||new entityValidationError.A,result.addError("allow_creation_of_v4_resources","resource_types_deleted","Resource types v4 are deleted.")),this.isDefaultResourceTypeV4&&!hasV4ResourceTypes&&(result=result||new entityValidationError.A,result.addError("default_resource_types","resource_types_v4_deleted","Resource types v4 are deleted.")),this.allowCreationOfV5Resources&&!hasV5ResourceTypes&&(result=result||new entityValidationError.A,result.addError("allow_creation_of_v5_resources","resource_types_deleted","Resource types v5 are deleted.")),this.isDefaultResourceTypeV5&&!hasV5ResourceTypes&&(result=result||new entityValidationError.A,result.addError("default_resource_types","resource_types_v5_deleted","Resource types v5 are deleted.")),this.allowV5V4Downgrade&&!hasV4ResourceTypes&&(result=result||new entityValidationError.A,result.addError("allow_v5_v4_downgrade","resource_types_deleted","Resource types v4 are deleted.")),this.allowV5V4Downgrade&&!this.allowCreationOfV4Resources&&(result=result||new entityValidationError.A,result.addError("allow_v5_v4_downgrade","allow_creation","Resource types v4 creation is not allowed.")),this.allowV4V5Upgrade&&!hasV5ResourceTypes&&(result=result||new entityValidationError.A,result.addError("allow_v4_v5_upgrade","resource_types_deleted","Resource types v5 are deleted.")),this.allowV4V5Upgrade&&!this.allowCreationOfV5Resources&&(result=result||new entityValidationError.A,result.addError("allow_v4_v5_upgrade","allow_creation","Resource types v5 creation is not allowed."));return 0===metadataKeysCollection.items.filter((metadataKey=>!metadataKey.expired)).length&&this.allowCreationOfV5Resources&&(result=result||new entityValidationError.A,result.addError("allow_creation_of_v5_resources","active_metadata_key","No active metadata key defined.")),result}}const metadataTypesSettingsFormEntity=MetadataTypesSettingsFormEntity;var metadataSettingsServiceWorkerService=__webpack_require__("./src/shared/services/serviceWorker/metadata/metadataSettingsServiceWorkerService.js");class DisplayContentTypesEncryptedMetadataAdministrationActions extends react.Component{render(){return react.createElement("div",{className:"actions-wrapper"},react.createElement("button",{type:"button",className:"button primary form",disabled:this.props.isProcessing,onClick:this.props.onSaveRequested},react.createElement("span",null,react.createElement(es.x6,null,"Save"))))}}DisplayContentTypesEncryptedMetadataAdministrationActions.propTypes={isProcessing:prop_types_default().bool,onSaveRequested:prop_types_default().func,t:prop_types_default().func};const DisplayContentTypesEncryptedMetadataAdministration_DisplayContentTypesEncryptedMetadataAdministrationActions=(0,es.CI)("common")(DisplayContentTypesEncryptedMetadataAdministrationActions);DisplayContentTypesEncryptedMetadataAdministrationActions.__docgenInfo={description:"",methods:[],displayName:"DisplayContentTypesEncryptedMetadataAdministrationActions",props:{isProcessing:{description:"",type:{name:"bool"},required:!1},onSaveRequested:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};var NotifyError=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),DialogContext=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),ActionFeedbackContext=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),ResourceTypesLocalStorageContext=__webpack_require__("./src/shared/context/ResourceTypesLocalStorageContext/ResourceTypesLocalStorageContext.js"),portals=__webpack_require__("./src/shared/utils/portals.js"),file_text=__webpack_require__("./src/img/svg/file_text.svg"),metadataKeysServiceWorkerService=__webpack_require__("./src/shared/services/serviceWorker/metadata/metadataKeysServiceWorkerService.js");class DisplayContentTypesEncryptedMetadataAdministration extends react.Component{originalSettings=null;formSettings=null;metadataKeys=void 0;constructor(props){super(props),this.metadataSettingsServiceWorkerService=props.metadataSettingsServiceWorkerService??new metadataSettingsServiceWorkerService.Ay(props.context.port),this.metadataKeysServiceWorkerService=props.metadataKeysServiceWorkerService??new metadataKeysServiceWorkerService.Ay(props.context.port),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{isProcessing:!0,hasAlreadyBeenValidated:!1,settings:{default_resource_types:"v4",allow_creation_of_v5_resources:!1,allow_creation_of_v4_resources:!1,allow_v4_v5_upgrade:!1,allow_v5_v4_downgrade:!1}}}bindCallbacks(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.save=this.save.bind(this)}async componentDidMount(){this.originalSettings=await this.metadataSettingsServiceWorkerService.findTypesSettings(),this.formSettings=new metadataTypesSettingsFormEntity(this.originalSettings.toDto(),{validate:!1}),this.metadataKeys=await this.metadataKeysServiceWorkerService.findAll();this.setState({settings:this.formSettings.toFormDto(),isProcessing:!1})}validateForm=(0,memoize_one_esm.A)((formSettingsDto=>this.formSettings?.validate()));verifyDataHealth=(0,memoize_one_esm.A)(((formSettingsDto,resourceTypes,metadataKeysCollection)=>this.formSettings?.verifyHealth(resourceTypes,metadataKeysCollection)));hasSettingsChanges=(0,memoize_one_esm.A)(((originalSettings,formSettings,formSettingsDto)=>this.originalSettings?.hasDiffProps(this.formSettings)));handleInputChange(event){if(this.hasAllInputDisabled())return;const{type,checked,value,name}=event.target,parsedValue="checkbox"===type?checked:value;this.setFormPropertyValue(name,parsedValue)}setFormPropertyValue(name,parsedValue){this.formSettings.set(name,parsedValue,{validate:!1}),this.setState({settings:this.formSettings.toFormDto()})}hasAllInputDisabled(){return this.state.isProcessing}handleFormSubmit(event){event.preventDefault(),this.save()}async save(){if(this.state.isProcessing)return;const validationError=this.validateForm(this.state.settings);if(validationError?.hasErrors()){const hasAlreadyBeenValidated=!0;this.setState({hasAlreadyBeenValidated})}else{this.setState({isProcessing:!0});try{this.originalSettings=await this.metadataSettingsServiceWorkerService.saveTypesSettings(this.formSettings),this.formSettings=new metadataTypesSettingsFormEntity(this.originalSettings.toDto()),await this.props.actionFeedbackContext.displaySuccess(this.props.t("The encrypted metadata settings were updated."))}catch(error){this.props.dialogContext.open(NotifyError.A,{error})}this.setState({hasAlreadyBeenValidated:!0,isProcessing:!1,settings:this.formSettings.toDto()})}}render(){const errors=this.state.hasAlreadyBeenValidated?this.validateForm(this.state.settings):null,warnings=this.verifyDataHealth(this.state.settings,this.props.resourceTypes,this.metadataKeys),hasSettingsChanges=this.hasSettingsChanges(this.originalSettings,this.formSettings,this.state.settings);return react.createElement("div",{className:"row"},react.createElement("div",{id:"content-types-encrypted-metadata-settings",className:"main-column"},react.createElement("div",{className:"main-content"},react.createElement("form",{onSubmit:this.handleFormSubmit,"data-testid":"submit-form"},react.createElement("h3",{className:"title"},react.createElement("label",null,react.createElement(es.x6,null,"Encrypted metadata"))),react.createElement("p",{className:"description"},react.createElement(es.x6,null,"Encrypted metadata for resources is available.")," ",react.createElement(es.x6,null,"Define the strategy to manage and migrate the legacy items.")),react.createElement("h4",null,react.createElement(es.x6,null,"Supported metadata types")),react.createElement("div",{className:`input toggle-switch form-element\n              ${errors?.hasError("allow_creation_of_v5_resources")?"error":""}\n              ${warnings?.hasError("allow_creation_of_v5_resources")?"warning":""}`},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"allow_creation_of_v5_resources",id:"allowCreationOfV5ResourcesInput",onChange:this.handleInputChange,checked:this.state.settings.allow_creation_of_v5_resources,disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"allowCreationOfV5ResourcesInput"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Enable encrypted metadata (recommended)")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Enable encrypted metadata for resources.")),errors?.hasError("allow_creation_of_v5_resources","is_default")&&react.createElement("div",{className:"name error-message"},react.createElement(es.x6,null,"Encrypted metadata must be enabled to set it as the default type.")),!errors?.hasError("allow_creation_of_v5_resources")&&react.createElement(react.Fragment,null,warnings?.hasError("allow_creation_of_v5_resources","resource_types_deleted")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"All encrypted metadata resource types were previously disabled. Re-enable them if you want users to create resources of this type.")),warnings?.hasError("allow_creation_of_v5_resources","active_metadata_key")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"A metadata key should be enabled to allow users to create resources of this type."))))),react.createElement("div",{className:`input toggle-switch form-element\n              ${errors?.hasError("allow_creation_of_v4_resources")?"error":""}\n              ${warnings?.hasError("allow_creation_of_v4_resources")?"warning":""}`},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"allow_creation_of_v4_resources",id:"allowCreationOfV4ResourcesInput",onChange:this.handleInputChange,checked:this.state.settings.allow_creation_of_v4_resources,disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"allowCreationOfV4ResourcesInput"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Enable legacy cleartext metadata")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Enable legacy cleartext metadata for resources.")),errors?.hasError("allow_creation_of_v4_resources","is_default")&&react.createElement("div",{className:"name error-message"},react.createElement(es.x6,null,"Legacy cleartext metadata must be enabled to set it as the default type.")),!errors?.hasError("allow_creation_of_v4_resources")&&warnings?.hasError("allow_creation_of_v4_resources","resource_types_deleted")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"All legacy cleartext resource types were previously disabled. Re-enable them if you want users to create resources of this type.")))),react.createElement("h4",null,react.createElement(es.x6,null,"Default metadata type")),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:`input radio\n                  ${"v5"===this.state.settings.default_resource_types?"checked":""}\n                  ${errors?.hasError("default_resource_types","allow_create_v5")?"error":""}\n                  ${!errors?.hasError("default_resource_types","allow_create_v5")&&warnings?.hasError("default_resource_types","resource_types_v5_deleted")?"warning":""}`},react.createElement("input",{type:"radio",value:"v5",onChange:this.handleInputChange,name:"default_resource_types",checked:"v5"===this.state.settings.default_resource_types,id:"defaultResourceTypesV5Input",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"defaultResourceTypesV5Input"},react.createElement("span",{className:"name bold"},react.createElement(es.x6,null,"Encrypted metadata (recommended)")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Users can create resources with encrypted metadata by default."),react.createElement("br",null)),errors?.hasError("default_resource_types","allow_create_v5")&&react.createElement("div",{className:"name error-message"},react.createElement(es.x6,null,"Encrypted metadata must be enabled to set it as the default type.")),!errors?.hasError("default_resource_types","allow_create_v5")&&warnings?.hasError("default_resource_types","resource_types_v5_deleted")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"All encrypted metadata resource types were previously disabled. Re-enable them if you want users to create resources of this type.")))),react.createElement("div",{className:`input radio ${"v4"===this.state.settings.default_resource_types?"checked":""}\n                  ${errors?.hasError("default_resource_types","allow_create_v4")?"error":""}\n                  ${!errors?.hasError("default_resource_types","allow_create_v4")&&warnings?.hasError("default_resource_types","resource_types_v4_deleted")?"warning":""}`},react.createElement("input",{type:"radio",value:"v4",onChange:this.handleInputChange,name:"default_resource_types",checked:"v4"===this.state.settings.default_resource_types,id:"defaultResourceTypesV4Input",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"defaultResourceTypesV4Input"},react.createElement("span",{className:"name bold"},react.createElement(es.x6,null,"Legacy cleartext metadata")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Users can create legacy resources with cleartext metadata by default.")),errors?.hasError("default_resource_types","allow_create_v4")&&react.createElement("div",{className:"name error-message"},react.createElement(es.x6,null,"Legacy cleartext metadata must be enabled to set it as the default type.")),!errors?.hasError("default_resource_types","allow_create_v4")&&warnings?.hasError("default_resource_types","resource_types_v4_deleted")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"All legacy cleartext resource types were previously disabled. Re-enable them if you want users to create resources of this type."))))),react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Self served migration")),react.createElement("div",{className:"input toggle-switch form-element"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"allow_v4_v5_upgrade",id:"allowV4V5UpgradeInput",onChange:this.handleInputChange,checked:this.state.settings.allow_v4_v5_upgrade,disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"allowV4V5UpgradeInput",className:"text"},react.createElement(es.x6,null,"Allow users to upgrade their content from cleartext to encrypted metadata type."),warnings?.hasError("allow_v4_v5_upgrade","resource_types_deleted")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"All encrypted metadata resource types were previously disabled. Re-enable them if you want users to upgrade their resources.")),warnings?.hasError("allow_v4_v5_upgrade","allow_creation")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"Encrypted metadata should be enabled to allow users to upgrade their resources.")))),react.createElement("div",{className:"input toggle-switch form-element"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"allow_v5_v4_downgrade",id:"allowV5V4DowngradeInput",onChange:this.handleInputChange,checked:this.state.settings.allow_v5_v4_downgrade,disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"allowV5V4DowngradeInput",className:"text"},react.createElement(es.x6,null,"Allow users to downgrade their content from encrypted to cleartext metadata type."),warnings?.hasError("allow_v5_v4_downgrade","resource_types_deleted")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"All legacy cleartext resource types were previously disabled. Re-enable them if you want users to downgrade their resources.")),warnings?.hasError("allow_v5_v4_downgrade","allow_creation")&&react.createElement("div",{className:"name warning-message"},react.createElement(es.x6,null,"Legacy cleartext metadata should be enabled to allow users to downgrade their resources.")))))),hasSettingsChanges&&react.createElement("div",{className:"warning message form-banner"},react.createElement("div",null,react.createElement("p",null,react.createElement(es.x6,null,"Don't forget to save your settings to apply your modification."))))),react.createElement(DisplayContentTypesEncryptedMetadataAdministration_DisplayContentTypesEncryptedMetadataAdministrationActions,{onSaveRequested:this.save,isProcessing:this.state.isProcessing}),(0,portals.m)(react.createElement("div",{className:"sidebar-help-section"},react.createElement("h3",null,react.createElement(es.x6,null,"Need help?")),react.createElement("p",null,react.createElement(es.x6,null,"For more information about the content type support and migration, checkout the dedicated page on the official website.")),react.createElement("a",{className:"button",target:"_blank",rel:"noopener noreferrer",href:"https://passbolt.com/docs"},react.createElement(file_text.A,null),react.createElement("span",null,react.createElement(es.x6,null,"Read the documentation")))),document.getElementById("administration-help-panel")))}}DisplayContentTypesEncryptedMetadataAdministration.propTypes={context:prop_types_default().object,actionFeedbackContext:prop_types_default().object,dialogContext:prop_types_default().object,createPortal:prop_types_default().func,metadataSettingsServiceWorkerService:prop_types_default().object,metadataKeysServiceWorkerService:prop_types_default().object,resourceTypes:prop_types_default().instanceOf(resourceTypesCollection.A),t:prop_types_default().func};const DisplayContentTypesEncryptedMetadataAdministration_DisplayContentTypesEncryptedMetadataAdministration=(0,AppContext.L)((0,ActionFeedbackContext.ot)((0,DialogContext.z9)((0,ResourceTypesLocalStorageContext.KH)((0,es.CI)("common")(DisplayContentTypesEncryptedMetadataAdministration)))));DisplayContentTypesEncryptedMetadataAdministration.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get default state\n@returns {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"handleInputChange",docblock:"Handle form input changes.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:[],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle form input changes."},{name:"setFormPropertyValue",docblock:"Set a form property value. Trigger the validation if the form has already been submitted once.\n@param name\n@param parsedValue",modifiers:[],params:[{name:"name",optional:!1},{name:"parsedValue",optional:!1}],returns:null,description:"Set a form property value. Trigger the validation if the form has already been submitted once."},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"handleFormSubmit",docblock:"Handle form submission that can be trigger when hitting `enter`\n@param {Event} event The html event triggering the form submit.",modifiers:[],params:[{name:"event",description:"The html event triggering the form submit.",type:{name:"Event"},optional:!1}],returns:null,description:"Handle form submission that can be trigger when hitting `enter`"},{name:"save",docblock:"Save the settings\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Save the settings"}],displayName:"DisplayContentTypesEncryptedMetadataAdministration",props:{context:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"object"},required:!1},createPortal:{description:"",type:{name:"func"},required:!1},metadataSettingsServiceWorkerService:{description:"",type:{name:"object"},required:!1},metadataKeysServiceWorkerService:{description:"",type:{name:"object"},required:!1},resourceTypes:{description:"",type:{name:"instanceOf",value:"ResourceTypesCollection"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-extension/contexts/ActionFeedbackContext.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function defaultActionFeedbackContext(data={}){const defaultContext={displaySuccess:jest.fn(),displayError:jest.fn(),remove:jest.fn()};return Object.assign(defaultContext,data)}__webpack_require__.d(__webpack_exports__,{M:()=>defaultActionFeedbackContext})},"./src/react-extension/contexts/AdministrationWorkspaceContext.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function defaultAdministrationWorkspaceContext(context={}){const defaultContext={must:{editSubscriptionKey:!1,refreshSubscriptionKey:!1},onResetActionsSettings:jest.fn(),setDisplayAdministrationWorkspaceAction:jest.fn(),resetDisplayAdministrationWorkspaceAction:jest.fn()};return Object.assign(defaultContext,context)}__webpack_require__.d(__webpack_exports__,{M:()=>defaultAdministrationWorkspaceContext})},"./src/react-extension/contexts/DialogContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>DialogContextProvider,z9:()=>withDialog});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),uuid__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const DialogContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({dialogs:[],open:()=>{},close:()=>{}});class DialogContextProvider extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState}get defaultState(){return{dialogs:[],open:(Dialog,DialogProps)=>{const dialogKey=(0,uuid__WEBPACK_IMPORTED_MODULE_1__.A)();return this.setState({dialogs:[...this.state.dialogs,{key:dialogKey,Dialog,DialogProps}]}),dialogKey},close:dialogKey=>this.setState({dialogs:this.state.dialogs.filter((dialog=>dialogKey!==dialog.key))}),closeAll:()=>this.setState({dialogs:[]})}}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(DialogContext.Provider,{value:this.state},this.props.children)}}function withDialog(WrappedComponent){return class WithDialog extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(DialogContext.Consumer,null,(dialogContext=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(WrappedComponent,{dialogContext,...this.props})))}}}DialogContextProvider.displayName="DialogContextProvider",DialogContextProvider.propTypes={children:prop_types__WEBPACK_IMPORTED_MODULE_2___default().any},DialogContextProvider.__docgenInfo={description:"The related context provider",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"}],displayName:"DialogContextProvider",props:{children:{description:"",type:{name:"any"},required:!1}}}},"./src/react-extension/contexts/DialogContext.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function defaultDialogContext(context={}){const defaultContext={dialogs:[],open:jest.fn(),close:jest.fn(),closeAll:jest.fn()};return Object.assign(defaultContext,context)}__webpack_require__.d(__webpack_exports__,{L:()=>defaultDialogContext})},"./src/shared/context/ResourceTypesLocalStorageContext/ResourceTypesLocalStorageContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,KH:()=>withResourceTypesLocalStorage,dA:()=>ResourceTypesLocalStorageContext});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_models_entity_resourceType_resourceTypesCollection__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js");const ResourceTypesLocalStorageContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({get:()=>{},resourceTypes:null,updateLocalStorage:()=>{}});class ResourceTypesLocalStorageContextProvider extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.runningLocalStorageUpdatePromise=null,this.initEventHandlers()}get defaultState(){return{get:this.get.bind(this),resourceTypes:null,updateLocalStorage:this.updateLocalStorage.bind(this)}}initEventHandlers(){this.handleStorageChange=this.handleStorageChange.bind(this)}componentDidMount(){this.props.context.storage.onChanged.addListener(this.handleStorageChange)}componentWillUnmount(){this.props.context.storage.onChanged.removeListener(this.handleStorageChange)}handleStorageChange(changes){changes.resourceTypes&&this.set(changes.resourceTypes.newValue)}set(resourceTypes){const resourceTypesCollection=new _models_entity_resourceType_resourceTypesCollection__WEBPACK_IMPORTED_MODULE_2__.A(resourceTypes);this.setState({resourceTypes:resourceTypesCollection})}get(){return null===this.state.resourceTypes?(this.loadLocalStorage(),null):this.state.resourceTypes}async loadLocalStorage(){const storageData=await this.props.context.storage.local.get(["resourceTypes"]);storageData.resourceTypes?this.set(storageData.resourceTypes):this.updateLocalStorage()}async updateLocalStorage(){null===this.runningLocalStorageUpdatePromise?(this.runningLocalStorageUpdatePromise=this.props.context.port.request("passbolt.resource-type.get-or-find-all"),await this.runningLocalStorageUpdatePromise,this.runningLocalStorageUpdatePromise=null):await this.runningLocalStorageUpdatePromise}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(ResourceTypesLocalStorageContext.Provider,{value:this.state},this.props.children)}}ResourceTypesLocalStorageContextProvider.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_3___default().any,children:prop_types__WEBPACK_IMPORTED_MODULE_3___default().any};const __WEBPACK_DEFAULT_EXPORT__=(0,_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)(ResourceTypesLocalStorageContextProvider);function withResourceTypesLocalStorage(WrappedComponent){return class withResourceTypesLocalStorage extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(ResourceTypesLocalStorageContext.Consumer,null,(resourceTypesLocalStorageContext=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(WrappedComponent,{resourceTypesLocalStorageContext,resourceTypes:resourceTypesLocalStorageContext.get(),...this.props})))}}}ResourceTypesLocalStorageContextProvider.__docgenInfo={description:"The resource types local storage context provider",methods:[{name:"defaultState",docblock:"Returns the default component state\n@returns {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Returns the default component state"},{name:"initEventHandlers",docblock:"Initialize the component event handlers",modifiers:[],params:[],returns:null,description:"Initialize the component event handlers"},{name:"handleStorageChange",docblock:"Handles update of the resource types in the local storage.",modifiers:[],params:[{name:"changes",optional:!1}],returns:null,description:"Handles update of the resource types in the local storage."},{name:"set",docblock:"Set resourceTypes.\n@param {Array<Object>} resourceTypes The resource types to set.\n@private",modifiers:[],params:[{name:"resourceTypes",description:"The resource types to set.",type:{name:"Array",elements:[{name:"Object"}]},optional:!1}],returns:null,description:"Set resourceTypes."},{name:"get",docblock:"Get the resource types from the local storage and/or init them if not the case already.\n@returns {ResourceTypesCollection|null}",modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"ResourceTypesCollection"}]}},description:"Get the resource types from the local storage and/or init them if not the case already."},{name:"loadLocalStorage",docblock:"Load the resource types from the local storage if it is available.\nIf the local storage is not yet initialised, then it asks for its initialisation.\n@returns {Promise<void>}\n@private",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Load the resource types from the local storage if it is available.\nIf the local storage is not yet initialised, then it asks for its initialisation."},{name:"updateLocalStorage",docblock:"Forces the update of the resource types in the local storage.\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Forces the update of the resource types in the local storage."}],displayName:"ResourceTypesLocalStorageContextProvider",props:{context:{description:"",type:{name:"any"},required:!1},children:{description:"",type:{name:"any"},required:!1}}}},"./src/shared/models/entity/metadata/metadataKeysCollection.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{hm:()=>defaultMetadataKeysDtos});var _metadataKeyEntity_test_data__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/metadata/metadataKeyEntity.test.data.js");__webpack_require__("./src/shared/models/entity/metadata/metadataPrivateKeyEntity.test.data.js");const defaultMetadataKeysDtos=(count=2,data={},options={})=>{const dtos=[];for(let i=0;i<count;i+=2){const dto1=(0,_metadataKeyEntity_test_data__WEBPACK_IMPORTED_MODULE_0__.L)({fingerprint:generateFingerprint(i),...data},options),dto2=(0,_metadataKeyEntity_test_data__WEBPACK_IMPORTED_MODULE_0__.L)({fingerprint:generateFingerprint(i+1),...data},options);dtos.push(dto1,dto2)}return dtos};function generateFingerprint(index){return index.toString().padStart(40,"0")}},"./src/shared/models/entity/metadata/metadataTypesSettingsEntity.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{_5:()=>defaultMetadataTypesSettingsV6Dto,uc:()=>defaultMetadataTypesSettingsV4Dto});const defaultMetadataTypesSettingsV4Dto=(data={})=>Object.assign({default_resource_types:"v4",default_folder_type:"v4",default_tag_type:"v4",default_comment_type:"v4",allow_creation_of_v5_resources:!1,allow_creation_of_v5_folders:!1,allow_creation_of_v5_tags:!1,allow_creation_of_v5_comments:!1,allow_creation_of_v4_resources:!0,allow_creation_of_v4_folders:!0,allow_creation_of_v4_tags:!0,allow_creation_of_v4_comments:!0,allow_v4_v5_upgrade:!1,allow_v5_v4_downgrade:!1},data),defaultMetadataTypesSettingsV6Dto=(data={})=>Object.assign({default_resource_types:"v5",default_folder_type:"v5",default_tag_type:"v5",default_comment_type:"v5",allow_creation_of_v5_resources:!0,allow_creation_of_v5_folders:!0,allow_creation_of_v5_tags:!0,allow_creation_of_v5_comments:!0,allow_creation_of_v4_resources:!1,allow_creation_of_v4_folders:!1,allow_creation_of_v4_tags:!1,allow_creation_of_v4_comments:!1,allow_v4_v5_upgrade:!1,allow_v5_v4_downgrade:!1},data)}}]);