/*! For license information please see react-extension-components-Resource-ExportResources-ExportResources-test-stories.3b55f457.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[9635],{"./src/react-extension/components/Resource/ExportResources/ExportResources.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Initial:()=>Initial,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _ExportResources__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/react-extension/components/Resource/ExportResources/ExportResources.js"),_ExportResources_test_data__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/react-extension/components/Resource/ExportResources/ExportResources.test.data.js");const __WEBPACK_DEFAULT_EXPORT__={title:"Components/Resource/ExportResources/ExportResources",component:_ExportResources__WEBPACK_IMPORTED_MODULE_0__.A},Initial={args:{resourceWorkspaceContext:{resourcesToExport:{foldersIds:[1,2]},onResourcesToExport:()=>{}},onClose:()=>{},context:(0,_ExportResources_test_data__WEBPACK_IMPORTED_MODULE_1__.st)()}},__namedExportsOrder=["Initial"];Initial.parameters={...Initial.parameters,docs:{...Initial.parameters?.docs,source:{originalSource:"{\n  args: {\n    resourceWorkspaceContext: {\n      resourcesToExport: {\n        foldersIds: [1, 2]\n      },\n      onResourcesToExport: () => {}\n    },\n    onClose: () => {},\n    context: defaultAppContext()\n  }\n}",...Initial.parameters?.docs?.source}}}},"./src/react-extension/components/Resource/ExportResources/ExportResources.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_12__),_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/react-extension/contexts/ResourceWorkspaceContext.js"),_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/components/Common/Dialog/DialogWrapper/DialogWrapper.js"),_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormSubmitButton.js"),_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormCancelButton.js"),_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),_ExportResourcesCredentials__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/react-extension/components/Resource/ExportResources/ExportResourcesCredentials.js"),react_i18next__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_Common_Select_Select__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/react-extension/components/Common/Select/Select.js");class ExportResources extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindHandlers()}get defaultState(){return{selectedExportFormat:this.exportFormats[0].value,actions:{processing:!1}}}bindHandlers(){this.handleExport=this.handleExport.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleClose=this.handleClose.bind(this),this.handleExportFormatSelected=this.handleExportFormatSelected.bind(this)}componentDidMount(){this.findContentToExport()}findContentToExport(){const foldersIds=this.findFoldersIdsToExport(),resourcesIds=this.findResourcesIdsToExport(foldersIds);this.props.resourceWorkspaceContext.onResourcesToExport({resourcesIds,foldersIds})}get isProcessing(){return this.state.actions.processing}get areActionsAllowed(){return!this.isProcessing}get hasFoldersToExport(){const foldersIds=this.props.resourceWorkspaceContext.resourcesToExport.foldersIds;return foldersIds&&foldersIds.length>0}get hasResourcesToExport(){const resourcesIds=this.props.resourceWorkspaceContext.resourcesToExport.resourcesIds;return resourcesIds&&resourcesIds.length>0}findFoldersIdsToExport(){if(!this.hasFoldersToExport)return[];const foldersIds=this.props.resourceWorkspaceContext.resourcesToExport.foldersIds,childrenFoldersIds=foldersIds.map((folderId=>this.getChildrenFoldersIds(folderId))).flat();return[...foldersIds,...childrenFoldersIds]}getChildrenFoldersIds(folderId){const childrenFoldersIds=this.props.context.folders.filter((folder=>folder.folder_parent_id===folderId)).map((folder=>folder.id));if(0!==childrenFoldersIds.length){const grandChildrenFolders=childrenFoldersIds.map((childFolderId=>this.getChildrenFoldersIds(childFolderId)));return[...childrenFoldersIds,...grandChildrenFolders.flat()]}return[]}findResourcesIdsToExport(foldersIds){const resourcesIdsOfFoldersIds=this.getResourcesIdsOfFoldersToExport(foldersIds),resourcesIdsToExport=this.props.resourceWorkspaceContext.resourcesToExport.resourcesIds||[];return Array.from(new Set([...resourcesIdsToExport,...resourcesIdsOfFoldersIds]))}getResourcesIdsOfFoldersToExport(foldersIds){return this.props.context.resources.filter((resource=>foldersIds.some((folderId=>folderId===resource.folder_parent_id)))).map((resource=>resource.id))}get exportFormats(){return[{label:"kdbx (keepass)",value:"kdbx"},{label:"kdbx (keepassXC & others)",value:"kdbx-others"},{label:"csv (keepass)",value:"csv-kdbx"},{label:"csv (lastpass)",value:"csv-lastpass"},{label:"csv (1password)",value:"csv-1password"},{label:"csv (chromium based browsers)",value:"csv-chromium"},{label:"csv (bitwarden)",value:"csv-bitwarden"},{label:"csv (mozilla)",value:"csv-mozilla"},{label:"csv (safari)",value:"csv-safari"},{label:"csv (dashlane)",value:"csv-dashlane"},{label:"csv (nordpass)",value:"csv-nordpass"},{label:"csv (logmeonce)",value:"csv-logmeonce"}]}handleExportFormatSelected(event){this.selectFormat(event.target.value)}async handleExport(event){event.preventDefault();this.state.selectedExportFormat.startsWith("csv")?(await this.setState({actions:{processing:!0}}),this.export().then(this.onExportSuccess.bind(this)).catch(this.onExportFailure.bind(this))):(await this.props.dialogContext.open(_ExportResourcesCredentials__WEBPACK_IMPORTED_MODULE_9__.A,{format:this.state.selectedExportFormat}),this.close())}async handleCancel(){await this.props.resourceWorkspaceContext.onResourcesToExport({resourcesIds:null,foldersIds:null}),this.close()}async handleClose(){await this.props.resourceWorkspaceContext.onResourcesToExport({resourcesIds:null,foldersIds:null}),this.close()}selectFormat(selectedExportFormat){this.setState({selectedExportFormat})}async export(){const foldersIds=this.props.resourceWorkspaceContext.resourcesToExport.foldersIds,resourcesIds=this.props.resourceWorkspaceContext.resourcesToExport.resourcesIds,exportDto={format:this.state.selectedExportFormat,folders_ids:foldersIds,resources_ids:resourcesIds};await this.props.context.port.request("passbolt.export-resources.export-to-file",exportDto)}async onExportSuccess(){await this.setState({actions:{processing:!1}}),await this.props.actionFeedbackContext.displaySuccess(this.translate("The passwords have been exported successfully")),await this.props.resourceWorkspaceContext.onResourcesToExport({resourcesIds:null,foldersIds:null}),this.close()}onExportFailure(error){if("UserAbortsOperationError"===error.name)return void this.setState({actions:{processing:!1}});const errorDialogProps={error};this.setState({actions:{processing:!1}}),this.props.dialogContext.open(_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_7__.A,errorDialogProps)}close(){this.props.onClose()}get translate(){return this.props.t}render(){const foldersIdsToExport=this.hasFoldersToExport&&this.props.resourceWorkspaceContext.resourcesToExport.foldersIds,resourcesIdsToExport=this.hasResourcesToExport&&this.props.resourceWorkspaceContext.resourcesToExport.resourcesIds;return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_4__.A,{title:this.translate("Export passwords"),onClose:this.handleClose,disabled:!this.areActionsAllowed},react__WEBPACK_IMPORTED_MODULE_0__.createElement("form",{onSubmit:this.handleExport,noValidate:!0},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-content"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"select-wrapper input required "+(this.areActionsAllowed?"":"disabled")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"export-format"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_10__.x6,null,"Choose the export format (csv and kdbx are supported)")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Select_Select__WEBPACK_IMPORTED_MODULE_11__.A,{id:"export-format",value:this.state.selectedExportFormat,items:this.exportFormats,onChange:this.handleExportFormatSelected,disabled:!this.areActionsAllowed})),this.hasFoldersToExport&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("em",null,this.translate("{{count}} folder is going to be exported.",{count:foldersIdsToExport.length}))),this.hasResourcesToExport&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("em",null,this.translate("{{count}} password is going to be exported.",{count:resourcesIdsToExport.length})))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"submit-wrapper clearfix"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_6__.A,{disabled:!this.areActionsAllowed,processing:this.isProcessing,onClick:this.handleCancel}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_5__.A,{disabled:!this.areActionsAllowed,processing:this.isProcessing,value:this.translate("Export")}))))}}ExportResources.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,onClose:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func,resourceWorkspaceContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,dialogContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().object,t:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_3__.L)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_8__.ot)((0,_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_2__.z9)((0,_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_1__.Qw)((0,react_i18next__WEBPACK_IMPORTED_MODULE_10__.CI)("common")(ExportResources)))));ExportResources.__docgenInfo={description:"This component allows to export resources to a specified format",methods:[{name:"defaultState",docblock:"Returns the component default state",modifiers:["get"],params:[],returns:null,description:"Returns the component default state"},{name:"bindHandlers",docblock:"Bind the component handlers",modifiers:[],params:[],returns:null,description:"Bind the component handlers"},{name:"findContentToExport",docblock:"Find the content to export and update the context.",modifiers:[],params:[],returns:null,description:"Find the content to export and update the context."},{name:"isProcessing",docblock:"Return trus if the export is processing",modifiers:["get"],params:[],returns:null,description:"Return trus if the export is processing"},{name:"areActionsAllowed",docblock:"Returns true if actions can be performed",modifiers:["get"],params:[],returns:null,description:"Returns true if actions can be performed"},{name:"hasFoldersToExport",docblock:"Returns true if some folders must be exported",modifiers:["get"],params:[],returns:null,description:"Returns true if some folders must be exported"},{name:"hasResourcesToExport",docblock:"Returns true if some resources must be exported",modifiers:["get"],params:[],returns:null,description:"Returns true if some resources must be exported"},{name:"findFoldersIdsToExport",docblock:"Returns the folders identifiers to export",modifiers:[],params:[],returns:null,description:"Returns the folders identifiers to export"},{name:"getChildrenFoldersIds",docblock:"Returns the children folders ids of the given folder\n@param folderId A folder identifier",modifiers:[],params:[{name:"folderId",description:"A folder identifier",optional:!1}],returns:null,description:"Returns the children folders ids of the given folder"},{name:"findResourcesIdsToExport",docblock:"Returns the resources identifiers to export\n@param {array} foldersIds The list of folders to crawl for resources",modifiers:[],params:[{name:"foldersIds",description:"The list of folders to crawl for resources",type:{name:"array"},optional:!1}],returns:null,description:"Returns the resources identifiers to export"},{name:"getResourcesIdsOfFoldersToExport",docblock:"Returns the resources ids of the folders to export\n@param foldersIds The folders to look into",modifiers:[],params:[{name:"foldersIds",description:"The folders to look into",optional:!1}],returns:null,description:"Returns the resources ids of the folders to export"},{name:"exportFormats",docblock:"Returns the list of available export formats",modifiers:["get"],params:[],returns:null,description:"Returns the list of available export formats"},{name:"handleExportFormatSelected",docblock:"Whenever the user selects an export format\n@param event Select DOM event",modifiers:[],params:[{name:"event",description:"Select DOM event",optional:!1}],returns:null,description:"Whenever the user selects an export format"},{name:"handleExport",docblock:"Whenever the export is submitted\n@param event A dom event",modifiers:["async"],params:[{name:"event",description:"A dom event",optional:!1}],returns:null,description:"Whenever the export is submitted"},{name:"handleCancel",docblock:"Whenever the export is cancelled",modifiers:["async"],params:[],returns:null,description:"Whenever the export is cancelled"},{name:"handleClose",docblock:"Whenever the dialog is closed",modifiers:["async"],params:[],returns:null,description:"Whenever the dialog is closed"},{name:"selectFormat",docblock:"Select the export format\n@param selectedExportFormat The selected export format",modifiers:[],params:[{name:"selectedExportFormat",description:"The selected export format",optional:!1}],returns:null,description:"Select the export format"},{name:"export",docblock:"Export the selected resources or folders",modifiers:["async"],params:[],returns:null,description:"Export the selected resources or folders"},{name:"onExportSuccess",docblock:"Whenever the export has been performed successfully",modifiers:["async"],params:[],returns:null,description:"Whenever the export has been performed successfully"},{name:"onExportFailure",docblock:"Whenever the export has been performed with failure",modifiers:[],params:[{name:"error",optional:!1}],returns:null,description:"Whenever the export has been performed with failure"},{name:"close",docblock:"Close the dialog",modifiers:[],params:[],returns:null,description:"Close the dialog"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"ExportResources",props:{context:{description:"",type:{name:"any"},required:!1},onClose:{description:"",type:{name:"func"},required:!1},resourceWorkspaceContext:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}}}]);