/*! For license information please see react-quickaccess-components-ResourceAutoSave-SaveResource-test-stories.f15730a9.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[691],{"./src/img/svg/logo.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _title,_desc,_path,_path2,_path3,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SvgLogo(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",width:151,height:27,fill:"none","aria-labelledby":"logo-title logo-description",viewBox:"0 0 151 27"},props),_title||(_title=react__WEBPACK_IMPORTED_MODULE_0__.createElement("title",{id:"logo-title"},"Passbolt logo")),_desc||(_desc=react__WEBPACK_IMPORTED_MODULE_0__.createElement("desc",{id:"logo-description"},"This is the logo of passbolt.")),_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"var(--icon-color)",d:"M4.648 9.234v8.607h2.48c1.646 0 2.786-.349 3.47-1.012.685-.664 1.013-1.823 1.013-3.395 0-1.52-.305-2.595-.938-3.218-.633-.673-1.695-.972-3.24-.972zM.597 5.963h7.797c2.357 0 4.178.676 5.496 2.048q1.976 2.058 1.974 5.689a8.6 8.6 0 0 1-.406 2.749 7.1 7.1 0 0 1-1.24 2.278 5.9 5.9 0 0 1-2.38 1.773c-.937.349-2.152.524-3.697.524H4.648V26.5H.597zM24.016 18.016h5.064v-3.119h-4.76c-.937 0-1.594.124-1.95.375-.357.25-.517.698-.517 1.321 0 .524.15.899.429 1.122.28.223.848.301 1.734.301M18.649 5.963h8.268c2.103 0 3.672.476 4.736 1.423 1.065.947 1.594 2.347 1.594 4.217v9.456H22.37c-1.52 0-2.708-.375-3.52-1.121-.81-.747-1.2-1.823-1.2-3.22 0-1.722.454-2.945 1.392-3.692s2.483-1.134 4.697-1.134h5.315v-.365c0-.898-.276-1.518-.809-1.896-.532-.377-1.47-.55-2.86-.55H18.65zM36.55 17.915h8.525c.76 0 1.318-.124 1.646-.35.183-.122.328-.29.423-.486.094-.197.134-.414.115-.63a1.2 1.2 0 0 0-.112-.632 1.24 1.24 0 0 0-.42-.492c-.355-.253-.91-.374-1.646-.374h-3.494c-2.067 0-3.467-.325-4.203-.947-.737-.623-1.088-1.747-1.088-3.32 0-1.62.431-2.82 1.318-3.592.886-.772 2.255-1.152 4.064-1.152h8.684v3.142h-7.134q-1.75 0-2.279.301c-.354.198-.532.547-.532 1.071-.017.193.016.387.096.564s.204.332.361.449c.302.223.809.324 1.468.324h3.676c1.672 0 2.961.397 3.824 1.172s1.315 1.871 1.315 3.32c0 1.397-.405 2.53-1.188 3.417-.37.427-.833.768-1.354.996-.522.23-1.09.34-1.661.325H36.549zM53.822 17.915h8.526c.76 0 1.318-.124 1.646-.35a1.23 1.23 0 0 0 .42-.487c.093-.196.132-.413.112-.629a1.2 1.2 0 0 0-.111-.632 1.24 1.24 0 0 0-.421-.492c-.354-.253-.91-.374-1.646-.374h-3.493c-2.067 0-3.467-.325-4.204-.947-.736-.623-1.088-1.752-1.088-3.324 0-1.62.432-2.82 1.318-3.593.886-.772 2.253-1.147 4.075-1.147h8.686v3.142h-7.141q-1.747 0-2.28.301c-.353.198-.531.547-.531 1.071-.017.193.016.387.096.564s.204.332.361.449c.302.223.809.324 1.468.324h3.671c1.672 0 2.963.397 3.824 1.172s1.315 1.871 1.315 3.32c0 1.397-.403 2.53-1.188 3.417-.37.427-.832.767-1.354.996a3.9 3.9 0 0 1-1.66.325H53.769v-3.106zM75.387.5v5.463h3.47c1.55 0 2.759.175 3.694.55.946.362 1.77.976 2.38 1.772a7.2 7.2 0 0 1 1.243 2.296c.281.888.417 1.814.403 2.744q0 3.63-1.974 5.689c-1.315 1.372-3.14 2.046-5.493 2.046h-7.8V.5zm2.462 8.734h-2.483v8.608h2.785c1.55 0 2.633-.324 3.243-.95s.935-1.721.935-3.268-.354-2.694-1.033-3.367c-.68-.673-1.832-1.023-3.447-1.023M92.3 13.525c0 1.445.328 2.532 1.013 3.367s1.62 1.198 2.86 1.198 2.152-.398 2.863-1.198 1.033-1.921 1.033-3.367-.356-2.547-1.033-3.344c-.677-.798-1.62-1.198-2.863-1.198a3.64 3.64 0 0 0-1.57.279 3.6 3.6 0 0 0-1.29.919c-.685.797-1.013 1.921-1.013 3.344m12.002 0q0 3.544-2.202 5.689c-1.47 1.397-3.42 2.121-5.901 2.121s-4.457-.699-5.924-2.121-2.202-3.292-2.202-5.664q0-3.558 2.202-5.69c1.467-1.424 3.444-2.145 5.919-2.145s4.431.724 5.901 2.144 2.207 3.294 2.207 5.666M110.935 21.06h-4.202V.5h4.202zM112.884 5.963h2.86V.5h4.052v5.463h4.278v3.02h-4.278v6.09c0 1.12.204 1.895.581 2.343.377.449 1.064.649 2.026.649h1.671v3.02h-3.72c-1.494 0-2.636-.4-3.444-1.223-.809-.823-1.189-1.995-1.189-3.519v-7.36h-2.863v-3.02z"})),_path2||(_path2=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"#D40101",d:"m149.951 10.68-9.059-8.36a2.12 2.12 0 0 0-1.421-.543c-.526 0-1.033.194-1.421.544l-5.684 5.268c.745.271 1.414.71 1.952 1.282.539.572.933 1.26 1.149 2.01h7.673a.73.73 0 0 1 .504.204.69.69 0 0 1 .207.494v1.147a.68.68 0 0 1-.207.494.72.72 0 0 1-.504.204h-.886v1.623a.68.68 0 0 1-.205.494.72.72 0 0 1-.503.205h-1.945a.73.73 0 0 1-.503-.205.69.69 0 0 1-.205-.494v-1.623h-3.426a4.84 4.84 0 0 1-1.135 2.033 5 5 0 0 1-1.966 1.287l5.71 5.276c.388.349.895.543 1.421.543a2.12 2.12 0 0 0 1.421-.543l9.043-8.355a2.03 2.03 0 0 0-.01-2.985"})),_path3||(_path3=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"#D40101",d:"M130.683 9.867a2.6 2.6 0 0 0-1.064.253c-.371.18-.686.455-.913.794a2.242 2.242 0 0 0-.113 2.305 2.3 2.3 0 0 0 .831.877 2.36 2.36 0 0 0 2.355.059c.362-.197.664-.484.875-.833a2.24 2.24 0 0 0 .324-1.153 2.21 2.21 0 0 0-.653-1.625 2.3 2.3 0 0 0-.751-.5 2.3 2.3 0 0 0-.891-.177"})))}},"./src/img/svg/power.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _path,react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const __WEBPACK_DEFAULT_EXPORT__=function SvgPower(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18"},props),_path||(_path=react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{stroke:"var(--icon-color)",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 1.5V9M13.8 4.95a6.75 6.75 0 1 1-9.578.03"})))}},"./src/react-quickaccess/components/Header/Header.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),react_i18next__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_img_svg_logo_svg__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/img/svg/logo.svg"),_img_svg_power_svg__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/img/svg/power.svg");class Header extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.initEventHandlers()}initEventHandlers(){this.handleLogoutClick=this.handleLogoutClick.bind(this)}get translate(){return this.props.t}async handleLogoutClick(){this.props.context.port.request("passbolt.auth.logout",!1),this.props.logoutSuccessCallback()}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"quickaccess-header"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"logo-svg"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{href:this.props.context.userSettings?this.props.context.userSettings.getTrustedDomain():"#",target:"_blank",rel:"noopener noreferrer",title:this.translate("open passbolt in a new tab")},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_logo_svg__WEBPACK_IMPORTED_MODULE_4__.A,{role:"img",width:"10rem",height:"1.8rem"}))),this.props.context.isAuthenticated&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{role:"button",className:"option-link button button-transparent",onClick:this.handleLogoutClick,title:this.translate("sign out")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"visually-hidden"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_2__.x6,null,"sign out")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_power_svg__WEBPACK_IMPORTED_MODULE_5__.A,null))))}}Header.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_1___default().any,logoutSuccessCallback:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,t:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_3__.L)((0,react_i18next__WEBPACK_IMPORTED_MODULE_2__.CI)("common")(Header));Header.__docgenInfo={description:"",methods:[{name:"initEventHandlers",docblock:null,modifiers:[],params:[],returns:null},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"},{name:"handleLogoutClick",docblock:null,modifiers:["async"],params:[],returns:null}],displayName:"Header",props:{context:{description:"",type:{name:"any"},required:!1},logoutSuccessCallback:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-quickaccess/components/ResourceAutoSave/SaveResource.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Initial:()=>Initial,SaveResourceFromTab:()=>SaveResourceFromTab,__namedExportsOrder:()=>__namedExportsOrder,default:()=>SaveResource_test_stories});var react=__webpack_require__("./node_modules/react/index.js"),react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),spinner=__webpack_require__("./src/img/svg/spinner.svg"),Password=__webpack_require__("./src/shared/components/Password/Password.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),PasswordPoliciesContext=__webpack_require__("./src/shared/context/PasswordPoliciesContext/PasswordPoliciesContext.js"),PasswordExpirySettingsContext=__webpack_require__("./src/react-extension/contexts/PasswordExpirySettingsContext.js"),entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),ResourceViewModel=__webpack_require__("./src/shared/models/resource/ResourceViewModel.js"),ResourceTypesLocalStorageContext=__webpack_require__("./src/shared/context/ResourceTypesLocalStorageContext/ResourceTypesLocalStorageContext.js"),resourceTypesCollection=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.js"),MetadataTypesSettingsLocalStorageContext=__webpack_require__("./src/shared/context/MetadataTypesSettingsLocalStorageContext/MetadataTypesSettingsLocalStorageContext.js"),metadataTypesSettingsEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.js"),ResourceViewModelFactory=__webpack_require__("./src/shared/models/resource/ResourceViewModelFactory.js"),resourceTypeSchemasDefinition=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypeSchemasDefinition.js");class SaveResource extends react.Component{constructor(props){super(props),this.state=this.defaultState,this.initEventHandlers()}get defaultState(){return{resourceViewModel:null,errors:null,unexpectedErrorMessage:"",hasAlreadyBeenValidated:!1,loaded:!1}}async componentDidMount(){await this.props.passwordExpiryContext.findSettings(),this.loadPasswordMetaFromTabForm(),await this.props.passwordPoliciesContext.findPolicies()}initEventHandlers(){this.handleClose=this.handleClose.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this)}async loadPasswordMetaFromTabForm(){const resourceDto=await this.props.context.port.request("passbolt.quickaccess.prepare-autosave");let resourceType;resourceDto.uri=resourceDto.uris&&resourceDto.uris.length>0?resourceDto.uris[0]:"",resourceDto.password=resourceDto.secret_clear,this.props.metadataTypeSettings.isDefaultResourceTypeV5?resourceType=this.props.resourceTypes.getFirstBySlug(resourceTypeSchemasDefinition.gG):this.props.metadataTypeSettings.isDefaultResourceTypeV4&&(resourceType=this.props.resourceTypes.getFirstBySlug(resourceTypeSchemasDefinition.Bo)),resourceDto.resource_type_id=resourceType.id;const resourceViewModel=ResourceViewModelFactory.A.createFromResourceTypeAndResourceViewModelDto(resourceType,resourceDto);this.setState({loaded:!0,resourceViewModel})}handleClose(){window.close()}validate(resourceViewModel){const errors=resourceViewModel.validate(ResourceViewModel.A.CREATE_MODE);return this.setState({errors}),errors}async handleFormSubmit(event){event.preventDefault(),this.setState({processing:!0,hasAlreadyBeenValidated:!0});const expired=this.props.passwordExpiryContext.getDefaultExpirationDate(),resourceViewModel=this.state.resourceViewModel.cloneWithMutation("expired",expired);if(this.validate(resourceViewModel).hasErrors())return void this.setState({processing:!1});const resourceDto=resourceViewModel.toResourceDto(),secretDto=resourceViewModel.toSecretDto();try{await this.props.context.port.request("passbolt.resources.create",resourceDto,secretDto),this.handleClose()}catch(error){this.handleSubmitError(error)}}handleSubmitError(error){const newState={processing:!1};"PassboltApiFetchError"===error.name&&400===error.data.code&&(error.data.body?.name||error.data.body?.username||error.data.body?.uri)?newState.errors=this.formatApiErrors(error.data.body):newState.unexpectedErrorMessage=error.message,this.setState(newState)}formatApiErrors(errorBody){const errors=new entityValidationError.A,fieldsInError=Object.keys(errorBody);for(let i=0;i<fieldsInError.length;i++){const prop=fieldsInError[i],errorMessages=errorBody[prop].join(", ");errors.addError(prop,"api-validation",errorMessages)}return errors}handleInputChange(event){const{name,value}=event.target,newState={resourceViewModel:this.state.resourceViewModel.cloneWithMutation(name,value)};this.state.hasAlreadyBeenValidated&&(newState.errors=newState.resourceViewModel.validate(ResourceViewModel.A.CREATE_MODE)),this.setState(newState)}get translate(){return this.props.t}render(){return react.createElement("div",{className:"resource-auto-save"},react.createElement("h1",{className:"title"},react.createElement(es.x6,null,"Would you like to save this credential ?")),react.createElement("form",{onSubmit:this.handleFormSubmit},react.createElement("div",{className:"resource-auto-save-form"},react.createElement("div",{className:"form-container"},react.createElement("div",{className:"input text required "+(this.state.errors?.hasError("name")?"error":"")},react.createElement("label",{htmlFor:"name"},react.createElement(es.x6,null,"Name")),react.createElement("input",{name:"name",value:this.state.resourceViewModel?.name||"",onChange:this.handleInputChange,disabled:this.state.processing,className:"required fluid",maxLength:"255",type:"text",id:"name",autoComplete:"off"}),this.state.errors?.hasError("name","required")&&react.createElement("div",{className:"error-message"},react.createElement(es.x6,null,"A name is required.")),this.state.errors?.hasError("name","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("name","api-validation"))),react.createElement("div",{className:"input text "+(this.state.errors?.hasError("uri")?"error":"")},react.createElement("label",{htmlFor:"uri"},react.createElement(es.x6,null,"URL")),react.createElement("input",{name:"uri",value:this.state.resourceViewModel?.uri||"",onChange:this.handleInputChange,disabled:this.state.processing,className:"fluid",maxLength:"1024",type:"text",id:"uri",autoComplete:"off"}),this.state.errors?.hasError("uri","maxLength")&&react.createElement("div",{className:"error-message"},react.createElement(es.x6,null,"The URI cannot exceed 1024 characters.")),this.state.errors?.hasError("uri","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("uri","api-validation"))),react.createElement("div",{className:"input text "+(this.state.errors?.hasError("username")?"error":"")},react.createElement("label",{htmlFor:"username"},react.createElement(es.x6,null,"Username")),react.createElement("input",{name:"username",value:this.state.resourceViewModel?.username||"",onChange:this.handleInputChange,disabled:this.state.processing,className:"fluid",maxLength:"255",type:"text",id:"username",autoComplete:"off"}),this.state.errors?.hasError("username","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("username","api-validation"))),react.createElement("div",{className:"input-password-wrapper input required "+(this.state.errors?.hasError("password")?"error":"")},react.createElement("label",{htmlFor:"password"},react.createElement(es.x6,null,"Password")),react.createElement("div",{className:"password-button-inline"},react.createElement(Password.A,{name:"password",value:this.state.resourceViewModel?.password||"",preview:!0,onChange:this.handleInputChange,disabled:this.state.processing,placeholder:this.translate("Password"),id:"password",autoComplete:"new-password"})),this.state.errors?.hasError("password","required")&&react.createElement("div",{className:"error-message"},react.createElement(es.x6,null,"A password is required.")),this.state.errors?.hasError("password","api-validation")&&react.createElement("div",{className:"error-message"},this.state.errors.getError("password","api-validation"))),this.state.unexpectedErrorMessage&&react.createElement("div",{className:"error-message"},this.state.unexpectedErrorMessage))),react.createElement("div",{className:"submit-wrapper input flex-row-end"},react.createElement("a",{className:"cancel",role:"button",onClick:this.handleClose},this.translate("no, thanks")),react.createElement("button",{type:"submit",className:"button primary big "+(this.state.processing?"processing":""),role:"button",disabled:this.state.processing},react.createElement(es.x6,null,"Save"),this.state.processing&&react.createElement(spinner.A,null)))))}}SaveResource.propTypes={context:prop_types_default().any,history:prop_types_default().object,t:prop_types_default().func,resourceTypes:prop_types_default().instanceOf(resourceTypesCollection.A),metadataTypeSettings:prop_types_default().instanceOf(metadataTypesSettingsEntity.Ay),passwordPoliciesContext:prop_types_default().object,passwordExpiryContext:prop_types_default().object};const ResourceAutoSave_SaveResource=(0,AppContext.L)((0,react_router.withRouter)((0,ResourceTypesLocalStorageContext.KH)((0,MetadataTypesSettingsLocalStorageContext.mw)((0,PasswordPoliciesContext.WJ)((0,PasswordExpirySettingsContext.f4)((0,es.CI)("common")(SaveResource)))))));SaveResource.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get the default state\n@returns {object}",modifiers:["get"],params:[],returns:{type:{name:"object"}},description:"Get the default state"},{name:"initEventHandlers",docblock:"initialize event handlers",modifiers:[],params:[],returns:null,description:"initialize event handlers"},{name:"loadPasswordMetaFromTabForm",docblock:"Loads the resource data from the information of the autosave preparation\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Loads the resource data from the information of the autosave preparation"},{name:"handleClose",docblock:'Handles the "close" event',modifiers:[],params:[],returns:null,description:'Handles the "close" event'},{name:"validate",docblock:"Validate the form data and returns true if it's valid\n@param {ResourcePasswordDescriptionViewModel} resourceViewModel\n@returns {EntityValidationError}",modifiers:[],params:[{name:"resourceViewModel",type:{name:"ResourcePasswordDescriptionViewModel"},optional:!1}],returns:{type:{name:"EntityValidationError"}},description:"Validate the form data and returns true if it's valid"},{name:"handleFormSubmit",docblock:"Handles the form submission\n@param {React.Event} event\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"event",type:{name:"React.Event"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handles the form submission"},{name:"handleSubmitError",docblock:"Handles error during form submission\n@param {Error} error",modifiers:[],params:[{name:"error",type:{name:"Error"},optional:!1}],returns:null,description:"Handles error during form submission"},{name:"formatApiErrors",docblock:"Format the given BadRequest error invalid field information.\n@param {object} errorBody\n@returns {EntityValidationError}",modifiers:[],params:[{name:"errorBody",type:{name:"object"},optional:!1}],returns:{type:{name:"EntityValidationError"}},description:"Format the given BadRequest error invalid field information."},{name:"handleInputChange",docblock:"Handles form input changed\n@param {React.Event} event",modifiers:[],params:[{name:"event",type:{name:"React.Event"},optional:!1}],returns:null,description:"Handles form input changed"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"SaveResource",props:{context:{description:"",type:{name:"any"},required:!1},history:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1},resourceTypes:{description:"",type:{name:"instanceOf",value:"ResourceTypesCollection"},required:!1},metadataTypeSettings:{description:"",type:{name:"instanceOf",value:"MetadataTypesSettingsEntity"},required:!1},passwordPoliciesContext:{description:"",type:{name:"object"},required:!1},passwordExpiryContext:{description:"",type:{name:"object"},required:!1}}};var PasswordExpirySettingsContext_test_data=__webpack_require__("./src/react-extension/contexts/PasswordExpirySettingsContext.test.data.js"),PasswordExpirySettingsDto_test_data=__webpack_require__("./src/shared/models/passwordExpirySettings/PasswordExpirySettingsDto.test.data.js"),PasswordPoliciesContext_test_data=__webpack_require__("./src/shared/context/PasswordPoliciesContext/PasswordPoliciesContext.test.data.js"),PasswordPoliciesDto_test_data=__webpack_require__("./src/shared/models/passwordPolicies/PasswordPoliciesDto.test.data.js"),AppContext_test_data=__webpack_require__("./src/react-quickaccess/contexts/AppContext.test.data.js"),resourceTypesCollection_test_data=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypesCollection.test.data.js"),metadataTypesSettingsEntity_test_data=__webpack_require__("./src/shared/models/entity/metadata/metadataTypesSettingsEntity.test.data.js");function defaultProps(props={}){const defaultProps1={context:(0,AppContext_test_data.s)(props?.appContext),resourceTypes:new resourceTypesCollection.A((0,resourceTypesCollection_test_data.V1)()),metadataTypeSettings:new metadataTypesSettingsEntity.Ay((0,metadataTypesSettingsEntity_test_data.uc)()),passwordExpiryContext:(0,PasswordExpirySettingsContext_test_data.i)({getSettings:()=>(0,PasswordExpirySettingsDto_test_data.om)()}),passwordPoliciesContext:(0,PasswordPoliciesContext_test_data.M)({getPolicies:jest.fn(()=>(0,PasswordPoliciesDto_test_data.m)())})};return Object.assign(defaultProps1,props)}function mockExtensionCall(context){context.port.addRequestListener("passbolt.resources.create",()=>{}),context.port.addRequestListener("passbolt.quickaccess.prepare-autosave",()=>({name:"",uri:"",username:"",secret_clear:""})),context.port.addRequestListener("passbolt.secrets.powned-password",value=>{if("hello-world"===value)return 3;if("unavailable"===value)throw new Error("Service is unavailable");return 0})}var Header=__webpack_require__("./src/react-quickaccess/components/Header/Header.js");const SaveResource_test_stories={title:"Components/QuickAccess/SaveResource",component:ResourceAutoSave_SaveResource},Template=({context,...args})=>react.createElement(AppContext.A.Provider,{value:context},react.createElement(react_router.MemoryRouter,{initialEntries:["/"]},react.createElement(react_router.Route,{component:routerProps=>react.createElement("div",{className:"container quickaccess"},react.createElement(Header.A,null),react.createElement(ResourceAutoSave_SaveResource,{...args,...routerProps}))})));Template.propTypes={context:prop_types_default().object};const parameters={css:"ext_quickaccess"},initialAppContext=(0,AppContext_test_data.s)();mockExtensionCall(initialAppContext);const Initial=Template.bind({});Initial.args=defaultProps({context:initialAppContext}),Initial.parameters=parameters;const appContextWithTabInfo=(0,AppContext_test_data.s)();!function mockExtensionCallWithTabInfo(context){mockExtensionCall(context),context.port.addRequestListener("passbolt.quickaccess.prepare-autosave",()=>({name:"test",uri:"www.test.com",username:"test@passbolt.com",secret_clear:"test@passbolt.com"}))}(appContextWithTabInfo);const SaveResourceFromTab=Template.bind({});SaveResourceFromTab.args=defaultProps({context:appContextWithTabInfo}),SaveResourceFromTab.parameters=parameters;const __namedExportsOrder=["Initial","SaveResourceFromTab"];Initial.parameters={...Initial.parameters,docs:{...Initial.parameters?.docs,source:{originalSource:"({\n  context,\n  ...args\n}) => <AppContext.Provider value={context}>\n    <MemoryRouter initialEntries={['/']}>\n      <Route component={routerProps => <div className=\"container quickaccess\"><Header /><SaveResource {...args} {...routerProps} /></div>} />\n    </MemoryRouter>\n  </AppContext.Provider>",...Initial.parameters?.docs?.source}}},SaveResourceFromTab.parameters={...SaveResourceFromTab.parameters,docs:{...SaveResourceFromTab.parameters?.docs,source:{originalSource:"({\n  context,\n  ...args\n}) => <AppContext.Provider value={context}>\n    <MemoryRouter initialEntries={['/']}>\n      <Route component={routerProps => <div className=\"container quickaccess\"><Header /><SaveResource {...args} {...routerProps} /></div>} />\n    </MemoryRouter>\n  </AppContext.Provider>",...SaveResourceFromTab.parameters?.docs?.source}}}},"./src/shared/components/Password/Password.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__),_img_svg_eye_open_svg__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/img/svg/eye_open.svg"),_img_svg_eye_close_svg__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/img/svg/eye_close.svg"),react_i18next__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js");class Password extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{viewPassword:!1,hasPassphraseFocus:!1,isPassphraseActive:!1}}bindCallbacks(){this.handleInputChange=this.handleInputChange.bind(this),this.handlePasswordInputFocus=this.handlePasswordInputFocus.bind(this),this.handlePasswordInputBlur=this.handlePasswordInputBlur.bind(this),this.handleViewPasswordButtonClick=this.handleViewPasswordButtonClick.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this)}handleInputChange(event){this.props.onChange&&this.props.onChange(event)}handlePasswordInputFocus(){this.setState({hasPassphraseFocus:!0})}handlePasswordInputBlur(){this.setState({hasPassphraseFocus:!1})}handleViewPasswordButtonClick(){this.props.disabled||this.setState({viewPassword:!this.state.viewPassword})}get securityTokenStyle(){const inverseStyle={background:this.props.securityToken.textColor,color:this.props.securityToken.backgroundColor},fullStyle={background:this.props.securityToken.backgroundColor,color:this.props.securityToken.textColor};return this.state.hasPassphraseFocus?inverseStyle:fullStyle}get passphraseInputStyle(){if(!this.state.hasPassphraseFocus)return;const{backgroundColor}=this.props.securityToken,textColor=this.getContrastTextColor(backgroundColor);return{background:backgroundColor,color:textColor,"--passphrase-placeholder-color":textColor}}get previewStyle(){if(!this.state.hasPassphraseFocus)return;const{backgroundColor}=this.props.securityToken;return{"--icon-color":this.getContrastTextColor(backgroundColor),"--icon-background-color":backgroundColor}}getContrastTextColor(backgroundColor){const hex=backgroundColor.replace("#",""),bigint=parseInt(hex,16);return(.299*(bigint>>16&255)+.587*(bigint>>8&255)+.114*(255&bigint))/255>.5?"var(--Token-Token-text-and-icon)":"var(--Token-Token-text-and-icon-reversed)"}handleMouseDown(){this.setState({isPassphraseActive:!0})}handleMouseUp(){this.setState({isPassphraseActive:!1})}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input password ${this.props.disabled?"disabled":""} ${this.state.hasPassphraseFocus?"":"no-focus"} ${this.state.isPassphraseActive?"active":""} ${this.props.securityToken?"security":""}`,style:this.props.securityToken?this.passphraseInputStyle:void 0},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:this.props.id,name:this.props.name,maxLength:"4096",placeholder:this.props.placeholder,type:this.state.viewPassword&&!this.props.disabled?"text":"password",onKeyUp:this.props.onKeyUp,value:this.props.value,onFocus:this.handlePasswordInputFocus,onBlur:this.handlePasswordInputBlur,onChange:this.handleInputChange,disabled:this.props.disabled,readOnly:this.props.readOnly,autoComplete:this.props.autoComplete,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,"aria-required":!0,ref:this.props.inputRef}),this.props.preview&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"password-view-wrapper"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",onClick:this.handleViewPasswordButtonClick,style:this.props.securityToken?this.previewStyle:void 0,className:"password-view infield button-transparent "+(this.props.disabled?"disabled":"")},!this.state.viewPassword&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_eye_open_svg__WEBPACK_IMPORTED_MODULE_2__.A,{className:"svg-icon eye-open"}),this.state.viewPassword&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_img_svg_eye_close_svg__WEBPACK_IMPORTED_MODULE_3__.A,{className:"svg-icon eye-close"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"visually-hidden"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_4__.x6,null,"View")))),this.props.securityToken&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"security-token-wrapper"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",{className:"security-token",style:this.securityTokenStyle},this.props.securityToken.code)))}}Password.defaultProps={id:"",name:"",autoComplete:"off"},Password.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_1___default().any,id:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,name:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,value:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,placeholder:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,autoComplete:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,inputRef:prop_types__WEBPACK_IMPORTED_MODULE_1___default().object,disabled:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,readOnly:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,preview:prop_types__WEBPACK_IMPORTED_MODULE_1___default().bool,onChange:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,onKeyUp:prop_types__WEBPACK_IMPORTED_MODULE_1___default().func,securityToken:prop_types__WEBPACK_IMPORTED_MODULE_1___default().shape({code:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,backgroundColor:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string,textColor:prop_types__WEBPACK_IMPORTED_MODULE_1___default().string})};const __WEBPACK_DEFAULT_EXPORT__=(0,react_i18next__WEBPACK_IMPORTED_MODULE_4__.CI)("common")(Password);Password.__docgenInfo={description:"This component represent a password input field with some additional properties",methods:[{name:"defaultState",docblock:null,modifiers:["get"],params:[],returns:null},{name:"bindCallbacks",docblock:"Bind callbacks methods\n@return {void}",modifiers:[],params:[],returns:{type:{name:"void"}},description:"Bind callbacks methods"},{name:"handleInputChange",docblock:"Handle form input change.\n@params {ReactEvent} The react event.",modifiers:[],params:[{name:"event",optional:!1}],returns:null,description:"Handle form input change."},{name:"handlePasswordInputFocus",docblock:"Whenever the user focus on the password input",modifiers:[],params:[],returns:null,description:"Whenever the user focus on the password input"},{name:"handlePasswordInputBlur",docblock:"Whenever the user blurs on the password input",modifiers:[],params:[],returns:null,description:"Whenever the user blurs on the password input"},{name:"handleViewPasswordButtonClick",docblock:"Handle view password button click.",modifiers:[],params:[],returns:null,description:"Handle view password button click."},{name:"securityTokenStyle",docblock:"Returns the style of the security token (color and text color)",modifiers:["get"],params:[],returns:null,description:"Returns the style of the security token (color and text color)"},{name:"passphraseInputStyle",docblock:"Get the passphrase input style.\n@return {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Get the passphrase input style."},{name:"previewStyle",docblock:"Returns the style of preview (icon color and icon background color)",modifiers:["get"],params:[],returns:null,description:"Returns the style of preview (icon color and icon background color)"},{name:"getContrastTextColor",docblock:"Calculate the luminance of a color and return the appropriate text color variable.\n@param {string} backgroundColor - The background color in hex format.\n@returns {string} - The CSS variable for text color.",modifiers:[],params:[{name:"backgroundColor",description:"The background color in hex format.",type:{name:"string"},optional:!1}],returns:{description:"The CSS variable for text color.",type:{name:"string"}},description:"Calculate the luminance of a color and return the appropriate text color variable."},{name:"handleMouseDown",docblock:"Handle the mouse down to set active item",modifiers:[],params:[],returns:null,description:"Handle the mouse down to set active item"},{name:"handleMouseUp",docblock:"Handle the mouse down to set active item to false",modifiers:[],params:[],returns:null,description:"Handle the mouse down to set active item to false"}],displayName:"Password",props:{id:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},name:{defaultValue:{value:'""',computed:!1},description:"",type:{name:"string"},required:!1},autoComplete:{defaultValue:{value:'"off"',computed:!1},description:"",type:{name:"string"},required:!1},context:{description:"",type:{name:"any"},required:!1},value:{description:"",type:{name:"string"},required:!1},placeholder:{description:"",type:{name:"string"},required:!1},inputRef:{description:"",type:{name:"object"},required:!1},disabled:{description:"",type:{name:"bool"},required:!1},readOnly:{description:"",type:{name:"bool"},required:!1},preview:{description:"",type:{name:"bool"},required:!1},onChange:{description:"",type:{name:"func"},required:!1},onKeyUp:{description:"",type:{name:"func"},required:!1},securityToken:{description:"",type:{name:"shape",value:{code:{name:"string",required:!1},backgroundColor:{name:"string",required:!1},textColor:{name:"string",required:!1}}},required:!1}}}},"./src/shared/models/entity/abstract/entityV2Collection.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _entityValidationError__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),_entityCollection__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityCollection.js"),_collectionValidationError__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/abstract/collectionValidationError.js"),_entityCollectionError__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/models/entity/abstract/entityCollectionError.js"),_entitySchema__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js"),_utils_logger__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/shared/utils/logger.js");class EntityV2Collection extends _entityCollection__WEBPACK_IMPORTED_MODULE_1__.A{static _cachedSchema={};get entityClass(){throw new Error("The collection class should declare the entity class that is handled.")}constructor(dtos=[],options={}){super(dtos,options);(options?.validate??!0)&&this.validateSchema(),this.pushMany(this._props,{...options,clone:!1}),this._props=null}validateSchema(){this._props=_entitySchema__WEBPACK_IMPORTED_MODULE_4__.A.validate(this.constructor.name,this._props,this.cachedSchema)}get cachedSchema(){return this.constructor._cachedSchema[this.constructor.name]||(this.constructor._cachedSchema[this.constructor.name]=this.constructor.getSchema()),this.constructor._cachedSchema[this.constructor.name]}static getSchema(){throw new Error("The collection class should declare its schema.")}buildOrCloneEntity(data,entityOptions={}){if(!data||"object"!=typeof data)throw new TypeError(`${this.entityClass.name}::buildOrCloneEntity expects "data" to be an object.`);return data instanceof this.entityClass&&(data=data.toDto(this.entityClass?.ALL_CONTAIN_OPTIONS)),new this.entityClass(data,entityOptions)}validateBuildRules(item,options={}){}validate(options={}){try{this.validateItems(options)}catch(error){if(!(error instanceof _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A))throw error;return error}return null}validateItems(options={}){if(0===this.length)return null;const collectionValidationError=new _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A;if(this.items.forEach((entity,index)=>{const errors=entity.validate(options);errors&&collectionValidationError.addItemValidationError(index,errors)}),collectionValidationError.hasErrors())throw collectionValidationError}push(data,entityOptions={},options={}){const entity=this.buildOrCloneEntity(data,entityOptions);this.validateBuildRules(entity,options?.validateBuildRules),this._items.push(entity),options?.onItemPushed?.(entity)}pushOrReplace(data,entityOptions={},options={}){const replacePropertyName=options?.replacePropertyName||"id",foundIndex=this.items.findIndex(entity=>entity[replacePropertyName]===data[replacePropertyName]);if(-1!==foundIndex){this.items.splice(foundIndex,1);const entity=this.buildOrCloneEntity(data,entityOptions);this.validateBuildRules(entity,options?.validateBuildRules),this.items.splice(foundIndex,0,entity)}else this.push(data,entityOptions,options)}pushMany(data,entityOptions={},options={}){if(!Array.isArray(data))throw new TypeError(`${this.constructor.name} pushMany expects "data" to be an array.`);data.forEach((itemDto,index)=>{try{this.push(itemDto,entityOptions,options)}catch(error){this.handlePushItemError(index,error,entityOptions)}})}handlePushItemError(index,error,entityOptions){if(!(error instanceof _entityValidationError__WEBPACK_IMPORTED_MODULE_0__.A||error instanceof _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A||error instanceof _entityCollectionError__WEBPACK_IMPORTED_MODULE_3__.A))throw error;if(!entityOptions?.ignoreInvalidEntity){const collectionValidationError=new _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A;throw collectionValidationError.addItemValidationError(index,error),collectionValidationError}{const errorMessage=`${this.entityClass.name}::pushMany ignored item (${index}) due to validation error.`;_utils_logger__WEBPACK_IMPORTED_MODULE_5__.A.error(new Error(errorMessage,{cause:error}))}}}const __WEBPACK_DEFAULT_EXPORT__=EntityV2Collection},"./src/shared/utils/logger.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Logger});var _models_entity_abstract_collectionValidationError__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/collectionValidationError.js");class Logger{static error(error){console.error(error);try{error instanceof Error&&"function"==typeof error.toJSON&&console.log(`Error: ${error.message}\nError structure: ${JSON.stringify(Logger.serializeError(error))}`)}catch(error){console.error("The logger was unable to extract additional error information",error)}}static serializeError(error){const{stack,cause,...errorProperties}=error.toJSON();return error.cause&&error.cause instanceof Error&&(errorProperties.cause=Logger.serializeError(error.cause)),error instanceof _models_entity_abstract_collectionValidationError__WEBPACK_IMPORTED_MODULE_0__.A&&Array.isArray(error.errors)&&(errorProperties.errors=error.errors.map(collectionError=>Logger.serializeError(collectionError))),errorProperties}}}}]);