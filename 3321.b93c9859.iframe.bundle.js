/*! For license information please see 3321.b93c9859.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[3321],{"./src/shared/models/entity/abstract/entityV2Collection.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _entityValidationError__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),_entityCollection__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityCollection.js"),_collectionValidationError__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/abstract/collectionValidationError.js"),_entityCollectionError__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/models/entity/abstract/entityCollectionError.js"),_entitySchema__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js");class EntityV2Collection extends _entityCollection__WEBPACK_IMPORTED_MODULE_1__.A{static _cachedSchema={};get entityClass(){throw new Error("The collection class should declare the entity class that is handled.")}constructor(dtos=[],options={}){super(dtos,options);(options?.validate??!0)&&this.validateSchema(),this.pushMany(this._props,{...options,clone:!1}),this._props=null}validateSchema(){this._props=_entitySchema__WEBPACK_IMPORTED_MODULE_4__.A.validate(this.constructor.name,this._props,this.cachedSchema)}get cachedSchema(){return this.constructor._cachedSchema[this.constructor.name]||(this.constructor._cachedSchema[this.constructor.name]=this.constructor.getSchema()),this.constructor._cachedSchema[this.constructor.name]}static getSchema(){throw new Error("The collection class should declare its schema.")}buildOrCloneEntity(data,entityOptions={}){if(!data||"object"!=typeof data)throw new TypeError(`${this.entityClass.name}::buildOrCloneEntity expects "data" to be an object.`);return data instanceof this.entityClass&&(data=data.toDto(this.entityClass?.ALL_CONTAIN_OPTIONS)),new this.entityClass(data,entityOptions)}validateBuildRules(item,options={}){}validate(options={}){try{this.validateItems(options)}catch(error){if(!(error instanceof _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A))throw error;return error}return null}validateItems(options={}){if(0===this.length)return null;const collectionValidationError=new _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A;if(this.items.forEach(((entity,index)=>{const errors=entity.validate(options);errors&&collectionValidationError.addItemValidationError(index,errors)})),collectionValidationError.hasErrors())throw collectionValidationError}push(data,entityOptions={},options={}){const entity=this.buildOrCloneEntity(data,entityOptions);this.validateBuildRules(entity,options?.validateBuildRules),this._items.push(entity),options?.onItemPushed?.(entity)}pushOrReplace(data,entityOptions={},options={}){const replacePropertyName=options?.replacePropertyName||"id",foundIndex=this.items.findIndex((entity=>entity[replacePropertyName]===data[replacePropertyName]));if(-1!==foundIndex){this.items.splice(foundIndex,1);const entity=this.buildOrCloneEntity(data,entityOptions);this.validateBuildRules(entity,options?.validateBuildRules),this.items.splice(foundIndex,0,entity)}else this.push(data,entityOptions,options)}pushMany(data,entityOptions={},options={}){if(!Array.isArray(data))throw new TypeError(`${this.constructor.name} pushMany expects "data" to be an array.`);data.forEach(((itemDto,index)=>{try{this.push(itemDto,entityOptions,options)}catch(error){this.handlePushItemError(index,error,entityOptions)}}))}handlePushItemError(index,error,entityOptions){if(!(error instanceof _entityValidationError__WEBPACK_IMPORTED_MODULE_0__.A||error instanceof _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A||error instanceof _entityCollectionError__WEBPACK_IMPORTED_MODULE_3__.A))throw error;if(!entityOptions?.ignoreInvalidEntity){const collectionValidationError=new _collectionValidationError__WEBPACK_IMPORTED_MODULE_2__.A;throw collectionValidationError.addItemValidationError(index,error),collectionValidationError}console.debug(`${this.entityClass.name}::pushMany ignore item (${index}) due to validation error ${JSON.stringify(error?.details)}`)}}const __WEBPACK_DEFAULT_EXPORT__=EntityV2Collection},"./src/shared/models/entity/customField/customFieldEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,F8:()=>CUSTOM_FIELD_TEXT_MAX_LENGTH,GR:()=>CUSTOM_FIELD_TYPE,bD:()=>CUSTOM_FIELD_KEY_MAX_LENGTH});var _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),_abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),uuid__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const CUSTOM_FIELD_TYPE={TEXT:"text",PASSWORD:"password",BOOLEAN:"boolean",NUMBER:"number",URI:"uri"},CUSTOM_FIELD_KEY_MAX_LENGTH=255,CUSTOM_FIELD_TEXT_MAX_LENGTH=5e3;class CustomFieldEntity extends _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__.A{static getSchema(){return{type:"object",required:["id","type"],properties:{id:{type:"string",format:"uuid"},type:{type:"string",enum:[CUSTOM_FIELD_TYPE.TEXT,CUSTOM_FIELD_TYPE.PASSWORD,CUSTOM_FIELD_TYPE.BOOLEAN,CUSTOM_FIELD_TYPE.NUMBER,CUSTOM_FIELD_TYPE.URI]},metadata_key:{type:"string",maxLength:CUSTOM_FIELD_KEY_MAX_LENGTH,nullable:!0},metadata_value:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}],nullable:!0},secret_key:{type:"string",maxLength:CUSTOM_FIELD_KEY_MAX_LENGTH,nullable:!0},secret_value:{anyOf:[{type:"string"},{type:"number"},{type:"boolean"}],nullable:!0}}}}validateBuildRules(){let validationError;const{metadata_key,metadata_value,secret_key,secret_value,type}=this._props,isSecretKeyDefined=null!=secret_key;null!=metadata_key&&isSecretKeyDefined&&(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("key","metadata_key-secret_key","The custom field key should be defined in only one of either the metadata_key or the secret_key"));const isMetadataValueDefined=null!=metadata_value,isSecretValueDefined=null!=secret_value;if(isMetadataValueDefined&&isSecretValueDefined&&(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","metadata_value-secret_value","The custom field value should be defined in only one of either the metadata_value or the secret_value")),isSecretKeyDefined&&isMetadataValueDefined&&(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","secret_key-metadata_value","The custom field value should not be set in metadata_value if the ket is defined in the secret_key")),isMetadataValueDefined||isSecretValueDefined){const value=secret_value??metadata_value;"string"==typeof value||type!==CUSTOM_FIELD_TYPE.TEXT&&type!==CUSTOM_FIELD_TYPE.PASSWORD&&type!==CUSTOM_FIELD_TYPE.URI?type===CUSTOM_FIELD_TYPE.NUMBER&&"number"!=typeof value||type===CUSTOM_FIELD_TYPE.BOOLEAN&&"boolean"!=typeof value?(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","value-type","The type and the value type should match")):type===CUSTOM_FIELD_TYPE.TEXT&&value.length>5e3?(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","maxLength",`The length of the value should not exceed ${CUSTOM_FIELD_TEXT_MAX_LENGTH} characters`)):type===CUSTOM_FIELD_TYPE.PASSWORD&&value.length>4096?(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","maxLength","The length of the value should not exceed 4096 characters")):type===CUSTOM_FIELD_TYPE.URI&&value.length>1024&&(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","maxLength","The length of the value should not exceed 1024 characters")):(validationError=validationError||new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A,validationError.addError("value","value-type","The type and the value type should match"))}if(validationError)throw validationError}toMetadataDto(){const result=Object.assign({},this._props);return delete result.secret_key,delete result.secret_value,result}toSecretDto(){const result=Object.assign({},this._props);return delete result.metadata_key,delete result.metadata_value,result}get key(){return this._props.metadata_key??this._props.secret_key}get value(){return this._props.secret_value??this._props.metadata_value}static createFromDefault(data={}){const defaultData={id:data.id||(0,uuid__WEBPACK_IMPORTED_MODULE_2__.A)(),type:CUSTOM_FIELD_TYPE.TEXT,metadata_key:"",secret_value:"",...data};return new CustomFieldEntity(defaultData)}static areFieldsDifferent(a,b){if(!(a instanceof CustomFieldEntity&&b instanceof CustomFieldEntity))throw new TypeError("Both paramerters must be of type CustomFieldEntity");return a._props.id!==b._props.id||a._props.type!==b._props.type||a._props.metadata_key!==b._props.metadata_key||a._props.metadata_value!==b._props.metadata_value||a._props.secret_key!==b._props.secret_key||a._props.secret_value!==b._props.secret_value}isEmpty(){return!this.key&&!this.value}}const __WEBPACK_DEFAULT_EXPORT__=CustomFieldEntity},"./src/shared/models/entity/customField/customFieldsCollection.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>CustomFieldsCollection,b:()=>CUSTOM_FIELD_COLLECTION_MAX_CONTENT_SIZE});var _abstract_entityV2Collection__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityV2Collection.js"),_abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),_customFieldEntity__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/customField/customFieldEntity.js");const CUSTOM_FIELD_COLLECTION_MAX_CONTENT_SIZE=5e4;class CustomFieldsCollection extends _abstract_entityV2Collection__WEBPACK_IMPORTED_MODULE_0__.A{get entityClass(){return _customFieldEntity__WEBPACK_IMPORTED_MODULE_2__.Ay}constructor(dtos=[],options={}){super(dtos,options)}static getSchema(){return{type:"array",items:_customFieldEntity__WEBPACK_IMPORTED_MODULE_2__.Ay.getSchema(),maxItems:128}}validateBuildRules(item,options={}){this.assertNotExist("id",item._props.id,{haystackSet:options?.uniqueIdsSetCache}),this.assertContentDoNotExceedMaxSize(item,options)}assertContentDoNotExceedMaxSize(item,options){if((options?.contentInformation?.currentSize||this.currentSize)+(item.value?.toString().length||0)<=CUSTOM_FIELD_COLLECTION_MAX_CONTENT_SIZE)return;const error=new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A;throw error.addError("items","maxContentSize",`The collection items should not cumulate more than ${CUSTOM_FIELD_COLLECTION_MAX_CONTENT_SIZE} characters in total.`),error}pushMany(data,entityOptions={},options={}){const uniqueIdsSetCache=new Set(this.extract("id")),contentInformation={currentSize:0};options={onItemPushed:item=>{uniqueIdsSetCache.add(item._props.id),contentInformation.currentSize+=item.value?.toString().length||0},validateBuildRules:{...options?.validateBuildRules,uniqueIdsSetCache,contentInformation},...options},super.pushMany(data,entityOptions,options)}get currentSize(){return this.items.reduce(((size,customFieldEntity)=>(customFieldEntity.value?.toString().length||0)+size),0)}isEmpty(){return 0===this.length||!this.items.find((i=>!i.isEmpty()))}toMetadataDto(){return this.items.map((customField=>customField.toMetadataDto()))}toSecretDto(){return this.items.map((customField=>customField.toSecretDto()))}static areCollectionsDifferent(collectionA,collectionB){if(!(collectionA instanceof CustomFieldsCollection&&collectionB instanceof CustomFieldsCollection))throw new TypeError("Both parameters must be of type CustomFieldsCollection");const length=collectionA.length;if(length!==collectionB.length)return!0;for(let i=0;i<length;i++){if(_customFieldEntity__WEBPACK_IMPORTED_MODULE_2__.Ay.areFieldsDifferent(collectionA.items[i],collectionB.items[i]))return!0}return!1}static mergeCollectionsMetadataAndSecret(collectionMetadata,collectionSecret){if(!(collectionMetadata instanceof CustomFieldsCollection&&collectionSecret instanceof CustomFieldsCollection))throw new TypeError("Both parameters must be of type CustomFieldsCollection");collectionMetadata.length!==collectionSecret.length&&console.debug("Collections are corrupted, some data is missing");const collectionMergedDto=collectionMetadata.toDto().reduce(((columnsMerged,columnToMerge)=>{const index=columnsMerged.findIndex((column=>column.id===columnToMerge.id));return index>-1?(columnsMerged[index]=Object.assign(columnsMerged[index],columnToMerge),columnsMerged):[...columnsMerged,columnToMerge]}),collectionSecret.toDto());return new CustomFieldsCollection(collectionMergedDto)}}},"./src/shared/models/entity/customField/customFieldsCollection.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>defaultCustomFieldsCollection});var v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const customFieldEntity_test_data_defaultCustomField=(data={})=>({id:(0,v4.A)(),type:"text",metadata_key:"key-0",secret_value:"secret-0",...data}),defaultCustomFieldsCollection=()=>[customFieldEntity_test_data_defaultCustomField({metadata_key:"Key 0",secret_value:"Value 0"}),customFieldEntity_test_data_defaultCustomField({metadata_key:"Key 1",secret_value:"Value 1"})]},"./src/shared/models/entity/resource/metadata/IconEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>IconEntity,FU:()=>COLOR_TRANSPARENT,h5:()=>ICON_TYPE_KEEPASS_ICON_SET});var _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),_abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js");const ICON_TYPE_KEEPASS_ICON_SET="keepass-icon-set",COLOR_TRANSPARENT="#00000000";class IconEntity extends _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__.A{static getSchema(){return{type:"object",required:[],properties:{type:{type:"string",enum:[ICON_TYPE_KEEPASS_ICON_SET,"passbolt-icon-set"]},value:{type:"integer",minimum:0,nullable:!0},background_color:{type:"string",pattern:/^#(?:[0-9A-Fa-f]{6}|[0-9A-Fa-f]{8})$/,nullable:!0}}}}validateBuildRules(){if(Boolean(this._props.value)&&!this._props.type){const error=new _abstract_entityValidationError__WEBPACK_IMPORTED_MODULE_1__.A;throw error.addError("type","required_with_value","The property type must be set if the property value is set"),error}}get type(){return this._props.type||null}get value(){return this._props.value||null}get backgroundColor(){return this._props.background_color||null}}},"./src/shared/models/entity/resource/metadata/resourceMetadataEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js"),_IconEntity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/resource/metadata/IconEntity.js"),_customField_customFieldsCollection__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/customField/customFieldsCollection.js");class ResourceMetadataEntity extends _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__.A{static getSchema(){return{type:"object",required:["name","resource_type_id"],properties:{object_type:{type:"string",enum:["PASSBOLT_RESOURCE_METADATA"]},resource_type_id:{type:"string",format:"uuid"},name:{type:"string",maxLength:255},username:{type:"string",maxLength:255,nullable:!0},uris:{type:"array",items:{type:"string",maxLength:1024}},description:{type:"string",maxLength:1e4,nullable:!0},icon:_IconEntity__WEBPACK_IMPORTED_MODULE_1__.Ay.getSchema(),custom_fields:_customField_customFieldsCollection__WEBPACK_IMPORTED_MODULE_2__.A.getSchema()}}}static get associations(){return{icon:_IconEntity__WEBPACK_IMPORTED_MODULE_1__.Ay,custom_fields:_customField_customFieldsCollection__WEBPACK_IMPORTED_MODULE_2__.A}}toDto(contain){const result=Object.assign({},this._props);return contain?(this._icon&&contain.icon&&(result.icon=this._icon.toDto()),this._customFields&&contain.custom_fields&&(result.custom_fields=this._customFields.toDto()),result):result}createAssociations(options={}){if(this._props.icon){try{this._icon=new _IconEntity__WEBPACK_IMPORTED_MODULE_1__.Ay(this._props.icon,options)}catch(e){console.warn("The associated icon entity could not be set.",e)}delete this._props.icon,super.createAssociations(options)}else super.createAssociations(options)}get objectType(){return this._props.object_type||null}get name(){return this._props.name}get username(){return this._props.username}get description(){return this._props.description||null}get resourceTypeId(){return this._props.resource_type_id}get uris(){return this._props.uris||[]}get icon(){return this._icon||null}get customFields(){return this._customFields||null}static get ENTITY_NAME(){return"ResourceMetadataEntity"}static get METADATA_OBJECT_TYPE(){return"PASSBOLT_RESOURCE_METADATA"}static get URI_MAX_LENGTH(){return 1024}static get DEFAULT_CONTAIN(){return{icon:!0,custom_fields:!0}}}const __WEBPACK_DEFAULT_EXPORT__=ResourceMetadataEntity},"./src/shared/models/entity/resource/metadata/resourceMetadataEntity.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>defaultResourceMetadataDto,W:()=>minimalResourceMetadataDto});var resourceTypeEntity_test_data=__webpack_require__("./src/shared/models/entity/resourceType/resourceTypeEntity.test.data.js"),IconEntity=__webpack_require__("./src/shared/models/entity/resource/metadata/IconEntity.js");const defaultIconDto=(data={})=>((data={})=>({type:IconEntity.h5,...data}))({value:42,background_color:"#E64626",...data});var customFieldsCollection_test_data=__webpack_require__("./src/shared/models/entity/customField/customFieldsCollection.test.data.js"),resourceMetadataEntity=__webpack_require__("./src/shared/models/entity/resource/metadata/resourceMetadataEntity.js");const minimalResourceMetadataDto=(data={})=>({name:"Passbolt",resource_type_id:data?.resource_type_id||resourceTypeEntity_test_data.s_,...data}),defaultResourceMetadataDto=(data={},options={})=>{const metadataDto={object_type:resourceMetadataEntity.A.METADATA_OBJECT_TYPE,resource_type_id:data?.resource_type_id||resourceTypeEntity_test_data.s_,name:"Passbolt",username:"admin@passbolt.com",uris:["https://passbolt.com"],description:"Description",...data};return options?.withIcon&&!data.icon&&(metadataDto.icon=defaultIconDto()),options?.withCustomFields&&!data.custom_fields&&(metadataDto.custom_fields=(0,customFieldsCollection_test_data.o)()),metadataDto}}}]);