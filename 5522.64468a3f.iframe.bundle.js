/*! For license information please see 5522.64468a3f.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[5522],{"./src/react-extension/components/User/ConfirmShareMissingMetadataKeys/ConfirmShareMissingMetadataKeys.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var prop_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_8__),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_i18next__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormSubmitButton.js"),_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormCancelButton.js"),_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/components/Common/Dialog/DialogWrapper/DialogWrapper.js"),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),_shared_services_serviceWorker_metadata_metadataKeysServiceWorkerService__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/shared/services/serviceWorker/metadata/metadataKeysServiceWorkerService.js"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/shared/context/AppContext/AppContext.js");class ConfirmShareMissingMetadataKeys extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks(),this.metadataKeysServiceWorkerService=new _shared_services_serviceWorker_metadata_metadataKeysServiceWorkerService__WEBPACK_IMPORTED_MODULE_6__.Ay(props.context.port)}get defaultState(){return{processing:!1}}bindCallbacks(){this.handleConfirmShare=this.handleConfirmShare.bind(this)}async handleConfirmShare(event){if(event.preventDefault(),0!==this.numberOfKeysCanBeShared){this.setState({processing:!0});try{await this.metadataKeysServiceWorkerService.share(this.props.user.id),this.props.actionFeedbackContext.displaySuccess(this.props.t("Metadata keys has been shared with ({{username}}",{username:this.props.user.username}))}catch(error){console.error(error),this.props.actionFeedbackContext.displayError(error.message)}this.setState({processing:!1}),this.props.onClose()}else this.props.onClose()}hasAllButtonsDisabled(){return this.state.processing}get numberOfKeysCanBeShared(){const loggedInUserMissingMetadataKeys=this.props.context.loggedInUser.missing_metadata_key_ids,userMissingMetadataKeys=this.props.user.missing_metadata_key_ids;return 0===loggedInUserMissingMetadataKeys.length?userMissingMetadataKeys.length:userMissingMetadataKeys.filter((key=>!loggedInUserMissingMetadataKeys.includes(key))).length}get userFullName(){return`${this.props.user.profile.first_name} ${this.props.user.profile.last_name}`}render(){const isDisabled=this.hasAllButtonsDisabled(),loggedInUserMissingMetadataKeys=this.props.context.loggedInUser.missing_metadata_key_ids,userMissingMetadataKeys=this.props.user.missing_metadata_key_ids;return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_4__.A,{className:"delete-sso-settings-dialog",title:this.props.t("Share missing metadata keys?"),onClose:this.props.onClose,disabled:isDisabled},react__WEBPACK_IMPORTED_MODULE_0__.createElement("form",{onSubmit:this.handleConfirmShare,noValidate:!0},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-content"},0===loggedInUserMissingMetadataKeys.length&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,this.props.t("Share missing metadata keys with {{name}} ({{username}})",{name:this.userFullName,username:this.props.user.username})),0===this.numberOfKeysCanBeShared&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,this.props.t("You can't share metadata keys with {{name}} ({{username}}) because you don't have access to them. Ask another administrator for help.",{name:this.userFullName,username:this.props.user.username})),this.numberOfKeysCanBeShared>0&&this.numberOfKeysCanBeShared<userMissingMetadataKeys.length&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,this.props.t("Share your available metadata keys with {{name}} ({{username}})? You're missing some keys yourself. Ask another administrator to share the remaining keys.",{name:this.userFullName,username:this.props.user.username}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"submit-wrapper clearfix"},this.numberOfKeysCanBeShared>0&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_3__.A,{disabled:isDisabled,onClick:this.props.onClose}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_2__.A,{disabled:isDisabled,processing:this.state.processing,value:this.props.t("Share")})),0===this.numberOfKeysCanBeShared&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_2__.A,{disabled:isDisabled,processing:this.state.processing,value:this.props.t("Ok")}))))}}ConfirmShareMissingMetadataKeys.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_8___default().any,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_8___default().any,user:prop_types__WEBPACK_IMPORTED_MODULE_8___default().object,onClose:prop_types__WEBPACK_IMPORTED_MODULE_8___default().func,t:prop_types__WEBPACK_IMPORTED_MODULE_8___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_7__.L)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_5__.ot)((0,react_i18next__WEBPACK_IMPORTED_MODULE_1__.CI)("common")(ConfirmShareMissingMetadataKeys)));ConfirmShareMissingMetadataKeys.__docgenInfo={description:"Component for confirming and handling the sharing of missing metadata keys.",methods:[{name:"defaultState",docblock:"Get default state\n@returns {Object} The default state object.",modifiers:["get"],params:[],returns:{description:"The default state object.",type:{name:"Object"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks",modifiers:[],params:[],returns:null,description:"Bind callbacks"},{name:"handleConfirmShare",docblock:"Handles the form submission for sharing metadata keys.\n@param {Event} event - The form submission event.\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"event",description:"The form submission event.",type:{name:"Event"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handles the form submission for sharing metadata keys."},{name:"hasAllButtonsDisabled",docblock:"Returns true if the buttons must be disabled.\n@returns {boolean} Whether all buttons should be disabled.",modifiers:[],params:[],returns:{description:"Whether all buttons should be disabled.",type:{name:"boolean"}},description:"Returns true if the buttons must be disabled."},{name:"numberOfKeysCanBeShared",docblock:"The number of metadata keys that can be shared with the user.\n@returns {number} The number of metadata keys that can be shared.",modifiers:["get"],params:[],returns:{description:"The number of metadata keys that can be shared.",type:{name:"number"}},description:"The number of metadata keys that can be shared with the user."},{name:"userFullName",docblock:"Retrieves the full name of the user.\n@returns {string} The full name of the user.",modifiers:["get"],params:[],returns:{description:"The full name of the user.",type:{name:"string"}},description:"Retrieves the full name of the user."}],displayName:"ConfirmShareMissingMetadataKeys",props:{context:{description:"",type:{name:"any"},required:!1},actionFeedbackContext:{description:"",type:{name:"any"},required:!1},user:{description:"",type:{name:"object"},required:!1},onClose:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/shared/models/entity/gpgkey/external/externalGpgKeyPairEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_entity__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/abstract/entity.js"),_externalGpgKeyEntity__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/gpgkey/externalGpgKeyEntity.js"),_abstract_entitySchema__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js");class ExternalGpgKeyPairEntity extends _abstract_entity__WEBPACK_IMPORTED_MODULE_2__.A{constructor(externalGpgKeyPeyPairDto,options={}){super(_abstract_entitySchema__WEBPACK_IMPORTED_MODULE_1__.A.validate(ExternalGpgKeyPairEntity.ENTITY_NAME,externalGpgKeyPeyPairDto,ExternalGpgKeyPairEntity.getSchema()),options),this._props.private_key&&(this._private_key=new _externalGpgKeyEntity__WEBPACK_IMPORTED_MODULE_0__.A(this._props.private_key,{clone:!1}),delete this._props.private_key),this._props.public_key&&(this._public_key=new _externalGpgKeyEntity__WEBPACK_IMPORTED_MODULE_0__.A(this._props.public_key,{clone:!1}),delete this._props.public_key)}static getSchema(){return{type:"object",required:["public_key","private_key"],properties:{public_key:_externalGpgKeyEntity__WEBPACK_IMPORTED_MODULE_0__.A.getSchema(),private_key:_externalGpgKeyEntity__WEBPACK_IMPORTED_MODULE_0__.A.getSchema()}}}toDto(contain){const result=Object.assign({},this._props);return contain?(contain.public_key&&this._public_key&&(result.public_key=this.publicKey.toDto()),contain.private_key&&this._private_key&&(result.private_key=this.privateKey.toDto()),result):result}toJSON(){return this.toDto(ExternalGpgKeyPairEntity.ALL_CONTAIN_OPTIONS)}get publicKey(){return this._public_key}get privateKey(){return this._private_key}static get ENTITY_NAME(){return"externalGpgKeyPairEntity"}static get ALL_CONTAIN_OPTIONS(){return{public_key:!0,private_key:!0}}}const __WEBPACK_DEFAULT_EXPORT__=ExternalGpgKeyPairEntity},"./src/shared/models/entity/gpgkey/externalGpgKeyEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_entity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entity.js"),_abstract_entitySchema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js");class ExternalGpgKeyEntity extends _abstract_entity__WEBPACK_IMPORTED_MODULE_1__.A{constructor(gpgkeyDto,options={}){const sanitizedGpgkeyDto=ExternalGpgKeyEntity.sanitizeDto(gpgkeyDto);super(_abstract_entitySchema__WEBPACK_IMPORTED_MODULE_0__.A.validate(ExternalGpgKeyEntity.ENTITY_NAME,sanitizedGpgkeyDto,ExternalGpgKeyEntity.getSchema()),options)}static getSchema(){return{type:"object",required:["armored_key"],properties:{armored_key:{type:"string",minLength:1},key_id:{type:"string",minLength:8,maxLength:16},user_ids:{type:"array"},fingerprint:{type:"string",minLength:40,maxLength:40},expires:{anyOf:[{type:"string",format:"date-time"},{type:"string",pattern:"^Infinity$"},{}],nullable:!0},created:{type:"string",format:"date-time"},algorithm:{type:"string"},length:{type:"integer",minimum:1},curve:{type:"string",nullable:!0},private:{type:"boolean"},revoked:{type:"boolean"}}}}static sanitizeDto(dto){const sanitizedDto=JSON.parse(JSON.stringify(dto));if(dto.key&&(sanitizedDto.armored_key=dto.key,delete sanitizedDto.key),dto.keyId&&(sanitizedDto.key_id=dto.keyId,delete sanitizedDto.keyId),dto.userIds&&(sanitizedDto.user_ids=dto.userIds,delete sanitizedDto.userIds),dto.created)try{const date=new Date(sanitizedDto.created);sanitizedDto.created=date.toISOString()}catch(error){delete sanitizedDto.created}if("Never"===dto.expires)sanitizedDto.expires="Infinity";else if(dto.expires&&"Infinity"!==dto.expires)try{const date=new Date(sanitizedDto.expires);sanitizedDto.expires=date.toISOString()}catch(error){delete sanitizedDto.expires,console.error(`ExternalGpgKeyEntity::sanitizeDto Unable to sanitize the key for the user ${dto.user_id}`)}return sanitizedDto}get armoredKey(){return this._props.armored_key}get keyId(){return this._props.key_id}get userIds(){return this._props.user_ids}get fingerprint(){return this._props.fingerprint}get expires(){return this._props.expires}get isValid(){return null!==this.expires}get created(){return this._props.created}get algorithm(){return this._props.algorithm}get length(){return this._props.length}get curve(){return this._props.curve}get revoked(){return this._props.revoked}get private(){return this._props.private}get isExpired(){const expires=this.expires;if(null===expires)return null;if("Infinity"===expires)return!1;const now=Date.now();return new Date(expires)<now}static get ENTITY_NAME(){return"externalGpgKey"}}const __WEBPACK_DEFAULT_EXPORT__=ExternalGpgKeyEntity},"./src/shared/models/entity/metadata/metadataKeysCollection.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_collectionValidationError__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/collectionValidationError.js"),_abstract_entityV2Collection__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/abstract/entityV2Collection.js"),_metadataKeyEntity__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/metadata/metadataKeyEntity.js");class MetadataKeysCollection extends _abstract_entityV2Collection__WEBPACK_IMPORTED_MODULE_1__.A{get entityClass(){return _metadataKeyEntity__WEBPACK_IMPORTED_MODULE_2__.A}constructor(dtos=[],options={}){super(dtos,options)}static getSchema(){return{type:"array",items:_metadataKeyEntity__WEBPACK_IMPORTED_MODULE_2__.A.getSchema()}}validateBuildRules(item,options={}){this.assertNotExist("id",item._props.id,{haystackSet:options?.uniqueIdsSetCache}),this.assertNotExist("fingerprint",item._props.fingerprint,{haystackSet:options?.uniqueFingerprintsSetCache})}assertFingerprintsPublicAndPrivateKeysMatch(){this._items.forEach(((metadataKey,index)=>{try{metadataKey.assertFingerprintPublicAndPrivateKeysMatch(index)}catch(error){const collectionValidationError=new _abstract_collectionValidationError__WEBPACK_IMPORTED_MODULE_0__.A;throw collectionValidationError.addItemValidationError(index,error),collectionValidationError}}))}getFirstByLatestCreated(){return this.length?this._items.reduce(((latestCreatedItem,item)=>latestCreatedItem.created?item.created&&item.created>latestCreatedItem.created?item:latestCreatedItem:item)):null}toDto(contains={}){return this._items.map((entity=>entity.toDto(contains)))}hasDecryptedKeys(){return this._items.some((metadataKey=>metadataKey.metadataPrivateKeys?.hasDecryptedPrivateKeys()))}hasEncryptedKeys(){return this._items.some((metadataKey=>metadataKey.metadataPrivateKeys?.hasEncryptedPrivateKeys()))}pushMany(data,entityOptions={},options={}){const uniqueIdsSetCache=new Set(this.extract("id")),uniqueFingerprintsSetCache=new Set(this.extract("fingerprint"));options={onItemPushed:item=>{uniqueIdsSetCache.add(item._props.id),uniqueFingerprintsSetCache.add(item._props.fingerprint)},validateBuildRules:{...options?.validateBuildRules,uniqueIdsSetCache,uniqueFingerprintsSetCache},...options},super.pushMany(data,entityOptions,options)}}const __WEBPACK_DEFAULT_EXPORT__=MetadataKeysCollection},"./src/shared/services/serviceWorker/metadata/metadataKeysServiceWorkerService.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__});var _models_entity_metadata_metadataKeysCollection__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/metadata/metadataKeysCollection.js"),_models_entity_gpgkey_external_externalGpgKeyPairEntity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/gpgkey/external/externalGpgKeyPairEntity.js"),_models_entity_metadata_metadataKeyEntity__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/shared/models/entity/metadata/metadataKeyEntity.js");const __WEBPACK_DEFAULT_EXPORT__=class MetadataKeysServiceWorkerService{constructor(port){this.port=port}async findAll(){const metadataKeysDto=await this.port.request("passbolt.metadata.find-all-non-deleted-metadata-keys");return new _models_entity_metadata_metadataKeysCollection__WEBPACK_IMPORTED_MODULE_0__.A(metadataKeysDto)}async generateKeyPair(){const externalGpgKeyPairDto=await this.port.request("passbolt.metadata.generate-metadata-key");return new _models_entity_gpgkey_external_externalGpgKeyPairEntity__WEBPACK_IMPORTED_MODULE_1__.A(externalGpgKeyPairDto)}async createKey(metadataKeyPair){if(!(metadataKeyPair instanceof _models_entity_gpgkey_external_externalGpgKeyPairEntity__WEBPACK_IMPORTED_MODULE_1__.A))throw new TypeError("The parameter `metadataKeyPair` should be of type ExternalGpgKeyPairEntity.");const metadataKeyDto=await this.port.request("passbolt.metadata.create-key",metadataKeyPair.toDto({public_key:!0,private_key:!0}));return new _models_entity_metadata_metadataKeyEntity__WEBPACK_IMPORTED_MODULE_2__.A(metadataKeyDto)}async share(userId){await this.port.request("passbolt.metadata.share-missing-metadata-private-keys-with-user",userId)}}}}]);