/*! For license information please see 1015.e89f772e.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[1015],{"./src/react-extension/components/Administration/DisplayAdministrationPasswordExpiry/DisplayAdministrationPasswordExpiry.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>DisplayAdministrationPasswordExpiry_DisplayAdministrationPasswordExpiry});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),AdministrationWorkspaceContext=__webpack_require__("./src/react-extension/contexts/AdministrationWorkspaceContext.js"),AdministrationPaswordExpiryContext=__webpack_require__("./src/react-extension/contexts/Administration/AdministrationPaswordExpiryContext/AdministrationPaswordExpiryContext.js"),DialogContext=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),ActionFeedbackContext=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),NotifyError=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js");class DisplayAdministrationPasswordExpiryActions extends react.Component{constructor(props){super(props),this.bindCallbacks()}bindCallbacks(){this.handleSave=this.handleSave.bind(this)}get isActionEnabled(){return!this.props.adminPasswordExpiryContext.isProcessing()}async handleSave(){if(this.props.adminPasswordExpiryContext.setSubmitted(!0),this.isActionEnabled&&this.props.adminPasswordExpiryContext.validateData())try{await this.props.adminPasswordExpiryContext.save(),await this.handleSaveSuccess()}catch(error){await this.handleSaveError(error)}}async handleSaveSuccess(){await this.props.actionFeedbackContext.displaySuccess(this.props.t("The password expiry settings were updated."))}async handleSaveError(error){console.error(error),await this.props.actionFeedbackContext.displayError(error.message),this.props.dialogContext.open(NotifyError.A,{error})}render(){const isDisabled=!this.isActionEnabled;return react.createElement("div",{className:"actions-wrapper"},react.createElement("button",{type:"button",className:"button primary",disabled:isDisabled,id:"save-settings",onClick:this.handleSave},react.createElement("span",null,react.createElement(es.x6,null,"Save"))))}}DisplayAdministrationPasswordExpiryActions.propTypes={adminPasswordExpiryContext:prop_types_default().object,actionFeedbackContext:prop_types_default().object,dialogContext:prop_types_default().any,t:prop_types_default().func};const DisplayAdministrationPasswordExpiryActions_DisplayAdministrationPasswordExpiryActions=(0,ActionFeedbackContext.ot)((0,AdministrationPaswordExpiryContext._l)((0,DialogContext.z9)((0,es.CI)("common")(DisplayAdministrationPasswordExpiryActions))));DisplayAdministrationPasswordExpiryActions.__docgenInfo={description:"This component is a container of multiple actions applicable on setting",methods:[{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"isActionEnabled",docblock:"Is save button enabled\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Is save button enabled"},{name:"handleSave",docblock:"Handles the save action.\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handles the save action."},{name:"handleSaveSuccess",docblock:"Handle save operation success.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handle save operation success."},{name:"handleSaveError",docblock:"Handle save operation error.\n@param {object} error The returned error\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"error",description:"The returned error",type:{name:"object"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handle save operation error."}],displayName:"DisplayAdministrationPasswordExpiryActions",props:{adminPasswordExpiryContext:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};class DisplayAdministrationPasswordExpiryAdvanced extends react.PureComponent{constructor(props){super(props),this.bindCallbacks()}bindCallbacks(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleExpiryPeriodToggleClick=this.handleExpiryPeriodToggleClick.bind(this)}handleInputChange(event){const{type,checked,value,name}=event.target,filedValue="checkbox"===type?checked:parseInt(value,10);this.props.adminPasswordExpiryContext.setSettingsBulk({[name]:filedValue})}handleExpiryPeriodToggleClick(event){const value=event.target.checked;this.props.adminPasswordExpiryContext.setDefaultExpiryToggle(value)}async handleFormSubmit(event){if(event.preventDefault(),this.props.adminPasswordExpiryContext.setSubmitted(!0),!this.props.adminPasswordExpiryContext.isProcessing()&&this.props.adminPasswordExpiryContext.validateData())try{await this.props.adminPasswordExpiryContext.save(),await this.handleSaveSuccess()}catch(error){await this.handleSaveError(error)}}async handleSaveSuccess(){await this.props.actionFeedbackContext.displaySuccess(this.props.t("The password expiry settings were updated."))}async handleSaveError(error){await this.props.actionFeedbackContext.displayError(error.message),this.props.dialogContext.open(NotifyError.A,{error})}hasAllInputDisabled(){return this.props.adminPasswordExpiryContext.isProcessing()}get settings(){return this.props.adminPasswordExpiryContext.getSettings()}get errors(){const errors=this.props.adminPasswordExpiryContext.getErrors();return errors?.details}render(){const isSubmitted=this.props.adminPasswordExpiryContext.isSubmitted(),defaultExpiryPeriod=this.settings.default_expiry_period||"",isDefaultExpiryPeriodToggleChecked=Boolean(this.settings?.default_expiry_period_toggle);return react.createElement("div",{id:"password-expiry-form-advanced"},react.createElement("form",{className:"form",onSubmit:this.handleFormSubmit},react.createElement("h4",{className:"no-border",id:"expiry-policies-subtitle"},react.createElement(es.x6,null,"Expiry Policies")),react.createElement("p",{id:"expiry-policies-description"},react.createElement(es.x6,null,"In this section you can choose the default behaviour of password expiry policy for all users.")),react.createElement("div",{className:"togglelist-alt"},react.createElement("span",{id:"default-expiry-period",className:"input toggle-switch form-element "+(this.errors?.default_expiry_period&&isSubmitted?"has-error":"")},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"defaultExpiryPeriodToggle",onChange:this.handleExpiryPeriodToggleClick,checked:isDefaultExpiryPeriodToggleChecked,disabled:this.hasAllInputDisabled(),id:"default-expiry-period-toggle"}),react.createElement("label",{htmlFor:"default-expiry-period-toggle"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Default password expiry period")),react.createElement("span",{className:"info-input"},react.createElement(es.x6,null,react.createElement("span",null,"When a user creates a resource, a default expiry date is set to "),react.createElement("input",{type:"text",className:"toggle-input",id:"default-expiry-period-input",name:"default_expiry_period",onChange:this.handleInputChange,maxLength:3,value:defaultExpiryPeriod,disabled:this.hasAllInputDisabled()||!isDefaultExpiryPeriodToggleChecked,placeholder:"90"}),react.createElement("span",null,"days"))))),this.errors?.default_expiry_period&&isSubmitted&&react.createElement("div",{className:"input"},!this.errors.default_expiry_period.required&&react.createElement("div",{className:"default-expiry-period-gte error-message"},react.createElement(es.x6,null,"The default password expiry period should be a number between 1 and 999 days.")),this.errors?.default_expiry_period.required&&react.createElement("div",{className:"default-expiry-period-required  error-message"},react.createElement(es.x6,null,"The default password expiry period should be a valid number.")))),react.createElement("div",{className:"togglelist-alt"},react.createElement("span",{className:"input toggle-switch form-element",id:"policy-override"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"policy_override",onChange:this.handleInputChange,checked:this.settings.policy_override,disabled:this.hasAllInputDisabled(),id:"policy-override-toggle"}),react.createElement("label",{htmlFor:"policy-override-toggle"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Policy Override")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Allow users to override the default policy."))))),react.createElement("h4",{className:"no-border",id:"automatic-workflow-subtitle"},react.createElement(es.x6,null,"Automatic workflows")),react.createElement("p",{id:"automatic-workflow-description"},react.createElement(es.x6,null,"In this section you can choose automatic behaviours.")),react.createElement("div",{className:"togglelist-alt"},react.createElement("span",{className:"input toggle-switch form-element",id:"automatic-expiry"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"automatic_expiry",onChange:this.handleInputChange,checked:this.settings.automatic_expiry,disabled:this.hasAllInputDisabled(),id:"automatic-expiry-toggle"}),react.createElement("label",{htmlFor:"automatic-expiry-toggle"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Automatic Expiry")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Password automatically expires when a user or group with a user who has accessed the password is removed from the permission list."))))),react.createElement("div",{className:"togglelist-alt"},react.createElement("span",{className:"input toggle-switch form-element",id:"automatic-update"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"automatic_update",onChange:this.handleInputChange,checked:this.settings.automatic_update,disabled:this.hasAllInputDisabled(),id:"automatic-update-toggle"}),react.createElement("label",{htmlFor:"automatic-update-toggle"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Automatic Update")),react.createElement("span",{className:"info"},isDefaultExpiryPeriodToggleChecked?react.createElement(es.x6,null,"Password expiry date is renewed based on the default password expiry period whenever a password is updated."):react.createElement(es.x6,null,"Password is no longer marked as expired whenever the password is updated.")))))))}}DisplayAdministrationPasswordExpiryAdvanced.propTypes={context:prop_types_default().object,adminPasswordExpiryContext:prop_types_default().object,actionFeedbackContext:prop_types_default().object,dialogContext:prop_types_default().object,t:prop_types_default().func};const DisplayAdministrationPasswordExpiryAdvanced_DisplayAdministrationPasswordExpiryAdvanced=(0,AppContext.L)((0,AdministrationPaswordExpiryContext._l)((0,ActionFeedbackContext.ot)((0,DialogContext.z9)((0,es.CI)("common")(DisplayAdministrationPasswordExpiryAdvanced)))));DisplayAdministrationPasswordExpiryAdvanced.__docgenInfo={description:"",methods:[{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"handleInputChange",docblock:"Handle form input changes.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:[],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle form input changes."},{name:"handleExpiryPeriodToggleClick",docblock:"Handle the expiry period toggle click\n@params {ReactEvent} The react event\n@returns {void}",modifiers:[],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle the expiry period toggle click"},{name:"handleFormSubmit",docblock:"Handle form submission that can be trigger when hitting `enter`\n@param {Event} event",modifiers:["async"],params:[{name:"event",type:{name:"Event"},optional:!1}],returns:null,description:"Handle form submission that can be trigger when hitting `enter`"},{name:"handleSaveSuccess",docblock:"Handle save operation success.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handle save operation success."},{name:"handleSaveError",docblock:"Handle save operation error.\n@param {object} error The returned error\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"error",description:"The returned error",type:{name:"object"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handle save operation error."},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"settings",docblock:"return the getSettings from context\n@returns {object}",modifiers:["get"],params:[],returns:{type:{name:"object"}},description:"return the getSettings from context"},{name:"errors",docblock:"return the errors from the validation\n@returns {object}",modifiers:["get"],params:[],returns:{type:{name:"object"}},description:"return the errors from the validation"}],displayName:"DisplayAdministrationPasswordExpiryAdvanced",props:{context:{description:"",type:{name:"object"},required:!1},adminPasswordExpiryContext:{description:"",type:{name:"object"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};var portals=__webpack_require__("./src/shared/utils/portals.js"),buoy=__webpack_require__("./src/img/svg/buoy.svg");class DisplayAdministrationPasswordExpiry extends react.PureComponent{constructor(props){super(props),this.state=this.defaultState}get defaultState(){return{isReady:!1}}async componentDidMount(){await this.props.adminPasswordExpiryContext.findSettings(),this.setState({isReady:!0})}hasAllInputDisabled(){return this.props.adminPasswordExpiryContext.isProcessing()}get canUseAdvancedSettings(){return this.props.context.siteSettings.canIUse("passwordExpiryPolicies")}render(){if(!this.state.isReady)return null;const adminContext=this.props.adminPasswordExpiryContext,isEnabled=adminContext.isFeatureToggleEnabled();return react.createElement("div",{className:"row"},react.createElement("div",{className:"password-expiry-settings main-column"},react.createElement("div",{className:"main-content"},react.createElement("h3",{id:"password-expiry-settings-title",className:"title"},react.createElement("span",{className:"input toggle-switch form-element"},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"passwordExpirySettingsToggle",onChange:()=>adminContext.setFeatureToggle(!isEnabled),checked:isEnabled,disabled:this.hasAllInputDisabled(),id:"passwordExpirySettingsToggle"}),react.createElement("label",{htmlFor:"passwordExpirySettingsToggle"},react.createElement(es.x6,null,"Password Expiry")))),!isEnabled&&react.createElement("p",{className:"description"},react.createElement(es.x6,null,"No Password Expiry is configured. Enable it to activate automatic password expiration and automatic password expiration reset workflows.")),isEnabled&&react.createElement(react.Fragment,null,this.canUseAdvancedSettings?react.createElement(DisplayAdministrationPasswordExpiryAdvanced_DisplayAdministrationPasswordExpiryAdvanced,null):react.createElement("div",{id:"password-expiry-settings-form"},react.createElement("h4",{id:"password-expiry-settings-automatic-workflows",className:"title title--required no-border"},react.createElement(es.x6,null,"Automatic workflows")),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:"input radio"},react.createElement("label",{htmlFor:"passwordExpiryAutomaticExpiry"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Automatic expiry")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Password automatically expires when a user or group with a user who has accessed the password is removed from the permission list.")))),react.createElement("div",{className:"input radio"},react.createElement("label",{htmlFor:"passwordExpiryAutomatiUpdate"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Automatic update")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Password is no longer marked as expired whenever the password is updated.")))))))),adminContext.hasSettingsChanges()&&react.createElement("div",{className:"warning message",id:"password-expiry-settings-save-banner"},react.createElement("div",null,react.createElement("p",null,react.createElement(es.x6,null,"Don't forget to save your settings to apply your modification."))))),react.createElement(DisplayAdministrationPasswordExpiryActions_DisplayAdministrationPasswordExpiryActions,null),(0,portals.m)(react.createElement("div",{className:"sidebar-help-section"},react.createElement("h3",null,react.createElement(es.x6,null,"About password expiry")),react.createElement("p",null,react.createElement(es.x6,null,"For more information about the password expiry, checkout the dedicated page on the help website.")),react.createElement("a",{className:"button",href:"https://passbolt.com/docs/admin/password-configuration/password-expiry",target:"_blank",rel:"noopener noreferrer"},react.createElement(buoy.A,null),react.createElement("span",null,react.createElement(es.x6,null,"Read the documentation")))),document.getElementById("administration-help-panel")))}}DisplayAdministrationPasswordExpiry.propTypes={context:prop_types_default().object,administrationWorkspaceContext:prop_types_default().object,adminPasswordExpiryContext:prop_types_default().object,t:prop_types_default().func};const DisplayAdministrationPasswordExpiry_DisplayAdministrationPasswordExpiry=(0,AppContext.L)((0,AdministrationWorkspaceContext.Kk)((0,AdministrationPaswordExpiryContext._l)((0,es.CI)("common")(DisplayAdministrationPasswordExpiry))));DisplayAdministrationPasswordExpiry.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get default state\n@returns {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Get default state"},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"canUseAdvancedSettings",docblock:"Check if the user can use the advanced expiry password\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Check if the user can use the advanced expiry password"}],displayName:"DisplayAdministrationPasswordExpiry",props:{context:{description:"",type:{name:"object"},required:!1},administrationWorkspaceContext:{description:"",type:{name:"object"},required:!1},adminPasswordExpiryContext:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-extension/contexts/Administration/AdministrationPaswordExpiryContext/AdministrationPaswordExpiryContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ay:()=>AdministrationPaswordExpiryContext,_l:()=>withAdminPasswordExpiry});var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),abstract_entityValidationError=__webpack_require__("./src/shared/models/entity/abstract/entityValidationError.js"),entitySchema=__webpack_require__("./src/shared/models/entity/abstract/entitySchema.js"),entity=__webpack_require__("./src/shared/models/entity/abstract/entity.js");class PasswordExpirySettingsEntity extends entity.A{constructor(PasswordExpirySettingsDto,options={}){super(entitySchema.A.validate(PasswordExpirySettingsEntity.ENTITY_NAME,PasswordExpirySettingsDto,PasswordExpirySettingsEntity.getSchema()),options)}static getSchema(){return{type:"object",required:["automatic_expiry","automatic_update"],properties:{id:{type:"string",format:"uuid"},default_expiry_period:{type:"null"},policy_override:{type:"boolean"},automatic_expiry:{type:"boolean"},automatic_update:{type:"boolean"},created:{type:"string",format:"date-time"},created_by:{type:"string",format:"uuid"},modified:{type:"string",format:"date-time"},modified_by:{type:"string",format:"uuid"}}}}static get ENTITY_NAME(){return"PasswordExpirySettings"}static createFromDefault(data={}){const dto={default_expiry_period:null,policy_override:!1,automatic_expiry:!1,automatic_update:!1,...data};return new PasswordExpirySettingsEntity(dto)}}const passwordExpirySettingsEntity=PasswordExpirySettingsEntity;class PasswordExpiryProSettingsEntity extends entity.A{constructor(PasswordExpirySettingsDto,options={}){super(entitySchema.A.validate(PasswordExpiryProSettingsEntity.ENTITY_NAME,PasswordExpirySettingsDto,PasswordExpiryProSettingsEntity.getSchema()),options)}static getSchema(){return{type:"object",required:["automatic_expiry","automatic_update","policy_override"],properties:{id:{type:"string",format:"uuid"},default_expiry_period:{type:"integer",minimum:1,maximum:999,nullable:!0},policy_override:{type:"boolean"},automatic_expiry:{type:"boolean"},automatic_update:{type:"boolean"},created:{type:"string",format:"date-time"},created_by:{type:"string",format:"uuid"},modified:{type:"string",format:"date-time"},modified_by:{type:"string",format:"uuid"}}}}static get ENTITY_NAME(){return"passwordExpiryProSettingsEntity"}static createFromDefault(data={}){const dto={default_expiry_period:null,policy_override:!1,automatic_expiry:!0,automatic_update:!0,...data};return new PasswordExpiryProSettingsEntity(dto)}}const passwordExpiryProSettingsEntity=PasswordExpiryProSettingsEntity;class PasswordExpirySettingsViewModel{constructor(settings={}){this.automatic_update=Boolean(settings?.automatic_update),this.policy_override=Boolean(settings?.policy_override),this.automatic_expiry=Boolean(settings?.automatic_expiry);const defaultExpiryPeriod=parseInt(settings?.default_expiry_period,10);this.default_expiry_period=isNaN(defaultExpiryPeriod)?null:defaultExpiryPeriod,this.default_expiry_period_toggle=void 0!==settings?.default_expiry_period_toggle?Boolean(settings.default_expiry_period_toggle):Boolean(this.default_expiry_period),settings?.id&&(this.id=settings?.id)}static getSchema(isAvanced=!1){const baseEntitySchema=isAvanced?passwordExpiryProSettingsEntity.getSchema():passwordExpirySettingsEntity.getSchema();return this.getDefaultSchema(baseEntitySchema,isAvanced)}static getDefaultSchema(baseEntitySchema,isAdvanced=!1){const schema={type:"object",required:["automatic_expiry","automatic_update"],properties:{id:baseEntitySchema.properties.id,automatic_expiry:baseEntitySchema.properties.automatic_expiry,automatic_update:baseEntitySchema.properties.automatic_update,policy_override:baseEntitySchema.properties.policy_override,default_expiry_period:baseEntitySchema.properties.default_expiry_period}};return isAdvanced&&schema.required.push("policy_override"),schema}static fromEntityDto(entityDto){const data={automatic_expiry:Boolean(entityDto?.automatic_expiry),automatic_update:Boolean(entityDto?.automatic_update),policy_override:Boolean(entityDto?.policy_override),default_expiry_period:null!==entityDto?.default_expiry_period?parseInt(entityDto?.default_expiry_period,10):null};return entityDto?.id&&(data.id=entityDto.id),new PasswordExpirySettingsViewModel(data)}static isDataDifferent(a,b){return["automatic_expiry","automatic_update","policy_override","default_expiry_period"].some((key=>a[key]!==b[key]))}toEntityDto(){const default_expiry_period=this.default_expiry_period_toggle?this.default_expiry_period:null;return{automatic_expiry:this.automatic_expiry,automatic_update:this.automatic_update,policy_override:this.policy_override,default_expiry_period}}cloneWithMutation(field,value){const clone={...this,[field]:value};return new PasswordExpirySettingsViewModel(clone)}validate(isAdvanced=!1){const entityValidationError=new abstract_entityValidationError.A,schema=PasswordExpirySettingsViewModel.getSchema(isAdvanced);try{entitySchema.A.validate(this.constructor.name,this,schema),this.validateFormInput(entityValidationError,isAdvanced)}catch(e){if(!(e instanceof abstract_entityValidationError.A))throw e;return this.validateFormInput(e,isAdvanced),e}return entityValidationError}validateFormInput(entityValidationError,isAdvanced){isAdvanced&&this.default_expiry_period_toggle&&null===this.default_expiry_period&&entityValidationError.addError("default_expiry_period","required","The default_expiry_period is required.")}get isSettingsDisabled(){return!this.id}}const passwordExpirySettings_PasswordExpirySettingsViewModel=PasswordExpirySettingsViewModel,AdministrationPasswordExpiryContext=react.createContext({getSettings:()=>{},get:()=>{},setSettingsBulk:()=>{},findSettings:()=>{},isProcessing:()=>{},validateData:()=>{},save:()=>{},getErrors:()=>{},isFeatureToggleEnabled:()=>{},setFeatureToggle:()=>{},hasSettingsChanges:()=>{},isSubmitted:()=>{},setSubmitted:()=>{},setDefaultExpiryToggle:()=>{}});class AdministrationPasswordExpiryContextProvider extends react.Component{constructor(props){super(props),this.state=this.defaultState}get defaultState(){return{processing:!1,errors:null,hasBeenValidated:!1,isDataModified:!1,submitted:!1,currentSettings:new passwordExpirySettings_PasswordExpirySettingsViewModel,featureToggleEnabled:!1,settings:new passwordExpirySettings_PasswordExpirySettingsViewModel,findSettings:this.findSettings.bind(this),getSettings:this.getSettings.bind(this),setSettingsBulk:this.setSettingsBulk.bind(this),isProcessing:this.isProcessing.bind(this),validateData:this.validateData.bind(this),save:this.save.bind(this),getErrors:this.getErrors.bind(this),hasSettingsChanges:this.hasSettingsChanges.bind(this),isFeatureToggleEnabled:this.isFeatureToggleEnabled.bind(this),setFeatureToggle:this.setFeatureToggle.bind(this),setDefaultExpiryToggle:this.setDefaultExpiryToggle.bind(this),isSubmitted:this.isSubmitted.bind(this),setSubmitted:this.setSubmitted.bind(this)}}async findSettings(){this.setState({processing:!0}),this.setState({submitted:!1});const result=await this.props.context.port.request("passbolt.password-expiry.get-or-find",!0),settings=passwordExpirySettings_PasswordExpirySettingsViewModel.fromEntityDto(result);this.setState({toggleEnabled:settings?.id,settings,currentSettings:settings,processing:!1})}setDefaultExpiryToggle(value){let default_expiry_period=this.state.settings.default_expiry_period;value&&null===this.state.settings.default_expiry_period&&(default_expiry_period=90),this.setSettingsBulk({default_expiry_period_toggle:value,default_expiry_period})}getSettings(){return this.state.settings}setSubmitted(value){this.setState({submitted:value})}isSubmitted(){return this.state.submitted}setSettingsBulk(keyValuePairs){let newSettings=this.state.settings;const keys=Object.keys(keyValuePairs);for(let i=0;i<keys.length;i++){const key=keys[i];newSettings=newSettings.cloneWithMutation(key,keyValuePairs[key])}const isDataModified=passwordExpirySettings_PasswordExpirySettingsViewModel.isDataDifferent(newSettings,this.state.currentSettings);if(!this.state.hasBeenValidated)return void this.setState({settings:newSettings,isDataModified});const isAdvanced=this.props.context.siteSettings.canIUse("passwordExpiryPolicies"),errors=newSettings.validate(isAdvanced);this.setState({errors,settings:newSettings,isDataModified})}isProcessing(){return this.state.processing}isFeatureToggleEnabled(){return this.state.toggleEnabled}setFeatureToggle(toggleEnabled){this.props.context.siteSettings.canIUse("passwordExpiryPolicies")||this.setSettingsBulk({automatic_expiry:toggleEnabled,automatic_update:toggleEnabled}),this.setState({toggleEnabled})}validateData(){const isAdvanced=this.props.context.siteSettings.canIUse("passwordExpiryPolicies"),validationError=this.state.settings.validate(isAdvanced),hasErrors=validationError.hasErrors(),errors=hasErrors?validationError:null;return this.setState({errors,hasBeenValidated:!0}),!hasErrors}async save(){if(!this.isFeatureToggleEnabled()&&!this.state.settings.id)return;this.setState({processing:!0});const newState={processing:!1};try{const newSettings=!this.isFeatureToggleEnabled()&&Boolean(this.state.settings.id)?await this.doDeleteSettings():await this.doSaveSettings();newState.settings=newSettings,newState.currentSettings=newSettings,newState.isDataModified=!1,newState.submitted=!1}finally{this.setState(newState)}}async doDeleteSettings(){return this.props.context.port.request("passbolt.password-expiry.delete",this.state.settings.id),this.props.context.siteSettings.canIUse("passwordExpiryPolicies")?new passwordExpirySettings_PasswordExpirySettingsViewModel(passwordExpiryProSettingsEntity.createFromDefault().toDto()):new passwordExpirySettings_PasswordExpirySettingsViewModel}async doSaveSettings(){const isAdvanced=this.props.context.siteSettings.canIUse("passwordExpiryPolicies"),settings=this.state.settings.toEntityDto();isAdvanced&&!this.state.settings.default_expiry_period_toggle&&(settings.default_expiry_period=null);const passwordExpirySettingsEntityDto=await this.props.context.port.request("passbolt.password-expiry.save",settings);return new passwordExpirySettings_PasswordExpirySettingsViewModel(passwordExpirySettingsEntityDto)}getErrors(){return this.state.errors}hasSettingsChanges(){return this.state.isDataModified}render(){return react.createElement(AdministrationPasswordExpiryContext.Provider,{value:this.state},this.props.children)}}AdministrationPasswordExpiryContextProvider.propTypes={context:prop_types_default().any,children:prop_types_default().any,t:prop_types_default().any};const AdministrationPaswordExpiryContext=(0,AppContext.L)((0,es.CI)("common")(AdministrationPasswordExpiryContextProvider));function withAdminPasswordExpiry(WrappedComponent){return class WithAdminPasswordExpiryContext extends react.Component{render(){return react.createElement(AdministrationPasswordExpiryContext.Consumer,null,(adminPasswordExpiryContext=>react.createElement(WrappedComponent,{adminPasswordExpiryContext,...this.props})))}}}AdministrationPasswordExpiryContextProvider.__docgenInfo={description:"The Administration User passphrase Policies context provider",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"},{name:"findSettings",docblock:"Find the password expiry settings\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Find the password expiry settings"},{name:"setDefaultExpiryToggle",docblock:"Set the defaultExpiry toggle\n@returns {void}",modifiers:[],params:[{name:"value",optional:!1}],returns:{type:{name:"void"}},description:"Set the defaultExpiry toggle"},{name:"getSettings",docblock:"Returns the settings that have been fetch previously.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns the settings that have been fetch previously."},{name:"setSubmitted",docblock:"Set submitted variable\n@returns {object}",modifiers:[],params:[{name:"value",optional:!1}],returns:{type:{name:"object"}},description:"Set submitted variable"},{name:"isSubmitted",docblock:"Returns if the form has been submitted.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns if the form has been submitted."},{name:"setSettingsBulk",docblock:"Set given fields with the given values.",modifiers:[],params:[{name:"keyValuePairs",optional:!1}],returns:null,description:"Set given fields with the given values."},{name:"isProcessing",docblock:"Returns true if data is under processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true if data is under processing"},{name:"isFeatureToggleEnabled",docblock:"Returns true if the main toggle is enable\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true if the main toggle is enable"},{name:"setFeatureToggle",docblock:"Enable or disable the feature by the users\n@param toggleEnabled the toggle state\n@returns {boolean}",modifiers:[],params:[{name:"toggleEnabled",description:"the toggle state",optional:!1}],returns:{type:{name:"boolean"}},description:"Enable or disable the feature by the users"},{name:"validateData",docblock:"runs the current data validation\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"runs the current data validation"},{name:"save",docblock:"Saves the data on the API.\nCan actually save the current settings, or can ask for deletion of settings if the feature is disabled.\nIf an admin tries to delete the settings when there is no settings yet, nothing happens.\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Saves the data on the API.\nCan actually save the current settings, or can ask for deletion of settings if the feature is disabled.\nIf an admin tries to delete the settings when there is no settings yet, nothing happens."},{name:"doDeleteSettings",docblock:"Deletes the current settings\n@returns {Promise<PasswordExpirySettingsViewModel>}\n@private",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"PasswordExpirySettingsViewModel"}]}},description:"Deletes the current settings"},{name:"doSaveSettings",docblock:"Saves the current settings\n@returns {Promise<PasswordExpirySettingsViewModel>}\n@private",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"PasswordExpirySettingsViewModel"}]}},description:"Saves the current settings"},{name:"getErrors",docblock:"Returns the latest validation errors available\n@returns {EntityValidationError|null}",modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"EntityValidationError"}]}},description:"Returns the latest validation errors available"},{name:"hasSettingsChanges",docblock:"Returns true if the data has changed\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true if the data has changed"}],displayName:"AdministrationPasswordExpiryContextProvider",props:{context:{description:"",type:{name:"any"},required:!1},children:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"any"},required:!1}}}}}]);