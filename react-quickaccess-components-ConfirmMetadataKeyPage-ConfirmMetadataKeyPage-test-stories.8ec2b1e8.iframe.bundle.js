/*! For license information please see react-quickaccess-components-ConfirmMetadataKeyPage-ConfirmMetadataKeyPage-test-stories.8ec2b1e8.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[8162],{"./src/react-quickaccess/components/ConfirmMetadataKeyPage/ConfirmMetadataKeyPage.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MetadataKeyRollback:()=>MetadataKeyRollback,MetadataKeyRotation:()=>MetadataKeyRotation,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ConfirmMetadataKeyPage_test_stories});var v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js"),metadataKeyEntity_test_data=__webpack_require__("./src/shared/models/entity/metadata/metadataKeyEntity.test.data.js"),metadataTrustedKeyEntity_test_data=__webpack_require__("./src/shared/models/entity/metadata/metadataTrustedKeyEntity.test.data.js"),AppContext_test_data=__webpack_require__("./src/react-quickaccess/contexts/AppContext.test.data.js"),metadataTrustedKeyEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataTrustedKeyEntity.js"),metadataKeyEntity=__webpack_require__("./src/shared/models/entity/metadata/metadataKeyEntity.js");var react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),Icon=__webpack_require__("./src/shared/components/Icons/Icon.js"),spinner=__webpack_require__("./src/img/svg/spinner.svg"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),caret_down=__webpack_require__("./src/img/svg/caret_down.svg"),caret_right=__webpack_require__("./src/img/svg/caret_right.svg");class ConfirmMetadataKeyPage extends react.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{openMoreInformation:!1,processing:!1}}bindCallbacks(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleMoreInformationClicked=this.handleMoreInformationClicked.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}close(){this.props.context.port.emit(this.props.requestId,"SUCCESS",!1),this.props.onComplete()}handleCloseClick(){this.close()}handleMoreInformationClicked(){this.setState({openMoreInformation:!this.state.openMoreInformation})}async handleFormSubmit(event){event.preventDefault(),this.setState({processing:!0}),this.props.context.port.emit(this.props.requestId,"SUCCESS",!0),this.setState({processing:!1}),this.props.onComplete()}get isMetadataKeyRotation(){return null===this.props.metadataKey.metadataPrivateKeys?.items?.[0]?.dataSignedByCurrentUser}get translate(){return this.props.t}handleKeyDown(event){27===event.keyCode&&(event.stopPropagation(),this.close())}render(){const isMetadataKeyRotation=this.isMetadataKeyRotation,creatorName=this.props.metadataKey?.creator?react.createElement(react.Fragment,null,this.props.metadataKey?.creator?.profile?.name," (",this.props.metadataKey?.creator.username,")"):this.translate("Unknown User");return react.createElement("div",{className:"confirm-metadata-key",onKeyDown:this.handleKeyDown},react.createElement("div",{className:"back-link"},react.createElement("a",{className:"primary-action"},react.createElement("span",{className:"primary-action-title"},react.createElement(es.x6,null,"The metadata key has changed"))),react.createElement("a",{onClick:this.handleCloseClick,className:"secondary-action button-transparent button",title:this.translate("Cancel the operation")},react.createElement(Icon.A,{name:"close"}),react.createElement("span",{className:"visually-hidden"},react.createElement(es.x6,null,"Cancel")))),react.createElement("form",{onSubmit:this.handleFormSubmit},react.createElement("div",{className:"form-container"},react.createElement("p",null,react.createElement(es.x6,null,"The encryption key used to share metadata between users has been updated by ",react.createElement("span",{className:"creator"},{creatorName}),".")),react.createElement("p",null,isMetadataKeyRotation&&react.createElement(es.x6,null,"If you werenâ€™t expecting this, you can verify with your administrator."),!isMetadataKeyRotation&&react.createElement(es.x6,null,"This is unusual, please verify with your administrator.")),react.createElement("div",{className:"accordion accordion-section no-margin-divider no-padding-bottom"},react.createElement("div",{className:"accordion-header",onClick:this.handleMoreInformationClicked},react.createElement("h4",null,react.createElement("button",{type:"button",className:"no-border"},react.createElement("span",null,react.createElement(es.x6,null,"More information")),this.state.openMoreInformation?react.createElement(caret_down.A,{className:"baseline svg-icon"}):react.createElement(caret_right.A,{className:"baseline svg-icon"})))),this.state.openMoreInformation&&react.createElement("div",{className:"accordion-content"},react.createElement("p",null,isMetadataKeyRotation&&react.createElement(es.x6,null,"Your administrator may have rotated the metadata key and you need to trust it prior to its usage."),!isMetadataKeyRotation&&react.createElement(es.x6,null,"Your administrator may have rolled back the metadata key and you need to trust it prior to its usage.")),react.createElement("div",{className:"information-details"},react.createElement("div",{className:"info-type"},react.createElement(es.x6,null,"Key fingerprint")),react.createElement("div",{className:"info-data"},react.createElement("div",{className:"fingerprint"},react.createElement("div",{className:"fingerprint-line"},this.props.metadataKey.fingerprint?.substring(0,20)?.replace(/.{4}/g,"$& ")),react.createElement("div",{className:"fingerprint-line"},this.props.metadataKey.fingerprint?.substring(20)?.replace(/.{4}/g,"$& ")))))))),react.createElement("div",{className:"submit-wrapper"},react.createElement("button",{type:"submit",className:`button primary full-width ${this.state.processing?"processing":""} ${isMetadataKeyRotation?"attention":"warning"}`,disabled:this.state.processing},this.translate(isMetadataKeyRotation?"Trust the new key":"Trust the key"),this.state.processing&&react.createElement(spinner.A,null)))))}}ConfirmMetadataKeyPage.propTypes={context:prop_types_default().object,requestId:prop_types_default().string.isRequired,metadataKey:prop_types_default().object.isRequired,metadataTrustedKey:prop_types_default().object.isRequired,onComplete:prop_types_default().func,t:prop_types_default().func};const ConfirmMetadataKeyPage_ConfirmMetadataKeyPage=(0,AppContext.L)((0,es.CI)("common")(ConfirmMetadataKeyPage));ConfirmMetadataKeyPage.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Default state\n@returns {*}",modifiers:["get"],params:[],returns:{type:{name:"mixed"}},description:"Default state"},{name:"bindCallbacks",docblock:"Bind callbacks",modifiers:[],params:[],returns:null,description:"Bind callbacks"},{name:"close",docblock:"Close the dialog.",modifiers:[],params:[],returns:null,description:"Close the dialog."},{name:"handleCloseClick",docblock:"Handle close button click.",modifiers:[],params:[],returns:null,description:"Handle close button click."},{name:"handleMoreInformationClicked",docblock:"Handle more information button click.",modifiers:[],params:[],returns:null,description:"Handle more information button click."},{name:"handleFormSubmit",docblock:"Handle form submit event.\n@params {ReactEvent} The react event\n@return {Promise}",modifiers:["async"],params:[{name:"event",optional:!1}],returns:{type:{name:"Promise"}},description:"Handle form submit event."},{name:"isMetadataKeyRotation",docblock:"Is metadata key rotation\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Is metadata key rotation"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"},{name:"handleKeyDown",docblock:"Handle key down event\n@param {ReactEvent} event The triggered event",modifiers:[],params:[{name:"event",description:"The triggered event",type:{name:"ReactEvent"},optional:!1}],returns:null,description:"Handle key down event"}],displayName:"ConfirmMetadataKeyPage",props:{context:{description:"",type:{name:"object"},required:!1},requestId:{description:"",type:{name:"string"},required:!0},metadataKey:{description:"",type:{name:"object"},required:!0},metadataTrustedKey:{description:"",type:{name:"object"},required:!0},onComplete:{description:"",type:{name:"func"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};const ConfirmMetadataKeyPage_test_stories={title:"Components/QuickAccess/ConfirmMetadataKeyPage",component:ConfirmMetadataKeyPage_ConfirmMetadataKeyPage,decorators:[(Story,{args})=>react.createElement("div",{className:"container quickaccess"},react.createElement(Story,args))],parameters:{css:"ext_quickaccess"}},MetadataKeyRotation={args:function defaultProps(data={}){const metadataKeyDto=(0,metadataKeyEntity_test_data.Lq)({},{withMetadataPrivateKeys:!0});return delete metadataKeyDto.metadata_private_keys[0].data,metadataKeyDto.metadata_private_keys[0].data_signed_by_current_user="2025-04-24T10:39.000Z",{context:(0,AppContext_test_data.s)(),requestId:(0,v4.A)(),metadataTrustedKey:new metadataTrustedKeyEntity.A((0,metadataTrustedKeyEntity_test_data.Y)()),metadataKey:new metadataKeyEntity.A(metadataKeyDto,{validate:!1}),onComplete:jest.fn(),...data}}()},MetadataKeyRollback={args:function defaultPropsWithRollback(data={}){return{context:(0,AppContext_test_data.s)(),requestId:(0,v4.A)(),metadataTrustedKey:new metadataTrustedKeyEntity.A((0,metadataTrustedKeyEntity_test_data.Y)()),metadataKey:new metadataKeyEntity.A((0,metadataKeyEntity_test_data.Lq)(),{validate:!1}),onComplete:jest.fn(),...data}}()},__namedExportsOrder=["MetadataKeyRotation","MetadataKeyRollback"];MetadataKeyRotation.parameters={...MetadataKeyRotation.parameters,docs:{...MetadataKeyRotation.parameters?.docs,source:{originalSource:"{\n  args: defaultProps()\n}",...MetadataKeyRotation.parameters?.docs?.source}}},MetadataKeyRollback.parameters={...MetadataKeyRollback.parameters,docs:{...MetadataKeyRollback.parameters?.docs,source:{originalSource:"{\n  args: defaultPropsWithRollback()\n}",...MetadataKeyRollback.parameters?.docs?.source}}}},"./src/react-extension/test/fixture/Settings/userSettings.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={"user.settings.trustedDomain":new URL(window.location.href).origin,"user.firstname":"Ada","user.id":"f848277c-5398-58f8-a82a-72397af2d450","user.lastname":"Lovelace","user.settings.securityToken.code":"TST","user.settings.securityToken.color":"#000000","user.settings.securityToken.textColor":"#FFFFFF","user.username":"ada@passbolt.com","user.settings.locale":"en-UK","user.settings.theme":"default"}},"./src/react-quickaccess/contexts/AppContext.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>defaultAppContext});var _shared_lib_Settings_SiteSettings__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/lib/Settings/SiteSettings.js"),_react_extension_test_fixture_Settings_siteSettings__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/react-extension/test/fixture/Settings/siteSettings.js"),_react_extension_test_mock_MockPort__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/test/mock/MockPort.js"),_react_extension_test_mock_MockStorage__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/react-extension/test/mock/MockStorage.js"),_shared_lib_Settings_UserSettings__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/shared/lib/Settings/UserSettings.js"),_react_extension_test_fixture_Settings_userSettings__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/test/fixture/Settings/userSettings.js"),_shared_models_entity_user_userEntity_test_data__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/shared/models/entity/user/userEntity.test.data.js");function defaultAppContext(data={}){const siteSettings=new _shared_lib_Settings_SiteSettings__WEBPACK_IMPORTED_MODULE_0__.A(_react_extension_test_fixture_Settings_siteSettings__WEBPACK_IMPORTED_MODULE_1__.A);return{locale:"en-UK",userSettings:new _shared_lib_Settings_UserSettings__WEBPACK_IMPORTED_MODULE_4__.A(_react_extension_test_fixture_Settings_userSettings__WEBPACK_IMPORTED_MODULE_2__.A),siteSettings,port:new _react_extension_test_mock_MockPort__WEBPACK_IMPORTED_MODULE_5__.A,storage:new _react_extension_test_mock_MockStorage__WEBPACK_IMPORTED_MODULE_6__.A,loggedInUser:(0,_shared_models_entity_user_userEntity_test_data__WEBPACK_IMPORTED_MODULE_3__.cI)(),users:[],resources:[],focusSearch:jest.fn(),updateSearch:jest.fn(),getOpenerTabId:()=>1,search:"",searchHistory:{},...data}}},"./src/shared/models/entity/avatar/avatarEntity.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Fp:()=>defaultFullAvatarDto,KA:()=>defaultAvatarDto});var uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const defaultAvatarDto=(data={})=>({id:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.A)(),url:{medium:"/avatars/view/e6927385-195c-4c7f-a107-a202ea86de40/medium.jpg",small:"/avatars/view/e6927385-195c-4c7f-a107-a202ea86de40/small.jpg"},created:"2023-06-03T12:03:46+00:00",modified:"2023-06-03T12:03:46+00:00",...data}),defaultFullAvatarDto=(data={})=>({id:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.A)(),created:"2023-06-03T12:03:46+00:00",modified:"2023-06-03T12:03:46+00:00",user_id:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.A)(),foreign_key:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.A)(),model:"Avatar",filename:"carol.png",filesize:733439,mime_type:"image/png",extension:"png",hash:"7445a736df60a1ac1bfdab8fc5b842a95c495aec",path:"Avatar/60/6d/93/0519d40b29b94c79a68c8f933896c80d/0519d40b29b94c79a68c8f933896c80d.png",adapter:"Local",url:{medium:"img/public/Avatar/60/6d/93/0519d40b29b94c79a68c8f933896c80d/0519d40b29b94c79a68c8f933896c80d.a99472d5.png",small:"img/public/Avatar/60/6d/93/0519d40b29b94c79a68c8f933896c80d/0519d40b29b94c79a68c8f933896c80d.65a0ba70.png"},...data})},"./src/shared/models/entity/groupUser/groupUserEntity.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M2:()=>defaultGroupUser});var uuid__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");__webpack_require__("./src/shared/models/entity/user/userEntity.test.data.js");const defaultGroupUser=(data={})=>({id:(0,uuid__WEBPACK_IMPORTED_MODULE_1__.A)(),user_id:(0,uuid__WEBPACK_IMPORTED_MODULE_1__.A)(),group_id:(0,uuid__WEBPACK_IMPORTED_MODULE_1__.A)(),is_admin:!1,created:"2022-01-13T13:19:04.661Z",...data})},"./src/shared/models/entity/profile/ProfileEntity.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>defaultProfileDto});var uuid__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js"),_avatar_avatarEntity_test_data__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/models/entity/avatar/avatarEntity.test.data.js");const defaultProfileDto=(data={})=>({id:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.A)(),user_id:(0,uuid__WEBPACK_IMPORTED_MODULE_0__.A)(),first_name:"Ada",last_name:"Lovelace",created:"2020-04-20T11:32:17+00:00",modified:"2020-04-20T11:32:17+00:00",avatar:(0,_avatar_avatarEntity_test_data__WEBPACK_IMPORTED_MODULE_1__.KA)(),...data})},"./src/shared/models/entity/role/roleEntity.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/shared/models/entity/abstract/entityV2.js");class RoleEntity extends _abstract_entityV2__WEBPACK_IMPORTED_MODULE_0__.A{static getSchema(){return{type:"object",required:["id","name"],properties:{id:{type:"string",format:"uuid"},name:{type:"string",enum:[RoleEntity.ROLE_ADMIN,RoleEntity.ROLE_USER,RoleEntity.ROLE_GUEST,RoleEntity.ROLE_ROOT]},description:{type:"string",maxLength:255},created:{type:"string",format:"date-time"},modified:{type:"string",format:"date-time"}}}}get id(){return this._props.id}get name(){return this._props.name}get description(){return this._props.description||null}get created(){return this._props.created||null}get modified(){return this._props.modified||null}isAdmin(){return this.name===RoleEntity.ROLE_ADMIN}static get ENTITY_NAME(){return"Role"}static get ROLE_ADMIN(){return"admin"}static get ROLE_USER(){return"user"}static get ROLE_GUEST(){return"guest"}static get ROLE_ROOT(){return"root"}}const __WEBPACK_DEFAULT_EXPORT__=RoleEntity},"./src/shared/models/entity/user/userEntity.test.data.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{HI:()=>defaultAdminUserDto,cI:()=>defaultUserDto,VV:()=>users});var v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js"),ProfileEntity_test_data=__webpack_require__("./src/shared/models/entity/profile/ProfileEntity.test.data.js"),role_test_data=__webpack_require__("./src/shared/models/entity/role/role.test.data.js"),groupUserEntity_test_data=__webpack_require__("./src/shared/models/entity/groupUser/groupUserEntity.test.data.js"),keys=__webpack_require__("./test/fixture/pgpKeys/keys.js");const defaultUserDto=(data={},options={})=>{const defaultData={id:(0,v4.A)(),role_id:role_test_data.ol,username:"ada@passbolt.com",active:!0,deleted:!1,created:"2020-04-20T11:32:16+00:00",modified:"2020-04-20T11:32:16+00:00",last_logged_in:"2022-07-04T13:39:25+00:00",is_mfa_enabled:!1,...data};!data.role&&options?.withRole&&(defaultData.role=(0,role_test_data.Dm)({id:defaultData.role_id}));const profile=data?.profile||(0,ProfileEntity_test_data.S)({user_id:defaultData.id,...data?.profile});if(defaultData.profile=profile,!data.groups_users&&options?.withGroupsUsers){const groupsUsersCount="number"==typeof options?.withGroupsUsers?options?.withGroupsUsers:1;defaultData.groups_users=[];for(let i=0;i<groupsUsersCount;i++){const groupUserDto=(0,groupUserEntity_test_data.M2)({user_id:defaultData.id});defaultData.groups_users.push(groupUserDto)}}return!data.gpgkey&&options?.withGpgkey&&(defaultData.gpgkey=((data={})=>({id:"91d8a7fd-3ab3-5e98-a4a5-0d8694ff23b9",user_id:"d57c10f5-639d-5160-9c81-8a0c6c4ec856",armored_key:keys.u.ada.public,bits:4096,uid:"Passbolt Default Admin <admin@passbolt.com>",key_id:"D06426D3",fingerprint:"0C1D1761110D1E33C9006D1A5B1B332ED06426D3",type:"RSA",expires:null,key_created:"2015-10-31T16:21:43+00:00",deleted:!1,created:"2020-04-20T11:32:18+00:00",modified:"2020-04-20T11:32:18+00:00",...data}))()),!data.account_recovery_user_setting&&options?.withAccountRecoveryUserSetting&&(defaultData.account_recovery_user_setting=(data=>{const defaultData={user_id:(0,v4.A)(),status:"approved"};return Object.assign(defaultData,data||{})})()),!data.pending_account_recovery_request&&options?.withPendingAccountRecoveryUserRequest&&(defaultData.pending_account_recovery_request=((data={})=>({id:(0,v4.A)(),status:"pending",created:"2020-05-04T20:31:45+00:00",modified:"2020-05-04T20:31:45+00:00",created_by:(0,v4.A)(),modified_by:(0,v4.A)(),...data}))()),defaultData},defaultAdminUserDto=(data={})=>{const role=(0,role_test_data.bd)();return defaultUserDto({role,...data})},users={ada:defaultUserDto({id:"f848277c-5398-58f8-a82a-72397af2d450",username:"ada@passbolt.com",profile:(0,ProfileEntity_test_data.S)({first_name:"Ada",last_name:"Lovelace"})}),admin:defaultAdminUserDto({id:"f642271d-bbb1-401e-bbd1-7ec370f8e19b",username:"admin@passbolt.com",profile:(0,ProfileEntity_test_data.S)({first_name:"Admin",last_name:"User"})}),betty:defaultUserDto({id:"e97b14ba-8957-57c9-a357-f78a6e1e1a46",username:"betty@passbolt.com",profile:(0,ProfileEntity_test_data.S)({first_name:"Betty",last_name:"Holberton"})})}}}]);