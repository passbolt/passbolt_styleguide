/*! For license information please see react-extension-components-Administration-ManageAccountRecoveryAdministrationSettings-ManageAccountRecoveryAdministrationSettings-test-stories.2147a67c.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[2289],{"./src/react-extension/components/Administration/ManageAccountRecoveryAdministrationSettings/ManageAccountRecoveryAdministrationSettings.test.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,DefaultWithOrganisationRecoveryKey:()=>DefaultWithOrganisationRecoveryKey,Mandatory:()=>Mandatory,MandatoryWithOrganisationRecoveryKey:()=>MandatoryWithOrganisationRecoveryKey,OptIn:()=>OptIn,OptInWithOrganisationRecoveryKey:()=>OptInWithOrganisationRecoveryKey,OptOut:()=>OptOut,OptOutWithOrganisationRecoveryKey:()=>OptOutWithOrganisationRecoveryKey,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ManageAccountRecoveryAdministrationSettings_test_stories});var react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),react=__webpack_require__("./node_modules/react/index.js"),prop_types=__webpack_require__("./node_modules/prop-types/index.js"),prop_types_default=__webpack_require__.n(prop_types),Icon=__webpack_require__("./src/shared/components/Icons/Icon.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),AppContext=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),AccountRecoveryUserContext=__webpack_require__("./src/react-extension/contexts/AccountRecoveryUserContext.js");const AdminAccountRecoveryContext=react.createContext({currentPolicy:null,policyChanges:{},findAccountRecoveryPolicy:()=>{},getKeyInfo:()=>{},changePolicy:()=>{},changePublicKey:()=>{},hasPolicyChanges:()=>{},resetChanges:()=>{},downloadPrivateKey:()=>{},save:()=>{}});class AdminAccountRecoveryContextProvider extends react.Component{constructor(props){super(props),this.state=this.defaultState}get defaultState(){return{currentPolicy:null,policyChanges:{},findAccountRecoveryPolicy:this.findAccountRecoveryPolicy.bind(this),getKeyInfo:this.getKeyInfo.bind(this),changePolicy:this.changePolicy.bind(this),changePublicKey:this.changePublicKey.bind(this),hasPolicyChanges:this.hasPolicyChanges.bind(this),resetChanges:this.resetChanges.bind(this),downloadPrivateKey:this.downloadPrivateKey.bind(this),save:this.save.bind(this)}}async findAccountRecoveryPolicy(){if(!this.props.context.siteSettings.canIUse("accountRecovery"))return;const currentPolicy=await this.props.context.port.request("passbolt.account-recovery.get-organization-policy");this.setState({currentPolicy})}async changePolicy(policy){const policyChanges=this.state.policyChanges;policy===this.state.currentPolicy?.policy?delete policyChanges.policy:policyChanges.policy=policy,"disabled"===policy&&delete policyChanges.publicKey,await this.setState({policyChanges})}async changePublicKey(publicKey){const policyChanges={...this.state.policyChanges,publicKey};await this.setState({policyChanges})}hasPolicyChanges(){return Boolean(this.state.policyChanges?.publicKey)||Boolean(this.state.policyChanges?.policy)}async getKeyInfo(armoredKey){return armoredKey?this.props.context.port.request("passbolt.keyring.get-key-info",armoredKey):null}async resetChanges(){await this.setState({policyChanges:{}})}async downloadPrivateKey(privateKey){await this.props.context.port.request("passbolt.account-recovery.download-organization-generated-key",privateKey)}async save(privateGpgKeyDto){const policySaveDto=this.buildPolicySaveDto(),currentPolicy=await this.props.context.port.request("passbolt.account-recovery.save-organization-policy",policySaveDto,privateGpgKeyDto);this.setState({currentPolicy,policyChanges:{}}),this.props.accountRecoveryContext.reloadAccountRecoveryPolicy()}buildPolicySaveDto(){const policySaveDto={};return this.state.policyChanges.policy&&(policySaveDto.policy=this.state.policyChanges.policy),this.state.policyChanges.publicKey&&(policySaveDto.account_recovery_organization_public_key={armored_key:this.state.policyChanges.publicKey}),policySaveDto}render(){return react.createElement(AdminAccountRecoveryContext.Provider,{value:this.state},this.props.children)}}AdminAccountRecoveryContextProvider.propTypes={context:prop_types_default().any,children:prop_types_default().any,accountRecoveryContext:prop_types_default().object};(0,AppContext.L)((0,AccountRecoveryUserContext.Le)(AdminAccountRecoveryContextProvider));function withAdminAccountRecovery(WrappedComponent){return class WithAdminAccountRecovery extends react.Component{render(){return react.createElement(AdminAccountRecoveryContext.Consumer,null,(adminAccountRecoveryContext=>react.createElement(WrappedComponent,{adminAccountRecoveryContext,...this.props})))}}}AdminAccountRecoveryContextProvider.__docgenInfo={description:"The related context provider",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"},{name:"findAccountRecoveryPolicy",docblock:"Find the account recovery policy\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Find the account recovery policy"},{name:"changePolicy",docblock:"Change the policy\n@param {string} policy The new policy. Any of: mandatory, opt-out, opt-in, disable.\n@return {Promise<void>}",modifiers:["async"],params:[{name:"policy",description:"The new policy. Any of: mandatory, opt-out, opt-in, disable.",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Change the policy"},{name:"changePublicKey",docblock:"Change the public key\n@param {string} publicKey The new public key in armored format.\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"publicKey",description:"The new public key in armored format.",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Change the public key"},{name:"hasPolicyChanges",docblock:"Check if there are changes to apply\n@returns {Boolean}",modifiers:[],params:[],returns:{type:{name:"Boolean"}},description:"Check if there are changes to apply"},{name:"getKeyInfo",docblock:"Get the key info.\n@param {object} armoredKey The account recovery organization key\n@returns {Promise<object>} The key info dto",modifiers:["async"],params:[{name:"armoredKey",description:"The account recovery organization key",type:{name:"object"},optional:!1}],returns:{description:"The key info dto",type:{name:"Promise",elements:[{name:"object"}]}},description:"Get the key info."},{name:"resetChanges",docblock:"Reset the policy changes",modifiers:["async"],params:[],returns:null,description:"Reset the policy changes"},{name:"downloadPrivateKey",docblock:"Whenever the user wants to download the newly generated organization private key\n@param {string} privateKey The organization private key\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"privateKey",description:"The organization private key",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Whenever the user wants to download the newly generated organization private key"},{name:"save",docblock:"Whenever the save has been requested\n@param {string} privateGpgKeyDto The current organization private key",modifiers:["async"],params:[{name:"privateGpgKeyDto",description:"The current organization private key",type:{name:"string"},optional:!1}],returns:null,description:"Whenever the save has been requested"},{name:"buildPolicySaveDto",docblock:"Build the policy save dto.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Build the policy save dto."}],displayName:"AdminAccountRecoveryContextProvider",props:{context:{description:"",type:{name:"any"},required:!1},children:{description:"",type:{name:"any"},required:!1},accountRecoveryContext:{description:"",type:{name:"object"},required:!1}}};var WorkflowContext=__webpack_require__("./src/react-extension/contexts/WorkflowContext.js"),DialogContext=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),ProvideAccountRecoveryOrganizationKey=__webpack_require__("./src/react-extension/components/Administration/ProvideAccountRecoveryOrganizationKey/ProvideAccountRecoveryOrganizationKey.js"),ConfirmSaveAccountRecoverySettings=__webpack_require__("./src/react-extension/components/Administration/ConfirmSaveAccountRecoverySettings/ConfirmSaveAccountRecoverySettings.js"),ActionFeedbackContext=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),NotifyError=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js");class HandleSaveAccountRecoveryOrganizationPolicyWorkflow extends react.Component{constructor(props){super(props),this.bindCallbacks()}componentDidMount(){this.displayConfirmSummaryDialog()}bindCallbacks(){this.handleCloseDialog=this.handleCloseDialog.bind(this),this.handleConfirmSave=this.handleConfirmSave.bind(this),this.handleSave=this.handleSave.bind(this),this.handleError=this.handleError.bind(this)}async displayConfirmSummaryDialog(){this.props.dialogContext.open(ConfirmSaveAccountRecoverySettings.A,{policy:this.props.adminAccountRecoveryContext.policyChanges?.policy,keyInfo:await this.getNewOrganizationKeyInfo(),onClose:this.handleCloseDialog,onSubmit:this.handleConfirmSave})}getNewOrganizationKeyInfo(){const organizationKey=this.props.adminAccountRecoveryContext.policyChanges?.publicKey;return organizationKey?this.props.adminAccountRecoveryContext.getKeyInfo(organizationKey):null}displayProvideAccountRecoveryOrganizationKeyDialog(){this.props.dialogContext.open(ProvideAccountRecoveryOrganizationKey.A,{onClose:this.handleCloseDialog,onSubmit:this.handleSave})}handleCloseDialog(){this.props.onStop()}async handleConfirmSave(){Boolean(this.props.adminAccountRecoveryContext.currentPolicy?.account_recovery_organization_public_key)?this.displayProvideAccountRecoveryOrganizationKeyDialog():await this.handleSave()}async handleSave(privateGpgKeyDto=null){try{await this.props.adminAccountRecoveryContext.save(privateGpgKeyDto),await this.props.actionFeedbackContext.displaySuccess(this.translate("The organization recovery policy has been updated successfully")),this.props.onStop()}catch(error){this.handleError(error)}}handleError(error){if(["UserAbortsOperationError","WrongOrganizationRecoveryKeyError","InvalidMasterPasswordError","BadSignatureMessageGpgKeyError","GpgKeyError"].includes(error.name))throw error;"PassboltApiFetchError"===error.name&&error?.data?.body?.account_recovery_organization_public_key?.fingerprint?.isNotAccountRecoveryOrganizationPublicKeyFingerprintRule?this.props.dialogContext.open(NotifyError.A,{error:new Error(this.translate("The new organization recovery key should not be a formerly used organization recovery key."))}):this.props.dialogContext.open(NotifyError.A,{error}),this.props.onStop()}get translate(){return this.props.t}render(){return react.createElement(react.Fragment,null)}}HandleSaveAccountRecoveryOrganizationPolicyWorkflow.propTypes={dialogContext:prop_types_default().any,adminAccountRecoveryContext:prop_types_default().any,actionFeedbackContext:prop_types_default().object,context:prop_types_default().object,onStop:prop_types_default().func.isRequired,t:prop_types_default().func};const HandleSaveAccountRecoveryOrganizationPolicyWorkflow_HandleSaveAccountRecoveryOrganizationPolicyWorkflow=(0,AppContext.L)((0,DialogContext.z9)((0,ActionFeedbackContext.ot)(withAdminAccountRecovery((0,es.CI)("common")(HandleSaveAccountRecoveryOrganizationPolicyWorkflow)))));HandleSaveAccountRecoveryOrganizationPolicyWorkflow.__docgenInfo={description:"This component handle the account recovery organization policy save.",methods:[{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"displayConfirmSummaryDialog",docblock:"Display the confirmation summary dialog\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Display the confirmation summary dialog"},{name:"getNewOrganizationKeyInfo",docblock:"Get the new organization public key info.\n@returns {Promise<null|object>}",modifiers:[],params:[],returns:{type:{name:"Promise",elements:[{name:"union",elements:[{name:"object"}]}]}},description:"Get the new organization public key info."},{name:"displayProvideAccountRecoveryOrganizationKeyDialog",docblock:"Display the capture account recovery organization key dialog dialog\n@returns {Promise<void>}",modifiers:[],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Display the capture account recovery organization key dialog dialog"},{name:"handleCloseDialog",docblock:"Whenever the user close a dialog, stop the workflow.",modifiers:[],params:[],returns:null,description:"Whenever the user close a dialog, stop the workflow."},{name:"handleConfirmSave",docblock:"Handle the confirmation.\n@return {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Handle the confirmation."},{name:"handleSave",docblock:"Handle the actual registration of the new ORK.\n@param {Object|null} privateGpgKeyDto the private ORK given by the admin if any.",modifiers:["async"],params:[{name:"privateGpgKeyDto",description:"the private ORK given by the admin if any.",type:{name:"union",elements:[{name:"Object"}]},optional:!0}],returns:null,description:"Handle the actual registration of the new ORK."},{name:"handleError",docblock:"Handle error\n@param error",modifiers:[],params:[{name:"error",optional:!1}],returns:null,description:"Handle error"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"HandleSaveAccountRecoveryOrganizationPolicyWorkflow",props:{dialogContext:{description:"",type:{name:"any"},required:!1},adminAccountRecoveryContext:{description:"",type:{name:"any"},required:!1},actionFeedbackContext:{description:"",type:{name:"object"},required:!1},context:{description:"",type:{name:"object"},required:!1},onStop:{description:"",type:{name:"func"},required:!0},t:{description:"",type:{name:"func"},required:!1}}};class DisplayAdministrationWorkspaceActions extends react.Component{constructor(props){super(props),this.bindCallbacks()}bindCallbacks(){this.handleSaveClick=this.handleSaveClick.bind(this),this.handleEditSubscriptionClick=this.handleEditSubscriptionClick.bind(this)}handleSaveClick(){this.props.workflowContext.start(HandleSaveAccountRecoveryOrganizationPolicyWorkflow_HandleSaveAccountRecoveryOrganizationPolicyWorkflow,{})}handleEditSubscriptionClick(){this.props.adminAccountRecoveryContext.resetChanges()}isSaveEnabled(){if(!this.props.adminAccountRecoveryContext.hasPolicyChanges())return!1;const changes=this.props.adminAccountRecoveryContext.policyChanges,currentPolicy=this.props.adminAccountRecoveryContext.currentPolicy;if(changes?.policy===AccountRecoveryUserContext.On.POLICY_DISABLED)return!0;const effectiveOrk=changes.publicKey||currentPolicy.account_recovery_organization_public_key?.armored_key;return!(!Boolean(changes.policy)||!Boolean(effectiveOrk))||currentPolicy.policy!==AccountRecoveryUserContext.On.POLICY_DISABLED&&Boolean(changes.publicKey)}isResetEnabled(){return this.props.adminAccountRecoveryContext.hasPolicyChanges()}render(){return react.createElement("div",{className:"col2_3 actions-wrapper"},react.createElement("div",{className:"actions"},react.createElement("ul",null,react.createElement("li",null,react.createElement("button",{type:"button",disabled:!this.isSaveEnabled(),onClick:this.handleSaveClick},react.createElement(Icon.A,{name:"save"}),react.createElement("span",null,react.createElement(es.x6,null,"Save settings")))),react.createElement("li",null,react.createElement("button",{type:"button",disabled:!this.isResetEnabled(),onClick:this.handleEditSubscriptionClick},react.createElement(Icon.A,{name:"edit"}),react.createElement("span",null,react.createElement(es.x6,null,"Reset settings")))))))}}DisplayAdministrationWorkspaceActions.propTypes={adminAccountRecoveryContext:prop_types_default().object,workflowContext:prop_types_default().any};const DisplayAdministrationAccountRecoveryActions=(0,WorkflowContext.AV)(withAdminAccountRecovery((0,es.CI)("common")(DisplayAdministrationWorkspaceActions)));DisplayAdministrationWorkspaceActions.__docgenInfo={description:"This component is a container of multiple actions applicable on setting",methods:[{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"handleSaveClick",docblock:"Handle save settings",modifiers:[],params:[],returns:null,description:"Handle save settings"},{name:"handleEditSubscriptionClick",docblock:"Handle reset account recovery policy settings",modifiers:[],params:[],returns:null,description:"Handle reset account recovery policy settings"},{name:"isSaveEnabled",docblock:"Is save button enable\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Is save button enable"},{name:"isResetEnabled",docblock:"Is save button enable",modifiers:[],params:[],returns:null,description:"Is save button enable"}],displayName:"DisplayAdministrationWorkspaceActions",props:{adminAccountRecoveryContext:{description:"",type:{name:"object"},required:!1},workflowContext:{description:"",type:{name:"any"},required:!1}}};var AdministrationWorkspaceContext=__webpack_require__("./src/react-extension/contexts/AdministrationWorkspaceContext.js"),SelectAccountRecoveryOrganizationKey=__webpack_require__("./src/react-extension/components/Administration/SelectAccountRecoveryOrganizationKey/SelectAccountRecoveryOrganizationKey.js"),DownloadOrganizationKey=__webpack_require__("./src/react-extension/components/Administration/SelectAccountRecoveryOrganizationKey/DownloadOrganizationKey.js"),dateUtils=__webpack_require__("./src/shared/utils/dateUtils.js");class ManageAccountRecoveryAdministrationSettings extends react.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{keyInfoDto:null,loading:!0,processing:!1}}async componentDidMount(){this.props.administrationWorkspaceContext.setDisplayAdministrationWorkspaceAction(DisplayAdministrationAccountRecoveryActions),this.findAccountRecoveryPolicy()}componentWillUnmount(){this.props.administrationWorkspaceContext.resetDisplayAdministrationWorkspaceAction(),this.props.adminAccountRecoveryContext.resetChanges()}async componentDidUpdate(){const publicArmoredKey=this.props?.adminAccountRecoveryContext?.policyChanges?.publicKey||this.props?.adminAccountRecoveryContext?.currentPolicy?.account_recovery_organization_public_key?.armored_key,keyInfoDto=await(this.props?.adminAccountRecoveryContext?.getKeyInfo(publicArmoredKey));Boolean(publicArmoredKey)&&this.state.keyInfoDto?.fingerprint!==keyInfoDto?.fingerprint?this.setState({keyInfoDto}):!publicArmoredKey&&this.state.keyInfoDto&&this.setState({keyInfoDto:null})}bindCallbacks(){this.handlePolicyInputChange=this.handlePolicyInputChange.bind(this),this.HandleUpdatePublicKeyClick=this.HandleUpdatePublicKeyClick.bind(this),this.handleUpdateOrganizationKey=this.handleUpdateOrganizationKey.bind(this),this.downloadPrivateKey=this.downloadPrivateKey.bind(this)}get policy(){return this.props.adminAccountRecoveryContext.policyChanges.policy||this.props.adminAccountRecoveryContext.currentPolicy?.policy}get organizationKey(){return this.props.adminAccountRecoveryContext.policyChanges.publicKey||this.props.adminAccountRecoveryContext.currentPolicy?.account_recovery_organization_public_key.armored_key}get organizationKeyInfo(){return this.state.keyInfoDto}async findAccountRecoveryPolicy(){await this.props.adminAccountRecoveryContext.findAccountRecoveryPolicy(),this.setState({loading:!1})}async handlePolicyInputChange(event){const policy=event.target.value;"disabled"===policy&&this.resetKeyInfo(),await this.props.adminAccountRecoveryContext.changePolicy(policy)}HandleUpdatePublicKeyClick(){this.props.dialogContext.open(SelectAccountRecoveryOrganizationKey.A,{handleUpdateOrganizationKey:this.handleUpdateOrganizationKey})}async handleUpdateOrganizationKey(publicKey,privateKey){this.resetKeyInfo(),await this.props.adminAccountRecoveryContext.changePublicKey(publicKey),privateKey&&await this.downloadPrivateKey(privateKey)}async downloadPrivateKey(privateKey){await this.props.adminAccountRecoveryContext.downloadPrivateKey(privateKey),this.props.dialogContext.open(DownloadOrganizationKey.A,{privateKey,handleDownloadAgain:async()=>{await this.props.adminAccountRecoveryContext.downloadPrivateKey(privateKey)}})}hasAllInputDisabled(){return this.state.processing||this.state.loading}hasOrganisationRecoveryKey(){const publicORK=this.state.keyInfoDto;return Boolean(publicORK)}isPolicyEnabled(){return Boolean("disabled"!==this.policy)}resetKeyInfo(){this.setState({keyInfoDto:null})}async toggleProcessing(){this.setState({processing:!this.state.processing})}formatFingerprint(fingerprint){if(!fingerprint)return null;const result=fingerprint.toUpperCase().replace(/.{4}/g,"$& ");return react.createElement(react.Fragment,null,result.substr(0,24),react.createElement("br",null),result.substr(25))}formatUserIds(user_ids){return user_ids?user_ids.map(((user,id)=>react.createElement(react.Fragment,{key:id},user.name," <",user.email,">",react.createElement("br",null)))):null}get translate(){return this.props.t}render(){return react.createElement("div",{className:"row"},react.createElement("div",{className:"recover-account-settings col8 main-column"},react.createElement("h3",null,react.createElement(es.x6,null,"Account Recovery")),this.props.adminAccountRecoveryContext.hasPolicyChanges()&&react.createElement("div",{className:"warning message",id:"email-notification-setting-overridden-banner"},react.createElement("p",null,react.createElement(es.x6,null,"Don't forget to save your settings to apply your modification."))),!this.hasOrganisationRecoveryKey()&&this.isPolicyEnabled()&&react.createElement("div",{className:"warning message",id:"email-notification-setting-overridden-banner"},react.createElement("p",null,react.createElement(es.x6,null,"Warning, Don't forget to add an organization recovery key."))),react.createElement("form",{className:"form"},react.createElement("h4",{className:"no-border"},react.createElement(es.x6,null,"Account Recovery Policy")),react.createElement("p",null,react.createElement(es.x6,null,"In this section you can choose the default behavior of account recovery for all users.")),react.createElement("div",{className:"radiolist-alt"},react.createElement("div",{className:"input radio "+("mandatory"===this.policy?"checked":"")},react.createElement("input",{type:"radio",value:"mandatory",onChange:this.handlePolicyInputChange,name:"accountRecoveryPolicy",checked:"mandatory"===this.policy,id:"accountRecoveryPolicyMandatory",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"accountRecoveryPolicyMandatory"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Prompt")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Every user is required to provide a copy of their private key and passphrase during setup."),react.createElement("br",null),react.createElement(es.x6,null,"You should inform your users not to store personal passwords.")))),react.createElement("div",{className:"input radio "+("opt-out"===this.policy?"checked":"")},react.createElement("input",{type:"radio",value:"opt-out",onChange:this.handlePolicyInputChange,name:"accountRecoveryPolicy",checked:"opt-out"===this.policy,id:"accountRecoveryPolicyOptOut",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"accountRecoveryPolicyOptOut"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Optional, Opt-out")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Every user will be prompted to provide a copy of their private key and passphrase by default during the setup, but they can opt out.")))),react.createElement("div",{className:"input radio "+("opt-in"===this.policy?"checked":"")},react.createElement("input",{type:"radio",value:"opt-in",onChange:this.handlePolicyInputChange,name:"accountRecoveryPolicy",checked:"opt-in"===this.policy,id:"accountRecoveryPolicyOptIn",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"accountRecoveryPolicyOptIn"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Optional, Opt-in")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Every user can decide to provide a copy of their private key and passphrase by default during the setup, but they can opt in.")))),react.createElement("div",{className:"input radio "+("disabled"===this.policy?"checked":"")},react.createElement("input",{type:"radio",value:"disabled",onChange:this.handlePolicyInputChange,name:"accountRecoveryPolicy",checked:"disabled"===this.policy,id:"accountRecoveryPolicyDisable",disabled:this.hasAllInputDisabled()}),react.createElement("label",{htmlFor:"accountRecoveryPolicyDisable"},react.createElement("span",{className:"name"},react.createElement(es.x6,null,"Disable (Default)")),react.createElement("span",{className:"info"},react.createElement(es.x6,null,"Backup of the private key and passphrase will not be stored. This is the safest option."),react.createElement(es.x6,null,"If users lose their private key and passphrase they will not be able to recover their account."))))),react.createElement("h4",null,react.createElement("span",{className:"input toggle-switch form-element "},react.createElement("input",{type:"checkbox",className:"toggle-switch-checkbox checkbox",name:"organisationRecoveryKeyToggle",disabled:this.hasAllInputDisabled(),checked:this.isPolicyEnabled(),id:"recovery-key-toggle-button"}),react.createElement("label",{htmlFor:"recovery-key-toggle-button"},react.createElement(es.x6,null,"Organization Recovery Key")))),this.isPolicyEnabled()&&react.createElement(react.Fragment,null,react.createElement("p",null,react.createElement(es.x6,null,"Your organization recovery key will be used to decrypt and recover the private key and passphrase of the users that are participating in the account recovery program.")," ",react.createElement(es.x6,null,"The organization private recovery key should not be stored in passbolt.")," ",react.createElement(es.x6,null,"You should keep it offline in a safe place.")),react.createElement("div",{className:"recovery-key-details"},react.createElement("table",{className:"table-info recovery-key"},react.createElement("tbody",null,react.createElement("tr",{className:"user-ids"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"User ids")),this.organizationKeyInfo?.user_ids&&react.createElement("td",{className:"value"},this.formatUserIds(this.organizationKeyInfo.user_ids)),!this.organizationKeyInfo?.user_ids&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"not available")),react.createElement("td",{className:"table-button"},react.createElement("button",{className:"button primary medium",type:"button",disabled:this.hasAllInputDisabled(),onClick:this.HandleUpdatePublicKeyClick},this.hasOrganisationRecoveryKey()&&react.createElement(es.x6,null,"Rotate Key"),!this.hasOrganisationRecoveryKey()&&react.createElement(es.x6,null,"Add an Organization Recovery Key")))),react.createElement("tr",{className:"fingerprint"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Fingerprint")),this.organizationKeyInfo?.fingerprint&&react.createElement("td",{className:"value"},this.formatFingerprint(this.organizationKeyInfo.fingerprint)),!this.organizationKeyInfo?.fingerprint&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"not available"))),react.createElement("tr",{className:"algorithm"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Algorithm")),this.organizationKeyInfo?.algorithm&&react.createElement("td",{className:"value"},this.organizationKeyInfo.algorithm),!this.organizationKeyInfo?.algorithm&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"not available"))),react.createElement("tr",{className:"key-length"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Key length")),this.organizationKeyInfo?.length&&react.createElement("td",{className:"value"},this.organizationKeyInfo.length),!this.organizationKeyInfo?.length&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"not available"))),react.createElement("tr",{className:"created"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Created")),this.organizationKeyInfo?.created&&react.createElement("td",{className:"value"},(0,dateUtils.kD)(this.organizationKeyInfo.created,this.props.t,this.props.context.locale)),!this.organizationKeyInfo?.created&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"not available"))),react.createElement("tr",{className:"expires"},react.createElement("td",{className:"label"},react.createElement(es.x6,null,"Expires")),this.organizationKeyInfo?.expires&&react.createElement("td",{className:"value"},(0,dateUtils.kD)(this.organizationKeyInfo.expires,this.props.t,this.props.context.locale)),!this.organizationKeyInfo?.expires&&react.createElement("td",{className:"empty-value"},react.createElement(es.x6,null,"not available"))))))))),react.createElement("div",{className:"col4 last"},react.createElement("div",{className:"sidebar-help"},react.createElement("h3",null,react.createElement(es.x6,null,"Need some help?")),react.createElement("p",null,react.createElement(es.x6,null,"For more information about account recovery, checkout the dedicated page on the help website.")),react.createElement("a",{className:"button",href:"https://passbolt.com/docs/admin/authentication/account-recovery/",target:"_blank",rel:"noopener noreferrer"},react.createElement(Icon.A,{name:"life-ring"}),react.createElement("span",null,react.createElement(es.x6,null,"Read the documentation"))))))}}ManageAccountRecoveryAdministrationSettings.propTypes={context:prop_types_default().object,dialogContext:prop_types_default().any,administrationWorkspaceContext:prop_types_default().object,adminAccountRecoveryContext:prop_types_default().object,t:prop_types_default().func};const ManageAccountRecoveryAdministrationSettings_ManageAccountRecoveryAdministrationSettings=(0,AppContext.L)((0,DialogContext.z9)((0,AdministrationWorkspaceContext.Kk)(withAdminAccountRecovery((0,es.CI)("common")(ManageAccountRecoveryAdministrationSettings)))));ManageAccountRecoveryAdministrationSettings.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Get default state\n@returns {Object}",modifiers:["get"],params:[],returns:{type:{name:"Object"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"policy",docblock:"Get the account recovery policy\n@returns {null|string}",modifiers:["get"],params:[],returns:{type:{name:"union",elements:[{name:"string"}]}},description:"Get the account recovery policy"},{name:"organizationKey",docblock:"Get the account recovery organization public key.\n@returns {null|string} The armored organization public key.",modifiers:["get"],params:[],returns:{description:"The armored organization public key.",type:{name:"union",elements:[{name:"string"}]}},description:"Get the account recovery organization public key."},{name:"organizationKeyInfo",docblock:"Get the account recovery organization key info\n@returns {null|object}",modifiers:["get"],params:[],returns:{type:{name:"union",elements:[{name:"object"}]}},description:"Get the account recovery organization key info"},{name:"findAccountRecoveryPolicy",docblock:"fetch the account recovery organization settings",modifiers:["async"],params:[],returns:null,description:"fetch the account recovery organization settings"},{name:"handlePolicyInputChange",docblock:"Handle policy input change.\n@params {ReactEvent} The react event\n@returns {void}",modifiers:["async"],params:[{name:"event",optional:!1}],returns:{type:{name:"void"}},description:"Handle policy input change."},{name:"HandleUpdatePublicKeyClick",docblock:'Handle click on "Rotate key" button',modifiers:[],params:[],returns:null,description:'Handle click on "Rotate key" button'},{name:"handleUpdateOrganizationKey",docblock:"Handle registration in current state of the new Organization public key\n@param {string} publicKey The new organization public key\n@param {string} privateKey (Optional) The new organization private key. Presents if the user generate a key via the UI.",modifiers:["async"],params:[{name:"publicKey",description:"The new organization public key",type:{name:"string"},optional:!1},{name:"privateKey",description:"(Optional) The new organization private key. Presents if the user generate a key via the UI.",type:{name:"string"},optional:!1}],returns:null,description:"Handle registration in current state of the new Organization public key"},{name:"downloadPrivateKey",docblock:"Download the generated organization private key.\n@param {string} privateKey The new organization private key.\n@returns {Promise<void>}",modifiers:["async"],params:[{name:"privateKey",description:"The new organization private key.",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Download the generated organization private key."},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is loading or processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is loading or processing"},{name:"hasOrganisationRecoveryKey",docblock:"Has a recovery key\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Has a recovery key"},{name:"isPolicyEnabled",docblock:"Is policy enabled.\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Is policy enabled."},{name:"resetKeyInfo",docblock:"Reset the key details.",modifiers:[],params:[],returns:null,description:"Reset the key details."},{name:"toggleProcessing",docblock:"Toggle the processing mode",modifiers:["async"],params:[],returns:null,description:"Toggle the processing mode"},{name:"formatFingerprint",docblock:"get fingerprint\n@param fingerprint\n@returns {JSX.Element}",modifiers:[],params:[{name:"fingerprint",optional:!1}],returns:{type:{name:"JSX.Element"}},description:"get fingerprint"},{name:"formatUserIds",docblock:"Format organization key user ids.\n@param user_ids\n@returns {null|*}",modifiers:[],params:[{name:"user_ids",optional:!1}],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Format organization key user ids."},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"ManageAccountRecoveryAdministrationSettings",props:{context:{description:"",type:{name:"object"},required:!1},dialogContext:{description:"",type:{name:"any"},required:!1},administrationWorkspaceContext:{description:"",type:{name:"object"},required:!1},adminAccountRecoveryContext:{description:"",type:{name:"object"},required:!1},t:{description:"",type:{name:"func"},required:!1}}};var ExtAppContext_test_data=__webpack_require__("./src/react-extension/contexts/ExtAppContext.test.data.js");function defaultAdminAccountRecoveryContext(context={}){const defaultKeyInfo={amored_key:"armored-key"},defaultContext={currentPolicy:{policy:"disabled"},policyChanges:{},findAccountRecoveryPolicy:jest.fn(),getKeyInfo:jest.fn((()=>defaultKeyInfo)),hasPolicyChanges:jest.fn(),changePolicy:jest.fn(),changePublicKey:jest.fn(),resetChanges:jest.fn(),save:jest.fn()};return Object.assign(defaultContext,context)}function ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(props={}){const defaultProps1={context:(0,ExtAppContext_test_data.st)(props?.context),administrationWorkspaceContext:{setDisplayAdministrationWorkspaceAction:jest.fn(),resetDisplayAdministrationWorkspaceAction:jest.fn()},adminAccountRecoveryContext:defaultAdminAccountRecoveryContext(props?.adminAccountRecoveryContext)};return delete props.context,delete props.adminAccountRecoveryContext,Object.assign(defaultProps1,props)}const defaultKeyInfo={user_ids:[{name:"Test Test",email:"test@passbolt.com"}],armored_key:"new-public-key",fingerprint:"848E95CC7493129AD862583129B81CA8936023DD",algorithm:"RSA",length:"4096",created:"2022-05-01T13:11:08+00:00",expires:"2024-05-01T13:11:08+00:00"};const ManageAccountRecoveryAdministrationSettings_test_stories={title:"Components/Administration/ManageAccountRecoveryAdministrationSettings",component:ManageAccountRecoveryAdministrationSettings_ManageAccountRecoveryAdministrationSettings},Template=args=>react.createElement(react_router.fS,{initialEntries:["/"]},react.createElement("div",{className:"panel main"},react.createElement("div",{className:"panel middle"},react.createElement("div",{className:"grid grid-responsive-12"},react.createElement(react_router.qh,{component:routerProps=>react.createElement(ManageAccountRecoveryAdministrationSettings_ManageAccountRecoveryAdministrationSettings,{...args,...routerProps})}))))),Default=Template.bind({});Default.args=function disabledPolicyProps(props={}){return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign({adminAccountRecoveryContext:{policyChanges:{policy:"disabled"}}},props))}();const Mandatory=Template.bind({});Mandatory.args=function mandatoryPolicyProps(props={}){return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign({adminAccountRecoveryContext:{policyChanges:{policy:"mandatory"}}},props))}();const OptOut=Template.bind({});OptOut.args=function optOutPolicyProps(props={}){return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign({adminAccountRecoveryContext:{policyChanges:{policy:"opt-out"}}},props))}();const OptIn=Template.bind({});OptIn.args=function optInPolicyProps(props={}){return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign({adminAccountRecoveryContext:{policyChanges:{policy:"opt-in"}}},props))}();const DefaultWithOrganisationRecoveryKey=Template.bind({});DefaultWithOrganisationRecoveryKey.args=function disabledPolicyPropsWithOrganisationKey(props={}){const _props={adminAccountRecoveryContext:{policyChanges:{policy:"disabled",publicKey:"new-public-key"},getKeyInfo:()=>defaultKeyInfo}};return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign(_props,props))}();const MandatoryWithOrganisationRecoveryKey=Template.bind({});MandatoryWithOrganisationRecoveryKey.args=function mandatoryPolicyPropsWithOrganisationKey(props={}){const _props={adminAccountRecoveryContext:{policyChanges:{policy:"mandatory",publicKey:"new-public-key"},getKeyInfo:()=>defaultKeyInfo}};return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign(_props,props))}();const OptOutWithOrganisationRecoveryKey=Template.bind({});OptOutWithOrganisationRecoveryKey.args=function optOutPolicyPropsWithOrganisationKey(props={}){const _props={adminAccountRecoveryContext:{policyChanges:{policy:"opt-out",publicKey:"new-public-key"},getKeyInfo:()=>defaultKeyInfo}};return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign(_props,props))}();const OptInWithOrganisationRecoveryKey=Template.bind({});OptInWithOrganisationRecoveryKey.args=function optInPolicyPropsWithOrganisationKey(props={}){const _props={adminAccountRecoveryContext:{policyChanges:{policy:"opt-in",publicKey:"new-public-key"},getKeyInfo:()=>defaultKeyInfo}};return ManageAccountRecoveryAdministrationSettings_test_data_defaultProps(Object.assign(_props,props))}();const __namedExportsOrder=["Default","Mandatory","OptOut","OptIn","DefaultWithOrganisationRecoveryKey","MandatoryWithOrganisationRecoveryKey","OptOutWithOrganisationRecoveryKey","OptInWithOrganisationRecoveryKey"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...Default.parameters?.docs?.source}}},Mandatory.parameters={...Mandatory.parameters,docs:{...Mandatory.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...Mandatory.parameters?.docs?.source}}},OptOut.parameters={...OptOut.parameters,docs:{...OptOut.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...OptOut.parameters?.docs?.source}}},OptIn.parameters={...OptIn.parameters,docs:{...OptIn.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...OptIn.parameters?.docs?.source}}},DefaultWithOrganisationRecoveryKey.parameters={...DefaultWithOrganisationRecoveryKey.parameters,docs:{...DefaultWithOrganisationRecoveryKey.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...DefaultWithOrganisationRecoveryKey.parameters?.docs?.source}}},MandatoryWithOrganisationRecoveryKey.parameters={...MandatoryWithOrganisationRecoveryKey.parameters,docs:{...MandatoryWithOrganisationRecoveryKey.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...MandatoryWithOrganisationRecoveryKey.parameters?.docs?.source}}},OptOutWithOrganisationRecoveryKey.parameters={...OptOutWithOrganisationRecoveryKey.parameters,docs:{...OptOutWithOrganisationRecoveryKey.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...OptOutWithOrganisationRecoveryKey.parameters?.docs?.source}}},OptInWithOrganisationRecoveryKey.parameters={...OptInWithOrganisationRecoveryKey.parameters,docs:{...OptInWithOrganisationRecoveryKey.parameters?.docs,source:{originalSource:'args => <MemoryRouter initialEntries={[\'/\']}>\n    <div className="panel main">\n      <div className="panel middle">\n        <div className="grid grid-responsive-12">\n          <Route component={routerProps => <ManageAccountRecoveryAdministrationSettings {...args} {...routerProps} />}></Route>\n        </div>\n      </div>\n    </div>\n  </MemoryRouter>',...OptInWithOrganisationRecoveryKey.parameters?.docs?.source}}}},"./src/react-extension/components/Administration/SelectAccountRecoveryOrganizationKey/DownloadOrganizationKey.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_3__),react_i18next__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/components/Common/Dialog/DialogWrapper/DialogWrapper.js");class DownloadOrganizationKey extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindCallbacks()}get defaultState(){return{processing:!1}}bindCallbacks(){this.handleCloseClick=this.handleCloseClick.bind(this)}handleCloseClick(){this.props.onClose()}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_2__.A,{title:this.props.t("Confirm Organization Recovery Key download"),onClose:this.handleCloseClick,disabled:!1,className:"organization-recover-key-download-dialog"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"dialog-body"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"A download of the organization private key has automatically started."),react__WEBPACK_IMPORTED_MODULE_0__.createElement("br",null),react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Make sure your print it or store it in a safe place. You may need it later!"))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"dialog-footer clearfix"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{className:"button button-left cancel medium",type:"button",onClick:this.props.handleDownloadAgain},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Download again")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{className:"button primary",type:"button",onClick:this.handleCloseClick,disabled:this.isProcessing},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_1__.x6,null,"Ok")))))}}DownloadOrganizationKey.propTypes={onClose:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,handleDownloadAgain:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func,privateKey:prop_types__WEBPACK_IMPORTED_MODULE_3___default().string,t:prop_types__WEBPACK_IMPORTED_MODULE_3___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,react_i18next__WEBPACK_IMPORTED_MODULE_1__.CI)("common")(DownloadOrganizationKey);DownloadOrganizationKey.__docgenInfo={description:"This component allows to display the create recover account for the administration",methods:[{name:"defaultState",docblock:"Get default state\n@returns {*}",modifiers:["get"],params:[],returns:{type:{name:"mixed"}},description:"Get default state"},{name:"bindCallbacks",docblock:"Bind callbacks methods",modifiers:[],params:[],returns:null,description:"Bind callbacks methods"},{name:"handleCloseClick",docblock:"Handle close button click.",modifiers:[],params:[],returns:null,description:"Handle close button click."}],displayName:"DownloadOrganizationKey",props:{onClose:{description:"",type:{name:"func"},required:!1},handleDownloadAgain:{description:"",type:{name:"func"},required:!1},privateKey:{description:"",type:{name:"string"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-extension/contexts/AccountRecoveryUserContext.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Le:()=>withAccountRecovery,On:()=>AccountRecoveryUserContextProvider});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js");const AccountRecoveryUserContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({accountRecoveryOrganizationPolicy:null,status:null,isDataLoaded:!1,findAccountRecoveryPolicy:()=>{},getOrganizationPolicy:()=>{},getRequestor:()=>{},getRequestedDate:()=>{},getPolicy:()=>{},getUserAccountRecoverySubscriptionStatus:()=>{},isAccountRecoveryChoiceRequired:()=>{},isPolicyEnabled:()=>{},loadAccountRecoveryPolicy:()=>{},reloadAccountRecoveryPolicy:()=>{},isReady:()=>{}});class AccountRecoveryUserContextProvider extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState}get defaultState(){return{accountRecoveryOrganizationPolicy:null,status:null,isDataLoaded:!1,findAccountRecoveryPolicy:this.findAccountRecoveryPolicy.bind(this),getOrganizationPolicy:this.getOrganizationPolicy.bind(this),getRequestor:this.getRequestor.bind(this),getRequestedDate:this.getRequestedDate.bind(this),getPolicy:this.getPolicy.bind(this),getUserAccountRecoverySubscriptionStatus:this.getUserAccountRecoverySubscriptionStatus.bind(this),setUserAccountRecoveryStatus:this.setUserAccountRecoveryStatus.bind(this),isAccountRecoveryChoiceRequired:this.isAccountRecoveryChoiceRequired.bind(this),isPolicyEnabled:this.isPolicyEnabled.bind(this),loadAccountRecoveryPolicy:this.loadAccountRecoveryPolicy.bind(this),reloadAccountRecoveryPolicy:this.reloadAccountRecoveryPolicy.bind(this),isReady:this.isReady.bind(this)}}async loadAccountRecoveryPolicy(){this.state.isDataLoaded||await this.findAccountRecoveryPolicy()}async reloadAccountRecoveryPolicy(){await this.findAccountRecoveryPolicy()}async findAccountRecoveryPolicy(){if(!this.props.context.siteSettings.canIUse("accountRecovery"))return;const loggedInUser=this.props.context.loggedInUser;if(!loggedInUser)return;const accountRecoveryOrganizationPolicy=await this.props.accountRecoveryUserService.getOrganizationAccountRecoverySettings(),status=loggedInUser.account_recovery_user_setting?.status||AccountRecoveryUserContextProvider.STATUS_PENDING;this.setState({accountRecoveryOrganizationPolicy,status,isDataLoaded:!0})}isReady(){return this.state.isDataLoaded}getOrganizationPolicy(){return this.state.accountRecoveryOrganizationPolicy}getRequestedDate(){return this.getOrganizationPolicy()?.modified}getRequestor(){return this.getOrganizationPolicy()?.creator}getPolicy(){return this.getOrganizationPolicy()?.policy}getUserAccountRecoverySubscriptionStatus(){return this.state.status}setUserAccountRecoveryStatus(status){this.setState({status})}isAccountRecoveryChoiceRequired(){if(null===this.getOrganizationPolicy())return!1;const policy=this.getPolicy();return this.state.status===AccountRecoveryUserContextProvider.STATUS_PENDING&&policy!==AccountRecoveryUserContextProvider.POLICY_DISABLED}isPolicyEnabled(){const policy=this.getPolicy();return policy&&policy!==AccountRecoveryUserContextProvider.POLICY_DISABLED}static get STATUS_PENDING(){return"pending"}static get POLICY_DISABLED(){return"disabled"}static get POLICY_MANDATORY(){return"mandatory"}static get POLICY_OPT_OUT(){return"opt-out"}static get STATUS_APPROVED(){return"approved"}render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(AccountRecoveryUserContext.Provider,{value:this.state},this.props.children)}}AccountRecoveryUserContextProvider.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_2___default().any.isRequired,children:prop_types__WEBPACK_IMPORTED_MODULE_2___default().any,accountRecoveryUserService:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object.isRequired};(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)(AccountRecoveryUserContextProvider);function withAccountRecovery(WrappedComponent){return class WithAccountRecovery extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(AccountRecoveryUserContext.Consumer,null,(accountRecoveryContext=>react__WEBPACK_IMPORTED_MODULE_0__.createElement(WrappedComponent,{accountRecoveryContext,...this.props})))}}}AccountRecoveryUserContextProvider.__docgenInfo={description:"The related context provider",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"},{name:"loadAccountRecoveryPolicy",docblock:"Run the initial load of the account recovery policy.",modifiers:["async"],params:[],returns:null,description:"Run the initial load of the account recovery policy."},{name:"reloadAccountRecoveryPolicy",docblock:"Reload the account recovery policy regardless of having it cached or not.",modifiers:["async"],params:[],returns:null,description:"Reload the account recovery policy regardless of having it cached or not."},{name:"findAccountRecoveryPolicy",docblock:"Find the account recovery policy",modifiers:["async"],params:[],returns:null,description:"Find the account recovery policy"},{name:"isReady",docblock:"Returns true when the data has been loaded\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Returns true when the data has been loaded"},{name:"getOrganizationPolicy",docblock:"Returns the full organization policy settings.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Returns the full organization policy settings."},{name:"getRequestedDate",docblock:"Get the date at when an administrator asked users to set their account recovery policy setting.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Get the date at when an administrator asked users to set their account recovery policy setting."},{name:"getRequestor",docblock:"Get the user that asked the account recovery policy settings to be set.\n@returns {object}",modifiers:[],params:[],returns:{type:{name:"object"}},description:"Get the user that asked the account recovery policy settings to be set."},{name:"getPolicy",docblock:"Get the organization policy.\n@returns {string}",modifiers:[],params:[],returns:{type:{name:"string"}},description:"Get the organization policy."},{name:"getUserAccountRecoverySubscriptionStatus",docblock:"Get the current user account recovery setting status.\n@returns {string}",modifiers:[],params:[],returns:{type:{name:"string"}},description:"Get the current user account recovery setting status."},{name:"setUserAccountRecoveryStatus",docblock:"Set the current user account recovery setting.\n@param {string} status",modifiers:[],params:[{name:"status",type:{name:"string"},optional:!1}],returns:null,description:"Set the current user account recovery setting."},{name:"isAccountRecoveryChoiceRequired",docblock:'Returns true if the current user has to choose for an account recovery setting.\nIn that case, the organization account recovery setting has to be set with "mandatory" or "opt-out",\nplus the user shouldn\'t have made a choice yet.\n@returns {bool}',modifiers:[],params:[],returns:{type:{name:"bool"}},description:'Returns true if the current user has to choose for an account recovery setting.\nIn that case, the organization account recovery setting has to be set with "mandatory" or "opt-out",\nplus the user shouldn\'t have made a choice yet.'},{name:"isPolicyEnabled",docblock:"Return true if the policy is not set to POLICY_DISABLED\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Return true if the policy is not set to POLICY_DISABLED"},{name:"STATUS_PENDING",docblock:null,modifiers:["static","get"],params:[],returns:null},{name:"POLICY_DISABLED",docblock:null,modifiers:["static","get"],params:[],returns:null},{name:"POLICY_MANDATORY",docblock:null,modifiers:["static","get"],params:[],returns:null},{name:"POLICY_OPT_OUT",docblock:null,modifiers:["static","get"],params:[],returns:null},{name:"STATUS_APPROVED",docblock:null,modifiers:["static","get"],params:[],returns:null}],displayName:"AccountRecoveryUserContextProvider",props:{context:{description:"",type:{name:"any"},required:!0},children:{description:"",type:{name:"any"},required:!1},accountRecoveryUserService:{description:"",type:{name:"object"},required:!0}}}}}]);