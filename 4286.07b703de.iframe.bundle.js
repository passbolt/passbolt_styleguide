/*! For license information please see 4286.07b703de.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkpassbolt_styleguide=self.webpackChunkpassbolt_styleguide||[]).push([[4286],{"./src/react-extension/components/Resource/ImportResources/ImportResources.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_15__),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/react-extension/components/Common/Dialog/DialogWrapper/DialogWrapper.js"),_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormSubmitButton.js"),_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormCancelButton.js"),_ImportResourcesKeyUnlock__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/react-extension/components/Resource/ImportResources/ImportResourcesKeyUnlock.js"),_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/react-extension/contexts/ResourceWorkspaceContext.js"),_ImportResourcesResult__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/react-extension/components/Resource/ImportResources/ImportResourcesResult.js"),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),react_i18next__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_Common_Tooltip_Tooltip__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./src/react-extension/components/Common/Tooltip/Tooltip.js"),_shared_services_rbacs_uiActionEnumeration__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./src/shared/services/rbacs/uiActionEnumeration.js"),_shared_context_Rbac_RbacContext__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./src/shared/context/Rbac/RbacContext.js");class ImportResources extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindHandlers(),this.createReferences()}get defaultState(){return{processing:!1,fileToImport:null,options:{folders:this.canUseFolders,tags:this.canUseTags},errors:{}}}get canUseFolders(){return this.props.context.siteSettings.canIUse("folders")&&this.props.rbacContext.canIUseUiAction(_shared_services_rbacs_uiActionEnumeration__WEBPACK_IMPORTED_MODULE_13__.e.FOLDERS_USE)}get canUseTags(){return this.props.context.siteSettings.canIUse("tags")&&this.props.rbacContext.canIUseUiAction(_shared_services_rbacs_uiActionEnumeration__WEBPACK_IMPORTED_MODULE_13__.e.TAGS_USE)}bindHandlers(){this.handleSelectFile=this.handleSelectFile.bind(this),this.handleFileSelected=this.handleFileSelected.bind(this),this.handleImportOptionFoldersChanged=this.handleImportOptionFoldersChanged.bind(this),this.handleImportOptionTagsChanged=this.handleImportOptionTagsChanged.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}createReferences(){this.fileUploaderRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef()}async componentDidUpdate(previousProps){await this.handleFileToImportChange(previousProps.resourceWorkspaceContext.resourceFileToImport)}hasSubmitButtonDisabled(){return!this.state.fileToImport||this.state.processing}hasAllInputDisabled(){return this.state.processing}get selectedFilename(){return this.state.fileToImport?this.state.fileToImport.name:""}get selectedFileExtension(){const splitFilename=this.state.fileToImport.name.split(".");return splitFilename[splitFilename.length-1]}handleSelectFile(){this.fileUploaderRef.current.click()}async handleFileSelected(event){const[fileToImport]=event.target.files;await this.resetValidation(),this.setState({fileToImport})}async handleImportOptionFoldersChanged(){const options=Object.assign({},this.state.options,{folders:!this.state.options.folders});await this.setState({options})}async handleImportOptionTagsChanged(){const options=Object.assign({},this.state.options,{tags:!this.state.options.tags});await this.setState({options})}async handleFileToImportChange(previousFileToImport){previousFileToImport&&!this.props.resourceWorkspaceContext.resourceFileToImport&&this.close()}handleCancel(){this.props.resourceWorkspaceContext.onResourceFileToImport(null),this.close()}handleSubmit(event){event.preventDefault(),this.state.processing||this.import()}async toggleProcessing(){const prev=this.state.processing;return this.setState({processing:!prev})}close(){this.props.onClose()}toBinary(string){const codeUnits=new Uint16Array(string.length);for(let i=0;i<codeUnits.length;i++)codeUnits[i]=string.charCodeAt(i);return new Uint8Array(codeUnits.buffer).reduce(((data,byte)=>data+String.fromCharCode(byte)),"")}readFileCsv(){const reader=new FileReader;return new Promise(((resolve,reject)=>{reader.onloadend=event=>{try{const file=this.toBinary(event.target.result),fileBase64=btoa(file);resolve(fileBase64)}catch(e){reject(e)}},reader.readAsText(this.state.fileToImport)}))}readFileKdbx(){const reader=new FileReader;return new Promise(((resolve,reject)=>{reader.onloadend=event=>{try{const fileBase64=event.target.result.split(",")[1];resolve(fileBase64)}catch(e){reject(e)}},reader.readAsDataURL(this.state.fileToImport)}))}async import(){const fileType=this.selectedFileExtension,b64FileContent="kdbx"===fileType?await this.readFileKdbx():await this.readFileCsv(),options=Object.assign({},this.state.options,{credentials:{password:null,keyFile:null}});await this.toggleProcessing();try{const importResult=await this.props.context.port.request("passbolt.import-resources.import-file",fileType,b64FileContent,options);this.handleImportSuccess(importResult)}catch(error){this.handleImportError(error,b64FileContent,fileType)}}async handleImportSuccess(importResult){await this.props.resourceWorkspaceContext.onResourceFileImportResult(importResult),await this.props.resourceWorkspaceContext.onResourceFileToImport(null),await this.props.dialogContext.open(_ImportResourcesResult__WEBPACK_IMPORTED_MODULE_8__.A),this.toggleProcessing(),this.close()}handleImportError(error,b64FileContent,fileType){const isUserAbortsOperation="UserAbortsOperationError"===error.name,isKdbxBadSignatureError="KdbxError"===error.name&&"BadSignature"===error.code,isKdbxProtectedError="KdbxError"===error.name&&("InvalidKey"===error.code||"InvalidArg"===error.code),isCsvError="FileFormatError"===error.name;if(this.toggleProcessing(),isUserAbortsOperation);else if(isKdbxProtectedError)this.importProtectedKeepassFile(b64FileContent,fileType),this.close();else if(isKdbxBadSignatureError)this.setState({errors:{invalidKdbxFile:this.translate("Keepass file format not recognized")}});else if(isCsvError)this.setState({errors:{invalidCsvFile:error.message}});else{const errorDialogProps={error};this.props.dialogContext.open(_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_10__.A,errorDialogProps)}}async importProtectedKeepassFile(b64FileContent,fileType){const resourceFileToImport={b64FileContent,fileType,options:this.state.options};await this.props.resourceWorkspaceContext.onResourceFileToImport(resourceFileToImport),this.props.dialogContext.open(_ImportResourcesKeyUnlock__WEBPACK_IMPORTED_MODULE_6__.A)}async resetValidation(){await this.setState({errors:{}})}get translate(){return this.props.t}render(){const errors=this.state.errors,isInvalidCsvFile=errors&&errors.invalidCsvFile,isInvalidKdbxFile=errors&&errors.invalidKdbxFile,invalidFileClassName=isInvalidCsvFile||isInvalidKdbxFile?"errors":"";return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_3__.A,{title:this.translate("Import passwords"),className:"import-password-dialog",disabled:this.hasAllInputDisabled(),onClose:this.handleCancel},react__WEBPACK_IMPORTED_MODULE_0__.createElement("form",{onSubmit:this.handleSubmit},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-content"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:`input file ${this.hasAllInputDisabled()?"disabled":""} ${invalidFileClassName}`},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{type:"file",id:"dialog-import-passwords",ref:this.fileUploaderRef,onChange:this.handleFileSelected,accept:".csv, .kdbx, .kdb"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"dialog-import-passwords"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_11__.x6,null,"Select a file to import")," ",react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Tooltip_Tooltip__WEBPACK_IMPORTED_MODULE_12__.A,{message:this.translate("csv exports from browsers (safari, chrome, edge, brave, opera, vivaldi, firefox, waterfox), keepassx, logmeonce, lastpass, 1password, nordpass, dashlane and bitwarden are supported")},"(",react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",className:"link inline"},"csv"))," ",this.translate("or")," ",react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Tooltip_Tooltip__WEBPACK_IMPORTED_MODULE_12__.A,{message:this.translate("kdbx files are files generated by keepass v2.x")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{type:"button",className:"link inline"},"kdbx"),")")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input-file-inline"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{type:"text",disabled:!0,placeholder:this.translate("No file selected"),defaultValue:this.selectedFilename}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{className:"button primary",type:"button",disabled:this.hasAllInputDisabled(),onClick:this.handleSelectFile},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_11__.x6,null,"Choose a file")))),isInvalidCsvFile&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"error-message"},this.state.errors.invalidCsvFile),isInvalidKdbxFile&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"error-message"},this.state.errors.invalidKdbxFile)),this.canUseTags&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input checkbox"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"dialog-import-passwords-import-tags",type:"checkbox",checked:this.state.options.tags,disabled:this.hasAllInputDisabled(),onChange:this.handleImportOptionTagsChanged}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"dialog-import-passwords-import-tags"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_11__.x6,null,"Add a unique import tag to passwords"))),this.canUseFolders&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input checkbox"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{id:"dialog-import-passwords-import-folders",type:"checkbox",checked:this.state.options.folders,disabled:this.hasAllInputDisabled(),onChange:this.handleImportOptionFoldersChanged}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"dialog-import-passwords-import-folders"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_11__.x6,null,"Import folders"))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"warning message no-margin",id:"import-resources-warning-message"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("p",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_11__.x6,null,"Checkout the ",react__WEBPACK_IMPORTED_MODULE_0__.createElement("a",{href:"https://www.passbolt.com/docs/user/basic-features/browser/import/",target:"_blank",rel:"noopener noreferrer"},"documentation")," to see what information is supported."))))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"submit-wrapper clearfix"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_5__.A,{disabled:this.hasAllInputDisabled(),onClick:this.handleCancel}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_4__.A,{value:this.translate("Import"),disabled:this.hasSubmitButtonDisabled(),processing:this.state.processing}))))}}ImportResources.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_15___default().any,rbacContext:prop_types__WEBPACK_IMPORTED_MODULE_15___default().any,onClose:prop_types__WEBPACK_IMPORTED_MODULE_15___default().func,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_15___default().any,dialogContext:prop_types__WEBPACK_IMPORTED_MODULE_15___default().any,resourceWorkspaceContext:prop_types__WEBPACK_IMPORTED_MODULE_15___default().any,t:prop_types__WEBPACK_IMPORTED_MODULE_15___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_9__.L)((0,_shared_context_Rbac_RbacContext__WEBPACK_IMPORTED_MODULE_14__.x6)((0,_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_7__.Qw)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_1__.ot)((0,_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_2__.z9)((0,react_i18next__WEBPACK_IMPORTED_MODULE_11__.CI)("common")(ImportResources))))));ImportResources.__docgenInfo={description:"",methods:[{name:"defaultState",docblock:"Returns the default state",modifiers:["get"],params:[],returns:null,description:"Returns the default state"},{name:"canUseFolders",docblock:"Check if the user can use folders.\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Check if the user can use folders."},{name:"canUseTags",docblock:"Check if the user can use tags.\n@returns {boolean}",modifiers:["get"],params:[],returns:{type:{name:"boolean"}},description:"Check if the user can use tags."},{name:"bindHandlers",docblock:"Bind component handlers",modifiers:[],params:[],returns:null,description:"Bind component handlers"},{name:"createReferences",docblock:"Create elements references",modifiers:[],params:[],returns:null,description:"Create elements references"},{name:"hasSubmitButtonDisabled",docblock:"Returns true if the submit button should be disabled",modifiers:[],params:[],returns:null,description:"Returns true if the submit button should be disabled"},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is processing"},{name:"selectedFilename",docblock:"Returns the selected file's name",modifiers:["get"],params:[],returns:null,description:"Returns the selected file's name"},{name:"selectedFileExtension",docblock:"Returns the extension of the selected file",modifiers:["get"],params:[],returns:null,description:"Returns the extension of the selected file"},{name:"handleSelectFile",docblock:"Handle the selection of a file by file explorer",modifiers:[],params:[],returns:null,description:"Handle the selection of a file by file explorer"},{name:"handleFileSelected",docblock:"Handle the event that a file has been selected\n@param event A dom event",modifiers:["async"],params:[{name:"event",description:"A dom event",optional:!1}],returns:null,description:"Handle the event that a file has been selected"},{name:"handleImportOptionFoldersChanged",docblock:"Handle the change of import folders option",modifiers:["async"],params:[],returns:null,description:"Handle the change of import folders option"},{name:"handleImportOptionTagsChanged",docblock:"Handle the change of unique tag options",modifiers:["async"],params:[],returns:null,description:"Handle the change of unique tag options"},{name:"handleFileToImportChange",docblock:"Whenever the contextual file to import has changed\n@param previousFileToImport The previous file to import",modifiers:["async"],params:[{name:"previousFileToImport",description:"The previous file to import",optional:!1}],returns:null,description:"Whenever the contextual file to import has changed"},{name:"handleCancel",docblock:"Handle the cancellation of the import",modifiers:[],params:[],returns:null,description:"Handle the cancellation of the import"},{name:"handleSubmit",docblock:"Handle the import submit event\n@param event A dom event",modifiers:[],params:[{name:"event",description:"A dom event",optional:!1}],returns:null,description:"Handle the import submit event"},{name:"toggleProcessing",docblock:"Toggle processing state\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Toggle processing state"},{name:"close",docblock:"Close the dialog",modifiers:[],params:[],returns:null,description:"Close the dialog"},{name:"toBinary",docblock:"Convert a Unicode string to a string in which\neach 16-bit unit occupies only one byte\n@param string\n@returns {string}",modifiers:[],params:[{name:"string",optional:!1}],returns:{type:{name:"string"}},description:"Convert a Unicode string to a string in which\neach 16-bit unit occupies only one byte"},{name:"readFileCsv",docblock:"Read the selected CSV file and returns its content in a base 64",modifiers:[],params:[],returns:null,description:"Read the selected CSV file and returns its content in a base 64"},{name:"readFileKdbx",docblock:"Read the selected KDBX file and returns its content in a base 64\n@return {Promise<string>}",modifiers:[],params:[],returns:{type:{name:"Promise",elements:[{name:"string"}]}},description:"Read the selected KDBX file and returns its content in a base 64"},{name:"import",docblock:"Import the selected file with its given base 64 content",modifiers:["async"],params:[],returns:null,description:"Import the selected file with its given base 64 content"},{name:"handleImportSuccess",docblock:"Handle import success\n@param {Object} importResult The import restult",modifiers:["async"],params:[{name:"importResult",description:"The import restult",type:{name:"Object"},optional:!1}],returns:null,description:"Handle import success"},{name:"handleImportError",docblock:"Handle import error.\n@param {Object} error The error returned by the background page\n@param {string} b64FileContent The base 64 file content\n@param {string} fileType The file type",modifiers:[],params:[{name:"error",description:"The error returned by the background page",type:{name:"Object"},optional:!1},{name:"b64FileContent",description:"The base 64 file content",type:{name:"string"},optional:!1},{name:"fileType",description:"The file type",type:{name:"string"},optional:!1}],returns:null,description:"Handle import error."},{name:"importProtectedKeepassFile",docblock:"Import a KDBX file\n@param {string} b64FileContent The base 64 file content\n@param {string} fileType The file type\n@return {Promise}",modifiers:["async"],params:[{name:"b64FileContent",description:"The base 64 file content",type:{name:"string"},optional:!1},{name:"fileType",description:"The file type",type:{name:"string"},optional:!1}],returns:{type:{name:"Promise"}},description:"Import a KDBX file"},{name:"resetValidation",docblock:"Reset the validation process",modifiers:["async"],params:[],returns:null,description:"Reset the validation process"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"ImportResources",props:{context:{description:"",type:{name:"any"},required:!1},rbacContext:{description:"",type:{name:"any"},required:!1},onClose:{description:"",type:{name:"func"},required:!1},actionFeedbackContext:{description:"",type:{name:"any"},required:!1},dialogContext:{description:"",type:{name:"any"},required:!1},resourceWorkspaceContext:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}},"./src/react-extension/components/Resource/ImportResources/ImportResourcesKeyUnlock.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/prop-types/index.js"),prop_types__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_12__),_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/shared/context/AppContext/AppContext.js"),_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/react-extension/contexts/ActionFeedbackContext.js"),_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/react-extension/contexts/DialogContext.js"),_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/react-extension/components/Common/Dialog/DialogWrapper/DialogWrapper.js"),_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormSubmitButton.js"),_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/react-extension/components/Common/Inputs/FormSubmitButton/FormCancelButton.js"),_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/react-extension/contexts/ResourceWorkspaceContext.js"),_ImportResourcesResult__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/react-extension/components/Resource/ImportResources/ImportResourcesResult.js"),_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./src/react-extension/components/Common/Error/NotifyError/NotifyError.js"),react_i18next__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),_shared_components_Password_Password__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/shared/components/Password/Password.js");class ImportResourcesKeyUnlock extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(props){super(props),this.state=this.defaultState,this.bindHandlers(),this.createReferences()}get defaultState(){return{processing:!1,password:"",keyFile:null,errors:{}}}bindHandlers(){this.handleSelectFile=this.handleSelectFile.bind(this),this.handleFileSelected=this.handleFileSelected.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}createReferences(){this.fileUploaderRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef(),this.passwordInputRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef()}get selectedFilename(){return this.state.keyFile?this.state.keyFile.name:""}get fileToImport(){return this.props.resourceWorkspaceContext.resourceFileToImport}handleSelectFile(){this.fileUploaderRef.current.click()}async handleFileSelected(event){const[keyFile]=event.target.files;await this.setState({keyFile})}handleInputChange(event){const target=event.target,value=target.value,name=target.name;this.setState({[name]:value})}handleCancel(){this.props.resourceWorkspaceContext.onResourceFileToImport(null),this.close()}async handleSubmit(event){event.preventDefault(),this.state.processing||this.import()}readFile(){if(!this.state.keyFile)return;const reader=new FileReader;return new Promise(((resolve,reject)=>{reader.onloadend=event=>{try{const fileBase64=event.target.result.split(",")[1];resolve(fileBase64)}catch(e){reject(e)}},reader.readAsDataURL(this.state.keyFile)}))}async import(){const resourceFileToImport=this.fileToImport,b64FileContent=resourceFileToImport.b64FileContent,fileType=resourceFileToImport.fileType,password=this.state.password,keyfile=await this.readFile(),options=Object.assign({},resourceFileToImport.options,{credentials:{password,keyfile}});this.toggleProcessing(),await this.resetValidation();try{const result=await this.props.context.port.request("passbolt.import-resources.import-file",fileType,b64FileContent,options);this.handleImportSuccess(result)}catch(error){this.handleImportError(error)}}async resetValidation(){await this.setState({errors:{}})}async handleImportSuccess(importResult){await this.props.resourceWorkspaceContext.onResourceFileImportResult(importResult),await this.props.resourceWorkspaceContext.onResourceFileToImport(null),await this.props.dialogContext.open(_ImportResourcesResult__WEBPACK_IMPORTED_MODULE_8__.A),this.close()}handleImportError(error){const userAbortsOperation="UserAbortsOperationError"===error.name,isInvalidPasswordOrKeyFile="InvalidKey"===error.code||"InvalidArg"===error.code;if(this.toggleProcessing(),userAbortsOperation);else if(isInvalidPasswordOrKeyFile)this.setState({errors:{invalidPasswordOrKeyfile:!0}});else{const errorDialogProps={error};this.props.dialogContext.open(_Common_Error_NotifyError_NotifyError__WEBPACK_IMPORTED_MODULE_9__.A,errorDialogProps)}}close(){this.props.onClose()}async toggleProcessing(){const prev=this.state.processing;return this.setState({processing:!prev})}hasAllInputDisabled(){return this.state.processing}get translate(){return this.props.t}render(){const errors=this.state.errors,isInvalidPasswordOrKeyFile=errors&&errors.invalidPasswordOrKeyfile;return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Dialog_DialogWrapper_DialogWrapper__WEBPACK_IMPORTED_MODULE_4__.A,{title:this.translate("Enter the password and/or key file"),className:"import-password-dialog",disabled:this.hasAllInputDisabled(),onClose:this.handleCancel},react__WEBPACK_IMPORTED_MODULE_0__.createElement("form",{onSubmit:this.handleSubmit},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"form-content"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input-password-wrapper input "+(this.hasAllInputDisabled()?"disabled":"")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"import-password-dialog-password"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_10__.x6,null,"Keepass password")),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_components_Password_Password__WEBPACK_IMPORTED_MODULE_11__.A,{id:"import-password-dialog-password",name:"password",autoComplete:"off",value:this.state.password,onChange:this.handleInputChange,disabled:this.hasAllInputDisabled(),placeholder:this.translate("Passphrase"),preview:!0,inputRef:this.passwordInputRef})),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input file "+(this.hasAllInputDisabled()?"disabled":"")},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{type:"file",id:"dialog-import-passwords",ref:this.fileUploaderRef,onChange:this.handleFileSelected}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("label",{htmlFor:"dialog-import-passwords"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_10__.x6,null,"Keepass key file (optional)")),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"input-file-inline"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("input",{type:"text",placeholder:this.translate("No key file selected"),disabled:!0,value:this.selectedFilename}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("button",{className:"button primary",type:"button",disabled:this.hasAllInputDisabled(),onClick:this.handleSelectFile},react__WEBPACK_IMPORTED_MODULE_0__.createElement("span",null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_10__.x6,null,"Choose a file")))),isInvalidPasswordOrKeyFile&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"error-message"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_i18next__WEBPACK_IMPORTED_MODULE_10__.x6,null,"Cannot decrypt the file, invalid credentials.")))),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"submit-wrapper clearfix"},react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormCancelButton__WEBPACK_IMPORTED_MODULE_6__.A,{disabled:this.hasAllInputDisabled(),onClick:this.handleCancel}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_Common_Inputs_FormSubmitButton_FormSubmitButton__WEBPACK_IMPORTED_MODULE_5__.A,{value:this.translate("Continue import"),disabled:this.hasAllInputDisabled(),processing:this.state.processing}))))}}ImportResourcesKeyUnlock.propTypes={context:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,onClose:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func,actionFeedbackContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,dialogContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,resourceWorkspaceContext:prop_types__WEBPACK_IMPORTED_MODULE_12___default().any,t:prop_types__WEBPACK_IMPORTED_MODULE_12___default().func};const __WEBPACK_DEFAULT_EXPORT__=(0,_shared_context_AppContext_AppContext__WEBPACK_IMPORTED_MODULE_1__.L)((0,_contexts_ResourceWorkspaceContext__WEBPACK_IMPORTED_MODULE_7__.Qw)((0,_contexts_ActionFeedbackContext__WEBPACK_IMPORTED_MODULE_2__.ot)((0,_contexts_DialogContext__WEBPACK_IMPORTED_MODULE_3__.z9)((0,react_i18next__WEBPACK_IMPORTED_MODULE_10__.CI)("common")(ImportResourcesKeyUnlock)))));ImportResourcesKeyUnlock.__docgenInfo={description:"This component is the second step of the import dialog when the file to import is KDB(X) file",methods:[{name:"defaultState",docblock:"Returns the default component state",modifiers:["get"],params:[],returns:null,description:"Returns the default component state"},{name:"bindHandlers",docblock:"Bind component handlers",modifiers:[],params:[],returns:null,description:"Bind component handlers"},{name:"createReferences",docblock:"Create elements references",modifiers:[],params:[],returns:null,description:"Create elements references"},{name:"selectedFilename",docblock:"Returns the selected file's name",modifiers:["get"],params:[],returns:null,description:"Returns the selected file's name"},{name:"fileToImport",docblock:"Returns the current file to import",modifiers:["get"],params:[],returns:null,description:"Returns the current file to import"},{name:"handleSelectFile",docblock:"Handle the selection of a file by file explorer",modifiers:[],params:[],returns:null,description:"Handle the selection of a file by file explorer"},{name:"handleFileSelected",docblock:"Handle the event that a file has been selected\n@param event A dom event",modifiers:["async"],params:[{name:"event",description:"A dom event",optional:!1}],returns:null,description:"Handle the event that a file has been selected"},{name:"handleInputChange",docblock:"Handle input change\n@param event",modifiers:[],params:[{name:"event",optional:!1}],returns:null,description:"Handle input change"},{name:"handleCancel",docblock:"Handle the cancellation of the import",modifiers:[],params:[],returns:null,description:"Handle the cancellation of the import"},{name:"handleSubmit",docblock:"Handle the import submit event\n@param event A dom event",modifiers:["async"],params:[{name:"event",description:"A dom event",optional:!1}],returns:null,description:"Handle the import submit event"},{name:"readFile",docblock:"Read the selected file and returns its content in a base 64\n@return {Promise<string>}",modifiers:[],params:[],returns:{type:{name:"Promise",elements:[{name:"string"}]}},description:"Read the selected file and returns its content in a base 64"},{name:"import",docblock:"Import the resource file",modifiers:["async"],params:[],returns:null,description:"Import the resource file"},{name:"resetValidation",docblock:"Reset the validation process",modifiers:["async"],params:[],returns:null,description:"Reset the validation process"},{name:"handleImportSuccess",docblock:"Handle the success of the KDBX import\n@parama importResult The import result",modifiers:["async"],params:[{name:"importResult",optional:!1}],returns:null,description:"Handle the success of the KDBX import"},{name:"handleImportError",docblock:"Handle the failure of the KDBX import\n@param error The import error",modifiers:[],params:[{name:"error",description:"The import error",optional:!1}],returns:null,description:"Handle the failure of the KDBX import"},{name:"close",docblock:"Close the dialog",modifiers:[],params:[],returns:null,description:"Close the dialog"},{name:"toggleProcessing",docblock:"Toggle processing state\n@returns {Promise<void>}",modifiers:["async"],params:[],returns:{type:{name:"Promise",elements:[{name:"void"}]}},description:"Toggle processing state"},{name:"hasAllInputDisabled",docblock:"Should input be disabled? True if state is processing\n@returns {boolean}",modifiers:[],params:[],returns:{type:{name:"boolean"}},description:"Should input be disabled? True if state is processing"},{name:"translate",docblock:"Get the translate function\n@returns {function(...[*]=)}",modifiers:["get"],params:[],returns:{},description:"Get the translate function"}],displayName:"ImportResourcesKeyUnlock",props:{context:{description:"",type:{name:"any"},required:!1},onClose:{description:"",type:{name:"func"},required:!1},actionFeedbackContext:{description:"",type:{name:"any"},required:!1},dialogContext:{description:"",type:{name:"any"},required:!1},resourceWorkspaceContext:{description:"",type:{name:"any"},required:!1},t:{description:"",type:{name:"func"},required:!1}}}}}]);